\begin{lemma} \label{lemma-sheaf-differentials} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. The sheaf of differentials of $R$ seen as a scheme over $U$ via $t$ is a quotient of the pullback via $t$ of the conormal sheaf of the immersion $e : U \to R$. In a formula: there is a canonical surjection $t^*\mathcal{C}_{U/R} \to \Omega_{R/U}$. If $s$ is flat, then this map is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-first-order-structure-c} The map $I/I^2 \to J/J^2$ induced by $c$ is the composition $$ I/I^2 \xrightarrow{(1, 1)} I/I^2 \oplus I/I^2 \to J/J^2 $$ where the second arrow comes from the equality $J = (I \otimes B + B \otimes I)C$. The map $i : B \to B$ induces the map $-1 : I/I^2 \to I/I^2$. \end{lemma} 
\begin{lemma} \label{lemma-local-source} Let $S$ be a scheme. Let $(U, R, s, t, c, e, i)$ be a groupoid over $S$. Let $g : U' \to U$ be a morphism of schemes. Denote $h$ the composition $$ \xymatrix{ h : U' \times_{g, U, t} R \ar[r]_-{\text{pr}_1} & R \ar[r]_s & U. } $$ Let $\mathcal{P}, \mathcal{Q}, \mathcal{R}$ be properties of morphisms of schemes. Assume \begin{enumerate} \item $\mathcal{R} \Rightarrow \mathcal{Q}$, \item $\mathcal{Q}$ is preserved under base change and composition, \item for any morphism $f : X \to Y$ which has $\mathcal{Q}$ there exists a largest open $W(\mathcal{P}, f) \subset X$ such that $f|_{W(\mathcal{P}, f)}$ has $\mathcal{P}$, and \item for any morphism $f : X \to Y$ which has $\mathcal{Q}$, and any morphism $Y' \to Y$ which has $\mathcal{R}$ we have $Y' \times_Y W(\mathcal{P}, f) = W(\mathcal{P}, f')$, where $f' : X_{Y'} \to Y'$ is the base change of $f$. \end{enumerate} If $s, t$ have $\mathcal{R}$ and $g$ has $\mathcal{Q}$, then there exists an open subscheme $W \subset U'$ such that $W \times_{g, U, t} R = W(\mathcal{P}, h)$. \end{lemma} 
\begin{lemma} \label{lemma-property-invariant} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Let $\tau \in \{Zariski, \linebreak[0] fppf, \linebreak[0] \etale, \linebreak[0] smooth, \linebreak[0] syntomic\}$\footnote{The fact that $fpqc$ is missing is not a typo.}. Let $\mathcal{P}$ be a property of morphisms of schemes which is $\tau$-local on the target (Descent, Definition \ref{descent-definition-property-morphisms-local}). Assume $\{s : R \to U\}$ and $\{t : R \to U\}$ are coverings for the $\tau$-topology. Let $W \subset U$ be the maximal open subscheme such that $s|_{s^{-1}(W)} : s^{-1}(W) \to W$ has property $\mathcal{P}$. Then $W$ is $R$-invariant, see Groupoids, Definition \ref{groupoids-definition-invariant-open}. \end{lemma} 
\begin{lemma} \label{lemma-property-G-invariant} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Let $G \to U$ be its stabilizer group scheme. Let $\tau \in \{fppf, \linebreak[0] \etale, \linebreak[0] smooth, \linebreak[0] syntomic\}$. Let $\mathcal{P}$ be a property of morphisms which is $\tau$-local on the target. Assume $\{s : R \to U\}$ and $\{t : R \to U\}$ are coverings for the $\tau$-topology. Let $W \subset U$ be the maximal open subscheme such that $G_W \to W$ has property $\mathcal{P}$. Then $W$ is $R$-invariant (see Groupoids, Definition \ref{groupoids-definition-invariant-open}). \end{lemma} 
\begin{lemma} \label{lemma-two-fibres} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Let $r, r' \in R$ with $t(r) = t(r')$ in $U$. Set $u = s(r)$, $u' = s(r')$. Denote $F_u = s^{-1}(u)$ and $F_{u'} = s^{-1}(u')$ the scheme theoretic fibres. \begin{enumerate} \item There exists a common field extension $\kappa(u) \subset k$, $\kappa(u') \subset k$ and an isomorphism $(F_u)_k \cong (F_{u'})_k$. \item We may choose the isomorphism of (1) such that a point lying over $r$ maps to a point lying over $r'$. \item If the morphisms $s$, $t$ are flat then the morphisms of germs $s : (R, r) \to (U, u)$ and $s : (R, r') \to (U, u')$ are flat locally on the base isomorphic. \item If the morphisms $s$, $t$ are \'etale (resp.\ smooth, syntomic, or flat and locally of finite presentation) then the morphisms of germs $s : (R, r) \to (U, u)$ and $s : (R, r') \to (U, u')$ are locally on the base isomorphic in the \'etale (resp.\ smooth, syntomic, or fppf) topology. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-make-CM} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Assume $s$ and $t$ are flat and locally of finite presentation. Then there exists an open $U' \subset U$ such that \begin{enumerate} \item $t^{-1}(U') \subset R$ is the largest open subscheme of $R$ on which the morphism $s$ is Cohen-Macaulay, \item $s^{-1}(U') \subset R$ is the largest open subscheme of $R$ on which the morphism $t$ is Cohen-Macaulay, \item the morphism $t|_{s^{-1}(U')} : s^{-1}(U') \to U$ is surjective, \item the morphism $s|_{t^{-1}(U')} : t^{-1}(U') \to U$ is surjective, and \item the restriction $R' = s^{-1}(U') \cap t^{-1}(U')$ of $R$ to $U'$ defines a groupoid $(U', R', s', t', c')$ which has the property that the morphisms $s'$ and $t'$ are Cohen-Macaulay and locally of finite presentation. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-restrict-preserves-type} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ be a morphism of schemes. Let $(U', R', s', t', c')$ be the restriction of $(U, R, s, t, c)$ via $g$. \begin{enumerate} \item If $s, t$ are locally of finite type and $g$ is locally of finite type, then $s', t'$ are locally of finite type. \item If $s, t$ are locally of finite presentation and $g$ is locally of finite presentation, then $s', t'$ are locally of finite presentation. \item If $s, t$ are flat and $g$ is flat, then $s', t'$ are flat. \item Add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-restrict-property} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ be a morphism of schemes. Let $(U', R', s', t', c')$ be the restriction of $(U, R, s, t, c)$ via $g$, and let $h = s \circ \text{pr}_1 : U' \times_{g, U, t} R \to U$. If $\mathcal{P}$ is a property of morphisms of schemes such that \begin{enumerate} \item $h$ has property $\mathcal{P}$, and \item $\mathcal{P}$ is preserved under base change, \end{enumerate} then $s', t'$ have property $\mathcal{P}$. \end{lemma} 
\begin{lemma} \label{lemma-double-restrict} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ and $g' : U'' \to U'$ be morphisms of schemes. Set $g'' = g \circ g'$. Let $(U', R', s', t', c')$ be the restriction of $R$ to $U'$. Let $h = s \circ \text{pr}_1 : U' \times_{g, U, t} R \to U$, let $h' = s' \circ \text{pr}_1 : U'' \times_{g', U', t} R \to U'$, and let $h'' = s \circ \text{pr}_1 : U'' \times_{g'', U, t} R \to U$. The following diagram is commutative $$ \xymatrix{ U'' \times_{g', U', t} R' \ar[d]^{h'} & (U' \times_{g, U, t} R) \times_U (U'' \times_{g'', U, t} R) \ar[l] \ar[r] \ar[d] & U'' \times_{g'', U, t} R \ar[d]_{h''} \\ U' & U' \times_{g, U, t} R \ar[l]_{\text{pr}_0} \ar[r]^h & U } $$ with both squares cartesian where the left upper horizontal arrow is given by the rule $$ \begin{matrix} (U' \times_{g, U, t} R) \times_U (U'' \times_{g'', U, t} R) & \longrightarrow & U'' \times_{g', U', t} R' \\ ((u', r_0), (u'', r_1)) & \longmapsto & (u'', (c(r_1, i(r_0)), (g'(u''), u'))) \end{matrix} $$ with notation as explained in the proof. \end{lemma} 
\begin{lemma} \label{lemma-double-restrict-property} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ and $g' : U'' \to U'$ be morphisms of schemes. Set $g'' = g \circ g'$. Let $(U', R', s', t', c')$ be the restriction of $R$ to $U'$. Let $h = s \circ \text{pr}_1 : U' \times_{g, U, t} R \to U$, let $h' = s' \circ \text{pr}_1 : U'' \times_{g', U', t} R \to U'$, and let $h'' = s \circ \text{pr}_1 : U'' \times_{g'', U, t} R \to U$. Let $\tau \in \{Zariski, \linebreak[0] \etale, \linebreak[0] smooth, \linebreak[0] syntomic, \linebreak[0] fppf, \linebreak[0] fpqc\}$. Let $\mathcal{P}$ be a property of morphisms of schemes which is preserved under base change, and which is local on the target for the $\tau$-topology. If \begin{enumerate} \item $h(U' \times_U R)$ is open in $U$, \item $\{h : U' \times_U R \to h(U' \times_U R)\}$ is a $\tau$-covering, \item $h'$ has property $\mathcal{P}$, \end{enumerate} then $h''$ has property $\mathcal{P}$. Conversely, if \begin{enumerate} \item[(a)] $\{t : R \to U\}$ is a $\tau$-covering, \item[(d)] $h''$ has property $\mathcal{P}$, \end{enumerate} then $h'$ has property $\mathcal{P}$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-open-multiplication} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. If $U$ is the spectrum of a field, then the composition morphism $c : R \times_{s, U, t} R \to R$ is open. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-separated} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. If $U$ is the spectrum of a field, then $R$ is a separated scheme. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-homogeneous} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. For any points $r, r' \in R$ there exists a field extension $k'/k$ and points $r_1, r_2 \in R \times_{s, \Spec(k)} \Spec(k')$ and a diagram $$ \xymatrix{ R & R \times_{s, \Spec(k)} \Spec(k') \ar[l]_-{\text{pr}_0} \ar[r]^\varphi & R \times_{s, \Spec(k)} \Spec(k') \ar[r]^-{\text{pr}_0} & R } $$ such that $\varphi$ is an isomorphism of schemes over $\Spec(k')$, we have $\varphi(r_1) = r_2$, $\text{pr}_0(r_1) = r$, and $\text{pr}_0(r_2) = r'$. \end{lemma} 
\begin{lemma} \label{lemma-restrict-groupoid-on-field} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. Let $k'/k$ be a field extension, $U' = \Spec(k')$ and let $(U', R', s', t', c')$ be the restriction of $(U, R, s, t, c)$ via $U' \to U$. In the defining diagram $$ \xymatrix{ R' \ar[d] \ar[r] \ar@/_3pc/[dd]_{t'} \ar@/^1pc/[rr]^{s'} \ar@{..>}[rd] & R \times_{s, U} U' \ar[r] \ar[d] & U' \ar[d] \\ U' \times_{U, t} R \ar[d] \ar[r] & R \ar[r]^s \ar[d]_t & U \\ U' \ar[r] & U } $$ all the morphisms are surjective, flat, and universally open. The dotted arrow $R' \to R$ is in addition affine. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-explain-points} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. For any point $r \in R$ there exist \begin{enumerate} \item a field extension $k'/k$ with $k'$ algebraically closed, \item a point $r' \in R'$ where $(U', R', s', t', c')$ is the restriction of $(U, R, s, t, c)$ via $\Spec(k') \to \Spec(k)$ \end{enumerate} such that \begin{enumerate} \item the point $r'$ maps to $r$ under the morphism $R' \to R$, and \item the maps $s', t' : R' \to \Spec(k')$ induce isomorphisms $k' \to \kappa(r')$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-move-point} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. If $r \in R$ is a point such that $s, t$ induce isomorphisms $k \to \kappa(r)$, then the map $$ R \longrightarrow R, \quad x \longmapsto c(r, x) $$ (see proof for precise notation) is an automorphism $R \to R$ which maps $e$ to $r$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-translate-open} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. If $U$ is the spectrum of a field, $W \subset R$ is open, and $Z \to R$ is a morphism of schemes, then the image of the composition $Z \times_{s, U, t} W \to R \times_{s, U, t} R \to R$ is open. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-geometrically-irreducible} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. By abuse of notation denote $e \in R$ the image of the identity morphism $e : U \to R$. Then \begin{enumerate} \item every local ring $\mathcal{O}_{R, r}$ of $R$ has a unique minimal prime ideal, \item there is exactly one irreducible component $Z$ of $R$ passing through $e$, and \item $Z$ is geometrically irreducible over $k$ via either $s$ or $t$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-locally-finite-type-dimension} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. Assume $s, t$ are locally of finite type. Then \begin{enumerate} \item $R$ is equidimensional, \item $\dim(R) = \dim_r(R)$ for all $r \in R$, \item for any $r \in R$ we have $\text{trdeg}_{s(k)}(\kappa(r)) = \text{trdeg}_{t(k)}(\kappa(r))$, and \item for any closed point $r \in R$ we have $\dim(R) = \dim(\mathcal{O}_{R, r})$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-dimension-equal-stabilizer} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(k)$ with $k$ a field. Assume $s, t$ are locally of finite type. Then $\dim(R) = \dim(G)$ where $G$ is the stabilizer group scheme of $R$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-characteristic-zero-smooth} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume \begin{enumerate} \item $U = \Spec(k)$ with $k$ a field, \item $s, t$ are locally of finite type, and \item the characteristic of $k$ is zero. \end{enumerate} Then $s, t : R \to U$ are smooth. \end{lemma} 
\begin{lemma} \label{lemma-reduced-group-scheme-perfect-field-characteristic-p-smooth} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume \begin{enumerate} \item $U = \Spec(k)$ with $k$ a field, \item $s, t$ are locally of finite type, \item $R$ is reduced, and \item $k$ is perfect. \end{enumerate} Then $s, t : R \to U$ are smooth. \end{lemma} 
\begin{lemma} \label{lemma-open-image-is-closed} Notation and assumptions as in Situation \ref{situation-morphism-groupoids-on-field}. If $a(R_1)$ is open in $R_2$, then $a(R_1)$ is closed in $R_2$. \end{lemma} 
\begin{lemma} \label{lemma-map-groupoids-on-field-image} Notation and assumptions as in Situation \ref{situation-morphism-groupoids-on-field}. Let $Z \subset R_2$ be the reduced closed subscheme (see Schemes, Definition \ref{schemes-definition-reduced-induced-scheme}) whose underlying topological space is the closure of the image of $a : R_1 \to R_2$. Then $c_2(Z \times_{s_2, U, t_2} Z) \subset Z$ set theoretically. \end{lemma} 
\begin{lemma} \label{lemma-map-groupoids-on-perfect-field-image} Notation and assumptions as in Situation \ref{situation-morphism-groupoids-on-field}. Assume that $k$ is perfect. Let $Z \subset R_2$ be the reduced closed subscheme (see Schemes, Definition \ref{schemes-definition-reduced-induced-scheme}) whose underlying topological space is the closure of the image of $a : R_1 \to R_2$. Then $$ (U, Z, s_2|_Z, t_2|_Z, c_2|_Z) $$ is a groupoid scheme over $S$. \end{lemma} 
\begin{lemma} \label{lemma-locally-closed-image-is-closed} Notation and assumptions as in Situation \ref{situation-morphism-groupoids-on-field}. If the image $a(R_1)$ is a locally closed subset of $R_2$ then it is a closed subset. \end{lemma} 
\begin{lemma} \label{lemma-quasi-compact-map-groupoids-on-field-image} Notation and assumptions as in Situation \ref{situation-morphism-groupoids-on-field}. Assume that $a : R_1 \to R_2$ is a quasi-compact morphism. Let $Z \subset R_2$ be the scheme theoretic image (see Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-image}) of $a : R_1 \to R_2$. Then $$ (U, Z, s_2|_Z, t_2|_Z, c_2|_Z) $$ is a groupoid scheme over $S$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-field-image} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U$ is the spectrum of a field. Let $Z \subset U \times_S U$ be the reduced closed subscheme (see Schemes, Definition \ref{schemes-definition-reduced-induced-scheme}) whose underlying topological space is the closure of the image of $j = (t, s) : R \to U \times_S U$. Then $\text{pr}_{02}(Z \times_{\text{pr}_1, U, \text{pr}_0} Z) \subset Z$ set theoretically. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-on-perfect-field-image} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U$ is the spectrum of a perfect field. Let $Z \subset U \times_S U$ be the reduced closed subscheme (see Schemes, Definition \ref{schemes-definition-reduced-induced-scheme}) whose underlying topological space is the closure of the image of $j = (t, s) : R \to U \times_S U$. Then $$ (U, Z, \text{pr}_0|_Z, \text{pr}_1|_Z, \text{pr}_{02}|_{Z \times_{\text{pr}_1, U, \text{pr}_0} Z}) $$ is a groupoid scheme over $S$. \end{lemma} 
\begin{lemma} \label{lemma-quasi-compact-groupoid-on-field-image} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U$ is the spectrum of a field and assume $R$ is quasi-compact (equivalently $s, t$ are quasi-compact). Let $Z \subset U \times_S U$ be the scheme theoretic image (see Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-image}) of $j = (t, s) : R \to U \times_S U$. Then $$ (U, Z, \text{pr}_0|_Z, \text{pr}_1|_Z, \text{pr}_{02}|_{Z \times_{\text{pr}_1, U, \text{pr}_0} Z}) $$ is a groupoid scheme over $S$. \end{lemma} 
\begin{lemma} \label{lemma-slice} Let $S$ be a scheme. Let $(U, R, s, t, c, e, i)$ be a groupoid scheme over $S$. Let $G \to U$ be the stabilizer group scheme. Assume $s$ and $t$ are Cohen-Macaulay and locally of finite presentation. Let $u \in U$ be a finite type point of the scheme $U$, see Morphisms, Definition \ref{morphisms-definition-finite-type-point}. With notation as in Situation \ref{situation-slice}, set $$ d_1 = \dim(G_u), \quad d_2 = \dim_{e(u)}(F_u). $$ If $d_2 > d_1$, then there exist an affine scheme $U'$ and a morphism $g : U' \to U$ such that (with notation as in Situation \ref{situation-slice}) \begin{enumerate} \item $g$ is an immersion \item $u \in U'$, \item $g$ is locally of finite presentation, \item the morphism $h : U' \times_{g, U, t} R \longrightarrow U$ is Cohen-Macaulay at $(u, e(u))$, and \item we have $\dim_{e'(u)}(F'_u) = d_2 - 1$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-max-slice} Let $S$ be a scheme. Let $(U, R, s, t, c, e, i)$ be a groupoid scheme over $S$. Let $G \to U$ be the stabilizer group scheme. Assume $s$ and $t$ are Cohen-Macaulay and locally of finite presentation. Let $u \in U$ be a finite type point of the scheme $U$, see Morphisms, Definition \ref{morphisms-definition-finite-type-point}. With notation as in Situation \ref{situation-slice} there exist an affine scheme $U'$ and a morphism $g : U' \to U$ such that \begin{enumerate} \item $g$ is an immersion, \item $u \in U'$, \item $g$ is locally of finite presentation, \item the morphism $h : U' \times_{g, U, t} R \longrightarrow U$ is Cohen-Macaulay and locally of finite presentation, \item the morphisms $s', t' : R' \to U'$ are Cohen-Macaulay and locally of finite presentation, and \item $\dim_{e(u)}(F'_u) = \dim(G'_u)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-max-slice-quasi-finite} Let $S$ be a scheme. Let $(U, R, s, t, c, e, i)$ be a groupoid scheme over $S$. Let $G \to U$ be the stabilizer group scheme. Assume $s$ and $t$ are Cohen-Macaulay and locally of finite presentation. Let $u \in U$ be a finite type point of the scheme $U$, see Morphisms, Definition \ref{morphisms-definition-finite-type-point}. Assume that $G \to U$ is locally quasi-finite. With notation as in Situation \ref{situation-slice} there exist an affine scheme $U'$ and a morphism $g : U' \to U$ such that \begin{enumerate} \item $g$ is an immersion, \item $u \in U'$, \item $g$ is locally of finite presentation, \item the morphism $h : U' \times_{g, U, t} R \longrightarrow U$ is flat, locally of finite presentation, and locally quasi-finite, and \item the morphisms $s', t' : R' \to U'$ are flat, locally of finite presentation, and locally quasi-finite. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quasi-finite-over-base} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $p \in S$ be a point, and let $u \in U$ be a point lying over $p$. Assume that \begin{enumerate} \item $U \to S$ is locally of finite type, \item $U \to S$ is quasi-finite at $u$, \item $U \to S$ is separated, \item $R \to S$ is separated, \item $s$, $t$ are flat and locally of finite presentation, and \item $s^{-1}(\{u\})$ is finite. \end{enumerate} Then there exists an \'etale neighbourhood $(S', p') \to (S, p)$ with $\kappa(p) = \kappa(p')$ and a base change diagram $$ \xymatrix{ R' \amalg W' \ar@{=}[r] & S' \times_S R \ar[r] \ar@<2ex>[d]^{s'} \ar@<-2ex>[d]_{t'} & R \ar@<1ex>[d]^s \ar@<-1ex>[d]_t \\ U' \amalg W \ar@{=}[r] & S' \times_S U \ar[r] \ar[d] & U \ar[d] \\  & S' \ar[r] & S } $$ where the equal signs are decompositions into open and closed subschemes such that \begin{enumerate} \item[(a)] there exists a point $u'$ of $U'$ mapping to $u$ in $U$, \item[(b)] the fibre $(U')_{p'}$ equals $t'\big((s')^{-1}(\{u'\})\big)$ set theoretically, \item[(c)] the fibre $(R')_{p'}$ equals $(s')^{-1}\big((U')_{p'}\big)$ set theoretically, \item[(d)] the schemes $U'$ and $R'$ are finite over $S'$, \item[(e)] we have $s'(R') \subset U'$ and $t'(R') \subset U'$, \item[(f)] we have $c'(R' \times_{s', U', t'} R') \subset R'$ where $c'$ is the base change of $c$, and \item[(g)] the morphisms $s', t', c'$ determine a groupoid structure by taking the system $(U', R', s'|_{R'}, t'|_{R'}, c'|_{R' \times_{s', U', t'} R'})$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quasi-finite-over-base-j-proper} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $p \in S$ be a point, and let $u \in U$ be a point lying over $p$. Assume assumptions (1) -- (6) of Lemma \ref{lemma-quasi-finite-over-base} hold as well as \begin{enumerate} \item[(7)] $j : R \to U \times_S U$ is universally closed\footnote{In view of the other conditions this is equivalent to requiring $j$ to be proper.}. \end{enumerate} Then we can choose $(S', p') \to (S, p)$ and decompositions $S' \times_S U = U' \amalg W$ and $S' \times_S R = R' \amalg W'$ and $u' \in U'$ such that (a) -- (g) of Lemma \ref{lemma-quasi-finite-over-base} hold as well as \begin{enumerate} \item[(h)] $R'$ is the restriction of $S' \times_S R$ to $U'$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-stratify} Let $(U, R, s, t, c)$ be a groupoid scheme over a scheme $S$. Assume $s, t$ are finite. There exists a sequence of $R$-invariant closed subschemes $$ U = Z_0 \supset Z_1 \supset Z_2 \supset \ldots $$ such that $\bigcap Z_r = \emptyset$ and such that $s^{-1}(Z_{r - 1}) \setminus s^{-1}(Z_r) \to Z_{r - 1} \setminus Z_r$ is finite locally free of rank $r$. \end{lemma} 
\begin{lemma} \label{lemma-finite-flat-over-almost-dense-subscheme} Let $(U, R, s, t, c)$ be a groupoid scheme over a scheme $S$. Assume $s, t$ are finite. There exists an open subscheme $W \subset U$ and a closed subscheme $W' \subset W$ such that \begin{enumerate} \item $W$ and $W'$ are $R$-invariant, \item $U = t(s^{-1}(\overline{W}))$ set theoretically, \item $W$ is a thickening of $W'$, and \item the maps $s'$, $t'$ of the restriction $(W', R', s', t', c')$ are finite locally free. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-flat-over-almost-dense-subscheme-addendum} In Lemma \ref{lemma-finite-flat-over-almost-dense-subscheme} assume in addition that $s$ and $t$ are of finite presentation. Then \begin{enumerate} \item the morphism $W' \to W$ is of finite presentation, and \item if $u \in U$ is a point whose $R$-orbit consists of generic points of irreducible components of $U$, then $u \in W$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-invariant-affine-open-around-generic-point} Let $(U, R, s, t, c)$ be a groupoid scheme over a scheme $S$. Assume $s, t$ are finite and of finite presentation and $U$ quasi-separated. Let $u_1, \ldots, u_m \in U$ be points whose orbits consist of generic points of irreducible components of $U$. Then there exist $R$-invariant subschemes $V' \subset V \subset U$ such that \begin{enumerate} \item $u_1, \ldots, u_m \in V'$, \item $V$ is open in $U$, \item $V'$ and $V$ are affine, \item $V' \subset V$ is a thickening of finite presentation, \item the morphisms $s', t'$ of the restriction $(V', R', s', t', c')$ are finite locally free. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-invariant-affine-open-around-generic-point-Noetherian} Let $(U, R, s, t, c)$ be a groupoid scheme over a scheme $S$. Assume $s, t$ finite, $U$ is locally Noetherian, and $u_1, \ldots, u_m \in U$ points whose orbits consist of generic points of irreducible components of $U$. Then there exist $R$-invariant subschemes $V' \subset V \subset U$ such that \begin{enumerate} \item $u_1, \ldots, u_m \in V'$, \item $V$ is open in $U$, \item $V'$ and $V$ are affine, \item $V' \subset V$ is a thickening, \item the morphisms $s', t'$ of the restriction $(V', R', s', t', c')$ are finite locally free. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-find-affine-integral} Let $(U, R, s, t, c)$ be a groupoid scheme over a scheme $S$ with $s, t$ integral. Let $g : U' \to U$ be an integral morphism such that every $R$-orbit in $U$ meets $g(U')$. Let $(U', R', s', t', c')$ be the restriction of $R$ to $U'$. If $u' \in U'$ is contained in an $R'$-invariant affine open, then the image $u \in U$ is contained in an $R$-invariant affine open of $U$. \end{lemma} 
\begin{lemma} \label{lemma-find-almost-invariant-function} Let $(U, R, s, t, c)$ be a groupoid scheme with $s, t$ finite and of finite presentation. Let $u_1, \ldots, u_m \in U$ be points whose $R$-orbits consist of generic points of irreducible components of $U$. Let $j : U \to \Spec(A)$ be an immersion. Let $I \subset A$ be an ideal such that $j(U) \cap V(I) = \emptyset$ and $V(I) \cup j(U)$ is closed in $\Spec(A)$. Then there exists an $h \in I$ such that $j^{-1}D(h)$ is an $R$-invariant affine open subscheme of $U$ containing $u_1, \ldots, u_m$. \end{lemma} 
\begin{lemma} \label{lemma-no-specializations-map-to-same-point} Let $(U, R, s, t, c)$ be a groupoid scheme. If $s, t$ are finite, and $u, u' \in R$ are distinct points in the same orbit, then $u'$ is not a specialization of $u$. \end{lemma} 
\begin{lemma} \label{lemma-get-affine} Let $j : V \to \Spec(A)$ be a quasi-compact immersion of schemes. Let $f \in A$ be such that $j^{-1}D(f)$ is affine and $j(V) \cap V(f)$ is closed. Then $V$ is affine. \end{lemma} 
\begin{lemma} \label{lemma-find-affine-codimension-1} Let $(U, R, s, t, c)$ be a groupoid scheme. Let $u \in U$. Assume \begin{enumerate} \item $s, t$ are finite morphisms, \item $U$ is separated and locally Noetherian, \item $\dim(\mathcal{O}_{U, u'}) \leq 1$ for every point $u'$ in the orbit of $u$. \end{enumerate} Then $u$ is contained in an $R$-invariant affine open of $U$. \end{lemma} 
\begin{lemma} \label{lemma-sits-in-functions} Let $X$ be an ind-quasi-affine scheme. Let $E \subset X$ be an intersection of a nonempty family of quasi-compact opens of $X$. Set $A = \Gamma(E, \mathcal{O}_X|_E)$ and $Y = \Spec(A)$. Then the canonical morphism $$ j : (E, \mathcal{O}_X|_E) \longrightarrow (Y, \mathcal{O}_Y) $$ of Schemes, Lemma \ref{schemes-lemma-morphism-into-affine} determines an isomorphism $(E, \mathcal{O}_X|_E) \to (E', \mathcal{O}_Y|_{E'})$ where $E' \subset Y$ is an intersection of quasi-compact opens. If $W \subset E$ is open in $X$, then $j(W)$ is open in $Y$. \end{lemma} 
\begin{lemma} \label{lemma-affine-base-change} Suppose given a cartesian diagram $$ \xymatrix{ X \ar[d]_f \ar[r] & \Spec(B) \ar[d] \\ Y \ar[r] & \Spec(A) } $$ of schemes. Let $E \subset Y$ be an intersection of a nonempty family of quasi-compact opens of $Y$. Then $$ \Gamma(f^{-1}(E), \mathcal{O}_X|_{f^{-1}(E)}) = \Gamma(E, \mathcal{O}_Y|_E) \otimes_A B $$ provided $Y$ is quasi-separated and $A \to B$ is flat. \end{lemma} 
\begin{lemma}[Gabber] \label{lemma-ind-quasi-affine} Let $S$ be a scheme. Let $\{X_i \to S\}_{i\in I}$ be an fpqc covering. Let $(V_i/X_i, \varphi_{ij})$ be a descent datum relative to $\{X_i \to S\}$, see Descent, Definition \ref{descent-definition-descent-datum-for-family-of-morphisms}.  If each morphism $V_i \to X_i$ is ind-quasi-affine, then the descent datum is effective. \end{lemma} 
