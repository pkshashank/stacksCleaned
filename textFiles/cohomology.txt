\begin{definition} \label{definition-torsor} Let $X$ be a topological space. Let $\mathcal{G}$ be a sheaf of (possibly non-commutative) groups on $X$. A {\it torsor}, or more precisely a {\it $\mathcal{G}$-torsor}, is a sheaf of sets $\mathcal{F}$ on $X$ endowed with an action $\mathcal{G} \times \mathcal{F} \to \mathcal{F}$ such that \begin{enumerate} \item whenever $\mathcal{F}(U)$ is nonempty the action $\mathcal{G}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$ is simply transitive, and \item for every $x \in X$ the stalk $\mathcal{F}_x$ is nonempty. \end{enumerate} A {\it morphism of $\mathcal{G}$-torsors} $\mathcal{F} \to \mathcal{F}'$ is simply a morphism of sheaves of sets compatible with the $\mathcal{G}$-actions. The {\it trivial $\mathcal{G}$-torsor} is the sheaf $\mathcal{G}$ endowed with the obvious left $\mathcal{G}$-action. \end{definition} 
\begin{lemma} \label{lemma-trivial-torsor} Let $X$ be a topological space. Let $\mathcal{G}$ be a sheaf of (possibly non-commutative) groups on $X$. A $\mathcal{G}$-torsor $\mathcal{F}$ is trivial if and only if $\mathcal{F}(X) \not = \emptyset$. \end{lemma} 
\begin{lemma} \label{lemma-torsors-h1} Let $X$ be a topological space. Let $\mathcal{H}$ be an abelian sheaf on $X$. There is a canonical bijection between the set of isomorphism classes of $\mathcal{H}$-torsors and $H^1(X, \mathcal{H})$. \end{lemma} 
\begin{lemma} \label{lemma-h1-extensions} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules. There is a canonical bijection $$ \Ext^1_{\textit{Mod}(\mathcal{O}_X)}(\mathcal{O}_X, \mathcal{F}) \longrightarrow H^1(X, \mathcal{F}) $$ which associates to the extension $$ 0 \to \mathcal{F} \to \mathcal{E} \to \mathcal{O}_X \to 0 $$ the image of $1 \in \Gamma(X, \mathcal{O}_X)$ in $H^1(X, \mathcal{F})$. \end{lemma} 
\begin{lemma} \label{lemma-h1-invertible} Let $(X, \mathcal{O}_X)$ be a ringed space. If all stalks $\mathcal{O}_{X, x}$ are local rings, then there is a canonical isomorphism $$ H^1(X, \mathcal{O}_X^*) = \Pic(X). $$ of abelian groups. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-of-open} Let $X$ be a ringed space. Let $U \subset X$ be an open subspace. \begin{enumerate} \item If $\mathcal{I}$ is an injective $\mathcal{O}_X$-module then $\mathcal{I}|_U$ is an injective $\mathcal{O}_U$-module. \item For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we have $H^p(U, \mathcal{F}) = H^p(U, \mathcal{F}|_U)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-kill-cohomology-class-on-covering} Let $X$ be a ringed space. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules. Let $U \subset X$ be an open subspace. Let $n > 0$ and let $\xi \in H^n(U, \mathcal{F})$. Then there exists an open covering $U = \bigcup_{i\in I} U_i$ such that $\xi|_{U_i} = 0$ for all $i \in I$. \end{lemma} 
\begin{lemma} \label{lemma-describe-higher-direct-images} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{F}$ be a $\mathcal{O}_X$-module. The sheaves $R^if_*\mathcal{F}$ are the sheaves associated to the presheaves $$ V \longmapsto H^i(f^{-1}(V), \mathcal{F}) $$ with restriction mappings as in Equation (\ref{equation-restriction-mapping}). There is a similar statement for $R^if_*$ applied to a bounded below complex $\mathcal{F}^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-localize-higher-direct-images} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Let $V \subset Y$ be an open subspace. Denote $g : f^{-1}(V) \to V$ the restriction of $f$. Then we have $$ R^pg_*(\mathcal{F}|_{f^{-1}(V)}) = (R^pf_*\mathcal{F})|_V $$ There is a similar statement for the derived image $Rf_*\mathcal{F}^\bullet$ where $\mathcal{F}^\bullet$ is a bounded below complex of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-injective-restriction-surjective} \begin{slogan} Injectives are flasque. \end{slogan} Let $X$ be a ringed space. Let $U' \subset U \subset X$ be open subspaces. For any injective $\mathcal{O}_X$-module $\mathcal{I}$ the restriction mapping $\mathcal{I}(U) \to \mathcal{I}(U')$ is surjective. \end{lemma} 
\begin{lemma}[Mayer-Vietoris] \label{lemma-mayer-vietoris} Let $X$ be a ringed space. Suppose that $X = U \cup V$ is a union of two open subsets. For every $\mathcal{O}_X$-module $\mathcal{F}$ there exists a long exact cohomology sequence $$ 0 \to H^0(X, \mathcal{F}) \to H^0(U, \mathcal{F}) \oplus H^0(V, \mathcal{F}) \to H^0(U \cap V, \mathcal{F}) \to H^1(X, \mathcal{F}) \to \ldots $$ This long exact sequence is functorial in $\mathcal{F}$. \end{lemma} 
\begin{lemma}[Relative Mayer-Vietoris] \label{lemma-relative-mayer-vietoris} Let $f : X \to Y$ be a morphism of ringed spaces. Suppose that $X = U \cup V$ is a union of two open subsets. Denote $a = f|_U : U \to Y$, $b = f|_V : V \to Y$, and $c = f|_{U \cap V} : U \cap V \to Y$. For every $\mathcal{O}_X$-module $\mathcal{F}$ there exists a long exact sequence $$ 0 \to f_*\mathcal{F} \to a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to c_*(\mathcal{F}|_{U \cap V}) \to R^1f_*\mathcal{F} \to \ldots $$ This long exact sequence is functorial in $\mathcal{F}$. \end{lemma} 
\begin{definition} \label{definition-cech-complex} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{F}$ be an abelian presheaf on $X$. The complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ is the {\it {\v C}ech complex} associated to $\mathcal{F}$ and the open covering $\mathcal{U}$. Its cohomology groups $H^i(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}))$ are called the {\it {\v C}ech cohomology groups} associated to $\mathcal{F}$ and the covering $\mathcal{U}$. They are denoted $\check H^i(\mathcal{U}, \mathcal{F})$. \end{definition} 
\begin{lemma} \label{lemma-cech-h0} Let $X$ be a topological space. Let $\mathcal{F}$ be an abelian presheaf on $X$. The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is an abelian sheaf and \item for every open covering $\mathcal{U} : U = \bigcup_{i \in I} U_i$ the natural map $$ \mathcal{F}(U) \to \check{H}^0(\mathcal{U}, \mathcal{F}) $$ is bijective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cech-trivial} Let $X$ be a topological space. Let $\mathcal{F}$ be an abelian presheaf on $X$. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. If $U_i = U$ for some $i \in I$, then the extended {\v C}ech complex $$ \mathcal{F}(U) \to \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) $$ obtained by putting $\mathcal{F}(U)$ in degree $-1$ with differential given by the canonical map of $\mathcal{F}(U)$ into $\check{\mathcal{C}}^0(\mathcal{U}, \mathcal{F})$ is homotopy equivalent to $0$. \end{lemma} 
\begin{lemma} \label{lemma-cech-exact-presheaves} The functor given by Equation (\ref{equation-cech-functor}) is an exact functor (see Homology, Lemma \ref{homology-lemma-exact-functor}). \end{lemma} 
\begin{lemma} \label{lemma-cech-cohomology-delta-functor-presheaves} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. The functors $\mathcal{F} \mapsto \check{H}^n(\mathcal{U}, \mathcal{F})$ form a $\delta$-functor from the abelian category of presheaves of $\mathcal{O}_X$-modules to the category of $\mathcal{O}_X(U)$-modules (see Homology, Definition \ref{homology-definition-cohomological-delta-functor}). \end{lemma} 
\begin{lemma} \label{lemma-cech-map-into} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Denote $j_{i_0\ldots i_p} : U_{i_0 \ldots i_p} \to X$ the open immersion. Consider the chain complex $K(\mathcal{U})_\bullet$ of presheaves of $\mathcal{O}_X$-modules $$ \ldots \to \bigoplus_{i_0i_1i_2} (j_{i_0i_1i_2})_{p!}\mathcal{O}_{U_{i_0i_1i_2}} \to \bigoplus_{i_0i_1} (j_{i_0i_1})_{p!}\mathcal{O}_{U_{i_0i_1}} \to \bigoplus_{i_0} (j_{i_0})_{p!}\mathcal{O}_{U_{i_0}} \to 0 \to \ldots $$ where the last nonzero term is placed in degree $0$ and where the map $$ (j_{i_0\ldots i_{p + 1}})_{p!}\mathcal{O}_{U_{i_0\ldots i_{p + 1}}} \longrightarrow (j_{i_0\ldots \hat i_j \ldots i_{p + 1}})_{p!} \mathcal{O}_{U_{i_0\ldots \hat i_j \ldots i_{p + 1}}} $$ is given by $(-1)^j$ times the canonical map. Then there is an isomorphism $$ \Hom_{\mathcal{O}_X}(K(\mathcal{U})_\bullet, \mathcal{F}) = \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) $$ functorial in $\mathcal{F} \in \Ob(\textit{PMod}(\mathcal{O}_X))$. \end{lemma} 
\begin{lemma} \label{lemma-homology-complex} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{O}_\mathcal{U} \subset \mathcal{O}_X$ be the image presheaf of the map $\bigoplus j_{p!}\mathcal{O}_{U_i} \to \mathcal{O}_X$. The chain complex $K(\mathcal{U})_\bullet$ of presheaves of Lemma \ref{lemma-cech-map-into} above has homology presheaves $$ H_i(K(\mathcal{U})_\bullet) = \left\{ \begin{matrix} 0 & \text{if} & i \not = 0 \\ \mathcal{O}_\mathcal{U} & \text{if} & i = 0 \end{matrix} \right. $$ \end{lemma} 
\begin{lemma} \label{lemma-cech-cohomology-derived-presheaves} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering of $U \subset X$. The {\v C}ech cohomology functors $\check{H}^p(\mathcal{U}, -)$ are canonically isomorphic as a $\delta$-functor to the right derived functors of the functor $$ \check{H}^0(\mathcal{U}, -) : \textit{PMod}(\mathcal{O}_X) \longrightarrow \text{Mod}_{\mathcal{O}_X(U)}. $$ Moreover, there is a functorial quasi-isomorphism $$ \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \longrightarrow R\check{H}^0(\mathcal{U}, \mathcal{F}) $$ where the right hand side indicates the right derived functor $$ R\check{H}^0(\mathcal{U}, -) : D^{+}(\textit{PMod}(\mathcal{O}_X)) \longrightarrow D^{+}(\mathcal{O}_X(U)) $$ of the left exact functor $\check{H}^0(\mathcal{U}, -)$. \end{lemma} 
\begin{lemma} \label{lemma-injective-trivial-cech} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module. Then $$ \check{H}^p(\mathcal{U}, \mathcal{I}) = \left\{ \begin{matrix} \mathcal{I}(U) & \text{if} & p = 0 \\ 0 & \text{if} & p > 0 \end{matrix} \right. $$ \end{lemma} 
\begin{lemma} \label{lemma-cech-cohomology} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. There is a transformation $$ \check{\mathcal{C}}^\bullet(\mathcal{U}, -) \longrightarrow R\Gamma(U, -) $$ of functors $\textit{Mod}(\mathcal{O}_X) \to D^{+}(\mathcal{O}_X(U))$. In particular this provides canonical maps $\check{H}^p(\mathcal{U}, \mathcal{F}) \to H^p(U, \mathcal{F})$ for $\mathcal{F}$ ranging over $\textit{Mod}(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-cech-h1} Let $X$ be a topological space. Let $\mathcal{H}$ be an abelian sheaf on $X$. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering. The map $$ \check{H}^1(\mathcal{U}, \mathcal{H}) \longrightarrow H^1(X, \mathcal{H}) $$ is injective and identifies $\check{H}^1(\mathcal{U}, \mathcal{H})$ via the bijection of Lemma \ref{lemma-torsors-h1} with the set of isomorphism classes of $\mathcal{H}$-torsors which restrict to trivial torsors over each $U_i$. \end{lemma} 
\begin{lemma} \label{lemma-include} Let $X$ be a ringed space. Consider the functor $i : \textit{Mod}(\mathcal{O}_X) \to \textit{PMod}(\mathcal{O}_X)$. It is a left exact functor with right derived functors given by $$ R^pi(\mathcal{F}) = \underline{H}^p(\mathcal{F}) : U \longmapsto H^p(U, \mathcal{F}) $$ see discussion in Section \ref{section-locality}. \end{lemma} 
\begin{lemma} \label{lemma-cech-spectral-sequence} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ there is a spectral sequence $(E_r, d_r)_{r \geq 0}$ with $$ E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F})) $$ converging to $H^{p + q}(U, \mathcal{F})$. This spectral sequence is functorial in $\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-cech-spectral-sequence-application} Let $X$ be a ringed space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Assume that $H^i(U_{i_0 \ldots i_p}, \mathcal{F}) = 0$ for all $i > 0$, all $p \geq 0$ and all $i_0, \ldots, i_p \in I$. Then $\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(U, \mathcal{F})$ as $\mathcal{O}_X(U)$-modules. \end{lemma} 
\begin{lemma} \label{lemma-ses-cech-h1} Let $X$ be a ringed space. Let $$ 0 \to \mathcal{F} \to \mathcal{G} \to \mathcal{H} \to 0 $$ be a short exact sequence of $\mathcal{O}_X$-modules. Let $U \subset X$ be an open subset. If there exists a cofinal system of open coverings $\mathcal{U}$ of $U$ such that $\check{H}^1(\mathcal{U}, \mathcal{F}) = 0$, then the map $\mathcal{G}(U) \to \mathcal{H}(U)$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-cech-vanish} \begin{slogan} If higher {\v C}ech cohomology of an abelian sheaf vanishes for all open covers, then higher cohomology vanishes. \end{slogan} Let $X$ be a ringed space. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module such that $$ \check{H}^p(\mathcal{U}, \mathcal{F}) = 0 $$ for all $p > 0$ and any open covering $\mathcal{U} : U = \bigcup_{i \in I} U_i$ of an open of $X$. Then $H^p(U, \mathcal{F}) = 0$ for all $p > 0$ and any open $U \subset X$. \end{lemma} 
\begin{lemma} \label{lemma-cech-vanish-basis} (Variant of Lemma \ref{lemma-cech-vanish}.) Let $X$ be a ringed space. Let $\mathcal{B}$ be a basis for the topology on $X$. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Assume there exists a set of open coverings $\text{Cov}$ with the following properties: \begin{enumerate} \item For every $\mathcal{U} \in \text{Cov}$ with $\mathcal{U} : U = \bigcup_{i \in I} U_i$ we have $U, U_i \in \mathcal{B}$ and every $U_{i_0 \ldots i_p} \in \mathcal{B}$. \item For every $U \in \mathcal{B}$ the open coverings of $U$ occurring in $\text{Cov}$ is a cofinal system of open coverings of $U$. \item For every $\mathcal{U} \in \text{Cov}$ we have $\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for all $p > 0$. \end{enumerate} Then $H^p(U, \mathcal{F}) = 0$ for all $p > 0$ and any $U \in \mathcal{B}$. \end{lemma} 
\begin{lemma} \label{lemma-pushforward-injective} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module. Then \begin{enumerate} \item $\check{H}^p(\mathcal{V}, f_*\mathcal{I}) = 0$ for all $p > 0$ and any open covering $\mathcal{V} : V = \bigcup_{j \in J} V_j$ of $Y$. \item $H^p(V, f_*\mathcal{I}) = 0$ for all $p > 0$ and every open $V \subset Y$. \end{enumerate} In other words, $f_*\mathcal{I}$ is right acyclic for $\Gamma(V, -)$ (see Derived Categories, Definition \ref{derived-definition-derived-functor}) for any $V \subset Y$ open. \end{lemma} 
\begin{lemma} \label{lemma-pushforward-injective-flat} Let $f : X \to Y$ be a morphism of ringed spaces. Assume $f$ is flat. Then $f_*\mathcal{I}$ is an injective $\mathcal{O}_Y$-module for any injective $\mathcal{O}_X$-module $\mathcal{I}$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-products} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $I$ be a set. For $i \in I$ let  $\mathcal{F}_i$ be an $\mathcal{O}_X$-module. Let $U \subset X$ be open. The canonical map $$ H^p(U, \prod\nolimits_{i \in I} \mathcal{F}_i) \longrightarrow \prod\nolimits_{i \in I} H^p(U, \mathcal{F}_i) $$ is an isomorphism for $p = 0$ and injective for $p = 1$. \end{lemma} 
\begin{definition} \label{definition-flasque} Let $X$ be a topological space. We say a presheaf of sets $\mathcal{F}$ is {\it flasque} or {\it flabby} if for every $U \subset V$ open in $X$ the restriction map $\mathcal{F}(V) \to \mathcal{F}(U)$ is surjective. \end{definition} 
\begin{lemma} \label{lemma-injective-flasque} Let $(X, \mathcal{O}_X)$ be a ringed space. Then any injective $\mathcal{O}_X$-module is flasque. \end{lemma} 
\begin{lemma} \label{lemma-flasque-acyclic} Let $(X, \mathcal{O}_X)$ be a ringed space. Any flasque $\mathcal{O}_X$-module is acyclic for $R\Gamma(X, -)$ as well as $R\Gamma(U, -)$ for any open $U$ of $X$. \end{lemma} 
\begin{lemma} \label{lemma-flasque-acyclic-cech} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules. Let $\mathcal{U} : U = \bigcup U_i$ be an open covering. If $\mathcal{F}$ is flasque, then $\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for $p > 0$. \end{lemma} 
\begin{lemma} \label{lemma-flasque-acyclic-pushforward} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules. If $\mathcal{F}$ is flasque, then $R^pf_*\mathcal{F} = 0$ for $p > 0$. \end{lemma} 
\begin{lemma} \label{lemma-vanishing-ravi} Let $X$ be a topological space. Let $\mathcal{F}$ be an abelian sheaf on $X$. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Assume the restriction mappings $\mathcal{F}(U) \to \mathcal{F}(U')$ are surjective for $U'$ an arbitrary union of opens of the form $U_{i_0 \ldots i_p}$. Then $\check{H}^p(\mathcal{U}, \mathcal{F})$ vanishes for $p > 0$. \end{lemma} 
\begin{lemma} \label{lemma-before-Leray} Let $f : X \to Y$ be a morphism of ringed spaces. There is a commutative diagram $$ \xymatrix{ D^{+}(X) \ar[rr]_-{R\Gamma(X, -)} \ar[d]_{Rf_*} & & D^{+}(\mathcal{O}_X(X)) \ar[d]^{\text{restriction}} \\ D^{+}(Y) \ar[rr]^-{R\Gamma(Y, -)} & & D^{+}(\mathcal{O}_Y(Y)) } $$ More generally for any $V \subset Y$ open and $U = f^{-1}(V)$ there is a commutative diagram $$ \xymatrix{ D^{+}(X) \ar[rr]_-{R\Gamma(U, -)} \ar[d]_{Rf_*} & & D^{+}(\mathcal{O}_X(U)) \ar[d]^{\text{restriction}} \\ D^{+}(Y) \ar[rr]^-{R\Gamma(V, -)} & & D^{+}(\mathcal{O}_Y(V)) } $$ See also Remark \ref{remark-elucidate-lemma} for more explanation. \end{lemma} 
\begin{lemma} \label{lemma-modules-abelian} Let $X$ be a ringed space. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. \begin{enumerate} \item The cohomology groups $H^i(U, \mathcal{F})$ for $U \subset X$ open of $\mathcal{F}$ computed as an $\mathcal{O}_X$-module, or computed as an abelian sheaf are identical. \item Let $f : X \to Y$ be a morphism of ringed spaces. The higher direct images $R^if_*\mathcal{F}$ of $\mathcal{F}$ computed as an $\mathcal{O}_X$-module, or computed as an abelian sheaf are identical. \end{enumerate} There are similar statements in the case of bounded below complexes of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma}[Leray spectral sequence] \label{lemma-Leray} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{F}^\bullet$ be a bounded below complex of $\mathcal{O}_X$-modules. There is a spectral sequence $$ E_2^{p, q} = H^p(Y, R^qf_*(\mathcal{F}^\bullet)) $$ converging to $H^{p + q}(X, \mathcal{F}^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-apply-Leray} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. \begin{enumerate} \item If $R^qf_*\mathcal{F} = 0$ for $q > 0$, then $H^p(X, \mathcal{F}) = H^p(Y, f_*\mathcal{F})$ for all $p$. \item If $H^p(Y, R^qf_*\mathcal{F}) = 0$ for all $q$ and $p > 0$, then $H^q(X, \mathcal{F}) = H^0(Y, R^qf_*\mathcal{F})$ for all $q$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-higher-direct-images-compose} \begin{slogan} The total derived functor of a composition is the composition of the total derived functors. \end{slogan} Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces. In this case $Rg_* \circ Rf_* = R(g \circ f)_*$ as functors from $D^{+}(X) \to D^{+}(Z)$. \end{lemma} 
\begin{lemma}[Relative Leray spectral sequence] \label{lemma-relative-Leray} Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. There is a spectral sequence with $$ E_2^{p, q} = R^pg_*(R^qf_*\mathcal{F}) $$ converging to $R^{p + q}(g \circ f)_*\mathcal{F}$. This spectral sequence is functorial in $\mathcal{F}$, and there is a version for bounded below complexes of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-functoriality} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{G}^\bullet$, resp.\ $\mathcal{F}^\bullet$ be a bounded below complex of $\mathcal{O}_Y$-modules, resp.\ $\mathcal{O}_X$-modules. Let $\varphi : \mathcal{G}^\bullet \to f_*\mathcal{F}^\bullet$ be a morphism of complexes. There is a canonical morphism $$ \mathcal{G}^\bullet \longrightarrow Rf_*(\mathcal{F}^\bullet) $$ in $D^{+}(Y)$. Moreover this construction is functorial in the triple $(\mathcal{G}^\bullet, \mathcal{F}^\bullet, \varphi)$. \end{lemma} 
\begin{lemma} \label{lemma-functoriality-cech} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\varphi : f^*\mathcal{G} \to \mathcal{F}$ be an $f$-map from an $\mathcal{O}_Y$-module $\mathcal{G}$ to an $\mathcal{O}_X$-module $\mathcal{F}$. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ and $\mathcal{V} : Y = \bigcup_{j \in J} V_j$ be open coverings. Assume that $\mathcal{U}$ is a refinement of $f^{-1}\mathcal{V} : X = \bigcup_{j \in J} f^{-1}(V_j)$. In this case there exists a commutative diagram $$ \xymatrix{ \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \ar[r] & R\Gamma(X, \mathcal{F}) \\ \check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{G}) \ar[r] \ar[u]^\gamma & R\Gamma(Y, \mathcal{G}) \ar[u] } $$ in $D^{+}(\mathcal{O}_X(X))$ with horizontal arrows given by Lemma \ref{lemma-cech-cohomology} and right vertical arrow by (\ref{equation-functorial-derived}). In particular we get commutative diagrams of cohomology groups $$ \xymatrix{ \check{H}^p(\mathcal{U}, \mathcal{F}) \ar[r] & H^p(X, \mathcal{F}) \\ \check{H}^p(\mathcal{V}, \mathcal{G}) \ar[r] \ar[u]^\gamma & H^p(Y, \mathcal{G}) \ar[u] } $$ where the right vertical arrow is (\ref{equation-functorial}) \end{lemma} 
\begin{lemma} \label{lemma-cech-always} Let $X$ be a topological space. Let $\mathcal{F}$ be an abelian sheaf. Then the map $\check{H}^1(X, \mathcal{F}) \to H^1(X, \mathcal{F})$ defined in (\ref{equation-cech-to-cohomology}) is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-cech-Hausdorff-quasi-compact} Let $X$ be a Hausdorff and quasi-compact topological space. Let $\mathcal{F}$ be an abelian sheaf on $X$. Then the map $\check{H}^n(X, \mathcal{F}) \to H^n(X, \mathcal{F})$ defined in (\ref{equation-cech-to-cohomology}) is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-of-closed} \begin{reference} \cite[Expose V bis, 4.1.3]{SGA4} \end{reference} Let $X$ be a topological space. Let $Z \subset X$ be a quasi-compact subset such that any two points of $Z$ have disjoint open neighbourhoods in $X$. For every abelian sheaf $\mathcal{F}$ on $X$ the canonical map $$ \colim H^p(U, \mathcal{F}) \longrightarrow H^p(Z, \mathcal{F}|_Z) $$ where the colimit is over open neighbourhoods $U$ of $Z$ in $X$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-base-change-map-flat-case} Let $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ S' \ar[r]^g & S } $$ be a commutative diagram of ringed spaces. Let $\mathcal{F}^\bullet$ be a bounded below complex of $\mathcal{O}_X$-modules. Assume both $g$ and $g'$ are flat. Then there exists a canonical base change map $$ g^*Rf_*\mathcal{F}^\bullet \longrightarrow R(f')_*(g')^*\mathcal{F}^\bullet $$ in $D^{+}(S')$. \end{lemma} 
\begin{lemma} \label{lemma-proper-base-change} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $y \in Y$. Assume that \begin{enumerate} \item $f$ is closed, \item $f$ is separated, and \item $f^{-1}(y)$ is quasi-compact. \end{enumerate} Then for $E$ in $D^+(\mathcal{O}_X)$ we have $(Rf_*E)_y = R\Gamma(f^{-1}(y), E|_{f^{-1}(y)})$ in $D^+(\mathcal{O}_{Y, y})$. \end{lemma} 
\begin{theorem}[Proper base change] \label{theorem-proper-base-change} \begin{reference} \cite[Expose V bis, 4.1.1]{SGA4} \end{reference} Consider a cartesian square of topological spaces $$ \xymatrix{ X' = Y' \times_Y X \ar[d]_{f'} \ar[r]_-{g'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ Assume that $f$ is proper. Let $E$ be an object of $D^+(X)$. Then the base change map $$ g^{-1}Rf_*E \longrightarrow Rf'_*(g')^{-1}E $$ of Lemma \ref{lemma-base-change-map-flat-case} is an isomorphism in $D^+(Y')$. \end{theorem} 
\begin{lemma}[Proper base change for sheaves of sets] \label{lemma-proper-base-change-sheaves-of-sets} Consider a cartesian square of topological spaces $$ \xymatrix{ X' \ar[d]_{f'} \ar[r]_-{g'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ Assume that $f$ is proper. Then $g^{-1}f_*\mathcal{F} = f'_*(g')^{-1}\mathcal{F}$ for any sheaf of sets $\mathcal{F}$ on $X$. \end{lemma} 
\begin{lemma} \label{lemma-quasi-separated-cohomology-colimit} Let $X$ be a ringed space. Assume that the underlying topological space of $X$ has the following properties: \begin{enumerate} \item there exists a basis of quasi-compact open subsets, and \item the intersection of any two quasi-compact opens is quasi-compact. \end{enumerate} Then for any directed system $(\mathcal{F}_i, \varphi_{ii'})$ of sheaves of $\mathcal{O}_X$-modules and for any quasi-compact open $U \subset X$ the canonical map $$ \colim_i H^q(U, \mathcal{F}_i) \longrightarrow H^q(U, \colim_i \mathcal{F}_i) $$ is an isomorphism for every $q \geq 0$. \end{lemma} 
\begin{lemma} \label{lemma-higher-direct-image-colimit} Let $f : X \to Y$ be a continuous map of topological spaces. Let $(\mathcal{F}_i, \varphi_{ii'})$ be a system of abelian sheaves on $X$. Set $\mathcal{F} = \colim \mathcal{F}_i$. Let $p \geq 0$ be an integer. Assume the set of opens $V \subset Y$ such that $H^p(f^{-1}(V), \mathcal{F}) = \colim H^p(f^{-1}(V), \mathcal{F}_i)$ is a basis for the topology on $Y$. Then $R^pf_*\mathcal{F} = \colim R^pf_*\mathcal{F}_i$. \end{lemma} 
\begin{lemma} \label{lemma-colimit} In the situation discussed above. Let $i \in \Ob(\mathcal{I})$ and let $U_i \subset X_i$ be quasi-compact open. Then $$ \colim_{a : j \to i} H^p(f_a^{-1}(U_i), \mathcal{F}_j) = H^p(p_i^{-1}(U_i), \mathcal{F}) $$ for all $p \geq 0$. In particular we have $H^p(X, \mathcal{F}) = \colim H^p(X_i, \mathcal{F}_i)$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-and-closed-immersions} Let $i : Z \to X$ be a closed immersion of topological spaces. For any abelian sheaf $\mathcal{F}$ on $Z$ we have $H^p(Z, \mathcal{F}) = H^p(X, i_*\mathcal{F})$. \end{lemma} 
\begin{lemma} \label{lemma-irreducible-constant-cohomology-zero} Let $X$ be an irreducible topological space. Then $H^p(X, \underline{A}) = 0$ for all $p > 0$ and any abelian group $A$. \end{lemma} 
\begin{lemma} \label{lemma-subsheaf-of-constant-sheaf} \begin{reference} \cite[Page 168]{Tohoku}. \end{reference} Let $X$ be a topological space such that the intersection of any two quasi-compact opens is quasi-compact. Let $\mathcal{F} \subset \underline{\mathbf{Z}}$ be a subsheaf generated by finitely many sections over quasi-compact opens. Then there exists a finite filtration $$ (0) = \mathcal{F}_0 \subset \mathcal{F}_1 \subset \ldots \subset \mathcal{F}_n = \mathcal{F} $$ by abelian subsheaves such that for each $0 < i \leq n$ there exists a short exact sequence $$ 0 \to j'_!\underline{\mathbf{Z}}_V \to j_!\underline{\mathbf{Z}}_U \to \mathcal{F}_i/\mathcal{F}_{i - 1} \to 0 $$ with $j : U \to X$ and $j' : V \to X$ the inclusion of quasi-compact opens into $X$. \end{lemma} 
\begin{lemma} \label{lemma-vanishing-generated-one-section} \begin{reference} This is a special case of \cite[Proposition 3.6.1]{Tohoku}. \end{reference} Let $X$ be a topological space. Let $d \geq 0$ be an integer. Assume \begin{enumerate} \item $X$ is quasi-compact, \item the quasi-compact opens form a basis for $X$, and \item the intersection of two quasi-compact opens is quasi-compact. \item $H^p(X, j_!\underline{\mathbf{Z}}_U) = 0$ for all $p > d$ and any quasi-compact open $j : U \to X$. \end{enumerate} Then $H^p(X, \mathcal{F}) = 0$ for all $p > d$ and any abelian sheaf $\mathcal{F}$ on $X$. \end{lemma} 
\begin{lemma} \label{lemma-subsheaf-irreducible} Let $X$ be an irreducible topological space. Let $\mathcal{H} \subset \underline{\mathbf{Z}}$ be an abelian subsheaf of the constant sheaf. Then there exists a nonempty open $U \subset X$ such that $\mathcal{H}|_U = \underline{d\mathbf{Z}}_U$ for some $d \in \mathbf{Z}$. \end{lemma} 
\begin{proposition}[Grothendieck] \label{proposition-vanishing-Noetherian} \begin{reference} \cite[Theorem 3.6.5]{Tohoku}. \end{reference} Let $X$ be a Noetherian topological space. If $\dim(X) \leq d$, then $H^p(X, \mathcal{F}) = 0$ for all $p > d$ and any abelian sheaf $\mathcal{F}$ on $X$. \end{proposition} 
\begin{lemma} \label{lemma-sections-with-support-acyclic} Let $i : Z \to X$ be the inclusion of a closed subset. Let $\mathcal{I}$ be an injective abelian sheaf on $X$. Then $\mathcal{H}_Z(\mathcal{I})$ is an injective abelian sheaf on $Z$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-of-neighbourhoods-of-closed} Let $X$ be a spectral space. Let $\mathcal{F}$ be an abelian sheaf on $X$. Let $E \subset X$ be a quasi-compact subset. Let $W \subset X$ be the set of points of $X$ which specialize to a point of $E$. \begin{enumerate} \item $H^p(W, \mathcal{F}|_W) = \colim H^p(U, \mathcal{F})$ where the colimit is over quasi-compact open neighbourhoods of $E$, \item $H^p(W \setminus E, \mathcal{F}|_{W \setminus E}) = \colim H^p(U \setminus E, \mathcal{F}|_{U \setminus E})$ if $E$ is a constructible subset. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-proper-base-change-spectral} Let $f : X \to Y$ be a spectral map of spectral spaces. Let $y \in Y$. Let $E \subset Y$ be the set of points specializing to $y$. Let $\mathcal{F}$ be an abelian sheaf on $X$. Then $(R^pf_*\mathcal{F})_y = H^p(f^{-1}(E), \mathcal{F}|_{f^{-1}(E)})$. \end{lemma} 
\begin{lemma} \label{lemma-vanishing-for-profinite} Let $X$ be a profinite topological space. Then $H^q(X, \mathcal{F}) = 0$ for all $q > 0$ and all abelian sheaves $\mathcal{F}$. \end{lemma} 
\begin{proposition} \label{proposition-cohomological-dimension-spectral} \begin{reference} Part (1) is the main theorem of \cite{Scheiderer}. \end{reference} Let $X$ be a spectral space of Krull dimension $d$. Let $\mathcal{F}$ be an abelian sheaf on $X$. \begin{enumerate} \item $H^q(X, \mathcal{F}) = 0$ for $q > d$, \item $H^d(X, \mathcal{F}) \to H^d(U, \mathcal{F})$ is surjective for every quasi-compact open $U \subset X$, \item $H^q_Z(X, \mathcal{F}) = 0$ for $q > d$ and any constructible closed subset $Z \subset X$. \end{enumerate} \end{proposition} 
\begin{definition} \label{definition-alternating-cech-complex} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{F}$ be an abelian presheaf on $X$. The complex $\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$ is the {\it alternating {\v C}ech complex} associated to $\mathcal{F}$ and the open covering $\mathcal{U}$. \end{definition} 
\begin{definition} \label{definition-ordered-cech-complex} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Assume given a total ordering on $I$. Let $\mathcal{F}$ be an abelian presheaf on $X$. The complex $\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})$ is the {\it ordered {\v C}ech complex} associated to $\mathcal{F}$, the open covering $\mathcal{U}$ and the given total ordering on $I$. \end{definition} 
\begin{lemma} \label{lemma-ordered-alternating} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Assume $I$ comes equipped with a total ordering. The map $c$ is a morphism of complexes. In fact it induces an isomorphism $$ c : \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F}) \to \check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F}) $$ of complexes. \end{lemma} 
\begin{lemma} \label{lemma-project-to-ordered} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Assume $I$ comes equipped with a total ordering. The map $\pi : \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \to \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})$ is a morphism of complexes. It induces an isomorphism $$ \pi : \check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F}) \to \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F}) $$ of complexes which is a left inverse to the morphism $c$. \end{lemma} 
\begin{lemma} \label{lemma-alternating-usual} Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. Assume $I$ comes equipped with a total ordering. The map $c \circ \pi$ is homotopic to the identity on $\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$. In particular the inclusion map $\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F}) \to \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ is a homotopy equivalence. \end{lemma} 
\begin{lemma} \label{lemma-alternating-cech-trivial} Let $X$ be a topological space. Let $\mathcal{F}$ be an abelian presheaf on $X$. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering. If $U_i = U$ for some $i \in I$, then the extended alternating {\v C}ech complex $$ \mathcal{F}(U) \to \check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F}) $$ obtained by putting $\mathcal{F}(U)$ in degree $-1$ with differential given by the canonical map of $\mathcal{F}(U)$ into $\check{\mathcal{C}}^0(\mathcal{U}, \mathcal{F})$ is homotopy equivalent to $0$. Similarly, for any total ordering on $I$ the extended ordered {\v C}ech complex $$ \mathcal{F}(U) \to \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F}) $$ is homotopy equivalent to $0$. \end{lemma} 
\begin{lemma} \label{lemma-covering-resolution} Let $X$ be a ringed space. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering of $X$. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Denote $\mathcal{F}_{i_0 \ldots i_p}$ the restriction of $\mathcal{F}$ to $U_{i_0 \ldots i_p}$. There exists a complex ${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$ of $\mathcal{O}_X$-modules with $$ {\mathfrak C}^p(\mathcal{U}, \mathcal{F}) = \prod\nolimits_{i_0 \ldots i_p} (j_{i_0 \ldots i_p})_* \mathcal{F}_{i_0 \ldots i_p} $$ and differential $d : {\mathfrak C}^p(\mathcal{U}, \mathcal{F}) \to {\mathfrak C}^{p + 1}(\mathcal{U}, \mathcal{F})$ as in Equation (\ref{equation-d-cech}). Moreover, there exists a canonical map $$ \mathcal{F} \to {\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F}) $$ which is a quasi-isomorphism, i.e., ${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$ is a resolution of $\mathcal{F}$. \end{lemma} 
\begin{definition} \label{definition-covering-locally-finite} Let $X$ be a topological space. An open covering $X = \bigcup_{i \in I} U_i$ is said to be {\it locally finite} if for every $x \in X$ there exists an open neighbourhood $W$ of $x$ such that $\{i \in I \mid W \cap U_i \not = \emptyset\}$ is finite. \end{definition} 
\begin{lemma} \label{lemma-cech-complex-complex} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering. For a bounded below complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical map $$ \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}^\bullet)) \longrightarrow R\Gamma(X, \mathcal{F}^\bullet) $$ functorial in $\mathcal{F}^\bullet$ and compatible with (\ref{equation-global-sections-to-cech}) and (\ref{equation-transformation}). There is a spectral sequence $(E_r, d_r)_{r \geq 0}$ with $$ E_2^{p, q} = H^p(\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \underline{H}^q(\mathcal{F}^\bullet))) $$ converging to $H^{p + q}(X, \mathcal{F}^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-cech-complex-complex-computes} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering. Let $\mathcal{F}^\bullet$ be a bounded below complex of $\mathcal{O}_X$-modules. If $H^i(U_{i_0 \ldots i_p}, \mathcal{F}^q) = 0$ for all $i > 0$ and all $p, i_0, \ldots, i_p, q$, then the map $ \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}^\bullet)) \to R\Gamma(X, \mathcal{F}^\bullet) $ of Lemma \ref{lemma-cech-complex-complex} is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-compute-sign-cup-product-boundaries} In the situation above, assume {\v C}ech cohomology agrees with cohomology for the sheaves $\mathcal{F}_i^p$ and $\mathcal{G}_j^q$. Let $a_3 \in H^n(X, \mathcal{F}_3^\bullet)$ and $b_1 \in H^m(X, \mathcal{G}_1^\bullet)$. Then we have $$ \gamma_1( \partial a_3 \cup b_1) = (-1)^{n + 1} \gamma_3( a_3 \cup \partial b_1) $$ in $H^{n + m + 1}(X, \mathcal{H}^\bullet)$ where $\partial$ indicates the boundary map on cohomology associated to the short exact sequences of complexes above. \end{lemma} 
\begin{lemma} \label{lemma-boundary-derivation-over-cup-product} Let $X$ be a topological space. Let $\mathcal{O}' \to \mathcal{O}$ be a surjection of sheaves of rings whose kernel $\mathcal{I} \subset \mathcal{O}'$ has square zero. Then $M = H^1(X, \mathcal{I})$ is a $R = H^0(X, \mathcal{O})$-module and the boundary map $\partial : R \to M$ associated to the short exact sequence $$ 0 \to \mathcal{I} \to \mathcal{O}' \to \mathcal{O} \to 0 $$ is a derivation (Algebra, Definition \ref{algebra-definition-derivation}). \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-exact} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{G}^\bullet$ be a complex of $\mathcal{O}_X$-modules. The functors $$ K(\textit{Mod}(\mathcal{O}_X)) \longrightarrow K(\textit{Mod}(\mathcal{O}_X)), \quad \mathcal{F}^\bullet \longmapsto \text{Tot}(\mathcal{G}^\bullet \otimes_{\mathcal{O}_X} \mathcal{F}^\bullet) $$ and $$ K(\textit{Mod}(\mathcal{O}_X)) \longrightarrow K(\textit{Mod}(\mathcal{O}_X)), \quad \mathcal{F}^\bullet \longmapsto \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{G}^\bullet) $$ are exact functors of triangulated categories. \end{lemma} 
\begin{definition} \label{definition-K-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. A complex $\mathcal{K}^\bullet$ of $\mathcal{O}_X$-modules is called {\it K-flat} if for every acyclic complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules the complex $$ \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet) $$ is acyclic. \end{definition} 
\begin{lemma} \label{lemma-K-flat-quasi-isomorphism} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{K}^\bullet$ be a K-flat complex. Then the functor $$ K(\textit{Mod}(\mathcal{O}_X)) \longrightarrow K(\textit{Mod}(\mathcal{O}_X)), \quad \mathcal{F}^\bullet \longmapsto \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet) $$ transforms quasi-isomorphisms into quasi-isomorphisms. \end{lemma} 
\begin{lemma} \label{lemma-check-K-flat-stalks} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{K}^\bullet$ be a complex of $\mathcal{O}_X$-modules. Then $\mathcal{K}^\bullet$ is K-flat if and only if for all $x \in X$ the complex $\mathcal{K}_x^\bullet$ of $\mathcal{O}_{X, x}$-modules is K-flat (More on Algebra, Definition \ref{more-algebra-definition-K-flat}). \end{lemma} 
\begin{lemma} \label{lemma-tensor-product-K-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. If $\mathcal{K}^\bullet$, $\mathcal{L}^\bullet$ are K-flat complexes of $\mathcal{O}_X$-modules, then $\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet)$ is a K-flat complex of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-two-out-of-three} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(\mathcal{K}_1^\bullet, \mathcal{K}_2^\bullet, \mathcal{K}_3^\bullet)$ be a distinguished triangle in $K(\textit{Mod}(\mathcal{O}_X))$. If two out of three of $\mathcal{K}_i^\bullet$ are K-flat, so is the third. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-two-out-of-three-ses} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $0 \to \mathcal{K}_1^\bullet \to \mathcal{K}_2^\bullet \to \mathcal{K}_3^\bullet \to 0$ be a short exact sequence of complexes such that the terms of $\mathcal{K}_3^\bullet$ are flat $\mathcal{O}_X$-modules. If two out of three of $\mathcal{K}_i^\bullet$ are K-flat, so is the third. \end{lemma} 
\begin{lemma} \label{lemma-pullback-K-flat} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. The pullback of a K-flat complex of $\mathcal{O}_Y$-modules is a K-flat complex of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-bounded-flat-K-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. A bounded above complex of flat $\mathcal{O}_X$-modules is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-colimit-K-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{K}_1^\bullet \to \mathcal{K}_2^\bullet \to \ldots$ be a system of K-flat complexes. Then $\colim_i \mathcal{K}_i^\bullet$ is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-resolution-by-direct-sums-extensions-by-zero} Let $(X, \mathcal{O}_X)$ be a ringed space. For any complex $\mathcal{G}^\bullet$ of $\mathcal{O}_X$-modules there exists a commutative diagram of complexes of $\mathcal{O}_X$-modules $$ \xymatrix{ \mathcal{K}_1^\bullet \ar[d] \ar[r] & \mathcal{K}_2^\bullet \ar[d] \ar[r] & \ldots \\ \tau_{\leq 1}\mathcal{G}^\bullet \ar[r] & \tau_{\leq 2}\mathcal{G}^\bullet \ar[r] & \ldots } $$ with the following properties: (1) the vertical arrows are quasi-isomorphisms and termwise surjective, (2) each $\mathcal{K}_n^\bullet$ is a bounded above complex whose terms are direct sums of $\mathcal{O}_X$-modules of the form $j_{U!}\mathcal{O}_U$, and (3) the maps $\mathcal{K}_n^\bullet \to \mathcal{K}_{n + 1}^\bullet$ are termwise split injections whose cokernels are direct sums of $\mathcal{O}_X$-modules of the form $j_{U!}\mathcal{O}_U$. Moreover, the map $\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$ is a quasi-isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-resolution} Let $(X, \mathcal{O}_X)$ be a ringed space. For any complex $\mathcal{G}^\bullet$ there exists a $K$-flat complex $\mathcal{K}^\bullet$ whose terms are flat $\mathcal{O}_X$-modules and a quasi-isomorphism $\mathcal{K}^\bullet \to \mathcal{G}^\bullet$ which is termwise surjective. \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-quasi-isomorphism-other-side} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\alpha : \mathcal{P}^\bullet \to \mathcal{Q}^\bullet$ be a quasi-isomorphism of K-flat complexes of $\mathcal{O}_X$-modules. For every complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules the induced map $$ \text{Tot}(\text{id}_{\mathcal{F}^\bullet} \otimes \alpha) : \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{P}^\bullet) \longrightarrow \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{Q}^\bullet) $$ is a quasi-isomorphism. \end{lemma} 
\begin{definition} \label{definition-derived-tor} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}^\bullet$ be an object of $D(\mathcal{O}_X)$. The {\it derived tensor product} $$ - \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{F}^\bullet : D(\mathcal{O}_X) \longrightarrow D(\mathcal{O}_X) $$ is the exact functor of triangulated categories described above. \end{definition} 
\begin{definition} \label{definition-tor} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}_X$-modules. The {\it Tor}'s of $\mathcal{F}$ and $\mathcal{G}$ are define by the formula $$ \text{Tor}_p^{\mathcal{O}_X}(\mathcal{F}, \mathcal{G}) = H^{-p}(\mathcal{F} \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{G}) $$ with derived tensor product as defined above. \end{definition} 
\begin{lemma} \label{lemma-flat-tor-zero} \begin{slogan} Tor measures the deviation of flatness. \end{slogan} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is a flat $\mathcal{O}_X$-module, and \item $\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}, \mathcal{G}) = 0$ for every $\mathcal{O}_X$-module $\mathcal{G}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-factor-through-K-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $a : \mathcal{K}^\bullet \to \mathcal{L}^\bullet$ be a map of complexes of $\mathcal{O}_X$-modules. If $\mathcal{K}^\bullet$ is K-flat, then there exist a complex $\mathcal{N}^\bullet$ and maps of complexes $b : \mathcal{K}^\bullet \to \mathcal{N}^\bullet$ and $c : \mathcal{N}^\bullet \to \mathcal{L}^\bullet$ such that \begin{enumerate} \item $\mathcal{N}^\bullet$ is K-flat, \item $c$ is a quasi-isomorphism, \item $a$ is homotopic to $c \circ b$. \end{enumerate} If the terms of $\mathcal{K}^\bullet$ are flat, then we may choose $\mathcal{N}^\bullet$, $b$, and $c$ such that the same is true for $\mathcal{N}^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-derived-base-change} The construction above is independent of choices and defines an exact functor of triangulated categories $Lf^* : D(\mathcal{O}_Y) \to D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-pullback-composition} Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces. Then $Lf^* \circ Lg^* = L(g \circ f)^*$ as functors $D(\mathcal{O}_Z) \to D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-pullback-tensor-product} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. There is a canonical bifunctorial isomorphism $$ Lf^*( \mathcal{F}^\bullet \otimes_{\mathcal{O}_Y}^{\mathbf{L}} \mathcal{G}^\bullet ) = Lf^*\mathcal{F}^\bullet  \otimes_{\mathcal{O}_X}^{\mathbf{L}} Lf^*\mathcal{G}^\bullet  $$ for $\mathcal{F}^\bullet, \mathcal{G}^\bullet \in \Ob(D(\mathcal{O}_Y))$. \end{lemma} 
\begin{lemma} \label{lemma-variant-derived-pullback} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. There is a canonical bifunctorial isomorphism $$ \mathcal{F}^\bullet \otimes_{\mathcal{O}_X}^{\mathbf{L}} Lf^*\mathcal{G}^\bullet = \mathcal{F}^\bullet  \otimes_{f^{-1}\mathcal{O}_Y}^{\mathbf{L}} f^{-1}\mathcal{G}^\bullet  $$ for $\mathcal{F}^\bullet$ in $D(\mathcal{O}_X)$ and $\mathcal{G}^\bullet$ in $D(\mathcal{O}_Y)$. \end{lemma} 
\begin{lemma} \label{lemma-tensor-pull-compatibility} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $\mathcal{K}^\bullet$ and $\mathcal{M}^\bullet$ be complexes of $\mathcal{O}_Y$-modules. The diagram $$ \xymatrix{ Lf^*(\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y}^\mathbf{L} \mathcal{M}^\bullet) \ar[r] \ar[d] & Lf^*\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y} \mathcal{M}^\bullet) \ar[d] \\ Lf^*\mathcal{K}^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} Lf^*\mathcal{M}^\bullet \ar[d] & f^*\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y} \mathcal{M}^\bullet) \ar[d] \\ f^*\mathcal{K}^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} f^*\mathcal{M}^\bullet \ar[r] & \text{Tot}(f^*\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} f^*\mathcal{M}^\bullet) } $$ commutes. \end{lemma} 
\begin{lemma} \label{lemma-adjoint} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. The functor $Rf_*$ defined above and the functor $Lf^*$ defined in Lemma \ref{lemma-derived-base-change} are adjoint: $$ \Hom_{D(\mathcal{O}_X)}(Lf^*\mathcal{G}^\bullet, \mathcal{F}^\bullet) = \Hom_{D(\mathcal{O}_Y)}(\mathcal{G}^\bullet, Rf_*\mathcal{F}^\bullet) $$ bifunctorially in $\mathcal{F}^\bullet \in \Ob(D(\mathcal{O}_X))$ and $\mathcal{G}^\bullet \in \Ob(D(\mathcal{O}_Y))$. \end{lemma} 
\begin{lemma} \label{lemma-derived-pushforward-composition} Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces. Then $Rg_* \circ Rf_* = R(g \circ f)_*$ as functors $D(\mathcal{O}_X) \to D(\mathcal{O}_Z)$. \end{lemma} 
\begin{lemma} \label{lemma-adjoints-push-pull-compatibility} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $\mathcal{K}^\bullet$ be a complex of $\mathcal{O}_X$-modules. The diagram $$ \xymatrix{ Lf^*f_*\mathcal{K}^\bullet \ar[r] \ar[d] & f^*f_*\mathcal{K}^\bullet \ar[d] \\ Lf^*Rf_*\mathcal{K}^\bullet \ar[r] & \mathcal{K}^\bullet } $$ coming from $Lf^* \to f^*$ on complexes, $f_* \to Rf_*$ on complexes, and adjunction $Lf^* \circ Rf_* \to \text{id}$ commutes in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-spectral-sequence-filtered-object} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}^\bullet$ be a filtered complex of $\mathcal{O}_X$-modules. There exists a canonical spectral sequence $(E_r, \text{d}_r)_{r \geq 1}$ of bigraded $\Gamma(X, \mathcal{O}_X)$-modules with $d_r$ of bidegree $(r, -r + 1)$ and $$ E_1^{p, q} = H^{p + q}(X, \text{gr}^p\mathcal{F}^\bullet) $$ If for every $n$ we have $$ H^n(X, F^p\mathcal{F}^\bullet) = 0\text{ for }p \gg 0 \quad\text{and}\quad H^n(X, F^p\mathcal{F}^\bullet) = H^n(X, \mathcal{F}^\bullet)\text{ for }p \ll 0 $$ then the spectral sequence is bounded and converges to $H^*(X, \mathcal{F}^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-relative-spectral-sequence-filtered-object} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $\mathcal{F}^\bullet$ be a filtered complex of $\mathcal{O}_X$-modules. There exists a canonical spectral sequence $(E_r, \text{d}_r)_{r \geq 1}$ of bigraded $\mathcal{O}_Y$-modules with $d_r$ of bidegree $(r, -r + 1)$ and $$ E_1^{p, q} = R^{p + q}f_*\text{gr}^p\mathcal{F}^\bullet $$ If for every $n$ we have $$ R^nf_*F^p\mathcal{F}^\bullet = 0 \text{ for }p \gg 0 \quad\text{and}\quad R^nf_*F^p\mathcal{F}^\bullet = R^nf_*\mathcal{F}^\bullet \text{ for }p \ll 0 $$ then the spectral sequence is bounded and converges to $Rf_*\mathcal{F}^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-godement-resolution} Let $(X, \mathcal{O}_X)$ be a ringed space. For every sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ there is a resolution $$ 0 \to \mathcal{F} \to f_*f^*\mathcal{F} \to f_*f^*f_*f^*\mathcal{F} \to f_*f^*f_*f^*f_*f^*\mathcal{F} \to \ldots $$ functorial in $\mathcal{F}$ such that each term $f_*f^* \ldots f_*f^*\mathcal{F}$ is a flasque $\mathcal{O}_X$-module and such that for all $x \in X$ the map $$ \mathcal{F}_x[0] \to \Big( (f_*f^*\mathcal{F})_x \to (f_*f^*f_*f^*\mathcal{F})_x \to (f_*f^*f_*f^*f_*f^*\mathcal{F})_x \to \ldots \Big) $$ is a homotopy equivalence in the category of complexes of $\mathcal{O}_{X, x}$-modules. \end{lemma} 
\begin{lemma} \label{lemma-godement-resolution-bounded-below} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}^\bullet$ be a bounded below complex of $\mathcal{O}_X$-modules. There exists a quasi-isomorphism $\mathcal{F}^\bullet \to \mathcal{G}^\bullet$ where $\mathcal{G}^\bullet$ be a bounded below complex of flasque $\mathcal{O}_X$-modules and for all $x \in X$ the map $\mathcal{F}^\bullet_x \to \mathcal{G}^\bullet_x$ is a homotopy equivalence in the category of complexes of $\mathcal{O}_{X, x}$-modules. \end{lemma} 
\begin{lemma} \label{lemma-second-cup-equals-first} This construction gives the cup product. \end{lemma} 
\begin{lemma} \label{lemma-cup-compatible-with-naive} In the situation above the following diagram commutes $$ \xymatrix{ f_*\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y}^\mathbf{L} f_*\mathcal{M}^\bullet \ar[r] \ar[d] & Rf_*\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*\mathcal{M}^\bullet \ar[d]^{\text{Remark \ref{remark-cup-product}}} \\ \text{Tot}( f_*\mathcal{K}^\bullet \otimes_{\mathcal{O}_Y} f_*\mathcal{M}^\bullet) \ar[d]_{\text{naive cup product}} & Rf_*(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{M}^\bullet) \ar[d] \\ f_*\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{M}^\bullet) \ar[r] & Rf_*\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{M}^\bullet) } $$ \end{lemma} 
\begin{lemma} \label{lemma-diagrams-commute} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{K}^\bullet$ and $\mathcal{M}^\bullet$ be bounded below complexes of $\mathcal{O}_X$-modules. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering Then $$ \xymatrix{ \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{K}^\bullet)) \otimes_A^\mathbf{L} \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{M}^\bullet)) \ar[d] \ar[r] & R\Gamma(X, \mathcal{K}^\bullet) \otimes_A^\mathbf{L} R\Gamma(X, \mathcal{M}^\bullet) \ar[d]^\mu \\ \text{Tot}( \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{K}^\bullet)) \otimes_A \text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{M}^\bullet))) \ar[d]^{(\ref{equation-needs-signs})} & R\Gamma(X, \mathcal{K}^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{M}^\bullet) \ar[d] \\ \text{Tot}( \check{\mathcal{C}}^\bullet({\mathcal U}, \text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{M}^\bullet) )) \ar[r] & R\Gamma(X, \text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{M}^\bullet)) } $$ where the horizontal arrows are the ones in Lemma \ref{lemma-cech-complex-complex} commutes in $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-cup-product-associative} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. The relative cup product of Remark \ref{remark-cup-product} is associative in the sense that the diagram $$ \xymatrix{ Rf_*K \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*L \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*M \ar[r] \ar[d] & Rf_*(K \otimes_{\mathcal{O}_X}^\mathbf{L} L) \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*M \ar[d] \\ Rf_*K \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*(L \otimes_{\mathcal{O}_X}^\mathbf{L} M) \ar[r] & Rf_*(K \otimes_{\mathcal{O}_X}^\mathbf{L}  L \otimes_{\mathcal{O}_X}^\mathbf{L} M) } $$ is commutative in $D(\mathcal{O}_Y)$ for all $K, L, M$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-cup-product-commutative} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. The relative cup product of Remark \ref{remark-cup-product} is commutative in the sense that the diagram $$ \xymatrix{ Rf_*K \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*L \ar[r] \ar[d]_\psi & Rf_*(K \otimes_{\mathcal{O}_X}^\mathbf{L} L) \ar[d]^{Rf_*\psi} \\ Rf_*L \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*K \ar[r] & Rf_*(L \otimes_{\mathcal{O}_X}^\mathbf{L} K) } $$ is commutative in $D(\mathcal{O}_Y)$ for all $K, L$ in $D(\mathcal{O}_X)$. Here $\psi$ is the commutativity constraint on the derived category (Lemma \ref{lemma-symmetric-monoidal-derived}). \end{lemma} 
\begin{lemma} \label{lemma-compose-cup-product} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ and $g : (Y, \mathcal{O}_Y) \to (Z, \mathcal{O}_Z)$ be morphisms of ringed spaces. The relative cup product of Remark \ref{remark-cup-product} is compatible with compositions in the sense that the diagram $$ \xymatrix{ R(g \circ f)_*K \otimes_{\mathcal{O}_Z}^\mathbf{L} R(g \circ f)_*L \ar@{=}[rr] \ar[d] & & Rg_*Rf_*K \otimes_{\mathcal{O}_Z}^\mathbf{L} Rg_*Rf_*L \ar[d] \\ R(g \circ f)_*(K \otimes_{\mathcal{O}_X}^\mathbf{L} L) \ar@{=}[r] & Rg_*Rf_*(K \otimes_{\mathcal{O}_X}^\mathbf{L} L) & Rg_*(Rf_*K \otimes_{\mathcal{O}_Y}^\mathbf{L}  Rf_*L) \ar[l] } $$ is commutative in $D(\mathcal{O}_Z)$ for all $K, L$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-restrict-K-injective-to-open} Let $X$ be a ringed space. Let $U \subset X$ be an open subspace. The restriction of a K-injective complex of $\mathcal{O}_X$-modules to $U$ is a K-injective complex of $\mathcal{O}_U$-modules. \end{lemma} 
\begin{lemma} \label{lemma-unbounded-cohomology-of-open} Let $X$ be a ringed space. Let $U \subset X$ be an open subspace. For $K$ in $D(\mathcal{O}_X)$ we have $H^p(U, K) = H^p(U, K|_U)$. \end{lemma} 
\begin{lemma} \label{lemma-sheafification-cohomology} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K$ be an object of $D(\mathcal{O}_X)$. The sheafification of $$ U \mapsto H^q(U, K) = H^q(U, K|_U) $$ is the $q$th cohomology sheaf $H^q(K)$ of $K$. \end{lemma} 
\begin{lemma} \label{lemma-restrict-direct-image-open} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Given an open subspace $V \subset Y$, set $U = f^{-1}(V)$ and denote $g : U \to V$ the induced morphism. Then $(Rf_*E)|_V = Rg_*(E|_U)$ for $E$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-Leray-unbounded} Let $f : X \to Y$ be a morphism of ringed spaces. Then $R\Gamma(Y, -) \circ Rf_* = R\Gamma(X, -)$ as functors $D(\mathcal{O}_X) \to D(\Gamma(Y, \mathcal{O}_Y))$. More generally for $V \subset Y$ open and $U = f^{-1}(V)$ we have $R\Gamma(U, -) = R\Gamma(V, -) \circ Rf_*$. \end{lemma} 
\begin{lemma} \label{lemma-unbounded-describe-higher-direct-images} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $K$ be in $D(\mathcal{O}_X)$. Then $H^i(Rf_*K)$ is the sheaf associated to the presheaf $$ V \mapsto H^i(f^{-1}(V), K) = H^i(V, Rf_*K) $$ \end{lemma} 
\begin{lemma} \label{lemma-modules-abelian-unbounded} Let $X$ be a ringed space. Let $K$ be an object of $D(\mathcal{O}_X)$ and denote $K_{ab}$ its image in $D(\underline{\mathbf{Z}}_X)$. \begin{enumerate} \item For any open $U \subset X$ there is a canonical map $R\Gamma(U, K) \to R\Gamma(U, K_{ab})$ which is an isomorphism in $D(\textit{Ab})$. \item Let $f : X \to Y$ be a morphism of ringed spaces. There is a canonical map $Rf_*K \to Rf_*(K_{ab})$ which is an isomorphism in $D(\underline{\mathbf{Z}}_Y)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-adjoint-lower-shriek-restrict} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $U \subset X$ be an open subset. Denote $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$ the corresponding open immersion. The restriction functor $D(\mathcal{O}_X) \to D(\mathcal{O}_U)$ is a right adjoint to extension by zero $j_! : D(\mathcal{O}_U) \to D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-K-injective-flat} Let $f : X \to Y$ be a flat morphism of ringed spaces. If $\mathcal{I}^\bullet$ is a K-injective complex of $\mathcal{O}_X$-modules, then $f_*\mathcal{I}^\bullet$ is K-injective as a complex of $\mathcal{O}_Y$-modules. \end{lemma} 
\begin{lemma} \label{lemma-exact-sequence-lower-shriek} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $X = U \cup V$ be the union of two open subspaces. For any object $E$ of $D(\mathcal{O}_X)$ we have a distinguished triangle $$ j_{U \cap V!}E|_{U \cap V} \to j_{U!}E|_U \oplus j_{V!}E|_V \to E \to  j_{U \cap V!}E|_{U \cap V}[1] $$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-exact-sequence-j-star} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $X = U \cup V$ be the union of two open subspaces. For any object $E$ of $D(\mathcal{O}_X)$ we have a distinguished triangle $$ E \to  Rj_{U, *}E|_U \oplus Rj_{V, *}E|_V \to Rj_{U \cap V, *}E|_{U \cap V} \to E[1] $$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-mayer-vietoris-hom} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $X = U \cup V$ be the union of two open subspaces of $X$. For objects $E$, $F$ of $D(\mathcal{O}_X)$ we have a Mayer-Vietoris sequence $$ \xymatrix{ & \ldots \ar[r] & \Ext^{-1}(E_{U \cap V}, F_{U \cap V}) \ar[lld] \\ \Hom(E, F) \ar[r] & \Hom(E_U, F_U) \oplus \Hom(E_V, F_V) \ar[r] & \Hom(E_{U \cap V}, F_{U \cap V}) } $$ where the subscripts denote restrictions to the relevant opens and the $\Hom$'s and $\Ext$'s are taken in the relevant derived categories. \end{lemma} 
\begin{lemma} \label{lemma-unbounded-mayer-vietoris} Let $(X, \mathcal{O}_X)$ be a ringed space. Suppose that $X = U \cup V$ is a union of two open subsets. For an object $E$ of $D(\mathcal{O}_X)$ we have a distinguished triangle $$ R\Gamma(X, E) \to R\Gamma(U, E) \oplus R\Gamma(V, E) \to R\Gamma(U \cap V, E) \to R\Gamma(X, E)[1] $$ and in particular a long exact cohomology sequence $$ \ldots \to H^n(X, E) \to H^n(U, E) \oplus H^0(V, E) \to H^n(U \cap V, E) \to H^{n + 1}(X, E) \to \ldots $$ The construction of the distinguished triangle and the long exact sequence is functorial in $E$. \end{lemma} 
\begin{lemma} \label{lemma-unbounded-relative-mayer-vietoris} Let $f : X \to Y$ be a morphism of ringed spaces. Suppose that $X = U \cup V$ is a union of two open subsets. Denote $a = f|_U : U \to Y$, $b = f|_V : V \to Y$, and $c = f|_{U \cap V} : U \cap V \to Y$. For every object $E$ of $D(\mathcal{O}_X)$ there exists a distinguished triangle $$ Rf_*E \to Ra_*(E|_U) \oplus Rb_*(E|_V) \to Rc_*(E|_{U \cap V}) \to Rf_*E[1] $$ This triangle is functorial in $E$. \end{lemma} 
\begin{lemma} \label{lemma-pushforward-restriction} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $j : U \to X$ be an open subspace. Let $T \subset X$ be a closed subset contained in $U$. \begin{enumerate} \item If $E$ is an object of $D(\mathcal{O}_X)$ whose cohomology sheaves are supported on $T$, then $E \to Rj_*(E|_U)$ is an isomorphism. \item If $F$ is an object of $D(\mathcal{O}_U)$ whose cohomology sheaves are supported on $T$, then $j_!F \to Rj_*F$ is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-mayer-vietoris-cup} Let $(X, \mathcal{O}_X)$ be a ringed space. Set $A = \Gamma(X, \mathcal{O}_X)$. Suppose that $X = U \cup V$ is a union of two open subsets. For objects $K$ and $M$ of $D(\mathcal{O}_X)$ we have a map of distinguished triangles $$ \xymatrix{ R\Gamma(X, K) \otimes_A^\mathbf{L} R\Gamma(X, M) \ar[r] \ar[d] & R\Gamma(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} M) \ar[d] \\ R\Gamma(X, K) \otimes_A^\mathbf{L} (R\Gamma(U, M) \oplus R\Gamma(V, M)) \ar[r] \ar[d] & R\Gamma(U, K \otimes_{\mathcal{O}_X}^\mathbf{L} M) \oplus R\Gamma(V, K \otimes_{\mathcal{O}_X}^\mathbf{L} M)) \ar[d] \\ R\Gamma(X, K) \otimes_A^\mathbf{L} R\Gamma(U \cap V, M) \ar[r] \ar[d] & R\Gamma(U \cap V, K \otimes_{\mathcal{O}_X}^\mathbf{L} M) \ar[d] \\ R\Gamma(X, K) \otimes_A^\mathbf{L} R\Gamma(X, M)[1] \ar[r] & R\Gamma(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} M)[1] } $$ where \begin{enumerate} \item the horizontal arrows are given by cup product, \item on the right hand side we have the distinguished triangle of Lemma \ref{lemma-unbounded-mayer-vietoris} for $K \otimes_{\mathcal{O}_X}^\mathbf{L} M$, and \item on the left hand side we have the exact functor $R\Gamma(X, K) \otimes_A^\mathbf{L} - $ applied to the distinguished triangle of Lemma \ref{lemma-unbounded-mayer-vietoris} for $M$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cohomology-with-support-sheaf-on-support} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. \begin{enumerate} \item $R\mathcal{H}_Z : D(\mathcal{O}_X) \to D(\mathcal{O}_X|_Z)$ is right adjoint to $i_* : D(\mathcal{O}_X|_Z) \to D(\mathcal{O}_X)$. \item For $K$ in $D(\mathcal{O}_X|_Z)$ we have $R\mathcal{H}_Z(i_*K) = K$. \item Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_X|_Z$-modules on $Z$. Then $\mathcal{H}^p_Z(i_*\mathcal{G}) = 0$ for $p > 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-complexes-with-support-on-closed} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. \begin{enumerate} \item For $K$ in $D(\mathcal{O}_X|_Z)$ we have $i_*K$ in $D_Z(\mathcal{O}_X)$. \item The functor $i_* : D(\mathcal{O}_X|_Z) \to D_Z(\mathcal{O}_X)$ is an equivalence with quasi-inverse $i^{-1}|_{D_Z(\mathcal{O}_X)} = R\mathcal{H}_Z|_{D_Z(\mathcal{O}_X)}$. \item The functor $i_* \circ R\mathcal{H}_Z : D(\mathcal{O}_X) \to D_Z(\mathcal{O}_X)$ is right adjoint to the inclusion functor $D_Z(\mathcal{O}_X) \to D(\mathcal{O}_X)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-sections-with-support-K-injective} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. If $\mathcal{I}^\bullet$ is a K-injective complex of $\mathcal{O}_X$-modules, then $\mathcal{H}_Z(\mathcal{I}^\bullet)$ is K-injective complex of $\mathcal{O}_X|_Z$-modules. \end{lemma} 
\begin{lemma} \label{lemma-local-to-global-sections-with-support} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. Then $R\Gamma(Z, - ) \circ R\mathcal{H}_Z = R\Gamma_Z(X, - )$ as functors $D(\mathcal{O}_X) \to D(\mathcal{O}_X(X))$. \end{lemma} 
\begin{lemma} \label{lemma-triangle-sections-with-support} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. Let $U = X \setminus Z$. There is a distinguished triangle $$ R\Gamma_Z(X, K) \to R\Gamma(X, K) \to R\Gamma(U, K) \to R\Gamma_Z(X, K)[1] $$ in $D(\mathcal{O}_X(X))$ functorial for $K$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-triangle-sections-with-support-sheaves} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $i : Z \to X$ be the inclusion of a closed subset. Denote $j : U = X \setminus Z \to X$ the inclusion of the complement. There is a distinguished triangle $$ i_*R\mathcal{H}_Z(K) \to K \to Rj_*(K|_U) \to i_*R\mathcal{H}_Z(K)[1] $$ in $D(\mathcal{O}_X)$ functorial for $K$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-sections-support-in-closed-disjoint-open} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $Z \subset X$ be a closed subset. Let $j : U \to X$ be the inclusion of an open subset with $U \cap Z = \emptyset$. Then $R\mathcal{H}_Z(Rj_*K) = 0$ for all $K$ in $D(\mathcal{O}_U)$. \end{lemma} 
\begin{lemma} \label{lemma-sections-support-abelian-unbounded} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $Z \subset X$ be a closed subset. Let $K$ be an object of $D(\mathcal{O}_X)$ and denote $K_{ab}$ its image in $D(\underline{\mathbf{Z}}_X)$. \begin{enumerate} \item There is a canonical map $R\Gamma_Z(X, K) \to R\Gamma_Z(X, K_{ab})$ which is an isomorphism in $D(\textit{Ab})$. \item There is a canonical map $R\mathcal{H}_Z(K) \to R\mathcal{H}_Z(K_{ab})$ which is an isomorphism in $D(\underline{\mathbf{Z}}_Z)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-support-cup-product} With notation as in Remark \ref{remark-support-cup-product} the diagram $$ \xymatrix{ H^i(X, K) \times H^j_Z(X, M) \ar[r] \ar[d] & H^{i + j}_Z(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} M) \ar[d] \\ H^i(X, K) \times H^j(X, M) \ar[r] & H^{i + j}(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} M) } $$ commutes where the top horizontal arrow is the cup product of Remark \ref{remark-support-cup-product-global}. \end{lemma} 
\begin{lemma} \label{lemma-support-functorial} With notation and assumptions as in Remark \ref{remark-support-functorial} the diagram $$ \xymatrix{ H^p_Z(X, K) \ar[r] \ar[d] & H^p_{Z'}(X, Lf^*K) \ar[d] \\ H^p(X, K) \ar[r] & H^p(X', Lf^*K) } $$ commutes. Here the top horizontal arrow comes from the identifications $H^p_Z(X, K) = H^p(Z, R\mathcal{H}_Z(K))$ and $H^p_{Z'}(X', Lf^*K) = H^p(Z', R\mathcal{H}_{Z'}(K'))$, the pullback map $H^p(Z, R\mathcal{H}_Z(K)) \to H^p(Z', L(f|_{Z'})^*R\mathcal{H}_Z(K))$, and the map constructed in Remark \ref{remark-support-functorial}. \end{lemma} 
\begin{lemma} \label{lemma-ML-general} Let $I$ be an ideal of a ring $A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules on $X$ such that $\mathcal{F}_n = \mathcal{F}_{n + 1}/I^n\mathcal{F}_{n + 1}$. Let $p \geq 0$. Assume $$ \bigoplus\nolimits_{n \geq 0} H^{p + 1}(X, I^n\mathcal{F}_{n + 1}) $$ satisfies the ascending chain condition as a graded $\bigoplus_{n \geq 0} I^n/I^{n + 1}$-module. Then the inverse system $M_n = H^p(X, \mathcal{F}_n)$ satisfies the Mittag-Leffler condition\footnote{In fact, there exists a $c \geq 0$ such that $\Im(M_n \to M_{n - c})$ is the stable image for all $n \geq c$.}. \end{lemma} 
\begin{lemma} \label{lemma-ML-general-better} Let $I$ be an ideal of a ring $A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of $A$-modules on $X$ such that $\mathcal{F}_n = \mathcal{F}_{n + 1}/I^n\mathcal{F}_{n + 1}$. Let $p \geq 0$. Given $n$ define $$ N_n = \bigcap\nolimits_{m \geq n} \Im\left( H^{p + 1}(X, I^n\mathcal{F}_{m + 1}) \to H^{p + 1}(X, I^n\mathcal{F}_{n + 1}) \right) $$ If $\bigoplus N_n$ satisfies the ascending chain condition as a graded $\bigoplus_{n \geq 0} I^n/I^{n + 1}$-module, then the inverse system $M_n = H^p(X, \mathcal{F}_n)$ satisfies the Mittag-Leffler condition\footnote{In fact, there exists a $c \geq 0$ such that $\Im(M_n \to M_{n - c})$ is the stable image for all $n \geq c$.}. \end{lemma} 
\begin{lemma} \label{lemma-topology-I-adic-general} Let $I$ be an ideal of a ring $A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules on $X$ such that $\mathcal{F}_n = \mathcal{F}_{n + 1}/I^n\mathcal{F}_{n + 1}$. Let $p \geq 0$. Assume $$ \bigoplus\nolimits_{n \geq 0} H^p(X, I^n\mathcal{F}_{n + 1}) $$ satisfies the ascending chain condition as a graded $\bigoplus_{n \geq 0} I^n/I^{n + 1}$-module. Then the limit topology on $M = \lim H^p(X, \mathcal{F}_n)$ is the $I$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-topology-I-adic-general-better} Let $I$ be an ideal of a ring $A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules on $X$ such that $\mathcal{F}_n = \mathcal{F}_{n + 1}/I^n\mathcal{F}_{n + 1}$. Let $p \geq 0$. Given $n$ define $$ N_n = \bigcap\nolimits_{m \geq n} \Im\left( H^p(X, I^n\mathcal{F}_{m + 1}) \to H^p(X, I^n\mathcal{F}_{n + 1}) \right) $$ If $\bigoplus N_n$ satisfies the ascending chain condition as a graded $\bigoplus_{n \geq 0} I^n/I^{n + 1}$-module, then the limit topology on $M = \lim H^p(X, \mathcal{F}_n)$ is the $I$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-equivalent-f-good} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $f \in \Gamma(X, \mathcal{O}_X)$. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be inverse system of $\mathcal{O}_X$-modules. Consider the conditions \begin{enumerate} \item for all $n \geq 1$ the map $f : \mathcal{F}_{n + 1} \to \mathcal{F}_{n + 1}$ factors through $\mathcal{F}_{n + 1} \to \mathcal{F}_n$ to give a short exact sequence $0 \to \mathcal{F}_n \to \mathcal{F}_{n + 1} \to \mathcal{F}_1 \to 0$, \item for all $n \geq 1$ the map $f^n : \mathcal{F}_{n + 1} \to \mathcal{F}_{n + 1}$ factors through $\mathcal{F}_{n + 1} \to \mathcal{F}_1$ to give a short exact sequence $0 \to \mathcal{F}_1 \to \mathcal{F}_{n + 1} \to \mathcal{F}_n \to 0$ \item there exists an $\mathcal{O}_X$-module $\mathcal{G}$ which is $f$-divisible such that $\mathcal{F}_n = \mathcal{G}[f^n]$, and \item there exists an $\mathcal{O}_X$-module $\mathcal{F}$ which is $f$-torsion free such that $\mathcal{F}_n = \mathcal{F}/f^n\mathcal{F}$. \end{enumerate} Then (4) $\Rightarrow$ (3) $\Leftrightarrow$ (2) $\Leftrightarrow$ (1). \end{lemma} 
\begin{lemma} \label{lemma-topology-I-adic-f} Suppose $X$, $f$, $(\mathcal{F}_n)$ satisfy condition (1) of Lemma \ref{lemma-equivalent-f-good}. Let $p \geq 0$ and set $H^p = \lim H^p(X, \mathcal{F}_n)$. Then $f^cH^p$ is the kernel of $H^p \to H^p(X, \mathcal{F}_c)$ for all $c \geq 1$. Thus the limit topology on $H^p$ is the $f$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-limit-finite} Let $A$ be a Noetherian ring complete with respect to a principal ideal $(f)$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules. Assume \begin{enumerate} \item $\Gamma(X, \mathcal{F}_1)$ is a finite $A$-module, \item $X$, $f$, $(\mathcal{F}_n)$ satisfy condition (1) of Lemma \ref{lemma-equivalent-f-good}. \end{enumerate} Then $$ M = \lim \Gamma(X, \mathcal{F}_n) $$ is a finite $A$-module, $f$ is a nonzerodivisor on $M$, and $M/fM$ is the image of $M$ in $\Gamma(X, \mathcal{F}_1)$. \end{lemma} 
\begin{lemma} \label{lemma-ML} Let $A$ be a ring. Let $f \in A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules. Let $p \geq 0$. Assume \begin{enumerate} \item either $H^{p + 1}(X, \mathcal{F}_1)$ is an $A$-module of finite length or $A$ is Noetherian and $H^{p + 1}(X, \mathcal{F}_1)$ is a finite $A$-module, \item $X$, $f$, $(\mathcal{F}_n)$ satisfy condition (1) of Lemma \ref{lemma-equivalent-f-good}. \end{enumerate} Then the inverse system $M_n = H^p(X, \mathcal{F}_n)$ satisfies the Mittag-Leffler condition. \end{lemma} 
\begin{lemma} \label{lemma-ML-better} Let $A$ be a ring. Let $f \in A$. Let $X$ be a topological space. Let $$ \ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1 $$ be an inverse system of sheaves of $A$-modules. Let $p \geq 0$. Assume \begin{enumerate} \item either there is an $m \geq 1$ such that the image of $H^{p + 1}(X, \mathcal{F}_m) \to H^{p + 1}(X, \mathcal{F}_1)$ is an $A$-module of finite length or $A$ is Noetherian and the intersection of the images of $H^{p + 1}(X, \mathcal{F}_m) \to H^{p + 1}(X, \mathcal{F}_1)$ is a finite $A$-module, \item $X$, $f$, $(\mathcal{F}_n)$ satisfy condition (1) of Lemma \ref{lemma-equivalent-f-good}. \end{enumerate} Then the inverse system $M_n = H^p(X, \mathcal{F}_n)$ satisfies the Mittag-Leffler condition. \end{lemma} 
\begin{lemma} \label{lemma-RGamma-commutes-with-Rlim} Let $(X, \mathcal{O}_X)$ be a ringed space. For $U \subset X$ open the functor $R\Gamma(U, -)$ commutes with $R\lim$. Moreover, there are short exact sequences $$ 0 \to R^1\lim H^{m - 1}(U, K_n) \to H^m(U, R\lim K_n) \to \lim H^m(U, K_n) \to 0 $$ for any inverse system $(K_n)$ in $D(\mathcal{O}_X)$ and any $m \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-Rf-commutes-with-Rlim} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Then $Rf_*$ commutes with $R\lim$, i.e., $Rf_*$ commutes with derived limits. \end{lemma} 
\begin{lemma} \label{lemma-inverse-limit-is-derived-limit} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(\mathcal{F}_n)$ be an inverse system of $\mathcal{O}_X$-modules. Let $\mathcal{B}$ be a set of opens of $X$. Assume \begin{enumerate} \item every open of $X$ has a covering whose members are elements of $\mathcal{B}$, \item $H^p(U, \mathcal{F}_n) = 0$ for $p > 0$ and $U \in \mathcal{B}$, \item the inverse system $\mathcal{F}_n(U)$ has vanishing $R^1\lim$ for $U \in \mathcal{B}$. \end{enumerate} Then $R\lim \mathcal{F}_n = \lim \mathcal{F}_n$ and we have $H^p(U, \lim \mathcal{F}_n) = 0$ for $p > 0$ and $U \in \mathcal{B}$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-derived-limit-injective} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K_n)$ be an inverse system in $D(\mathcal{O}_X)$. Let $x \in X$ and $m \in \mathbf{Z}$. Assume there exist an integer $n(x)$ and a fundamental system $\mathfrak{U}_x$ of open neighbourhoods of $x$ such that for $U \in \mathfrak{U}_x$ \begin{enumerate} \item $R^1\lim H^{m - 1}(U, K_n) = 0$, and \item $H^m(U, K_n) \to H^m(U, K_{n(x)})$ is injective for $n \geq n(x)$. \end{enumerate} Then the map on stalks $H^m(R\lim K_n)_x \to H^m(K_{n(x)})_x$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-is-limit-per-point} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E \in D(\mathcal{O}_X)$. Assume that for every $x \in X$ there exist a function $p(x, -) : \mathbf{Z} \to \mathbf{Z}$ and a fundamental system $\mathfrak{U}_x$ of open neighbourhoods of $x$ such that $$ H^p(U, H^{m - p}(E)) = 0 \text{ for } U \in \mathfrak{U}_x \text{ and } p > p(x, m) $$ Then the map $E \to R\lim \tau_{\geq -n} E$ of Derived Categories, Remark \ref{derived-remark-map-into-derived-limit-truncations} is an isomorphism in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-is-limit-spaltenstein} \begin{reference} \cite[Proposition 3.13]{Spaltenstein} \end{reference} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E \in D(\mathcal{O}_X)$. Assume that for every $x \in X$ there exist an integer $d_x \geq 0$ and a fundamental system $\mathfrak{U}_x$ of open neighbourhoods of $x$ such that $$ H^p(U, H^q(E)) = 0 \text{ for } U \in \mathfrak{U}_x,\ p > d_x, \text{ and }q < 0 $$ Then the map $E \to R\lim \tau_{\geq -n} E$ of Derived Categories, Remark \ref{derived-remark-map-into-derived-limit-truncations} is an isomorphism in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-is-limit} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E \in D(\mathcal{O}_X)$. Assume there exist a function $p(-) : \mathbf{Z} \to \mathbf{Z}$ and a set $\mathcal{B}$ of opens of $X$ such that \begin{enumerate} \item every open in $X$ has a covering whose members are elements of $\mathcal{B}$, and \item $H^p(U, H^{m - p}(E)) = 0$ for $p > p(m)$ and $U \in \mathcal{B}$. \end{enumerate} Then the map $E \to R\lim \tau_{\geq -n} E$ of Derived Categories, Remark \ref{derived-remark-map-into-derived-limit-truncations} is an isomorphism in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-is-limit-dimension} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E \in D(\mathcal{O}_X)$. Assume there exist an integer $d \geq 0$ and a basis $\mathcal{B}$ for the topology of $X$ such that $$ H^p(U, H^q(E)) = 0 \text{ for } U \in \mathcal{B},\ p > d, \text{ and }q < 0 $$ Then the map $E \to R\lim \tau_{\geq -n} E$ of Derived Categories, Remark \ref{derived-remark-map-into-derived-limit-truncations} is an isomorphism in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-over-U-trivial} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K$ be an object of $D(\mathcal{O}_X)$. Let $\mathcal{B}$ be a set of opens of $X$. Assume \begin{enumerate} \item every open of $X$ has a covering whose members are elements of $\mathcal{B}$, \item $H^p(U, H^q(K)) = 0$ for all $p > 0$, $q \in \mathbf{Z}$, and $U \in \mathcal{B}$. \end{enumerate} Then $H^q(U, K) = H^0(U, H^q(K))$ for $q \in \mathbf{Z}$ and $U \in \mathcal{B}$. \end{lemma} 
\begin{lemma} \label{lemma-derived-limit-suitable-system} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K_n)$ be an inverse system of objects of $D(\mathcal{O}_X)$. Let $\mathcal{B}$ be a set of opens of $X$. Assume \begin{enumerate} \item every open of $X$ has a covering whose members are elements of $\mathcal{B}$, \item for all $U \in \mathcal{B}$ and all $q \in \mathbf{Z}$ we have \begin{enumerate} \item $H^p(U, H^q(K_n)) = 0$ for $p > 0$, \item the inverse system $H^0(U, H^q(K_n))$ has vanishing $R^1\lim$. \end{enumerate} \end{enumerate} Then $H^q(R\lim K_n) = \lim H^q(K_n)$ for $q \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-K-injective} In the situation described above. Denote $\mathcal{H}^m = H^m(\mathcal{F}^\bullet)$ the $m$th cohomology sheaf. Let $\mathcal{B}$ be a set of open subsets of $X$. Let $d \in \mathbf{N}$. Assume \begin{enumerate} \item every open in $X$ has a covering whose members are elements of $\mathcal{B}$, \item for every $U \in \mathcal{B}$ we have $H^p(U, \mathcal{H}^q) = 0$ for $p > d$ and $q < 0$\footnote{It suffices if $\forall m$, $\exists p(m)$, $H^p(U. \mathcal{H}^{m - p}) = 0$ for $p > p(m)$, see Lemma \ref{lemma-is-limit}.}. \end{enumerate} Then (\ref{equation-into-candidate-K-injective}) is a quasi-isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-inverse-limit-complexes} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(\mathcal{F}_n^\bullet)$ be an inverse system of complexes of $\mathcal{O}_X$-modules. Let $m \in \mathbf{Z}$. Assume there exist a set $\mathcal{B}$ of open subsets of $X$ and an integer $n_0$ such that \begin{enumerate} \item every open in $X$ has a covering whose members are elements of $\mathcal{B}$, \item for every $U \in \mathcal{B}$ \begin{enumerate} \item the systems of abelian groups $\mathcal{F}_n^{m - 2}(U)$ and $\mathcal{F}_n^{m - 1}(U)$ have vanishing $R^1\lim$ (for example these have the Mittag-Leffler condition), \item the system of abelian groups $H^{m - 1}(\mathcal{F}_n^\bullet(U))$ has vanishing $R^1\lim$ (for example it has the Mittag-Leffler condition), and \item we have $H^m(\mathcal{F}_n^\bullet(U)) = H^m(\mathcal{F}_{n_0}^\bullet(U))$ for all $n \geq n_0$. \end{enumerate} \end{enumerate} Then the maps $H^m(\mathcal{F}^\bullet) \to \lim H^m(\mathcal{F}_n^\bullet) \to H^m(\mathcal{F}_{n_0}^\bullet)$ are isomorphisms of sheaves where $\mathcal{F}^\bullet = \lim \mathcal{F}_n^\bullet$ is the termwise inverse limit. \end{lemma} 
\begin{lemma} \label{lemma-formal-functions-principal} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $A \to \Gamma(X, \mathcal{O}_X)$ be a ring map and let $f \in A$. Let $E$ be an object of $D(\mathcal{O}_X)$. Denote $$ E_n = E \otimes_{\mathcal{O}_X} (\mathcal{O}_X \xrightarrow{f^n} \mathcal{O}_X) $$ and set $E^\wedge = R\lim E_n$. For $p \in \mathbf{Z}$ is a canonical commutative diagram $$ \xymatrix{ & 0 & 0 \\ 0 \ar[r] & \widehat{H^p(X, E)} \ar[r] \ar[u] & \lim H^p(X, E_n) \ar[r] \ar[u] & T_f(H^{p + 1}(X, E)) \ar[r] & 0 \\ 0 \ar[r] & H^0(H^p(X, E)^\wedge) \ar[r] \ar[u] & H^p(X, E^\wedge) \ar[r] \ar[u] & T_f(H^{p + 1}(X, E)) \ar[r] \ar@{=}[u] & 0 \\ & R^1\lim H^p(X, E)[f^n] \ar[u] \ar[r]^\cong & R^1\lim H^{p - 1}(X, E_n) \ar[u] \\ & 0 \ar[u] & 0 \ar[u] } $$ with exact rows and columns where $\widehat{H^p(X, E)} = \lim H^p(X, E)/f^n H^p(X, E)$ is the usual $f$-adic completion, $H^p(X, E)^\wedge$ is the derived $f$-adic completion, and $T_f(H^{p + 1}(X, E))$ is the $f$-adic Tate module, see More on Algebra, Example \ref{more-algebra-example-spectral-sequence-principal}. Finally, we have $H^p(X, E^\wedge) = H^p(R\Gamma(X, E)^\wedge)$. \end{lemma} 
\begin{lemma} \label{lemma-stabilizes} Let $\mathcal{A}$ be an abelian category. Let $f : M \to M$ be a morphism of $\mathcal{A}$. If $M[f^n] = \Ker(f^n : M \to M)$ stabilizes, then the inverse systems $$ (M \xrightarrow{f^n} M) \quad\text{and}\quad \Coker(f^n : M \to M) $$ are pro-isomorphic in $D(\mathcal{A})$. \end{lemma} 
\begin{lemma} \label{lemma-alternating-cech-complex-complex} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be a finite open covering. For a complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical map $$ \text{Tot}(\check{\mathcal{C}}^\bullet_{alt}(\mathcal{U}, \mathcal{F}^\bullet)) \longrightarrow R\Gamma(X, \mathcal{F}^\bullet) $$ functorial in $\mathcal{F}^\bullet$ and compatible with (\ref{equation-global-sections-to-alternating-cech}). \end{lemma} 
\begin{lemma} \label{lemma-alternating-cech-complex-complex-ss} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be a finite open covering. Let $\mathcal{F}^\bullet$ be a complex of $\mathcal{O}_X$-modules. Let $\mathcal{B}$ be a set of open subsets of $X$. Assume \begin{enumerate} \item every open in $X$ has a covering whose members are elements of $\mathcal{B}$, \item we have $U_{i_0\ldots i_p} \in \mathcal{B}$ for all $i_0, \ldots, i_p \in I$, \item for every $U \in \mathcal{B}$ and $p > 0$ we have \begin{enumerate} \item $H^p(U, \mathcal{F}^q) = 0$, \item $H^p(U, \Coker(\mathcal{F}^{q - 1} \to \mathcal{F}^q)) = 0$, and \item $H^p(U, H^q(\mathcal{F})) = 0$. \end{enumerate} \end{enumerate} Then the map $$ \text{Tot}(\check{\mathcal{C}}^\bullet_{alt}(\mathcal{U}, \mathcal{F}^\bullet)) \longrightarrow R\Gamma(X, \mathcal{F}^\bullet) $$ of Lemma \ref{lemma-alternating-cech-complex-complex} is an isomorphism in $D(\textit{Ab})$. \end{lemma} 
\begin{lemma} \label{lemma-compose} Let $(X, \mathcal{O}_X)$ be a ringed space. Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$ of $\mathcal{O}_X$-modules there is an isomorphism $$ \SheafHom^\bullet(\mathcal{K}^\bullet, \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet)) = \SheafHom^\bullet(\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet), \mathcal{M}^\bullet) $$ of complexes of $\mathcal{O}_X$-modules functorial in $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-composition} Let $(X, \mathcal{O}_X)$ be a ringed space. Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical morphism $$ \text{Tot}\left( \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet) \otimes_{\mathcal{O}_X} \SheafHom^\bullet(\mathcal{K}^\bullet, \mathcal{L}^\bullet) \right) \longrightarrow \SheafHom^\bullet(\mathcal{K}^\bullet, \mathcal{M}^\bullet) $$ of complexes of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-diagonal-better} Let $(X, \mathcal{O}_X)$ be a ringed space. Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical morphism $$ \text{Tot}\left( \mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \SheafHom^\bullet(\mathcal{M}^\bullet, \mathcal{L}^\bullet) \right) \longrightarrow \SheafHom^\bullet(\mathcal{M}^\bullet, \text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet)) $$ of complexes of $\mathcal{O}_X$-modules functorial in all three complexes. \end{lemma} 
\begin{lemma} \label{lemma-diagonal} Let $(X, \mathcal{O}_X)$ be a ringed space. Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical morphism $$ \mathcal{K}^\bullet \longrightarrow \SheafHom^\bullet(\mathcal{L}^\bullet, \text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet)) $$ of complexes of $\mathcal{O}_X$-modules functorial in both complexes. \end{lemma} 
\begin{lemma} \label{lemma-evaluate-and-more} Let $(X, \mathcal{O}_X)$ be a ringed space. Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$ of $\mathcal{O}_X$-modules there is a canonical morphism $$ \text{Tot}(\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet) \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet) \longrightarrow \SheafHom^\bullet(\SheafHom^\bullet(\mathcal{K}^\bullet, \mathcal{L}^\bullet), \mathcal{M}^\bullet) $$ of complexes of $\mathcal{O}_X$-modules functorial in all three complexes. \end{lemma} 
\begin{lemma} \label{lemma-RHom-into-K-injective} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $L$ and $M$ be objects of $D(\mathcal{O}_X)$. Let $\mathcal{I}^\bullet$ be a K-injective complex of $\mathcal{O}_X$-modules representing $M$. Let $\mathcal{L}^\bullet$ be a complex of $\mathcal{O}_X$-modules representing $L$. Then $$ H^0(\Gamma(U, \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet))) = \Hom_{D(\mathcal{O}_U)}(L|_U, M|_U) $$ for all $U \subset X$ open. \end{lemma} 
\begin{lemma} \label{lemma-RHom-well-defined} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(\mathcal{I}')^\bullet \to \mathcal{I}^\bullet$ be a quasi-isomorphism of K-injective complexes of $\mathcal{O}_X$-modules. Let $(\mathcal{L}')^\bullet \to \mathcal{L}^\bullet$ be a quasi-isomorphism of complexes of $\mathcal{O}_X$-modules. Then $$ \SheafHom^\bullet(\mathcal{L}^\bullet, (\mathcal{I}')^\bullet) \longrightarrow \SheafHom^\bullet((\mathcal{L}')^\bullet, \mathcal{I}^\bullet) $$ is a quasi-isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-RHom-from-K-flat-into-K-injective} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{I}^\bullet$ be a K-injective complex of $\mathcal{O}_X$-modules. Let $\mathcal{L}^\bullet$ be a K-flat complex of $\mathcal{O}_X$-modules. Then $\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)$ is a K-injective complex of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-section-RHom-over-U} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $L, M$ be objects of $D(\mathcal{O}_X)$. For every open $U$ we have $$ H^0(U, R\SheafHom(L, M)) = \Hom_{D(\mathcal{O}_U)}(L|_U, M|_U) $$ and in particular $H^0(X, R\SheafHom(L, M)) = \Hom_{D(\mathcal{O}_X)}(L, M)$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L, M$ be objects of $D(\mathcal{O}_X)$. With the construction as described above there is a canonical isomorphism $$ R\SheafHom(K, R\SheafHom(L, M)) = R\SheafHom(K \otimes_{\mathcal{O}_X}^\mathbf{L} L, M) $$ in $D(\mathcal{O}_X)$ functorial in $K, L, M$ which recovers (\ref{equation-internal-hom}) by taking $H^0(X, -)$. \end{lemma} 
\begin{lemma} \label{lemma-restriction-RHom-to-U} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L$ be objects of $D(\mathcal{O}_X)$. The construction of $R\SheafHom(K, L)$ commutes with restrictions to opens, i.e., for every open $U$ we have $R\SheafHom(K|_U, L|_U) = R\SheafHom(K, L)|_U$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-triangulated} Let $(X, \mathcal{O}_X)$ be a ringed space. The bifunctor $R\SheafHom(- , -)$ transforms distinguished triangles into distinguished triangles in both variables. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-composition} Let $(X, \mathcal{O}_X)$ be a ringed space. Given $K, L, M$ in $D(\mathcal{O}_X)$ there is a canonical morphism $$ R\SheafHom(L, M) \otimes_{\mathcal{O}_X}^\mathbf{L} R\SheafHom(K, L) \longrightarrow R\SheafHom(K, M) $$ in $D(\mathcal{O}_X)$ functorial in $K, L, M$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-diagonal-better} Let $(X, \mathcal{O}_X)$ be a ringed space. Given $K, L, M$ in $D(\mathcal{O}_X)$ there is a canonical morphism $$ K \otimes_{\mathcal{O}_X}^\mathbf{L} R\SheafHom(M, L) \longrightarrow R\SheafHom(M, K \otimes_{\mathcal{O}_X}^\mathbf{L} L) $$ in $D(\mathcal{O}_X)$ functorial in $K, L, M$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-diagonal} Let $(X, \mathcal{O}_X)$ be a ringed space. Given $K, L$ in $D(\mathcal{O}_X)$ there is a canonical morphism $$ K \longrightarrow R\SheafHom(L, K \otimes_{\mathcal{O}_X}^\mathbf{L} L) $$ in $D(\mathcal{O}_X)$ functorial in both $K$ and $L$. \end{lemma} 
\begin{lemma} \label{lemma-dual} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $L$ be an object of $D(\mathcal{O}_X)$. Set $L^\vee = R\SheafHom(L, \mathcal{O}_X)$. For $M$ in $D(\mathcal{O}_X)$ there is a canonical map \begin{equation} \label{equation-eval} M \otimes^\mathbf{L}_{\mathcal{O}_X} L^\vee \longrightarrow R\SheafHom(L, M) \end{equation} which induces a canonical map $$ H^0(X, M \otimes^\mathbf{L}_{\mathcal{O}_X} L^\vee) \longrightarrow \Hom_{D(\mathcal{O}_X)}(L, M) $$ functorial in $M$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L, M$ be objects of $D(\mathcal{O}_X)$. There is a canonical morphism $$ R\SheafHom(L, M) \otimes_{\mathcal{O}_X}^\mathbf{L} K \longrightarrow R\SheafHom(R\SheafHom(K, L), M) $$ in $D(\mathcal{O}_X)$ functorial in $K, L, M$. \end{lemma} 
\begin{lemma} \label{lemma-glue} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $X = U \cup V$ be the union of two open subspaces of $X$. Suppose given \begin{enumerate} \item an object $A$ of $D(\mathcal{O}_U)$, \item an object $B$ of $D(\mathcal{O}_V)$, and \item an isomorphism $c : A|_{U \cap V} \to B|_{U \cap V}$. \end{enumerate} Then there exists an object $F$ of $D(\mathcal{O}_X)$ and isomorphisms $f : F|_U \to A$, $g : F|_V \to B$ such that $c = g|_{U \cap V} \circ f^{-1}|_{U \cap V}$. Moreover, given \begin{enumerate} \item an object $E$ of $D(\mathcal{O}_X)$, \item a morphism $a : A \to E|_U$ of $D(\mathcal{O}_U)$, \item a morphism $b : B \to E|_V$ of $D(\mathcal{O}_V)$,  \end{enumerate} such that $$ a|_{U \cap V}  = b|_{U \cap V} \circ c. $$ Then there exists a morphism $F \to E$ in $D(\mathcal{O}_X)$ whose restriction to $U$ is $a \circ f$ and whose restriction to $V$ is $b \circ g$. \end{lemma} 
\begin{lemma} \label{lemma-vanishing-and-glueing} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $\mathcal{B}$ be a basis for the topology on $Y$. \begin{enumerate} \item Assume $K$ is in $D(\mathcal{O}_X)$ such that for $V \in \mathcal{B}$ we have $H^i(f^{-1}(V), K) = 0$ for $i < 0$. Then $Rf_*K$ has vanishing cohomology sheaves in negative degrees, $H^i(f^{-1}(V), K) = 0$ for $i < 0$ for all opens $V \subset Y$, and the rule $V \mapsto H^0(f^{-1}V, K)$ is a sheaf on $Y$. \item Assume $K, L$ are in $D(\mathcal{O}_X)$ such that for $V \in \mathcal{B}$ we have $\Ext^i(K|_{f^{-1}V}, L|_{f^{-1}V}) = 0$ for $i < 0$. Then $\Ext^i(K|_{f^{-1}V}, L|_{f^{-1}V}) = 0$ for $i < 0$ for all opens $V \subset Y$ and the rule $V \mapsto \Hom(K|_{f^{-1}V}, L|_{f^{-1}V})$ is a sheaf on $Y$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-uniqueness} In Situation \ref{situation-locally-given} assume \begin{enumerate} \item $X = \bigcup_{U \in \mathcal{B}} U$ and for $U, V \in \mathcal{B}$ we have $U \cap V = \bigcup_{W \in \mathcal{B}, W \subset U \cap V} W$, \item for any $U \in \mathcal{B}$ we have $\Ext^i(K_U, K_U) = 0$ for $i < 0$. \end{enumerate} If a solution $(K, \rho_U)$ exists, then it is unique up to unique isomorphism and moreover $\Ext^i(K, K) = 0$ for $i < 0$. \end{lemma} 
\begin{lemma} \label{lemma-solution-in-finite-case} In Situation \ref{situation-locally-given} assume \begin{enumerate} \item $X = U_1 \cup \ldots \cup U_n$ with $U_i \in \mathcal{B}$, \item for $U, V \in \mathcal{B}$ we have $U \cap V = \bigcup_{W \in \mathcal{B}, W \subset U \cap V} W$, \item for any $U \in \mathcal{B}$ we have $\Ext^i(K_U, K_U) = 0$ for $i < 0$. \end{enumerate} Then a solution exists and is unique up to unique isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-glueing-increasing-union} Let $X$ be a ringed space. Let $E$ be a well ordered set and let $$ X = \bigcup\nolimits_{\alpha \in E} W_\alpha $$ be an open covering with $W_\alpha \subset W_{\alpha + 1}$ and $W_\alpha = \bigcup_{\beta < \alpha} W_\beta$ if $\alpha$ is not a successor. Let $K_\alpha$ be an object of $D(\mathcal{O}_{W_\alpha})$ with $\Ext^i(K_\alpha, K_\alpha) = 0$ for $i < 0$. Assume given isomorphisms $\rho_\beta^\alpha :  K_\alpha|_{W_\beta} \to K_\beta$ in $D(\mathcal{O}_{W_\beta})$ for all $\beta < \alpha$ with $\rho_\gamma^\alpha = \rho_\gamma^\beta \circ \rho^\alpha_\beta|_{W_\gamma}$ for $\gamma < \beta < \alpha$. Then there exists an object $K$ in $D(\mathcal{O}_X)$ and isomorphisms $K|_{W_\alpha} \to K_\alpha$ for $\alpha \in E$ compatible with the isomorphisms $\rho_\beta^\alpha$. \end{lemma} 
\begin{theorem}[BBD gluing lemma] \label{theorem-glueing-bbd-general} \begin{reference} Special case of \cite[Theorem 3.2.4]{BBD} without boundedness assumption. \end{reference} In Situation \ref{situation-locally-given} assume \begin{enumerate} \item $X = \bigcup_{U \in \mathcal{B}} U$, \item for $U, V \in \mathcal{B}$ we have $U \cap V = \bigcup_{W \in \mathcal{B}, W \subset U \cap V} W$, \item for any $U \in \mathcal{B}$ we have $\Ext^i(K_U, K_U) = 0$ for $i < 0$. \end{enumerate} Then there exists an object $K$ of $D(\mathcal{O}_X)$ and isomorphisms $\rho_U : K|_U \to K_U$ in $D(\mathcal{O}_U)$ for $U \in \mathcal{B}$ such that $\rho^U_V \circ \rho_U|_V = \rho_V$ for all $V \subset U$ with $U, V \in \mathcal{B}$. The pair $(K, \rho_U)$ is unique up to unique isomorphism. \end{theorem} 
\begin{definition} \label{definition-strictly-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}_X$-modules. We say $\mathcal{E}^\bullet$ is {\it strictly perfect} if $\mathcal{E}^i$ is zero for all but finitely many $i$ and $\mathcal{E}^i$ is a direct summand of a finite free $\mathcal{O}_X$-module for all $i$. \end{definition} 
\begin{lemma} \label{lemma-cone} The cone on a morphism of strictly perfect complexes is strictly perfect. \end{lemma} 
\begin{lemma} \label{lemma-tensor} The total complex associated to the tensor product of two strictly perfect complexes is strictly perfect. \end{lemma} 
\begin{lemma} \label{lemma-strictly-perfect-pullback} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. If $\mathcal{F}^\bullet$ is a strictly perfect complex of $\mathcal{O}_Y$-modules, then $f^*\mathcal{F}^\bullet$ is a strictly perfect complex of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-local-lift-map} Let $(X, \mathcal{O}_X)$ be a ringed space. Given a solid diagram of $\mathcal{O}_X$-modules $$ \xymatrix{ \mathcal{E} \ar@{..>}[dr] \ar[r] & \mathcal{F} \\ & \mathcal{G} \ar[u]_p } $$ with $\mathcal{E}$ a direct summand of a finite free $\mathcal{O}_X$-module and $p$ surjective, then a dotted arrow making the diagram commute exists locally on $X$. \end{lemma} 
\begin{lemma} \label{lemma-local-homotopy} Let $(X, \mathcal{O}_X)$ be a ringed space. \begin{enumerate} \item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$ be a morphism of complexes of $\mathcal{O}_X$-modules with $\mathcal{E}^\bullet$ strictly perfect and $\mathcal{F}^\bullet$ acyclic. Then $\alpha$ is locally on $X$ homotopic to zero. \item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$ be a morphism of complexes of $\mathcal{O}_X$-modules with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^i = 0$ for $i < a$, and $H^i(\mathcal{F}^\bullet) = 0$ for $i \geq a$. Then $\alpha$ is locally on $X$ homotopic to zero. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lift-through-quasi-isomorphism} Let $(X, \mathcal{O}_X)$ be a ringed space. Given a solid diagram of complexes of $\mathcal{O}_X$-modules $$ \xymatrix{ \mathcal{E}^\bullet \ar@{..>}[dr] \ar[r]_\alpha & \mathcal{F}^\bullet \\ & \mathcal{G}^\bullet \ar[u]_f } $$ with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^j = 0$ for $j < a$ and $H^j(f)$ an isomorphism for $j > a$ and surjective for $j = a$, then a dotted arrow making the diagram commute up to homotopy exists locally on $X$. \end{lemma} 
\begin{lemma} \label{lemma-local-actual} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes of $\mathcal{O}_X$-modules with $\mathcal{E}^\bullet$ strictly perfect. \begin{enumerate} \item For any element $\alpha \in \Hom_{D(\mathcal{O}_X)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$ there exists an open covering $X = \bigcup U_i$ such that $\alpha|_{U_i}$ is given by a morphism of complexes $\alpha_i : \mathcal{E}^\bullet|_{U_i} \to \mathcal{F}^\bullet|_{U_i}$. \item Given a morphism of complexes $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$ whose image in the group $\Hom_{D(\mathcal{O}_X)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$ is zero, there exists an open covering $X = \bigcup U_i$ such that $\alpha|_{U_i}$ is homotopic to zero. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Rhom-strictly-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes of $\mathcal{O}_X$-modules with $\mathcal{E}^\bullet$ strictly perfect. Then the internal hom $R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$ is represented by the complex $\mathcal{H}^\bullet$ with terms $$ \mathcal{H}^n = \bigoplus\nolimits_{n = p + q} \SheafHom_{\mathcal{O}_X}(\mathcal{E}^{-q}, \mathcal{F}^p) $$ and differential as described in Section \ref{section-hom-complexes}. \end{lemma} 
\begin{lemma} \label{lemma-Rhom-strictly-perfect-K-flat} In the situation of Lemma \ref{lemma-Rhom-strictly-perfect} if $\mathcal{F}^\bullet$ is K-flat, then $\mathcal{H}^\bullet$ is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-Rhom-complex-of-direct-summands-finite-free} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes of $\mathcal{O}_X$-modules with \begin{enumerate} \item $\mathcal{F}^n = 0$ for $n \ll 0$, \item $\mathcal{E}^n = 0$ for $n \gg 0$, and \item $\mathcal{E}^n$ isomorphic to a direct summand of a finite free $\mathcal{O}_X$-module. \end{enumerate} Then the internal hom $R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$ is represented by the complex $\mathcal{H}^\bullet$ with terms $$ \mathcal{H}^n = \bigoplus\nolimits_{n = p + q} \SheafHom_{\mathcal{O}_X}(\mathcal{E}^{-q}, \mathcal{F}^p) $$ and differential as described in Section \ref{section-internal-hom}. \end{lemma} 
\begin{definition} \label{definition-pseudo-coherent} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}_X$-modules. Let $m \in \mathbf{Z}$. \begin{enumerate} \item We say $\mathcal{E}^\bullet$ is {\it $m$-pseudo-coherent} if there exists an open covering $X = \bigcup U_i$ and for each $i$ a morphism of complexes $\alpha_i : \mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$ where $\mathcal{E}_i^\bullet$ is strictly perfect on $U_i$ and $H^j(\alpha_i)$ is an isomorphism for $j > m$ and $H^m(\alpha_i)$ is surjective. \item We say $\mathcal{E}^\bullet$ is {\it pseudo-coherent} if it is $m$-pseudo-coherent for all $m$. \item We say an object $E$ of $D(\mathcal{O}_X)$ is {\it $m$-pseudo-coherent} (resp.\ {\it pseudo-coherent}) if and only if it can be represented by a $m$-pseudo-coherent (resp.\ pseudo-coherent) complex of $\mathcal{O}_X$-modules. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-pseudo-coherent-independent-representative} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. \begin{enumerate} \item If there exists an open covering $X = \bigcup U_i$, strictly perfect complexes $\mathcal{E}_i^\bullet$ on $U_i$, and maps $\alpha_i : \mathcal{E}_i^\bullet \to E|_{U_i}$ in $D(\mathcal{O}_{U_i})$ with $H^j(\alpha_i)$ an isomorphism for $j > m$ and $H^m(\alpha_i)$ surjective, then $E$ is $m$-pseudo-coherent. \item If $E$ is $m$-pseudo-coherent, then any complex representing $E$ is $m$-pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-pullback} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $E$ be an object of $D(\mathcal{O}_Y)$. If $E$ is $m$-pseudo-coherent, then $Lf^*E$ is $m$-pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-cone-pseudo-coherent} Let $(X, \mathcal{O}_X)$ be a ringed space and $m \in \mathbf{Z}$. Let $(K, L, M, f, g, h)$ be a distinguished triangle in $D(\mathcal{O}_X)$. \begin{enumerate} \item If $K$ is $(m + 1)$-pseudo-coherent and $L$ is $m$-pseudo-coherent then $M$ is $m$-pseudo-coherent. \item If $K$ and $M$ are $m$-pseudo-coherent, then $L$ is $m$-pseudo-coherent. \item If $L$ is $(m + 1)$-pseudo-coherent and $M$ is $m$-pseudo-coherent, then $K$ is $(m + 1)$-pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tensor-pseudo-coherent} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L$ be objects of $D(\mathcal{O}_X)$. \begin{enumerate} \item If $K$ is $n$-pseudo-coherent and $H^i(K) = 0$ for $i > a$ and $L$ is $m$-pseudo-coherent and $H^j(L) = 0$ for $j > b$, then $K \otimes_{\mathcal{O}_X}^\mathbf{L} L$ is $t$-pseudo-coherent with $t = \max(m + a, n + b)$. \item If $K$ and $L$ are pseudo-coherent, then $K \otimes_{\mathcal{O}_X}^\mathbf{L} L$ is pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-summands-pseudo-coherent} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $m \in \mathbf{Z}$. If $K \oplus L$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) in $D(\mathcal{O}_X)$ so are $K$ and $L$. \end{lemma} 
\begin{lemma} \label{lemma-complex-pseudo-coherent-modules} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $m \in \mathbf{Z}$. Let $\mathcal{F}^\bullet$ be a (locally) bounded above complex of $\mathcal{O}_X$-modules such that $\mathcal{F}^i$ is $(m - i)$-pseudo-coherent for all $i$. Then $\mathcal{F}^\bullet$ is $m$-pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-pseudo-coherent} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $m \in \mathbf{Z}$. Let $E$ be an object of $D(\mathcal{O}_X)$. If $E$ is (locally) bounded above and $H^i(E)$ is $(m - i)$-pseudo-coherent for all $i$, then $E$ is $m$-pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-finite-cohomology} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K$ be an object of $D(\mathcal{O}_X)$. Let $m \in \mathbf{Z}$. \begin{enumerate} \item If $K$ is $m$-pseudo-coherent and $H^i(K) = 0$ for $i > m$, then $H^m(K)$ is a finite type $\mathcal{O}_X$-module. \item If $K$ is $m$-pseudo-coherent and $H^i(K) = 0$ for $i > m + 1$, then $H^{m + 1}(K)$ is a finitely presented $\mathcal{O}_X$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-n-pseudo-module} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules. \begin{enumerate} \item $\mathcal{F}$ viewed as an object of $D(\mathcal{O}_X)$ is $0$-pseudo-coherent if and only if $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module, and \item $\mathcal{F}$ viewed as an object of $D(\mathcal{O}_X)$ is $(-1)$-pseudo-coherent if and only if $\mathcal{F}$ is an $\mathcal{O}_X$-module of finite presentation. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-tor-amplitude} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$ with $a \leq b$. \begin{enumerate} \item We say $E$ has {\it tor-amplitude in $[a, b]$} if $H^i(E \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{F}) = 0$ for all $\mathcal{O}_X$-modules $\mathcal{F}$ and all $i \not \in [a, b]$. \item We say $E$ has {\it finite tor dimension} if it has tor-amplitude in $[a, b]$ for some $a, b$. \item We say $E$ {\it locally has finite tor dimension} if there exists an open covering $X = \bigcup U_i$ such that $E|_{U_i}$ has finite tor dimension for all $i$. \end{enumerate} An $\mathcal{O}_X$-module $\mathcal{F}$ has {\it tor dimension $\leq d$} if $\mathcal{F}[0]$ viewed as an object of $D(\mathcal{O}_X)$ has tor-amplitude in $[-d, 0]$. \end{definition} 
\begin{lemma} \label{lemma-last-one-flat} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$ be a bounded above complex of flat $\mathcal{O}_X$-modules with tor-amplitude in $[a, b]$. Then $\Coker(d_{\mathcal{E}^\bullet}^{a - 1})$ is a flat $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$ with $a \leq b$. The following are equivalent \begin{enumerate} \item $E$ has tor-amplitude in $[a, b]$. \item $E$ is represented by a complex $\mathcal{E}^\bullet$ of flat $\mathcal{O}_X$-modules with $\mathcal{E}^i = 0$ for $i \not \in [a, b]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude-pullback} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $E$ be an object of $D(\mathcal{O}_Y)$. If $E$ has tor amplitude in $[a, b]$, then $Lf^*E$ has tor amplitude in $[a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude-stalk} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$ with $a \leq b$. The following are equivalent \begin{enumerate} \item $E$ has tor-amplitude in $[a, b]$. \item for every $x \in X$ the object $E_x$ of $D(\mathcal{O}_{X, x})$ has tor-amplitude in $[a, b]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cone-tor-amplitude} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K, L, M, f, g, h)$ be a distinguished triangle in $D(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$. \begin{enumerate} \item If $K$ has tor-amplitude in $[a + 1, b + 1]$ and $L$ has tor-amplitude in $[a, b]$ then $M$ has tor-amplitude in $[a, b]$. \item If $K$ and $M$ have tor-amplitude in $[a, b]$, then $L$ has tor-amplitude in $[a, b]$. \item If $L$ has tor-amplitude in $[a + 1, b + 1]$ and $M$ has tor-amplitude in $[a, b]$, then $K$ has tor-amplitude in $[a + 1, b + 1]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tensor-tor-amplitude} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L$ be objects of $D(\mathcal{O}_X)$. If $K$ has tor-amplitude in $[a, b]$ and $L$ has tor-amplitude in $[c, d]$ then $K \otimes_{\mathcal{O}_X}^\mathbf{L} L$ has tor amplitude in $[a + c, b + d]$. \end{lemma} 
\begin{lemma} \label{lemma-summands-tor-amplitude} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $a, b \in \mathbf{Z}$. For $K$, $L$ objects of $D(\mathcal{O}_X)$ if $K \oplus L$ has tor amplitude in $[a, b]$ so do $K$ and $L$. \end{lemma} 
\begin{definition} \label{definition-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}_X$-modules. We say $\mathcal{E}^\bullet$ is {\it perfect} if there exists an open covering $X = \bigcup U_i$ such that for each $i$ there exists a morphism of complexes $\mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$ which is a quasi-isomorphism with $\mathcal{E}_i^\bullet$ a strictly perfect complex of $\mathcal{O}_{U_i}$-modules. An object $E$ of $D(\mathcal{O}_X)$ is {\it perfect} if it can be represented by a perfect complex of $\mathcal{O}_X$-modules. \end{definition} 
\begin{lemma} \label{lemma-perfect-independent-representative} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. \begin{enumerate} \item If there exists an open covering $X = \bigcup U_i$ and strictly perfect complexes $\mathcal{E}_i^\bullet$ on $U_i$ such that $\mathcal{E}_i^\bullet$ represents $E|_{U_i}$ in $D(\mathcal{O}_{U_i})$, then $E$ is perfect. \item If $E$ is perfect, then any complex representing $E$ is perfect. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-on-locally-ringed} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. Assume that all stalks $\mathcal{O}_{X, x}$ are local rings. Then the following are equivalent \begin{enumerate} \item $E$ is perfect, \item there exists an open covering $X = \bigcup U_i$ such that $E|_{U_i}$ can be represented by a finite complex of finite locally free $\mathcal{O}_{U_i}$-modules, and \item there exists an open covering $X = \bigcup U_i$ such that $E|_{U_i}$ can be represented by a finite complex of finite free $\mathcal{O}_{U_i}$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-precise} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. Let $a \leq b$ be integers. If $E$ has tor amplitude in $[a, b]$ and is $(a - 1)$-pseudo-coherent, then $E$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object of $D(\mathcal{O}_X)$. The following are equivalent \begin{enumerate} \item $E$ is perfect, and \item $E$ is pseudo-coherent and locally has finite tor dimension. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-pullback} Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed spaces. Let $E$ be an object of $D(\mathcal{O}_Y)$. If $E$ is perfect in $D(\mathcal{O}_Y)$, then $Lf^*E$ is perfect in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-two-out-of-three-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K, L, M, f, g, h)$ be a distinguished triangle in $D(\mathcal{O}_X)$. If two out of three of $K, L, M$ are perfect then the third is also perfect. \end{lemma} 
\begin{lemma} \label{lemma-tensor-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. If $K, L$ are perfect objects of $D(\mathcal{O}_X)$, then so is $K \otimes_{\mathcal{O}_X}^\mathbf{L} L$. \end{lemma} 
\begin{lemma} \label{lemma-summands-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. If $K \oplus L$ is a perfect object of $D(\mathcal{O}_X)$, then so are $K$ and $L$. \end{lemma} 
\begin{lemma} \label{lemma-pushforward-perfect} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $j : U \to X$ be an open subspace. Let $E$ be a perfect object of $D(\mathcal{O}_U)$ whose cohomology sheaves are supported on a closed subset $T \subset U$ with $j(T)$ closed in $X$. Then $Rj_*E$ is a perfect object of $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-max-open-coh-loc-free} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ in $D(\mathcal{O}_X)$ be perfect. Assume that all stalks $\mathcal{O}_{X, x}$ are local rings. Then the set $$ U = \{x \in X \mid H^i(E)_x\text{ is a finite free } \mathcal{O}_{X, x}\text{-module for all }i\in \mathbf{Z}\} $$ is open in $X$ and is the maximal open set $U \subset X$ such that $H^i(E)|_U$ is finite locally free for all $i \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-symmetric-monoidal-cat-complexes} Let $(X, \mathcal{O}_X)$ be a ringed space. The category of complexes of $\mathcal{O}_X$-modules with tensor product defined by $\mathcal{F}^\bullet \otimes \mathcal{G}^\bullet = \text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{G}^\bullet)$ is a symmetric monoidal category (for sign rules, see More on Algebra, Section \ref{more-algebra-section-sign-rules}). \end{lemma} 
\begin{lemma} \label{lemma-left-dual-complex} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}^\bullet$ be a complex of $\mathcal{O}_X$-modules. If $\mathcal{F}^\bullet$ has a left dual in the monoidal category of complexes of $\mathcal{O}_X$-modules (Categories, Definition \ref{categories-definition-dual}) then $\mathcal{F}^\bullet$ is a locally bounded complex whose terms are locally direct summands of finite free $\mathcal{O}_X$-modules and the left dual is as constructed in Example \ref{example-dual}. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate-isom} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K, L, M \in D(\mathcal{O}_X)$. If $K$ is perfect, then the map $$ R\SheafHom(L, M) \otimes_{\mathcal{O}_X}^\mathbf{L} K \longrightarrow R\SheafHom(R\SheafHom(K, L), M) $$ of Lemma \ref{lemma-internal-hom-evaluate} is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-dual-perfect-complex} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K$ be a perfect object of $D(\mathcal{O}_X)$. Then $K^\vee = R\SheafHom(K, \mathcal{O}_X)$ is a perfect object too and $(K^\vee)^\vee \cong K$. There are functorial isomorphisms $$ M \otimes^\mathbf{L}_{\mathcal{O}_X} K^\vee = R\SheafHom(K, M) $$ and $$ H^0(X, M \otimes^\mathbf{L}_{\mathcal{O}_X} K^\vee) = \Hom_{D(\mathcal{O}_X)}(K, M) $$ for $M$ in $D(\mathcal{O}_X)$. \end{lemma} 
\begin{lemma} \label{lemma-symmetric-monoidal-derived} Let $(X, \mathcal{O}_X)$ be a ringed space. The derived category $D(\mathcal{O}_X)$ is a symmetric monoidal category with tensor product given by derived tensor product with usual associativity and commutativity constraints (for sign rules, see More on Algebra, Section \ref{more-algebra-section-sign-rules}). \end{lemma} 
\begin{lemma} \label{lemma-left-dual-derived} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $M$ be an object of $D(\mathcal{O}_X)$. If $M$ has a left dual in the monoidal category $D(\mathcal{O}_X)$ (Categories, Definition \ref{categories-definition-dual}) then $M$ is perfect and the left dual is as constructed in Example \ref{example-dual-derived}. \end{lemma} 
\begin{lemma} \label{lemma-colim-and-lim-of-duals} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K_n)_{n \in \mathbf{N}}$ be a system of perfect objects of $D(\mathcal{O}_X)$. Let $K = \text{hocolim} K_n$ be the derived colimit (Derived Categories, Definition \ref{derived-definition-derived-colimit}). Then for any object $E$ of $D(\mathcal{O}_X)$ we have $$ R\SheafHom(K, E) = R\lim E \otimes^\mathbf{L}_{\mathcal{O}_X} K_n^\vee $$ where $(K_n^\vee)$ is the inverse system of dual perfect complexes. \end{lemma} 
\begin{lemma} \label{lemma-ext-composition-is-cup} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $K$ and $E$ be objects of $D(\mathcal{O}_X)$ with $E$ perfect. The diagram $$ \xymatrix{ H^0(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} E^\vee) \times H^0(X, E) \ar[r] \ar[d] & H^0(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} E^\vee \otimes_{\mathcal{O}_X}^\mathbf{L} E) \ar[d] \\ \Hom_X(E, K) \times H^0(X, E) \ar[r] & H^0(X, K) } $$ commutes where the top horizontal arrow is the cup product, the right vertical arrow uses $\epsilon : E^\vee \otimes_{\mathcal{O}_X}^\mathbf{L} E \to \mathcal{O}_X$ (Example \ref{example-dual-derived}), the left vertical arrow uses Lemma \ref{lemma-dual-perfect-complex}, and the bottom horizontal arrow is the obvious one. \end{lemma} 
\begin{lemma} \label{lemma-pullback-internal-hom} Let $h : X \to Y$ be a morphism of ringed spaces. Let $K, M$ be objects of $D(\mathcal{O}_Y)$. The canonical map $$ Lh^*R\SheafHom(K, M) \longrightarrow R\SheafHom(Lh^*K, Lh^*M) $$ of Remark \ref{remark-prepare-fancy-base-change} is an isomorphism in the following cases \begin{enumerate} \item $K$ is perfect, \item $h$ is flat, $K$ is pseudo-coherent, and $M$ is (locally) bounded below, \item $\mathcal{O}_X$ has finite tor dimension over $h^{-1}\mathcal{O}_Y$, $K$ is pseudo-coherent, and $M$ is (locally) bounded below, \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-stalk-internal-hom} Let $X$ be a ringed space. Let $K, M$ be objects of $D(\mathcal{O}_X)$. Let $x \in X$. The canonical map $$ R\SheafHom(K, M)_x \longrightarrow R\Hom_{\mathcal{O}_{X, x}}(K_x, M_x) $$ is an isomorphism in the following cases \begin{enumerate} \item $K$ is perfect, \item $K$ is pseudo-coherent and $M$ is (locally) bounded below. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-category-summands-finite-free} Let $(X, \mathcal{O}_X)$ be a ringed space. Set $R = \Gamma(X, \mathcal{O}_X)$. The category of $\mathcal{O}_X$-modules which are summands of finite free $\mathcal{O}_X$-modules is equivalent to the category of finite projective $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-invertible-derived} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $M$ be an object of $D(\mathcal{O}_X)$. The following are equivalent \begin{enumerate} \item $M$ is invertible in $D(\mathcal{O}_X)$, see Categories, Definition \ref{categories-definition-invertible}, and \item there is a locally finite direct product decomposition $$ \mathcal{O}_X = \prod\nolimits_{n \in \mathbf{Z}} \mathcal{O}_n $$ and for each $n$ there is an invertible $\mathcal{O}_n$-module $\mathcal{H}^n$ (Modules, Definition \ref{modules-definition-invertible}) and $M = \bigoplus \mathcal{H}^n[-n]$ in $D(\mathcal{O}_X)$. \end{enumerate} If (1) and (2) hold, then $M$ is a perfect object of $D(\mathcal{O}_X)$. If $\mathcal{O}_{X, x}$ is a local ring for all $x \in X$ these condition are also equivalent to \begin{enumerate} \item[(3)] there exists an open covering $X = \bigcup U_i$ and for each $i$ an integer $n_i$ such that $M|_{U_i}$ is represented by an invertible $\mathcal{O}_{U_i}$-module placed in degree $n_i$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-when-jshriek-compact} Let $X$ be a ringed space. Let $j : U \to X$ be the inclusion of an open. The $\mathcal{O}_X$-module $j_!\mathcal{O}_U$ is a compact object of $D(\mathcal{O}_X)$ if there exists an integer $d$ such that \begin{enumerate} \item $H^p(U, \mathcal{F}) = 0$ for all $p > d$, and \item the functors $\mathcal{F} \mapsto H^p(U, \mathcal{F})$ commute with direct sums. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-is-compact} Let $X$ be a ringed space. Assume that the underlying topological space of $X$ has the following properties: \begin{enumerate} \item $X$ is quasi-compact, \item there exists a basis of quasi-compact open subsets, and \item the intersection of any two quasi-compact opens is quasi-compact. \end{enumerate} Let $K$ be a perfect object of $D(\mathcal{O}_X)$. Then \begin{enumerate} \item[(a)] $K$ is a compact object of $D^+(\mathcal{O}_X)$ in the following sense: if $M = \bigoplus_{i \in I} M_i$ is bounded below, then $\Hom(K, M) = \bigoplus_{i \in I} \Hom(K, M_i)$. \item[(b)] If $X$ has finite cohomological dimension, i.e., if there exists a $d$ such that $H^i(X, \mathcal{F}) = 0$ for $i > d$, then $K$ is a compact object of $D(\mathcal{O}_X)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-injective-tensor-finite-locally-free} Let $X$ be a ringed space. Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module. Let $\mathcal{E}$ be an $\mathcal{O}_X$-module. Assume $\mathcal{E}$ is finite locally free on $X$, see Modules, Definition \ref{modules-definition-locally-free}. Then $\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{I}$ is an injective $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-projection-formula} Let $f : X \to Y$ be a morphism of ringed spaces. Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Let $\mathcal{E}$ be an $\mathcal{O}_Y$-module. Assume $\mathcal{E}$ is finite locally free on $Y$, see Modules, Definition \ref{modules-definition-locally-free}. Then there exist isomorphisms $$ \mathcal{E} \otimes_{\mathcal{O}_Y} R^qf_*\mathcal{F} \longrightarrow R^qf_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F}) $$ for all $q \geq 0$. In fact there exists an isomorphism $$ \mathcal{E} \otimes_{\mathcal{O}_Y} Rf_*\mathcal{F} \longrightarrow Rf_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F}) $$ in $D^{+}(Y)$ functorial in $\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-projection-formula-perfect} Let $f : X \to Y$ be a morphism of ringed spaces. Let $E \in D(\mathcal{O}_X)$ and $K \in D(\mathcal{O}_Y)$. If $K$ is perfect, then $$ Rf_*E \otimes^\mathbf{L}_{\mathcal{O}_Y} K = Rf_*(E \otimes^\mathbf{L}_{\mathcal{O}_X} Lf^*K) $$ in $D(\mathcal{O}_Y)$. \end{lemma} 
\begin{lemma} \label{lemma-projection-formula-closed-immersion} Let $f : X \to Y$ be a morphism of ringed spaces such that $f$ is a homeomorphism onto a closed subset. Then (\ref{equation-projection-formula-map}) is an isomorphism always. \end{lemma} 
\begin{lemma} \label{lemma-invertible-ideal-sheaf} Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals. Consider the following two conditions \begin{enumerate} \item for every $x \in X$ there exists an open neighbourhood $U \subset X$ of $x$ and $f \in \mathcal{I}(U)$ such that $\mathcal{I}|_U = \mathcal{O}_U \cdot f$ and $f : \mathcal{O}_U \to \mathcal{O}_U$ is injective, and \item $\mathcal{I}$ is invertible as an $\mathcal{O}_X$-module. \end{enumerate} Then (1) implies (2) and the converse is true if all stalks $\mathcal{O}_{X, x}$ of the structure sheaf are local rings. \end{lemma} 
\begin{lemma} \label{lemma-I-torsion-free} In Situation \ref{situation-eta} let $\mathcal{F}$ be an $\mathcal{O}_X$-module. The following are equivalent \begin{enumerate} \item the subsheaf $\mathcal{F}[\mathcal{I}] \subset \mathcal{F}$ of sections annihilated by $\mathcal{I}$ is zero, \item the subsheaf $\mathcal{F}[\mathcal{I}^n]$ is zero for all $n \geq 1$, \item the multiplication map $\mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{F} \to \mathcal{F}$ is injective, \item for every open $U \subset X$ such that $\mathcal{I}|_U = \mathcal{O}_U \cdot f$ for some $f \in \mathcal{I}(U)$ the map $f : \mathcal{F}|_U \to \mathcal{F}|_U$ is injective, \item for every $x \in X$ and generator $f$ of the ideal $\mathcal{I}_x \subset \mathcal{O}_{X, x}$ the element $f$ is a nonzerodivisor on the stalk $\mathcal{F}_x$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-eta-stalks} In Situation \ref{situation-eta} let $\mathcal{F}^\bullet$ be a complex of $\mathcal{I}$-torsion free $\mathcal{O}_X$-modules. For $x \in X$ choose a generator $f \in \mathcal{I}_x$. Then the stalk $(\eta_\mathcal{I}\mathcal{F}^\bullet)_x$ is canonically isomorphic to the complex $\eta_f\mathcal{F}^\bullet_x$ constructed in More on Algebra, Section \ref{more-algebra-section-eta}. \end{lemma} 
\begin{lemma} \label{lemma-eta-first-property} In Situation \ref{situation-eta} let $\mathcal{F}^\bullet$ be a complex of $\mathcal{I}$-torsion free $\mathcal{O}_X$-modules. There is a canonical isomorphism $$ \mathcal{I}^{\otimes i} \otimes_{\mathcal{O}_X} \left( H^i(\mathcal{F}^\bullet)/H^i(\mathcal{F}^\bullet)[\mathcal{I}] \right) \longrightarrow H^i(\eta_\mathcal{I}\mathcal{F}^\bullet) $$ of cohomology sheaves. \end{lemma} 
\begin{lemma} \label{lemma-eta-qis} In Situation \ref{situation-eta} let $\mathcal{F}^\bullet \to \mathcal{G}^\bullet$ be a map of complexes of $\mathcal{I}$-torsion free $\mathcal{O}_X$-modules. Then the induced map $\eta_\mathcal{I}\mathcal{F}^\bullet \to \eta_\mathcal{I}\mathcal{G}^\bullet$ is a quasi-isomorphism too. \end{lemma} 
\begin{lemma} \label{lemma-Leta} In Situation \ref{situation-eta} there is an additive functor\footnote{Beware that this functor isn't exact, i.e., does not transform distinguished triangles into distinguished triangles.} $L\eta_\mathcal{I} : D(\mathcal{O}_X) \to D(\mathcal{O}_X)$ such that if $M$ in $D(\mathcal{O}_X)$ is represented by a complex $\mathcal{F}^\bullet$ of $\mathcal{I}$-torsion free $\mathcal{O}_X$-modules, then $L\eta_\mathcal{I}M = \eta_\mathcal{I}\mathcal{F}^\bullet$. Similarly for morphisms. \end{lemma} 
\begin{lemma} \label{lemma-eta-second-property} In Situation \ref{situation-eta} let $M$ be an object of $D(\mathcal{O}_X)$. There is a canonical isomorphism $$ L\eta_\mathcal{I}M \otimes^\mathbf{L} \mathcal{O}_X/\mathcal{I} \longrightarrow H^\bullet(M/\mathcal{I}) $$ in $D(\mathcal{O}_X)$ where the right hand side is the complex (\ref{equation-complex-bocksteins}). \end{lemma} 
\begin{lemma} \label{lemma-eta-tensor-invertible} In Situation \ref{situation-eta} let $\mathcal{F}^\bullet$ be a complex of $\mathcal{I}$-torsion free $\mathcal{O}_X$-modules. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module. Then $\eta_\mathcal{I}(\mathcal{F}^\bullet \otimes \mathcal{L}) = (\eta_\mathcal{I}\mathcal{F}^\bullet) \otimes \mathcal{L}$. \end{lemma} 
\begin{lemma} \label{lemma-eta-cohomology-locally-free} In Situation \ref{situation-eta} let $M$ be an object of $D(\mathcal{O}_X)$. Let $x \in X$ with $\mathcal{O}_{X, x}$ nonzero. If $H^i(M)_x$ is finite free over $\mathcal{O}_{X, x}$, then $H^i(L\eta_\mathcal{I}M)_x$ is finite free over $\mathcal{O}_{X, x}$ of the same rank. \end{lemma} 
