\begin{definition} \label{definition-stably-free} Let $R$ be a ring.  \begin{enumerate} \item Two modules $M$, $N$ over $R$ are said to be {\it stably isomorphic} if there exist $n, m \geq 0$ such that $M \oplus R^{\oplus m} \cong N \oplus R^{\oplus n}$ as $R$-modules. \item A module $M$ is {\it stably free} if it is stably isomorphic to a free module. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-exact-category-stably-free} Let $R$ be a ring. Let $0 \to P' \to P \to P'' \to 0$ be a short exact sequence of finite projective $R$-modules. If $2$ out of $3$ of these modules are stably free, then so is the third. \end{lemma} 
\begin{lemma} \label{lemma-lift-stably-free} Let $R$ be a ring. Let $I \subset R$ be an ideal. Assume that every element of $1 + I$ is a unit (in other words $I$ is contained in the Jacobson radical of $R$). For every finite stably free $R/I$-module $E$ there exists a finite stably free $R$-module $M$ such that $M/IM \cong E$. \end{lemma} 
\begin{lemma} \label{lemma-lift-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. Assume that every element of $1 + I$ is a unit (in other words $I$ is contained in the Jacobson radical of $R$). Let $M$ be a finite flat $R$-module such that $M/IM$ is a projective $R/I$-module. Then $M$ is a finite projective $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-isomorphic-finite-projective-lifts} Let $R$ be a ring. Let $I \subset R$ be an ideal. Assume that every element of $1 + I$ is a unit (in other words $I$ is contained in the Jacobson radical of $R$). If $P$ and $P'$ are finite projective $R$-modules, then \begin{enumerate} \item if $\varphi : P \to P'$ is an $R$-module map inducing an isomorphism $\overline{\varphi} : P/IP \to P'/IP'$, then $\varphi$ is an isomorphism, \item if $P/IP \cong P'/IP'$, then $P \cong P'$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-approximate-complex} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal contained in the Jacobson radical of $A$. Let $$ S : L \xrightarrow{f} M \xrightarrow{g} N \quad\text{and}\quad S' : L \xrightarrow{f'} M \xrightarrow{g'} N $$ be two complexes of finite $A$-modules as shown. Assume that \begin{enumerate} \item $c$ works in the Artin-Rees lemma for $f$ and $g$, \item the complex $S$ is exact, and \item $f' = f \bmod I^{c + 1}M$ and $g' = g \bmod I^{c + 1}N$. \end{enumerate} Then $c$ works in the Artin-Rees lemma for $g'$ and the complex $S'$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-approximate-complex-graded} Assumptions as in Lemma \ref{lemma-approximate-complex}. Let $Q = \Coker(g)$ and $Q' = \Coker(g')$. Then $\text{Gr}_I(Q) \cong \text{Gr}_I(Q')$ as graded $\text{Gr}_I(A)$-modules. \end{lemma} 
\begin{lemma} \label{lemma-works-flat-extension} Let $A \to B$ be a flat map of Noetherian rings. Let $I \subset A$ be an ideal. Let $f : M \to N$ be a homomorphism of finite $A$-modules. Assume that $c$ works for $f$ in the Artin-Rees lemma. Then $c$ works for $f \otimes 1 : M \otimes_A B \to N \otimes_A B$ in the Artin-Rees lemma for the ideal $IB$. \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-finite-type} Let $R$ be a ring. Let $A \to B$ and $C \to B$ be $R$-algebra maps. Assume \begin{enumerate} \item $R$ is Noetherian, \item $A$, $B$, $C$ are of finite type over $R$, \item $A \to B$ is surjective, and \item $B$ is finite over $C$. \end{enumerate} Then $A \times_B C$ is of finite type over $R$. \end{lemma} 
\begin{lemma} \label{lemma-formal-consequence} Let $R$ be a Noetherian ring. Let $I$ be a finite set. Suppose given a cartesian diagram $$ \xymatrix{ \prod B_i & \prod A_i \ar[l]^{\prod \varphi_i} \\ Q \ar[u]^{\prod \psi_i} & P \ar[u] \ar[l] } $$ with $\psi_i$ and $\varphi_i$ surjective, and $Q$, $A_i$, $B_i$ of finite type over $R$. Then $P$ is of finite type over $R$. \end{lemma} 
\begin{lemma} \label{lemma-diagram-localize} Suppose given a cartesian diagram of rings $$ \xymatrix{ R & R' \ar[l]^t \\ B \ar[u]_s & B'\ar[u] \ar[l] } $$ i.e., $B' = B \times_R R'$. If $h \in B'$ corresponds to $g \in B$ and $f \in R'$ such that $s(g) = t(f)$, then the diagram $$ \xymatrix{ R_{s(g)} = R_{t(f)} & (R')_f \ar[l]^-t \\ B_g \ar[u]_s & (B')_h \ar[u] \ar[l] } $$ is cartesian too. \end{lemma} 
\begin{lemma} \label{lemma-modules} Given a commutative diagram of rings $$ \xymatrix{ R & R' \ar[l] \\ B \ar[u] & B' \ar[u] \ar[l] } $$ the functor (\ref{equation-modules}) has a right adjoint, namely the functor $$ F : (N, M', \varphi) \longmapsto N \times_\varphi M' $$ (see proof for elucidation). \end{lemma} 
\begin{lemma} \label{lemma-points-of-fibre-product} In Situation \ref{situation-module-over-fibre-product} we have $$ \Spec(B') = \Spec(B) \amalg_{\Spec(A)} \Spec(A') $$ as topological spaces. \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-integral} In Situation \ref{situation-module-over-fibre-product} if $B \to A$ is integral, then $B' \to A'$ is integral. \end{lemma} 
\begin{lemma} \label{lemma-module-over-fibre-product} In Situation \ref{situation-module-over-fibre-product} the functor (\ref{equation-functor}) has a right adjoint, namely the functor $$ F : (N, M', \varphi) \longmapsto N \times_{\varphi, M} M' $$ where $M = M'/IM'$. Moreover, the composition of $F$ with (\ref{equation-functor}) is the identity functor on $\text{Mod}_B \times_{\text{Mod}_A} \text{Mod}_{A'}$. In other words, setting $N' = N \times_{\varphi, M} M'$ we have $N' \otimes_{B'} B = N$ and $N' \otimes_{B'} A' = M'$. \end{lemma} 
\begin{lemma} \label{lemma-module-over-fibre-product-bis} In the situation of Lemma \ref{lemma-module-over-fibre-product} for a $B'$-module $L'$ the adjunction map $$ L' \longrightarrow  (L' \otimes_{B'} B) \times_{(L' \otimes_{B'} A)} (L' \otimes_{B'} A') $$ is surjective but in general not injective. \end{lemma} 
\begin{lemma} \label{lemma-surjection-module-over-fibre-product} In Situation \ref{situation-module-over-fibre-product} let $(N_1, M'_1, \varphi_1) \to (N_2, M'_2, \varphi_2)$ be a morphism of $\text{Mod}_B \times_{\text{Mod}_A} \text{Mod}_{A'}$ with $N_1 \to N_2$ and $M'_1 \to M'_2$ surjective. Then $$ N_1 \times_{\varphi_1, M_1} M'_1 \to N_2 \times_{\varphi_2, M_2} M'_2 $$ where $M_1 = M'_1/IM'_1$ and $M_2 = M'_2/IM'_2$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-finite-module-over-fibre-product} Let $A, A', B, B', I, M, M', N, \varphi$ be as in Lemma \ref{lemma-module-over-fibre-product}. If $N$ finite over $B$ and $M'$ finite over $A'$, then $N' = N \times_{\varphi, M} M'$ is finite over $B'$. \end{lemma} 
\begin{lemma} \label{lemma-flat-module-over-fibre-product} With $A, A', B, B', I$ as in Situation \ref{situation-module-over-fibre-product}. \begin{enumerate} \item Let $(N, M', \varphi)$ be an object of $\text{Mod}_B \times_{\text{Mod}_A} \text{Mod}_{A'}$. If $M'$ is flat over $A'$ and $N$ is flat over $B$, then $N' = N \times_{\varphi, M} M'$ is flat over $B'$. \item If $L'$ is a flat $B'$-module, then $L' = (L \otimes_{B'} B) \times_{(L \otimes_{B'} A)} (L \otimes_{B'} A')$. \item The category of flat $B'$-modules is equivalent to the full subcategory of $\text{Mod}_B \times_{\text{Mod}_A} \text{Mod}_{A'}$ consisting of triples $(N, M', \varphi)$ with $N$ flat over $B$ and $M'$ flat over $A'$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finitely-presented-module-over-fibre-product} Let $A, A', B, B', I$ be as in Situation \ref{situation-module-over-fibre-product}. The category of finite projective $B'$-modules is equivalent to the full subcategory of $\text{Mod}_B \times_{\text{Mod}_A} \text{Mod}_{A'}$ consisting of triples $(N, M', \varphi)$ with $N$ finite projective over $B$ and $M'$ finite projective over $A'$. \end{lemma} 
\begin{lemma} \label{lemma-relative-module-over-fibre-product} In Situation \ref{situation-relative-module-over-fibre-product} the functor (\ref{equation-relative-functor}) has a right adjoint, namely the functor $$ F : (N, M', \varphi) \longmapsto N \times_{\varphi, M} M' $$ where $M = M'/IM'$. Moreover, the composition of $F$ with (\ref{equation-relative-functor}) is the identity functor on $\text{Mod}_D \times_{\text{Mod}_C} \text{Mod}_{C'}$. In other words, setting $N' = N \times_{\varphi, M} M'$ we have $N' \otimes_{D'} D = N$ and $N' \otimes_{D'} C' = M'$. \end{lemma} 
\begin{lemma} \label{lemma-relative-surjection-ideals} In Situation \ref{situation-relative-module-over-fibre-product} the map $JD' \to IC'$ is surjective where $J = \Ker(B' \to B)$. \end{lemma} 
\begin{lemma} \label{lemma-relative-finite-module-over-fibre-product} Let $A, A', B, B', C, C', D, D', I, M', M, N, \varphi$ be as in Lemma \ref{lemma-relative-module-over-fibre-product}. If $N$ finite over $D$ and $M'$ finite over $C'$, then $N' = N \times_{\varphi, M} M'$ is finite over $D'$. \end{lemma} 
\begin{lemma} \label{lemma-relative-flat-module-over-fibre-product} With $A, A', B, B', C, C', D, D', I$ as in Situation \ref{situation-relative-module-over-fibre-product}. \begin{enumerate} \item Let $(N, M', \varphi)$ be an object of $\text{Mod}_D \times_{\text{Mod}_C} \text{Mod}_{C'}$. If $M'$ is flat over $A'$ and $N$ is flat over $B$, then $N' = N \times_{\varphi, M} M'$ is flat over $B'$. \item If $L'$ is a $D'$-module flat over $B'$, then $L' = (L \otimes_{D'} D) \times_{(L \otimes_{D'} C)} (L \otimes_{D'} C')$. \item The category of $D'$-modules flat over $B'$ is equivalent to the categories of objects $(N, M', \varphi)$ of $\text{Mod}_D \times_{\text{Mod}_C} \text{Mod}_{C'}$ with $N$ flat over $B$ and $M'$ flat over $A'$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-relative-finitely-presented-module-over-fibre-product} Let $A, A', B, B', C, C', D, D', I, M', M, N, \varphi$ be as in Lemma \ref{lemma-relative-module-over-fibre-product}. If \begin{enumerate} \item $N$ is finitely presented over $D$ and flat over $B$, \item $M'$ finitely presented over $C'$ and flat over $A'$, and \item the ring map $B' \to D'$ factors as $B' \to D'' \to D'$ with $B' \to D''$ flat and $D'' \to D'$ of finite presentation, \end{enumerate} then $N' = N \times_M M'$ is finitely presented over $D'$. \end{lemma} 
\begin{lemma} \label{lemma-properties-algebras-over-fibre-product} Let $A, A', B, B', I$ be as in Situation \ref{situation-module-over-fibre-product}. Let $(D, C', \varphi)$ be a system consisting of an $B$-algebra $D$, a $A'$-algebra $C'$ and an isomorphism $D \otimes_B A \to C'/IC' = C$. Set $D' = D \times_C C'$ (as in Lemma \ref{lemma-module-over-fibre-product}). Then \begin{enumerate} \item $B' \to D'$ is finite type if and only if $B \to D$ and $A' \to C'$ are finite type, \item $B' \to D'$ is flat if and only if $B \to D$ and $A' \to C'$ are flat, \item $B' \to D'$ is flat and of finite presentation if and only if $B \to D$ and $A' \to C'$ are flat and of finite presentation, \item $B' \to D'$ is smooth if and only if $B \to D$ and $A' \to C'$ are smooth, \item $B' \to D'$ is \'etale if and only if $B \to D$ and $A' \to C'$ are \'etale. \end{enumerate} Moreover, if $D'$ is a flat $B'$-algebra, then $D' \to (D' \otimes_{B'} B) \times_{(D' \otimes_{B'} A)} (D' \otimes_{B'} A')$ is an isomorphism. In this way the category of flat $B'$-algebras is equivalent to the categories of systems $(D, C', \varphi)$ as above with $D$ flat over $B$ and $C'$ flat over $A'$. \end{lemma} 
\begin{lemma} \label{lemma-ideals-generated-by-minors} Let $R$ be a ring. Let $A$ be an $n \times m$ matrix with coefficients in $R$. Let $I_r(A)$ be the ideal generated by the $r \times r$-minors of $A$ with the convention that $I_0(A) = R$ and $I_r(A) = 0$ if $r > \min(n, m)$. Then \begin{enumerate} \item $I_0(A) \supset I_1(A) \supset I_2(A) \supset \ldots$, \item if $B$ is an $(n + n') \times m$ matrix, and $A$ is the first $n$ rows of $B$, then $I_{r + n'}(B) \subset I_r(A)$, \item if $C$ is an $n \times n$ matrix then $I_r(CA) \subset I_r(A)$. \item If $A$ is a block matrix $$ \left( \begin{matrix} A_1 & 0 \\ 0 & A_2  \end{matrix} \right) $$ then $I_r(A) = \sum_{r_1 + r_2 = r} I_{r_1}(A_1) I_{r_2}(A_2)$. \item Add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-fitting-ideal} Let $R$ be a ring. Let $M$ be a finite $R$-module. Choose a presentation $$ \bigoplus\nolimits_{j \in J} R \longrightarrow R^{\oplus n} \longrightarrow M \longrightarrow 0. $$ of $M$. Let $A = (a_{ij})_{i = 1, \ldots, n, j \in J}$ be the matrix of the map $\bigoplus_{j \in J} R \to R^{\oplus n}$. The ideal $\text{Fit}_k(M)$ generated by the $(n - k) \times (n - k)$ minors of $A$ is independent of the choice of the presentation. \end{lemma} 
\begin{definition} \label{definition-fitting-ideal} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $k \geq 0$. The {\it $k$th Fitting ideal} of $M$ is the ideal $\text{Fit}_k(M)$ constructed in Lemma \ref{lemma-fitting-ideal}. Set $\text{Fit}_{-1}(M) = 0$. \end{definition} 
\begin{lemma} \label{lemma-fitting-ideal-basics} Let $R$ be a ring. Let $M$ be a finite $R$-module. \begin{enumerate} \item If $M$ can be generated by $n$ elements, then $\text{Fit}_n(M) = R$. \item Given a second finite $R$-module $M'$ we have $\text{Fit}_0(M \oplus M') = \text{Fit}_0(M)\text{Fit}_0(M')$ and more generally $$ \text{Fit}_l(M \oplus M') = \sum\nolimits_{k + k' = l} \text{Fit}_k(M)\text{Fit}_{k'}(M') $$ \item If $R \to R'$ is a ring map, then $\text{Fit}_k(M \otimes_R R')$ is the ideal of $R'$ generated by the image of $\text{Fit}_k(M)$. \item If $M$ is of finite presentation, then $\text{Fit}_k(M)$ is a finitely generated ideal. \item If $M \to M'$ is a surjection, then $\text{Fit}_k(M) \subset \text{Fit}_k(M')$. \item We have $\text{Fit}_0(M) \subset \text{Ann}_R(M)$. \item We have $V(\text{Fit}_0(M)) = \text{Supp}(M)$. \item If $I$ is an ideal of $R$, then $\text{Fit}_0(R/I) = I$. \item Add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-fitting-ideal-generate-locally} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $k \geq 0$. Let $\mathfrak p \subset R$ be a prime ideal. The following are equivalent \begin{enumerate} \item $\text{Fit}_k(M) \not \subset \mathfrak p$, \item $\dim_{\kappa(\mathfrak p)} M \otimes_R \kappa(\mathfrak p) \leq k$, \item $M_\mathfrak p$ can be generated by $k$ elements over $R_\mathfrak p$, and \item $M_f$ can be generated by $k$ elements over $R_f$ for some $f \in R$, $f \not \in \mathfrak p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-fitting-ideal-finite-locally-free} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $r \geq 0$. The following are equivalent \begin{enumerate} \item $M$ is finite locally free of rank $r$ (Algebra, Definition \ref{algebra-definition-locally-free}), \item $\text{Fit}_{r - 1}(M) = 0$ and $\text{Fit}_r(M) = R$, and \item $\text{Fit}_k(M) = 0$ for $k < r$ and $\text{Fit}_k(M) = R$ for $k \geq r$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-principal-fitting-ideal} Let $R$ be a local ring. Let $M$ be a finite $R$-module. Let $k \geq 0$. Assume that $\text{Fit}_k(M) = (f)$ for some $f \in R$. Let $M'$ be the quotient of $M$ by $\{x \in M \mid fx = 0\}$. Then $M'$ can be generated by $k$ elements. \end{lemma} 
\begin{lemma} \label{lemma-fitting-ideals-and-pd1} Let $R$ be a ring. Let $M$ be a finitely presented $R$-module. Let $k \geq 0$. Assume that $\text{Fit}_k(M) = (f)$ for some nonzerodivisor $f \in R$ and $\text{Fit}_{k - 1}(M) = 0$. Then \begin{enumerate} \item $M$ has projective dimension $\leq 1$, \item $M' = \Ker(f : M \to M)$ is the $f$-power torsion submodule of $M$, \item $M'$ has projective dimension $\leq 1$, \item $M/M'$ is finite locally free of rank $k$, and \item $M \cong M/M' \oplus M'$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lift-invertible-element} Let $A$ be a ring, let $I \subset A$ be an ideal, let $\overline{u} \in A/I$ be an invertible element. There exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and an invertible element $u' \in A'$ lifting $\overline{u}$. \end{lemma} 
\begin{lemma} \label{lemma-lift-idempotent} Let $A$ be a ring, let $I \subset A$ be an ideal, let $\overline{e} \in A/I$ be an idempotent. There exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and an idempotent $e' \in A'$ lifting $\overline{e}$. \end{lemma} 
\begin{lemma} \label{lemma-lift-open-covering} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $\Spec(A/I) = \coprod_{j \in J} \overline{U}_j$ be a finite disjoint open covering. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and a finite disjoint open covering $\Spec(A') = \coprod_{j \in J} U'_j$ lifting the given covering. \end{lemma} 
\begin{lemma} \label{lemma-localize-upstairs} Let $A \to B$ be a ring map and $J \subset B$ an ideal. If $A \to B$ is \'etale at every prime of $V(J)$, then there exists a $g \in B$ mapping to an invertible element of $B/J$ such that $A' = B_g$ is \'etale over $A$. \end{lemma} 
\begin{lemma} \label{lemma-lift-factorization-monic} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $f \in A[x]$ be a monic polynomial. Let $\overline{f} = \overline{g} \overline{h}$ be a factorization of $f$ in $A/I[x]$ such that $\overline{g}$ and $\overline{h}$ are monic and generate the unit ideal in $A/I[x]$. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and a factorization $f = g' h'$ in $A'[x]$ with $g'$, $h'$ monic lifting the given factorization over $A/I$. \end{lemma} 
\begin{lemma} \label{lemma-lift-factorization-easy} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $f \in A[x]$ be a monic polynomial. Let $\overline{f} = \overline{g} \overline{h}$ be a factorization of $f$ in $A/I[x]$ and assume \begin{enumerate} \item the leading coefficient of $\overline{g}$ is an invertible element of $A/I$, and \item $\overline{g}$, $\overline{h}$ generate the unit ideal in $A/I[x]$. \end{enumerate} Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and a factorization $f = g' h'$ in $A'[x]$ lifting the given factorization over $A/I$. \end{lemma} 
\begin{lemma} \label{lemma-lift-factorization} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $f \in A[x]$ be a monic polynomial. Let $\overline{f} = \overline{g} \overline{h}$ be a factorization of $f$ in $A/I[x]$ and assume that  $\overline{g}$, $\overline{h}$ generate the unit ideal in $A/I[x]$. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and a factorization $f = g' h'$ in $A'[x]$ lifting the given factorization over $A/I$. \end{lemma} 
\begin{lemma} \label{lemma-separate-image-closed-from-closed} Let $R \to S$ be a ring map. Let $I \subset R$ be an ideal of $R$ and let $J \subset S$ be an ideal of $S$. If the closure of the image of $V(J)$ in $\Spec(R)$ is disjoint from $V(I)$, then there exists an element $f \in R$ which maps to $1$ in $R/I$ and to an element of $J$ in $S$. \end{lemma} 
\begin{lemma} \label{lemma-helper-integral} Let $I$ be an ideal of a ring $A$. Let $A \to B$ be an integral ring map. Let $b \in B$ map to an idempotent in $B/IB$. Then there exists a monic $f \in A[x]$ with $f(b) = 0$ and $f \bmod I = x^d(x - 1)^d$ for some $d \geq 1$. \end{lemma} 
\begin{lemma} \label{lemma-lift-idempotent-upstairs} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $A \to B$ be an integral ring map. Let $\overline{e} \in B/IB$ be an idempotent. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and an idempotent $e' \in B \otimes_A A'$ lifting $\overline{e}$. \end{lemma} 
\begin{lemma} \label{lemma-lift-projective-module} Let $A$ be a ring, let $I \subset A$ be an ideal. Let $\overline{P}$ be a finite projective $A/I$-module. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and a finite projective $A'$-module $P'$ lifting $\overline{P}$. \end{lemma} 
\begin{lemma} \label{lemma-cotangent-complex-symmetric-algebra} Let $A$ be a ring. Let $0 \to K \to A^{\oplus m} \to M \to 0$ be a sequence of $A$-modules. Consider the $A$-algebra $C = \text{Sym}^*_A(M)$ with its presentation $\alpha : A[y_1, \ldots, y_m] \to C$ coming from the surjection $A^{\oplus m} \to M$. Then $$ \NL(\alpha) = (K \otimes_A C \to \bigoplus\nolimits_{j = 1, \ldots, m} C \text{d}y_j) $$ (see Algebra, Section \ref{algebra-section-netherlander}) in particular $\Omega_{C/A} = M \otimes_A C$. \end{lemma} 
\begin{lemma} \label{lemma-symmetric-algebra-smooth} Let $A$ be a ring. Let $M$ be an $A$-module. Then $C = \text{Sym}_A^*(M)$ is smooth over $A$ if and only if $M$ is a finite projective $A$-module. \end{lemma} 
\begin{lemma} \label{lemma-lift-section-smooth-morphism} Let $A$ be a ring, let $I \subset A$ be an ideal. Consider a commutative diagram $$ \xymatrix{ B \ar[rd] \\ A \ar[u] \ar[r] & A/I } $$ where $B$ is a smooth $A$-algebra. Then there exists an \'etale ring map $A \to A'$ which induces an isomorphism $A/I \to A'/IA'$ and an $A$-algebra map $B \to A'$ lifting the ring map $B \to A/I$. \end{lemma} 
\begin{definition} \label{definition-zariski-pair} A {\it Zariski pair} is a pair $(A, I)$ such that $I$ is contained in the Jacobson radical of $A$. \end{definition} 
\begin{lemma} \label{lemma-idempotents-determined-modulo-radical} Let $(A, I)$ be a Zariski pair. Then the map from idempotents of $A$ to idempotents of $A/I$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-check-isomorphism-zariski} Let $(A, I)$ be a Zariski pair. Let $A \to B$ be a flat, integral, finitely presented ring map such that $A/I \to B/IB$ is an isomorphism. Then $A \to B$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-helper-finite} Let $(A, I)$ be a Zariski pair. Let $A \to B$ be a finite ring map. Assume \begin{enumerate} \item $B/IB = B_1 \times B_2$ is a product of $A/I$-algebras \item $A/I \to B_1/IB_1$ is surjective, \item $b \in B$ maps to $(1, 0)$ in the product. \end{enumerate} Then there exists a monic $f \in A[x]$ with $f(b) = 0$ and $f \bmod I = (x - 1)x^d$ for some $d \geq 1$. \end{lemma} 
\begin{lemma} \label{lemma-noetherian-zariski-jacobson-complement} Let $(A, I)$ be a Zariski pair with $A$ Noetherian. Let $f \in I$. Then $A_f$ is a Jacobson ring. \end{lemma} 
\begin{definition} \label{definition-henselian-pair} A {\it henselian pair} is a pair $(A, I)$ satisfying \begin{enumerate} \item $I$ is contained in the Jacobson radical of $A$, and \item for any monic polynomial $f \in A[T]$ and factorization $\overline{f} = g_0h_0$ with $g_0, h_0 \in A/I[T]$ monic generating the unit ideal in $A/I[T]$, there exists a factorization $f = gh$ in $A[T]$ with $g, h$ monic and $g_0 = \overline{g}$ and $h_0 = \overline{h}$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-locally-nilpotent-henselian} Let $(A, I)$ be a pair with $I$ locally nilpotent. Then the functor $B \mapsto B/IB$ induces an equivalence between the category of \'etale algebras over $A$ and the category of \'etale algebras over $A/I$. Moreover, the pair is henselian. \end{lemma} 
\begin{lemma} \label{lemma-limit-henselian} Let $A = \lim A_n$ where $(A_n)$ is an inverse system of rings whose transition maps are surjective and have locally nilpotent kernels. Then $(A, I_n)$ is a henselian pair, where $I_n = \Ker(A \to A_n)$. \end{lemma} 
\begin{lemma} \label{lemma-complete-henselian} Let $(A, I)$ be a pair. If $A$ is $I$-adically complete, then the pair is henselian. \end{lemma} 
\begin{lemma} \label{lemma-helper-finite-type} Let $(A, I)$ be a pair. Let $A \to B$ be a finite type ring map such that $B/IB = C_1 \times C_2$ with $A/I \to C_1$ finite. Let $B'$ be the integral closure of $A$ in $B$. Then we can write $B'/IB' = C_1 \times C'_2$ such that the map $B'/IB' \to B/IB$ preserves product decompositions and there exists a $g \in B'$ mapping to $(1, 0)$ in $C_1 \times C'_2$ with $B'_g \to B_g$ an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-characterize-henselian-pair} \begin{reference} \cite[Chapter XI]{Henselian} and \cite[Proposition 1]{Gabber-henselian} \end{reference} Let $(A, I)$ be a pair. The following are equivalent \begin{enumerate} \item $(A, I)$ is a henselian pair, \item given an \'etale ring map $A \to A'$ and an $A$-algebra map $\sigma : A' \to A/I$, there exists an $A$-algebra map $A' \to A$ lifting $\sigma$, \item for any finite $A$-algebra $B$ the map $B \to B/IB$ induces a bijection on idempotents, \item for any integral $A$-algebra $B$ the map $B \to B/IB$ induces a bijection on idempotents, and \item (Gabber) $I$ is contained in the Jacobson radical of $A$ and every monic polynomial $f(T) \in A[T]$ of the form $$ f(T) = T^n(T - 1) + a_n T^n + \ldots + a_1 T + a_0 $$ with $a_n, \ldots, a_0 \in I$ and $n \ge 1$ has a root $\alpha \in 1 + I$. \end{enumerate} Moreover, in part (5) the root is unique. \end{lemma} 
\begin{lemma} \label{lemma-change-ideal-henselian-pair} Let $A$ be a ring. Let $I, J \subset A$ be ideals with $V(I) = V(J)$. Then $(A, I)$ is henselian if and only if $(A, J)$ is henselian. \end{lemma} 
\begin{lemma} \label{lemma-integral-over-henselian-pair} Let $(A, I)$ be a henselian pair and let $A \to B$ be an integral ring map. Then $(B, IB)$ is a henselian pair. \end{lemma} 
\begin{lemma} \label{lemma-henselian-henselian-pair} Let $I \subset J \subset A$ be ideals of a ring $A$. The following are equivalent \begin{enumerate} \item $(A, I)$ and $(A/I, J/I)$ are henselian pairs, and \item $(A, J)$ is an henselian pair. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-sum-henselian} Let $A$ be a ring and let $(A, I)$ and $(A, I')$ be henselian pairs. Then $(A, I + I')$ is an henselian pair. \end{lemma} 
\begin{lemma} \label{lemma-product-henselian-pairs} Let $J$ be a set and let $\{ (A_j, I_j)\}_{j \in J}$ be a collection of pairs. Then $(\prod_{j \in J} A_j, \prod_{j\in J} I_j)$ is Henselian if and only if so is each $(A_j, I_j)$. \end{lemma} 
\begin{lemma} \label{lemma-limits-henselian} The property of being Henselian is preserved under limits of pairs. More precisely, let $J$ be a preordered set and let $(A_j, I_j)$ be an inverse system of henselian pairs over $J$. Then $A = \lim A_j$ equipped with the ideal $I = \lim I_j$ is a henselian pair $(A, I)$. \end{lemma} 
\begin{lemma} \label{lemma-filtered-colimits-henselian} The property of being Henselian is preserved under filtered colimits of pairs. More precisely, let $J$ be a directed set and let $(A_j, I_j)$ be a system of henselian pairs over $J$. Then $A = \colim A_j$ equipped with the ideal $I = \colim I_j$ is a henselian pair $(A, I)$. \end{lemma} 
\begin{lemma} \label{lemma-largest-ideal-henselian} Let $A$ be a ring. There exists a largest ideal $I \subset A$ such that $(A, I)$ is a henselian pair. \end{lemma} 
\begin{lemma} \label{lemma-irreducible-henselian-pair-connected} Let $(A, I)$ be a henselian pair. Let $\mathfrak p \subset A$ be a prime ideal. Then $V(\mathfrak p + I)$ is connected. \end{lemma} 
\begin{lemma} \label{lemma-henselization} The inclusion functor $$ \text{category of henselian pairs} \longrightarrow \text{category of pairs} $$ has a left adjoint $(A, I) \mapsto (A^h, I^h)$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-flat} Let $(A, I)$ be a pair. Let $(A^h, I^h)$ be as in  Lemma \ref{lemma-henselization}. Then $A \to A^h$ is flat, $I^h = IA^h$ and $A/I^n \to A^h/I^nA^h$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-local-ring} \begin{slogan} Compatibility henselization of pairs and of local rings. \end{slogan} The functor of Lemma \ref{lemma-henselization} associates to a local ring $(A, \mathfrak m)$ its henselization. \end{lemma} 
\begin{lemma} \label{lemma-henselization-Noetherian-pair} \begin{slogan} The henselization of a Noetherian pair is a Noetherian pair with the same completion \end{slogan} Let $(A, I)$ be a pair with $A$ Noetherian.  Let $(A^h, I^h)$ be as in  Lemma \ref{lemma-henselization}. Then the map of $I$-adic completions $$ A^\wedge \to (A^h)^\wedge $$ is an isomorphism. Moreover, $A^h$ is Noetherian, the maps $A \to A^h \to A^\wedge$ are flat, and $A^h \to A^\wedge$ is faithfully flat. \end{lemma} 
\begin{lemma} \label{lemma-henselization-colimit} Let $(A, I) = \colim (A_i, I_i)$ be a filtered colimit of pairs. The functor of Lemma \ref{lemma-henselization} gives $A^h = \colim A_i^h$ and $I^h = \colim I_i^h$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-change-ideal} \begin{slogan} The henselization of a pair only depends on the radical of the ideal \end{slogan} Let $A$ be a ring with ideals $I$ and $J$. If $V(I) = V(J)$ then the functor of Lemma \ref{lemma-henselization} produces the same ring for the pair $(A, I)$ as for the pair $(A, J)$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-integral} \begin{slogan} Henselization commutes with integral base change \end{slogan} Let $(A, I) \to (B, J)$ be a map of pairs such that $V(J) = V(IB)$. Let $(A^h , I^h) \to (B^h, J^h)$ be the induced map on henselizations (Lemma \ref{lemma-henselization}). If $A \to B$ is integral, then the induced map $A^h \otimes_A B \to B^h$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-lift-finite-projective-module} Let $(R, I)$ be a henselian pair. The map $$ P \longrightarrow P/IP $$ induces a bijection between the sets of isomorphism classes of finite projective $R$-modules and finite projective $R/I$-modules. In particular, any finite projective $R/I$-module is isomorphic to $P/IP$ for some finite projective $R$-module $P$. \end{lemma} 
\begin{lemma} \label{lemma-finite-etale-equivalence} Let $(A, I)$ be a henselian pair. The functor $B \to B/IB$ determines an equivalence between finite \'etale $A$-algebras and finite \'etale $A/I$-algebras. \end{lemma} 
\begin{lemma} \label{lemma-lift-smooth-henselian} Let $R$ be a ring and $S$ a smooth $R$-algebra. Assume that $A$ is an $R$-algebra and $(A,I)$ is a henselian pair. Then any $R$-algebra map $S \to A/I$ can be lifted to an $R$-algebra map $S \to A$. \end{lemma} 
\begin{lemma} \label{lemma-lim-finite-projective-gives-finite-projective} Let $A = \lim A_n$ be a limit of an inverse system $(A_n)$ of rings. Suppose given $A_n$-modules $M_n$ and $A_{n + 1}$-module maps $M_{n + 1} \to M_n$. Assume \begin{enumerate} \item the transition maps $A_{n + 1} \to A_n$ are surjective with locally nilpotent kernels, \item $M_1$ is a finite projective $A_1$-module, \item $M_n$ is a finite flat $A_n$-module, and \item the maps induce isomorphisms $M_{n + 1} \otimes_{A_{n + 1}} A_n \to M_n$. \end{enumerate} Then $M = \lim M_n$ is a finite projective $A$-module and $M \otimes_A A_n \to M_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{definition} \label{definition-absolutely-integrally-closed} A ring $A$ is {\it absolutely integrally closed} if every monic $f \in A[T]$ is a product of linear factors. \end{definition} 
\begin{lemma} \label{lemma-absolutely-integrally-closed} Let $A$ be a ring. The following are equivalent \begin{enumerate} \item $A$ is absolutely integrally closed, and \item any monic $f \in A[T]$ has a root in $A$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-absolutely-integrally-closed-quotient-localization} Let $A$ be absolutely integrally closed. \begin{enumerate} \item Any quotient ring $A/I$ of $A$ is absolutely integrally closed. \item Any localization $S^{-1}A$ is absolutely integrally closed. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-integrally-closed-in-absolutely-integrally-closed} Let $A$ be a ring. Let $S \subset A$ be a multiplicative subset consisting of nonzerodivisors. If $S^{-1}A$ is absolutely integrally closed and $A \subset S^{-1}A$ is integrally closed in $S^{-1}A$, then $A$ is absolutely integrally closed. \end{lemma} 
\begin{lemma} \label{lemma-normal-domain-absolutely-integrally-closed} Let $A$ be a normal domain. Then $A$ is absolutely integrally closed if and only if its fraction field is algebraically closed. \end{lemma} 
\begin{lemma} \label{lemma-construct-absolute-integral-closure} For any ring $A$ there exists an extension $A \subset B$ such that \begin{enumerate} \item $B$ is a filtered colimit of finite free $A$-algebras, \item $B$ is free as an $A$-module, and \item $B$ is absolutely integrally closed. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-absolutely-integrally-closed-strictly-henselian} Let $A$ be absolutely integrally closed. Let $\mathfrak p \subset A$ be a prime. Then the local ring $A_\mathfrak p$ is strictly henselian. \end{lemma} 
\begin{lemma} \label{lemma-absolutely-integrally-closed-henselian-pair} Let $A$ be absolutely integrally closed. Let $I \subset A$ be an ideal. Then $(A, I)$ is a henselian pair if (and only if) the following conditions hold \begin{enumerate} \item $I$ is contained in the Jacobson radical of $A$, \item $A \to A/I$ induces a bijection on idempotents. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-auto-ass} A ring $R$ is said to be {\it auto-associated} if $R$ is local and its maximal ideal $\mathfrak m$ is weakly associated to $R$. \end{definition} 
\begin{lemma} \label{lemma-auto-ass-implies-P} An auto-associated ring $R$ has the following property: (P) Every proper finitely generated ideal $I \subset R$ has a nonzero annihilator. \end{lemma} 
\begin{lemma} \label{lemma-P-universally-injective} Let $R$ be a ring having property (P) of Lemma \ref{lemma-auto-ass-implies-P}. Let $u : N \to M$ be a homomorphism of projective $R$-modules. Then $u$ is universally injective if and only if $u$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-P-fPD-zero} Let $R$ be a ring. The following are equivalent \begin{enumerate} \item $R$ has property (P) of Lemma \ref{lemma-auto-ass-implies-P}, \item any injective map of projective $R$-modules is universally injective, \item if $u : N \to M$ is injective and $N$, $M$ are finite projective $R$-modules then $\Coker(u)$ is a finite projective $R$-module, \item if $N \subset M$ and $N$, $M$ are finite projective as $R$-modules, then $N$ is a direct summand of $M$, and \item any injective map $R \to R^{\oplus n}$ is a split injection. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-exact-length-1} Let $(R, \mathfrak m)$ be a local ring. Suppose that $\varphi : R^m \to R^n$ is a map of finite free modules. The following are equivalent \begin{enumerate} \item $\varphi$ is injective, \item the rank of $\varphi$ is $m$ and the annihilator of $I(\varphi)$ in $R$ is zero. \end{enumerate} If $R$ is Noetherian these are also equivalent to \begin{enumerate} \item[(3)] the rank of $\varphi$ is $m$ and either $I(\varphi) = R$ or it contains a nonzerodivisor. \end{enumerate} Here the rank of $\varphi$ and $I(\varphi)$ are defined as in Algebra, Definition \ref{algebra-definition-rank}. \end{lemma} 
\begin{lemma} \label{lemma-coker-injective-free} Let $R$ be a ring. Suppose that $\varphi : R^n \to R^n$ be an injective map of finite free modules of the same rank. Then $\Hom_R(\Coker(\varphi), R) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-intersection-flat} Let $R$ be a ring. Let $M$ be an $R$-module. Let $I_1$, $I_2$ be ideals of $R$. If $M/I_1M$ is flat over $R/I_1$ and $M/I_2M$ is flat over $R/I_2$, then $M/(I_1 \cap I_2)M$ is flat over $R/(I_1 \cap I_2)$. \end{lemma} 
\begin{lemma} \label{lemma-flattening-artinian} Let $R$ be an Artinian ring. Let $M$ be an $R$-module. Then there exists a smallest ideal $I \subset R$ such that $M/IM$ is flat over $R/I$. \end{lemma} 
\begin{lemma} \label{lemma-flattening-artinian-universal-property} Let $R$ be an Artinian ring. Let $M$ be an $R$-module. Let $I \subset R$ be the smallest ideal $I \subset R$ such that $M/IM$ is flat over $R/I$. Then $I$ has the following universal property: For every ring map $\varphi : R \to R'$ we have $$ R' \otimes_R M\text{ is flat over }R' \Leftrightarrow \text{we have }\varphi(I) = 0. $$ \end{lemma} 
\begin{lemma} \label{lemma-base-change-flat-at-primes-over} Let $R \to S$ be a ring map. Let $I \subset R$ be an ideal. Let $M$ be an $S$-module. Let $R \to R'$ be a ring map and $IR' \subset I' \subset R'$ an ideal. If (\ref{equation-flat-at-primes-over}) holds for $(R \to S, I, M)$, then (\ref{equation-flat-at-primes-over}) holds for $(R' \to S \otimes_R R', I', M \otimes_R R')$. \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-flat-at-primes-over} Let $R \to S$ be a ring map. Let $I \subset R$ be an ideal. Let $M$ be an $S$-module. Let $R \to R'$ be a ring map and $IR' \subset I' \subset R'$ an ideal such that \begin{enumerate} \item the map $V(I') \to V(I)$ induced by $\Spec(R') \to \Spec(R)$ is surjective, and \item $R'_{\mathfrak p'}$ is flat over $R$ for all primes $\mathfrak p' \in V(I')$. \end{enumerate} If (\ref{equation-flat-at-primes-over}) holds for $(R' \to S \otimes_R R', I', M \otimes_R R')$, then (\ref{equation-flat-at-primes-over}) holds for $(R \to S, I, M)$. \end{lemma} 
\begin{lemma} \label{lemma-limit-preserving-flat-at-primes-over} Let $R \to S$ be a ring map of finite presentation. Let $M$ be an $S$-module of finite presentation. Let $R' = \colim_{\lambda \in \Lambda} R_\lambda$ be a directed colimit of $R$-algebras. Let $I_\lambda \subset R_\lambda$ be ideals such that $I_\lambda R_\mu \subset I_\mu$ for all $\mu \geq \lambda$ and set $I' = \colim_\lambda I_\lambda$. If (\ref{equation-flat-at-primes-over}) holds for $(R' \to S \otimes_R R', I', M \otimes_R R')$, then there exists a $\lambda \in \Lambda$ such that (\ref{equation-flat-at-primes-over}) holds for $(R_\lambda \to S \otimes_R R_\lambda, I_\lambda, M \otimes_R R_\lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-flat-at-primes} In Situation \ref{situation-flattening-general} let $R' \to R''$ be an $R$-algebra map. Let $I' \subset R'$ and $I'R'' \subset I'' \subset R''$ be ideals. If (\ref{equation-flat-at-primes}) holds for $(R', I')$, then (\ref{equation-flat-at-primes}) holds for $(R'', I'')$. \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-flat-at-primes} In Situation \ref{situation-flattening-general} let $R' \to R''$ be an $R$-algebra map. Let $I' \subset R'$ and $I'R'' \subset I'' \subset R''$ be ideals. Assume \begin{enumerate} \item the map $V(I'') \to V(I')$ induced by $\Spec(R'') \to \Spec(R')$ is surjective, and \item $R''_{\mathfrak p''}$ is flat over $R'$ for all primes $\mathfrak p'' \in V(I'')$. \end{enumerate} If (\ref{equation-flat-at-primes}) holds for $(R'', I'')$, then (\ref{equation-flat-at-primes}) holds for $(R', I')$. \end{lemma} 
\begin{lemma} \label{lemma-limit-preserving-flat-at-primes} In Situation \ref{situation-flattening-general} assume $R \to S$ is essentially of finite presentation and $M$ is an $S$-module of finite presentation. Let $R' = \colim_{\lambda \in \Lambda} R_\lambda$ be a directed colimit of $R$-algebras. Let $I_\lambda \subset R_\lambda$ be ideals such that $I_\lambda R_\mu \subset I_\mu$ for all $\mu \geq \lambda$ and set $I' = \colim_\lambda I_\lambda$. If (\ref{equation-flat-at-primes}) holds for $(R', I')$, then there exists a $\lambda \in \Lambda$ such that (\ref{equation-flat-at-primes}) holds for $(R_\lambda, I_\lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-flat-module-powers-variant} In Situation \ref{situation-flattening-general}. Let $I \subset R$ be an ideal. Assume \begin{enumerate} \item $R$ is a Noetherian ring, \item $S$ is a Noetherian ring, \item $M$ is a finite $S$-module, and \item for each $n \geq 1$ and any prime $\mathfrak q \in V(J + IS)$ the module $(M/I^n M)_{\mathfrak q}$ is flat over $R/I^n$. \end{enumerate} Then (\ref{equation-flat-at-primes}) holds for $(R, I)$, i.e., for every prime $\mathfrak q \in V(J + IS)$ the localization $M_{\mathfrak q}$ is flat over $R$. \end{lemma} 
\begin{lemma} \label{lemma-flattening-complete-local-noetherian} Let $R \to S$ be a ring map. Let $M$ be an $S$-module. Assume \begin{enumerate} \item $(R, \mathfrak m)$ is a complete local Noetherian ring, \item $S$ is a Noetherian ring, and \item $M$ is finite over $S$. \end{enumerate} Then there exists an ideal $I \subset \mathfrak m$ such that \begin{enumerate} \item $(M/IM)_{\mathfrak q}$ is flat over $R/I$ for all primes $\mathfrak q$ of $S/IS$ lying over $\mathfrak m$, and \item if $J \subset R$ is an ideal such that $(M/JM)_{\mathfrak q}$ is flat over $R/J$ for all primes $\mathfrak q$ lying over $\mathfrak m$, then $I \subset J$. \end{enumerate} In other words, $I$ is the smallest ideal of $R$ such that (\ref{equation-flat-at-primes-over}) holds for $(\overline{R} \to \overline{S}, \overline{\mathfrak m}, \overline{M})$ where $\overline{R} = R/I$, $\overline{S} = S/IS$, $\overline{\mathfrak m} = \mathfrak m/I$ and $\overline{M} = M/IM$. \end{lemma} 
\begin{lemma} \label{lemma-flattening-complete-local-noetherian-property-by-finite-type} With notation $R \to S$, $M$, and $I$ and assumptions as in Lemma \ref{lemma-flattening-complete-local-noetherian}. Consider a local homomorphism of local rings $\varphi : (R, \mathfrak m) \to (R', \mathfrak m')$ such that $R'$ is Noetherian. Then the following are equivalent \begin{enumerate} \item condition (\ref{equation-flat-at-primes-over}) holds for $(R' \to S \otimes_R R', \mathfrak m', M \otimes_R R')$, and \item $\varphi(I) = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flattening-complete-local-universal-property} With notation $R \to S$, $M$, and $I$ and assumptions as in Lemma \ref{lemma-flattening-complete-local-noetherian}. In addition assume that $R \to S$ is of finite type. Then for any local homomorphism of local rings $\varphi : (R, \mathfrak m) \to (R', \mathfrak m')$ the following are equivalent \begin{enumerate} \item condition (\ref{equation-flat-at-primes-over}) holds for $(R' \to S \otimes_R R', \mathfrak m', M \otimes_R R')$, and \item $\varphi(I) = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-have-one-root} Let $R$ be a ring. Let $P(T)$ be a monic polynomial with coefficients in $R$. Let $\alpha \in R$ be such that $P(\alpha) = 0$. Then $P(T) = (T - \alpha)Q(T)$ for some monic polynomial $Q(T) \in R[T]$. \end{lemma} 
\begin{lemma} \label{lemma-adjoin-one-root} Let $R$ be a ring. Let $P(T)$ be a monic polynomial with coefficients in $R$. There exists a finite free ring map $R \to R'$ such that $P(T) = (T - \alpha)Q(T)$ for some $\alpha \in R'$ and some monic polynomial $Q(T) \in R'[T]$. \end{lemma} 
\begin{lemma} \label{lemma-finite-split} Let $R \to S$ be a finite ring map. There exists a finite free ring extension $R \subset R'$ such that $S \otimes_R R'$ is a quotient of a ring of the form $$ R'[T_1, \ldots, T_n]/(P_1(T_1), \ldots, P_n(T_n)) $$ with $P_i(T) = \prod_{j = 1, \ldots, d_i} (T - \alpha_{ij})$ for some $\alpha_{ij} \in R'$. \end{lemma} 
\begin{lemma} \label{lemma-split-image} Let $R$ be a ring. Let $S = R[T_1, \ldots, T_n]/J$. Assume $J$ contains elements of the form $P_i(T_i)$ with $P_i(T) = \prod_{j = 1, \ldots, d_i} (T - \alpha_{ij})$ for some $\alpha_{ij} \in R$. For $\underline{k} = (k_1, \ldots, k_n)$ with $1 \leq k_i \leq d_i$ consider the ring map $$ \Phi_{\underline{k}} : R[T_1, \ldots, T_n] \to R, \quad T_i \longmapsto \alpha_{ik_i} $$ Set $J_{\underline{k}} = \Phi_{\underline{k}}(J)$. Then the image of $\Spec(S) \to \Spec(R)$ is equal to $V(\bigcap J_{\underline{k}})$. \end{lemma} 
\begin{lemma} \label{lemma-descent-flatness-injective-finite-Noetherian-rings} Let $R \to S$ be a finite injective homomorphism of Noetherian rings. Let $M$ be an $R$-module. If $M \otimes_R S$ is a flat $S$-module, then $M$ is a flat $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-descent-flatness-injective-integral} Let $R \to S$ be an injective integral ring map. Let $M$ be a finitely presented module over $R[x_1, \ldots, x_n]$. If $M \otimes_R S$ is flat over $S$, then $M$ is flat over $R$. \end{lemma} 
\begin{definition} \label{definition-torsion} Let $R$ be a domain. Let $M$ be an $R$-module. \begin{enumerate} \item We say an element $x \in M$ is {\it torsion} if there exists a nonzero $f \in R$ such that $fx = 0$. \item We say $M$ is {\it torsion free} if the only torsion element of $M$ is $0$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-torsion} Let $R$ be a domain. Let $M$ be an $R$-module. The set of torsion elements of $M$ forms a submodule $M_{tors} \subset M$. The quotient module $M/M_{tors}$ is torsion free. \end{lemma} 
\begin{lemma} \label{lemma-localize-torsion} Let $R$ be a domain. Let $M$ be a torsion free $R$-module. For any multiplicative set $S \subset R$ the module $S^{-1}M$ is a torsion free $S^{-1}R$-module. \end{lemma} 
\begin{lemma} \label{lemma-flat-pullback-torsion} Let $R \to R'$ be a flat homomorphism of domains. If $M$ is a torsion free $R$-module, then $M \otimes_R R'$ is a torsion free $R'$-module. \end{lemma} 
\begin{lemma} \label{lemma-extension-torsion-free} Let $R$ be a domain. Let $0 \to M \to M' \to M'' \to 0$ be a short exact sequence of $R$-modules. If $M$ and $M''$ are torsion free, then $M'$ is torsion free. \end{lemma} 
\begin{lemma} \label{lemma-check-torsion} Let $R$ be a domain. Let $M$ be an $R$-module. Then $M$ is torsion free if and only if $M_\mathfrak m$ is a torsion free $R_\mathfrak m$-module for all maximal ideals $\mathfrak m$ of $R$. \end{lemma} 
\begin{lemma} \label{lemma-finite-torsion-free-submodule-free} Let $R$ be a domain. Let $M$ be a finite $R$-module. Then $M$ is torsion free if and only if $M$ is a submodule of a finite free module. \end{lemma} 
\begin{lemma} \label{lemma-torsion-free-finite-noetherian-domain} Let $R$ be a Noetherian domain. Let $M$ be a nonzero finite $R$-module. The following are equivalent \begin{enumerate} \item $M$ is torsion free, \item $M$ is a submodule of a finite free module, \item $(0)$ is the only associated prime of $M$, \item $(0)$ is in the support of $M$ and $M$ has property $(S_1)$, and \item $(0)$ is in the support of $M$ and $M$ has no embedded associated prime. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-torsion-free} Let $R$ be a domain. Any flat $R$-module is torsion free. \end{lemma} 
\begin{lemma} \label{lemma-valuation-ring-torsion-free-flat} Let $A$ be a valuation ring. An $A$-module $M$ is flat over $A$ if and only if $M$ is torsion free. \end{lemma} 
\begin{lemma} \label{lemma-dedekind-torsion-free-flat} Let $A$ be a Dedekind domain (for example a discrete valuation ring or more generally a PID). \begin{enumerate} \item An $A$-module is flat if and only if it is torsion free. \item A finite torsion free $A$-module is finite locally free. \item A finite torsion free $A$-module is finite free if $A$ is a PID. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-hom-into-torsion-free} Let $R$ be a domain. Let $M$, $N$ be $R$-modules. If $N$ is torsion free, so is $\Hom_R(M, N)$. \end{lemma} 
\begin{definition} \label{definition-reflexive} Let $R$ be a domain. We say an $R$-module $M$ is {\it reflexive} if the natural map $$ j : M \longrightarrow \Hom_R(\Hom_R(M, R), R) $$ which sends $m \in M$ to the map sending $\varphi \in \Hom_R(M, R)$ to $\varphi(m) \in R$ is an isomorphism. \end{definition} 
\begin{lemma} \label{lemma-reflexive-torsion-free} Let $R$ be a domain and let $M$ be an $R$-module. \begin{enumerate} \item If $M$ is reflexive, then $M$ is torsion free. \item If $M$ is finite, then $j : M \to \Hom_R(\Hom_R(M, R), R)$ is injective if and only if $M$ is torsion free \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cokernel-map-double-dual-dvr} Let $R$ be a discrete valuation ring and let $M$ be a finite $R$-module. Then the map $j : M \to \Hom_R(\Hom_R(M, R), R)$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-check-reflexive} Let $R$ be a Noetherian domain. Let $M$ be a finite $R$-module. The following are equivalent: \begin{enumerate} \item $M$ is reflexive, \item $M_\mathfrak p$ is a reflexive $R_\mathfrak p$-module for all primes $\mathfrak p \subset R$, and \item $M_\mathfrak m$ is a reflexive $R_\mathfrak m$-module for all maximal ideals $\mathfrak m$ of $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-sequence-reflexive} Let $R$ be a Noetherian domain. Let $0 \to M \to M' \to M''$ an exact sequence of finite $R$-modules. If $M'$ is reflexive and $M''$ is torsion free, then $M$ is reflexive. \end{lemma} 
\begin{lemma} \label{lemma-characterize-reflexive} Let $R$ be a Noetherian domain. Let $M$ be a finite $R$-module. The following are equivalent \begin{enumerate} \item $M$ is reflexive, \item there exists a short exact sequence $0 \to M \to F \to N \to 0$ with $F$ finite free and $N$ torsion free. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-pullback-reflexive} Let $R \to R'$ be a flat homomorphism of Noetherian domains. If $M$ is a finite reflexive $R$-module, then $M \otimes_R R'$ is a finite reflexive $R'$-module. \end{lemma} 
\begin{lemma} \label{lemma-dual-reflexive} Let $R$ be a Noetherian domain. Let $M$ be a finite $R$-module. Let $N$ be a finite reflexive $R$-module. Then $\Hom_R(M, N)$ is reflexive. \end{lemma} 
\begin{definition} \label{definition-reflexive-hull} Let $R$ be a Noetherian domain. Let $M$ be a finite $R$-module. The module $M^{**} = \Hom_R(\Hom_R(M, R), R)$ is called the {\it reflexive hull} of $M$. \end{definition} 
\begin{lemma} \label{lemma-hom-into-depth} Let $R$ be a Noetherian local ring. Let $M$, $N$ be finite $R$-modules. \begin{enumerate} \item If $N$ has depth $\geq 1$, then $\Hom_R(M, N)$ has depth $\geq 1$. \item If $N$ has depth $\geq 2$, then $\Hom_R(M, N)$ has depth $\geq 2$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-hom-into-S2} Let $R$ be a Noetherian ring. Let $M$, $N$ be finite $R$-modules. \begin{enumerate} \item If $N$ has property $(S_1)$, then $\Hom_R(M, N)$ has property $(S_1)$. \item If $N$ has property $(S_2)$, then $\Hom_R(M, N)$ has property $(S_2)$. \item If $R$ is a domain, $N$ is torsion free and $(S_2)$, then $\Hom_R(M, N)$ is torsion free and has property $(S_2)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-injective-on-ass} Let $R$ be a Noetherian ring. Let $\varphi : M \to N$ be a map of $R$-modules. Assume that for every prime $\mathfrak p$ of $R$ at least one of the following happens \begin{enumerate} \item $M_\mathfrak p \to N_\mathfrak p$ is injective, or \item $\mathfrak p \not \in \text{Ass}(M)$. \end{enumerate} Then $\varphi$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-check-isomorphism-via-depth-and-ass} Let $R$ be a Noetherian ring. Let $\varphi : M \to N$ be a map of $R$-modules. Assume $M$ is finite and that for every prime $\mathfrak p$ of $R$ one of the following happens \begin{enumerate} \item $M_\mathfrak p \to N_\mathfrak p$ is an isomorphism, or \item $\text{depth}(M_\mathfrak p) \geq 2$ and $\mathfrak p \not \in \text{Ass}(N)$. \end{enumerate} Then $\varphi$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-isom-depth-2-torsion-free} Let $R$ be a Noetherian domain. Let $\varphi : M \to N$ be a map of $R$-modules. Assume $M$ is finite, $N$ is torsion free, and that for every prime $\mathfrak p$ of $R$ one of the following happens \begin{enumerate} \item $M_\mathfrak p \to N_\mathfrak p$ is an isomorphism, or \item $\text{depth}(M_\mathfrak p) \geq 2$. \end{enumerate} Then $\varphi$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-reflexive-depth-2} Let $R$ be a Noetherian domain. Let $M$ be a finite $R$-module. The following are equivalent \begin{enumerate} \item $M$ is reflexive, \item for every prime $\mathfrak p$ of $R$ one of the following happens \begin{enumerate} \item $M_\mathfrak p$ is a reflexive $R_\mathfrak p$-module, or \item $\text{depth}(M_\mathfrak p) \geq 2$. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-reflexive-S2} Let $R$ be a Noetherian domain. Let $M$ be a finite reflexive $R$-module. Let $\mathfrak p \subset R$ be a prime ideal. \begin{enumerate} \item If $\text{depth}(R_\mathfrak p) \geq 2$, then $\text{depth}(M_\mathfrak p) \geq 2$. \item If $R$ is $(S_2)$, then $M$ is $(S_2)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-reflexive-over-normal} Let $R$ be a Noetherian normal domain with fraction field $K$. Let $M$ be a finite $R$-module. The following are equivalent \begin{enumerate} \item $M$ is reflexive, \item $M$ is torsion free and has property $(S_2)$, \item $M$ is torsion free and $M = \bigcap_{\text{height}(\mathfrak p) = 1} M_{\mathfrak p}$ where the intersection happens in $M_K = M \otimes_R K$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-describe-reflexive-hull} Let $R$ be a Noetherian normal domain. Let $M$ be a finite $R$-module. Then the reflexive hull of $M$ is the intersection $$ M^{**} = \bigcap\nolimits_{\text{height}(\mathfrak p) = 1} M_{\mathfrak p}/(M_\mathfrak p)_{tors} = \bigcap\nolimits_{\text{height}(\mathfrak p) = 1} (M/M_{tors})_\mathfrak p $$ taken in $M \otimes_R K$. \end{lemma} 
\begin{lemma} \label{lemma-integral-closure-reflexive} Let $A$ be a Noetherian normal domain with fraction field $K$. Let $L$ be a finite extension of $K$. If the integral closure $B$ of $A$ in $L$ is finite over $A$, then $B$ is reflexive as an $A$-module. \end{lemma} 
\begin{definition} \label{definition-content-ideal} Let $A$ be a ring. Let $M$ be a flat $A$-module. Let $x \in M$. If the set of ideals $I$ in $A$ such that $x \in IM$ has a smallest element, we call it the {\it content ideal of $x$}. \end{definition} 
\begin{lemma} \label{lemma-content-finitely-generated} Let $A$ be a ring. Let $M$ be a flat $A$-module. Let $x \in M$. The content ideal of $x$, if it exists, is finitely generated. \end{lemma} 
\begin{lemma} \label{lemma-equal-content} Let $(A, \mathfrak m)$ be a local ring. Let $u : M \to N$ be a map of flat $A$-modules such that $\overline{u} : M/\mathfrak m M \to N/\mathfrak m N$ is injective. If $x \in M$ has content ideal $I$, then $u(x)$ has content ideal $I$ as well. \end{lemma} 
\begin{lemma} \label{lemma-content-exists-flat-Mittag-Leffler} Let $A$ be a ring. Let $M$ be a flat Mittag-Leffler module. Then every element of $M$ has a content ideal. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-type-finite-presentation-local-module} Let $R$ be a ring. Let $S = R[x_1, \ldots, x_n]$ be a polynomial ring over $R$. Let $M$ be an $S$-module. Assume \begin{enumerate} \item there exist finitely many primes $\mathfrak p_1, \ldots, \mathfrak p_m$ of $R$ such that the map $R \to \prod R_{\mathfrak p_j}$ is injective, \item $M$ is a finite $S$-module, \item $M$ flat over $R$, and \item for every prime $\mathfrak p$ of $R$ the module $M_{\mathfrak p}$ is of finite presentation over $S_{\mathfrak p}$. \end{enumerate} Then $M$ is of finite presentation over $S$. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-type-finite-presentation-local} Let $R \to S$ be a ring homomorphism. Assume \begin{enumerate} \item there exist finitely many primes $\mathfrak p_1, \ldots, \mathfrak p_m$ of $R$ such that the map $R \to \prod R_{\mathfrak p_j}$ is injective, \item $R \to S$ is of finite type, \item $S$ flat over $R$, and \item for every prime $\mathfrak p$ of $R$ the ring $S_{\mathfrak p}$ is of finite presentation over $R_{\mathfrak p}$. \end{enumerate} Then $S$ is of finite presentation over $R$. \end{lemma} 
\begin{lemma} \label{lemma-flat-graded-finite-type-finite-presentation-module} Let $R$ be a ring. Let $S = R[x_1, \ldots, x_n]$ be a graded polynomial algebra over $R$, i.e., $\deg(x_i) > 0$ but not necessarily equal to $1$. Let $M$ be a graded $S$-module. Assume \begin{enumerate} \item $R$ is a local ring, \item $M$ is a finite $S$-module, and \item $M$ is flat over $R$. \end{enumerate} Then $M$ is finitely presented as an $S$-module. \end{lemma} 
\begin{lemma} \label{lemma-flat-graded-finite-type-finite-presentation} Let $R$ be a ring. Let $S = \bigoplus_{n \geq 0} S_n$ be a graded $R$-algebra. Let $M = \bigoplus_{d \in \mathbf{Z}} M_d$ be a graded $S$-module. Assume $S$ is finitely generated as an $R$-algebra, assume $S_0$ is a finite $R$-algebra, and assume there exist finitely many primes $\mathfrak p_j$, $i = 1, \ldots, m$ such that $R \to \prod R_{\mathfrak p_j}$ is injective. \begin{enumerate} \item If $S$ is flat over $R$, then $S$ is a finitely presented $R$-algebra. \item If $M$ is flat as an $R$-module and finite as an $S$-module, then $M$ is finitely presented as an $S$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-type-valuation-ring-finite-presentation} \begin{reference} \cite[Theorem 3]{Nagata-Finitely} \end{reference} Let $A$ be a valuation ring. Let $A \to B$ be a ring map of finite type. Let $M$ be a finite $B$-module. \begin{enumerate} \item If $B$ is flat over $A$, then $B$ is a finitely presented $A$-algebra. \item If $M$ is flat as an $A$-module, then $M$ is finitely presented as a $B$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-valuation-ring-flat-essentially-finite-type} Let $A$ be a valuation ring. Let $A \to B$ be a local homomorphism which is essentially of finite type. Let $M$ be a finite $B$-module. \begin{enumerate} \item If $B$ is flat over $A$, then $B$ is essentially of finite presentation over $A$. \item If $M$ is flat as an $A$-module, then $M$ is finitely presented as a $B$-module. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-strict-transform} Let $R$ be a ring. Let $I \subset R$ be an ideal and $a \in I$. Let $R[\frac{I}{a}]$ be the affine blowup algebra, see Algebra, Definition \ref{algebra-definition-blow-up}. Let $M$ be an $R$-module. The {\it strict transform of $M$ along $R \to R[\frac{I}{a}]$} is the $R[\frac{I}{a}]$-module $$ M' = \left(M \otimes_R R[\textstyle{\frac{I}{a}}]\right)/a\text{-power torsion} $$ \end{definition} 
\begin{lemma} \label{lemma-flatten-on-affine-blowup} Let $(R, \mathfrak m)$ be a local domain with fraction field $K$. Let $S$ be a finite type $R$-algebra. Let $M$ be a finite $S$-module. For every valuation ring $A \subset K$ dominating $R$ there exists an ideal $I \subset \mathfrak m$ and a nonzero element $a \in I$ such that \begin{enumerate} \item $I$ is finitely generated, \item $A$ has center on $R[\frac{I}{a}]$, \item the fibre ring of $R \to R[\frac{I}{a}]$ at $\mathfrak m$ is not zero, and \item the strict transform $S_{I, a}$ of $S$ along $R \to R[\frac{I}{a}]$ is flat and of finite presentation over $R$, and the strict transform $M_{I, a}$ of $M$ along $R \to R[\frac{I}{a}]$ is flat over $R$ and finitely presented over $S_{I, a}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-blowup-fitting-ideal} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $k \geq 0$ and $I = \text{Fit}_k(M)$. For every $a \in I$ with $R' = R[\frac{I}{a}]$ the strict transform $$ M' = (M \otimes_R R')/a\text{-power torsion} $$ has $\text{Fit}_k(M') = R'$. \end{lemma} 
\begin{lemma} \label{lemma-blowup-fitting-ideal-locally-free} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $k \geq 0$ and $I = \text{Fit}_k(M)$. Assume that $M_\mathfrak p$ is free of rank $k$ for every $\mathfrak p \not \in V(I)$. Then for every $a \in I$ with $R' = R[\frac{I}{a}]$ the strict transform $$ M' = (M \otimes_R R')/a\text{-power torsion} $$ is locally free of rank $k$. \end{lemma} 
\begin{lemma} \label{lemma-blowup-module} Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $f \in R$ be an element such that $M_f$ is finite locally free of rank $r$. Then there exists a finitely generated ideal $I \subset R$ with $V(f) = V(I)$ such that for all $a \in I$ with $R' = R[\frac{I}{a}]$ the strict transform $$ M' = (M \otimes_R R')/a\text{-power torsion} $$ is locally free of rank $r$. \end{lemma} 
\begin{lemma} \label{lemma-ui-completion-direct-sum-into-product} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $A$ be a set. Assume $R$ is Noetherian and complete with respect to $I$. There is a canonical map $$ \left(\bigoplus\nolimits_{\alpha \in A} R\right)^\wedge \longrightarrow \prod\nolimits_{\alpha \in A} R $$ from the $I$-adic completion of the direct sum into the product which is universally injective. \end{lemma} 
\begin{lemma} \label{lemma-completed-direct-sum-flat} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $A$ be a set. Assume $R$ is Noetherian. The completion $(\bigoplus\nolimits_{\alpha \in A} R)^\wedge$ is a flat $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-tor-strictly-pro-zero} \begin{reference} This is \cite[Lemma 9.9]{quillenhomology}; note that the author forgot the word ``strict'' in the statement although it was clearly intended. \end{reference} Let $A$ be a Noetherian ring. Let $I$ be an ideal of $A$. Let $M$ be a finite $A$-module. For every $p > 0$ there exists a $c > 0$ such that $\text{Tor}_p^A(M, A/I^n) \to \text{Tor}_p^A(M, A/I^{n - c})$ is zero for all $n \geq c$. \end{lemma} 
\begin{lemma} \label{lemma-limit-flat} Let $A$ be a Noetherian ring. Let $I$ be an ideal of $A$. Let $(M_n)$ be an inverse system of $A$-modules such that \begin{enumerate} \item $M_n$ is a flat $A/I^n$-module, \item $M_{n + 1} \to M_n$ is surjective. \end{enumerate} Then $M = \lim M_n$ is a flat $A$-module and $Q \otimes_A M = \lim Q \otimes_A M_n$ for every finite $A$-module $Q$. \end{lemma} 
\begin{lemma} \label{lemma-flat-after-completion} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $M$ be an $R$-module. Assume \begin{enumerate} \item $I$ is finitely generated, \item $R/I$ is Noetherian, \item $M/IM$ is flat over $R/I$, \item $\text{Tor}_1^R(M, R/I) = 0$. \end{enumerate} Then the $I$-adic completion $R^\wedge$ is a Noetherian ring and $M^\wedge$ is flat over $R^\wedge$. \end{lemma} 
\begin{definition} \label{definition-koszul} Let $R$ be a ring. Let $\varphi : E \to R$ be an $R$-module map. The {\it Koszul complex} $K_\bullet(\varphi)$ associated to $\varphi$ is the commutative differential graded algebra defined as follows: \begin{enumerate} \item the underlying graded algebra is the exterior algebra $K_\bullet(\varphi) = \wedge(E)$, \item the differential $d : K_\bullet(\varphi) \to K_\bullet(\varphi)$ is the unique derivation such that $d(e) = \varphi(e)$ for all $e \in E = K_1(\varphi)$. \end{enumerate} \end{definition} 
\begin{definition} \label{definition-koszul-complex} Let $R$ be a ring and let $f_1, \ldots, f_r \in R$. The {\it Koszul complex on $f_1, \ldots, f_r$} is the Koszul complex associated to the map $(f_1, \ldots, f_r) : R^{\oplus r} \to R$. Notation $K_\bullet(f_\bullet)$, $K_\bullet(f_1, \ldots, f_r)$, $K_\bullet(R, f_1, \ldots, f_r)$, or $K_\bullet(R, f_\bullet)$. \end{definition} 
\begin{lemma} \label{lemma-functorial} Let $\varphi : E \to R$ and $\varphi' : E' \to R$ be $R$-module maps. Let $\psi : E \to E'$ be an $R$-module map such that $\varphi' \circ \psi = \varphi$. Then $\psi$ induces a homomorphism of differential graded algebras $K_\bullet(\varphi) \to K_\bullet(\varphi')$. \end{lemma} 
\begin{lemma} \label{lemma-change-basis} Let $f_1, \ldots, f_r \in R$ be a sequence. Let $(x_{ij})$ be an invertible $r \times r$-matrix with coefficients in $R$. Then the complexes $K_\bullet(f_\bullet)$ and $$ K_\bullet(\sum x_{1j}f_j, \sum x_{2j}f_j, \ldots, \sum x_{rj}f_j) $$ are isomorphic. \end{lemma} 
\begin{lemma} \label{lemma-homotopy-koszul-abstract} Let $R$ be a ring. Let $\varphi : E \to R$ be an $R$-module map. Let $e \in E$ with image $f = \varphi(e)$ in $R$. Then $$ f = de + ed $$ as endomorphisms of $K_\bullet(\varphi)$. \end{lemma} 
\begin{lemma} \label{lemma-homotopy-koszul} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ be a sequence. Multiplication by $f_i$ on $K_\bullet(f_\bullet)$ is homotopic to zero, and in particular the cohomology modules $H_i(K_\bullet(f_\bullet))$ are annihilated by the ideal $(f_1, \ldots, f_r)$. \end{lemma} 
\begin{lemma} \label{lemma-cone-koszul-abstract} Let $R$ be a ring. Let $\varphi : E \to R$ be an $R$-module map. Let $f \in R$. Set $E' = E \oplus R$ and define $\varphi' : E' \to R$ by $\varphi$ on $E$ and multiplication by $f$ on $R$. The complex $K_\bullet(\varphi')$ is isomorphic to the cone of the map of complexes $$ f : K_\bullet(\varphi) \longrightarrow K_\bullet(\varphi). $$ \end{lemma} 
\begin{lemma} \label{lemma-cone-koszul} Let $R$ be a ring. Let $f_1, \ldots, f_r$ be a sequence of elements of $R$. The complex $K_\bullet(f_1, \ldots, f_r)$ is isomorphic to the cone of the map of complexes $$ f_r : K_\bullet(f_1, \ldots, f_{r - 1}) \longrightarrow K_\bullet(f_1, \ldots, f_{r - 1}). $$ \end{lemma} 
\begin{lemma} \label{lemma-cone-squared} Let $R$ be a ring. Let $A_\bullet$ be a complex of $R$-modules. Let $f, g \in R$. Let $C(f)_\bullet$ be the cone of $f : A_\bullet \to A_\bullet$. Define similarly $C(g)_\bullet$ and $C(fg)_\bullet$. Then $C(fg)_\bullet$ is homotopy equivalent to the cone of a map $$ C(f)_\bullet[1] \longrightarrow C(g)_\bullet $$ \end{lemma} 
\begin{lemma} \label{lemma-koszul-mult-abstract} Let $R$ be a ring. Let $\varphi : E \to R$ be an $R$-module map. Let $f, g \in R$. Set $E' = E \oplus R$ and define $\varphi'_f, \varphi'_g, \varphi'_{fg} : E' \to R$ by $\varphi$ on $E$ and multiplication by $f, g, fg$ on $R$. The complex $K_\bullet(\varphi'_{fg})$ is homotopy equivalent to the cone of a map of complexes $$ K_\bullet(\varphi'_f)[1] \longrightarrow K_\bullet(\varphi'_g). $$ \end{lemma} 
\begin{lemma} \label{lemma-koszul-mult} Let $R$ be a ring. Let $f_1, \ldots, f_{r - 1}$ be a sequence of elements of $R$. Let $f, g \in R$. The complex $K_\bullet(f_1, \ldots, f_{r - 1}, fg)$ is homotopy equivalent to the cone of a map of complexes $$ K_\bullet(f_1, \ldots, f_{r - 1}, f)[1] \longrightarrow K_\bullet(f_1, \ldots, f_{r - 1}, g) $$ \end{lemma} 
\begin{lemma} \label{lemma-join-sequences-koszul-complex} Let $R$ be a ring. Let $f_1, \ldots, f_r$, $g_1, \ldots, g_s$ be elements of $R$. Then there is an isomorphism of Koszul complexes $$ K_\bullet(R, f_1, \ldots, f_r, g_1, \ldots, g_s) = \text{Tot}(K_\bullet(R, f_1, \ldots, f_r) \otimes_R K_\bullet(R, g_1, \ldots, g_s)). $$ \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-is-complex} The extended alternating {\v C}ech complexes defined above are complexes of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-form-module} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$. Let $M$ be an $R$-module. The extended alternating {\v C}ech complex of $M$ is the tensor product over $R$ of $M$ with the extended alternating {\v C}ech complex of $R$. \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-base-change} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$. Let $M$ be an $R$-module. Let $R \to S$ be a ring map, denote $g_1, \ldots, g_r \in S$ the images of $f_1, \ldots, f_r$, and set $N = M \otimes_R S$. The extended alternating {\v C}ech complex constructed using $S$, $g_1, \ldots, g_r$, and $N$ is the tensor product of the extended alternating {\v C}ech complex of $M$ with $S$ over $R$. \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-homotopy-zero} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$. Let $M$ be an $R$-module. If there exists an $i \in \{1, \ldots, r\}$ such that $f_i$ is a unit, then the extended alternating {\v C}ech complex of $M$ is homotopy equivalent to $0$. \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-torsion} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$. Let $M$ be an $R$-module. Let $H^q$ be the $q$th cohomology module of the extended alternation {\v C}ech complex of $M$. Then \begin{enumerate} \item $H^q = 0$ if $q \not \in [0, r]$, \item for $x \in H^i$ there exists an $n \geq 1$ such that $f_i^n x = 0$ for $i = 1, \ldots, r$, \item the support of $H^q$ is contained in $V(f_1, \ldots, f_r)$, \item if there is an $f \in (f_1, \ldots, f_r)$ which acts invertibly on $M$, then $H^q = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-extended-alternating-Cech-is-colimit-koszul} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$. The extended alternating {\v C}ech complex $$ R \to \bigoplus\nolimits_{i_0} R_{f_{i_0}} \to \bigoplus\nolimits_{i_0 < i_1} R_{f_{i_0}f_{i_1}} \to \ldots \to R_{f_1\ldots f_r} $$ is a colimit of the Koszul complexes $K(R, f_1^n, \ldots, f_r^n)$; see proof for a precise statement. \end{lemma} 
\begin{definition} \label{definition-koszul-regular-sequence} Let $R$ be a ring. Let $r \geq 0$ and let $f_1, \ldots, f_r \in R$ be a sequence of elements. Let $M$ be an $R$-module. The sequence $f_1, \ldots, f_r$ is called \begin{enumerate} \item {\it $M$-Koszul-regular} if $H_i(K_\bullet(f_1, \ldots, f_r) \otimes_R M) = 0$ for all $i \not = 0$, \item {\it $M$-$H_1$-regular} if $H_1(K_\bullet(f_1, \ldots, f_r) \otimes_R M) = 0$, \item {\it Koszul-regular} if $H_i(K_\bullet(f_1, \ldots, f_r)) = 0$ for all $i \not = 0$, and \item {\it $H_1$-regular} if $H_1(K_\bullet(f_1, \ldots, f_r)) = 0$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-regular-koszul-regular} An $M$-regular sequence is $M$-Koszul-regular. A regular sequence is Koszul-regular. \end{lemma} 
\begin{lemma} \label{lemma-koszul-regular-H1-regular} A $M$-Koszul-regular sequence is $M$-$H_1$-regular. A Koszul-regular sequence is $H_1$-regular. \end{lemma} 
\begin{lemma} \label{lemma-mult-koszul-regular} Let $f_1, \ldots, f_{r - 1} \in R$ be a sequence and $f, g \in R$. Let $M$ be an $R$-module. \begin{enumerate} \item If $f_1, \ldots, f_{r - 1}, f$ and $f_1, \ldots, f_{r - 1}, g$ are $M$-$H_1$-regular then $f_1, \ldots, f_{r - 1}, fg$ is $M$-$H_1$-regular too. \item If $f_1, \ldots, f_{r - 1}, f$ and $f_1, \ldots, f_{r - 1}, g$ are $M$-Koszul-regular then $f_1, \ldots, f_{r - 1}, fg$ is $M$-Koszul-regular too. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-koszul-regular-flat-base-change} Let $\varphi : R \to S$ be a flat ring map. Let $f_1, \ldots, f_r \in R$. Let $M$ be an $R$-module and set $N = M \otimes_R S$. \begin{enumerate} \item If $f_1, \ldots, f_r$ in $R$ is an $M$-$H_1$-regular sequence, then $\varphi(f_1), \ldots, \varphi(f_r)$ is an $N$-$H_1$-regular sequence in $S$. \item If $f_1, \ldots, f_r$ is an $M$-Koszul-regular sequence in $R$, then $\varphi(f_1), \ldots, \varphi(f_r)$ is an $N$-Koszul-regular sequence in $S$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-H1-regular-quasi-regular} An $M$-$H_1$-regular sequence is $M$-quasi-regular. \end{lemma} 
\begin{lemma} \label{lemma-noetherian-finite-all-equivalent} Let $(R, \mathfrak m)$ be a Noetherian local ring. Let $M$ be a nonzero finite $R$-module. Let $f_1, \ldots, f_r \in \mathfrak m$. The following are equivalent \begin{enumerate} \item $f_1, \ldots, f_r$ is an $M$-regular sequence, \item $f_1, \ldots, f_r$ is a $M$-Koszul-regular sequence, \item $f_1, \ldots, f_r$ is an $M$-$H_1$-regular sequence, \item $f_1, \ldots, f_r$ is an $M$-quasi-regular sequence. \end{enumerate} In particular the sequence $f_1, \ldots, f_r$ is a regular sequence in $R$ if and only if it is a Koszul regular sequence, if and only if it is a $H_1$-regular sequence, if and only if it is a quasi-regular sequence. \end{lemma} 
\begin{lemma} \label{lemma-H1-regular-in-quotient} Let $A$ be a ring. Let $I \subset A$ be an ideal. Let $g_1, \ldots, g_m$ be a sequence in $A$ whose image in $A/I$ is $H_1$-regular. Then $I \cap (g_1, \ldots, g_m) = I(g_1, \ldots, g_m)$. \end{lemma} 
\begin{lemma} \label{lemma-conormal-sequence-H1-regular} Let $A$ be a ring. Let $I \subset J \subset A$ be ideals. Assume that $J/I \subset A/I$ is generated by an $H_1$-regular sequence. Then $I \cap J^2 = IJ$. \end{lemma} 
\begin{lemma} \label{lemma-join-quasi-regular-H1-regular} Let $A$ be a ring. Let $I$ be an ideal generated by a quasi-regular sequence $f_1, \ldots, f_n$ in $A$. Let $g_1, \ldots, g_m \in A$ be elements whose images $\overline{g}_1, \ldots, \overline{g}_m$ form an $H_1$-regular sequence in $A/I$. Then $f_1, \ldots, f_n, g_1, \ldots, g_m$ is a quasi-regular sequence in $A$. \end{lemma} 
\begin{lemma} \label{lemma-join-H1-regular-sequences} Let $A$ be a ring. Let $I$ be an ideal generated by an $H_1$-regular sequence $f_1, \ldots, f_n$ in $A$. Let $g_1, \ldots, g_m \in A$ be elements whose images $\overline{g}_1, \ldots, \overline{g}_m$ form an $H_1$-regular sequence in $A/I$. Then $f_1, \ldots, f_n, g_1, \ldots, g_m$ is an $H_1$-regular sequence in $A$. \end{lemma} 
\begin{lemma} \label{lemma-truncate-H1-regular} Let $A$ be a ring. Let $f_1, \ldots, f_n, g_1, \ldots, g_m \in A$ be an $H_1$-regular sequence. Then the images $\overline{g}_1, \ldots, \overline{g}_m$ in $A/(f_1, \ldots, f_n)$ form an $H_1$-regular sequence. \end{lemma} 
\begin{lemma} \label{lemma-join-koszul-regular-sequences} Let $A$ be a ring. Let $I$ be an ideal generated by a Koszul-regular sequence $f_1, \ldots, f_n$ in $A$. Let $g_1, \ldots, g_m \in A$ be elements whose images $\overline{g}_1, \ldots, \overline{g}_m$ form a Koszul-regular sequence in $A/I$. Then $f_1, \ldots, f_n, g_1, \ldots, g_m$ is a Koszul-regular sequence in $A$. \end{lemma} 
\begin{lemma} \label{lemma-truncate-koszul-regular} Let $A$ be a ring. Let $f_1, \ldots, f_n, g_1, \ldots, g_m \in A$. If both $f_1, \ldots, f_n$ and $f_1, \ldots, f_n, g_1, \ldots, g_m$ are Koszul-regular sequences in $A$, then $\overline{g}_1, \ldots, \overline{g}_m$ in $A/(f_1, \ldots, f_n)$ form a Koszul-regular sequence. \end{lemma} 
\begin{lemma} \label{lemma-independence-of-generators} Let $R$ be a ring. Let $I$ be an ideal generated by $f_1, \ldots, f_r \in R$. \begin{enumerate} \item If $I$ can be generated by a quasi-regular sequence of length $r$, then $f_1, \ldots, f_r$ is a quasi-regular sequence. \item If $I$ can be generated by an $H_1$-regular sequence of length $r$, then $f_1, \ldots, f_r$ is an $H_1$-regular sequence. \item If $I$ can be generated by a Koszul-regular sequence of length $r$, then $f_1, \ldots, f_r$ is a Koszul-regular sequence. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-make-nonzero-divisor} \begin{reference} This is a particular case of \cite[Corollary]{McCoy} \end{reference} Let $R$ be a ring. Let $a_1, \ldots, a_n \in R$ be elements such that $R \to R^{\oplus n}$, $x \mapsto (xa_1, \ldots, xa_n)$ is injective. Then the element $\sum a_i t_i$ of the polynomial ring $R[t_1, \ldots, t_n]$ is a nonzerodivisor. \end{lemma} 
\begin{lemma} \label{lemma-Koszul-regular-flat-locally-regular} Let $R$ be a ring. Let $f_1, \ldots, f_n$ be a Koszul-regular sequence in $R$ such that $(f_1, \ldots, f_n) \not = R$. Consider the faithfully flat, smooth ring map $$ R \longrightarrow S = R[\{t_{ij}\}_{i \leq j}, t_{11}^{-1}, t_{22}^{-1}, \ldots, t_{nn}^{-1}] $$ For $1 \leq i \leq n$ set $$ g_i = \sum\nolimits_{i \leq j} t_{ij} f_j \in S. $$ Then $g_1, \ldots, g_n$ is a regular sequence in $S$ and $(f_1, \ldots, f_n)S = (g_1, \ldots, g_n)$. \end{lemma} 
\begin{lemma} \label{lemma-vanishing-extended-alternating-koszul} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ be an Koszul-regular sequence. Then the extended alternating {\v C}ech complex $R \to \bigoplus\nolimits_{i_0} R_{f_{i_0}} \to \bigoplus\nolimits_{i_0 < i_1} R_{f_{i_0}f_{i_1}} \to \ldots \to R_{f_1\ldots f_r}$ from Section \ref{section-alternating-cech} only has cohomology in degree $r$. \end{lemma} 
\begin{lemma} \label{lemma-blowup-regular-sequence} Let $a, a_2, \ldots, a_r$ be an $H_1$-regular sequence in a ring $R$ (for example a Koszul regular sequence or a regular sequence, see Lemmas \ref{lemma-regular-koszul-regular} and \ref{lemma-koszul-regular-H1-regular}). With $I = (a, a_2, \ldots, a_r)$ the blowup algebra $R' = R[\frac{I}{a}]$ is isomorphic to $R'' = R[y_2, \ldots, y_r]/(a y_i - a_i)$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-H1-regular} Let $A \to B$ be a ring map. Let $f_1, \ldots, f_r$ be a sequence in $B$ such that $B/(f_1, \ldots, f_r)$ is $A$-flat. Let $A \to A'$ be a ring map. Then the canonical map $$ H_1(K_\bullet(B, f_1, \ldots, f_r)) \otimes_A A' \longrightarrow H_1(K_\bullet(B', f'_1, \ldots, f'_r)) $$ is surjective. Here $B' = B \otimes_A A'$ and $f_i' \in B'$ is the image of $f_i$. \end{lemma} 
\begin{lemma} \label{lemma-relative-regular-immersion-algebra} Let $A \to B$ and $A \to A'$ be ring maps. Set $B' = B \otimes_A A'$. Let $f_1, \ldots, f_r \in B$. Assume $B/(f_1, \ldots, f_r)B$ is flat over $A$ \begin{enumerate} \item If $f_1, \ldots, f_r$ is a quasi-regular sequence, then the image in $B'$ is a quasi-regular sequence. \item If $f_1, \ldots, f_r$ is a $H_1$-regular sequence, then the image in $B'$ is a $H_1$-regular sequence. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cut-by-koszul-flat} Let $A' \to B'$ be a ring map. Let $I \subset A'$ be an ideal. Set $A = A'/I$ and $B = B'/IB'$. Let $f'_1, \ldots, f'_r \in B'$. Assume \begin{enumerate} \item $A' \to B'$ is flat and of finite presentation, \item $I$ is locally nilpotent, \item the images $f_1, \ldots, f_r \in B$ form a quasi-regular sequence, \item $B/(f_1, \ldots, f_r)$ is flat over $A$. \end{enumerate} Then $B'/(f'_1, \ldots, f'_r)$ is flat over $A'$. \end{lemma} 
\begin{lemma} \label{lemma-cut-by-koszul} Let $A' \to B'$ be a ring map. Let $I \subset A'$ be an ideal. Set $A = A'/I$ and $B = B'/IB'$. Let $f'_1, \ldots, f'_r \in B'$. Assume \begin{enumerate} \item $A' \to B'$ is flat and of finite presentation (for example smooth), \item $I$ is locally nilpotent, \item the images $f_1, \ldots, f_r \in B$ form a quasi-regular sequence, \item $B/(f_1, \ldots, f_r)$ is smooth over $A$. \end{enumerate} Then $B'/(f'_1, \ldots, f'_r)$ is smooth over $A'$. \end{lemma} 
\begin{definition} \label{definition-regular-ideal} Let $R$ be a ring and let $I \subset R$ be an ideal. \begin{enumerate} \item We say $I$ is a {\it regular ideal} if for every $\mathfrak p \in V(I)$ there exists a $g \in R$, $g \not \in \mathfrak p$ and a regular sequence $f_1, \ldots, f_r \in R_g$ such that $I_g$ is generated by $f_1, \ldots, f_r$. \item We say $I$ is a {\it Koszul-regular ideal} if for every $\mathfrak p \in V(I)$ there exists a $g \in R$, $g \not \in \mathfrak p$ and a Koszul-regular sequence $f_1, \ldots, f_r \in R_g$ such that $I_g$ is generated by $f_1, \ldots, f_r$. \item We say $I$ is a {\it $H_1$-regular ideal} if for every $\mathfrak p \in V(I)$ there exists a $g \in R$, $g \not \in \mathfrak p$ and an $H_1$-regular sequence $f_1, \ldots, f_r \in R_g$ such that $I_g$ is generated by $f_1, \ldots, f_r$. \item We say $I$ is a {\it quasi-regular ideal} if for every $\mathfrak p \in V(I)$ there exists a $g \in R$, $g \not \in \mathfrak p$ and a quasi-regular sequence $f_1, \ldots, f_r \in R_g$ such that $I_g$ is generated by $f_1, \ldots, f_r$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-quasi-regular-ideal-finite} A quasi-regular ideal is finitely generated. \end{lemma} 
\begin{lemma} \label{lemma-quasi-regular-ideal-finite-projective} Let $I \subset R$ be a quasi-regular ideal of a ring. Then $I/I^2$ is a finite projective $R/I$-module. \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-regular-ideal} Let $A \to B$ be a faithfully flat ring map. Let $I \subset A$ be an ideal. If $IB$ is a Koszul-regular (resp.\ $H_1$-regular, resp.\ quasi-regular) ideal in $B$, then $I$ is a Koszul-regular (resp.\ $H_1$-regular, resp.\ quasi-regular) ideal in $A$. \end{lemma} 
\begin{lemma} \label{lemma-conormal-sequence-H1-regular-ideal} Let $A$ be a ring. Let $I \subset J \subset A$ be ideals. Assume that $J/I \subset A/I$ is a $H_1$-regular ideal. Then $I \cap J^2 = IJ$. \end{lemma} 
\begin{lemma} \label{lemma-koszul-independence-presentation} Let $A \to B$ be a finite type ring map. If for some presentation $\alpha : A[x_1, \ldots, x_n] \to B$ the kernel $I$ is a Koszul-regular ideal then for any presentation $\beta : A[y_1, \ldots, y_m] \to B$ the kernel $J$ is a Koszul-regular ideal. \end{lemma} 
\begin{definition} \label{definition-local-complete-intersection} A ring map $A \to B$ is called a {\it local complete intersection} if it is of finite type and for some (equivalently any) presentation $B = A[x_1, \ldots, x_n]/I$ the ideal $I$ is Koszul-regular. \end{definition} 
\begin{lemma} \label{lemma-lci-local} Let $R \to S$ be a ring map. Let $g_1, \ldots, g_m \in S$ generate the unit ideal. If each $R \to S_{g_j}$ is a local complete intersection so is $R \to S$. \end{lemma} 
\begin{lemma} \label{lemma-relative-global-complete-intersection-koszul} Let $R$ be a ring. If $R[x_1, \ldots, x_n]/(f_1, \ldots, f_c)$ is a relative global complete intersection, then $f_1, \ldots, f_c$ is a Koszul regular sequence. \end{lemma} 
\begin{lemma} \label{lemma-syntomic-lci} Let $R \to S$ be a ring map. The following are equivalent \begin{enumerate} \item $R \to S$ is syntomic (Algebra, Definition \ref{algebra-definition-lci}), and \item $R \to S$ is flat and a local complete intersection. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-transitive-lci-at-end} Let $A \to B \to C$ be ring maps. Assume $B \to C$ is a local complete intersection homomorphism. Choose a presentation $\alpha : A[x_s, s \in S] \to B$ with kernel $I$. Choose a presentation $\beta : B[y_1, \ldots, y_m] \to C$ with kernel $J$. Let $\gamma : A[x_s, y_t] \to C$ be the induced presentation of $C$ with kernel $K$. Then we get a canonical commutative diagram $$ \xymatrix{ 0 \ar[r] & \Omega_{A[x_s]/A} \otimes C \ar[r] & \Omega_{A[x_s, y_t]/A} \otimes C \ar[r] & \Omega_{B[y_t]/B} \otimes C \ar[r] & 0 \\ 0 \ar[r] & I/I^2 \otimes C \ar[r] \ar[u] & K/K^2 \ar[r] \ar[u] & J/J^2 \ar[r] \ar[u] & 0 } $$ with exact rows. In particular, the six term exact sequence of Algebra, Lemma \ref{algebra-lemma-exact-sequence-NL} can be completed with a zero on the left, i.e., the sequence $$ 0 \to H_1(\NL_{B/A} \otimes_B C) \to H_1(L_{C/A}) \to H_1(L_{C/B}) \to \Omega_{B/A} \otimes_B C \to \Omega_{C/A} \to \Omega_{C/B} \to 0 $$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-transitive-colimit-lci-at-end} Let $A \to B \to C$ be ring maps. If $B \to C$ is a filtered colimit of local complete intersection homomorphisms then the conclusion of Lemma \ref{lemma-transitive-lci-at-end} remains valid. \end{lemma} 
\begin{lemma} \label{lemma-henselization-NL} Let $A \to B$ be a local homomorphism of local rings. Let $A^h \to B^h$, resp.\ $A^{sh} \to B^{sh}$ be the induced map on henselizations, resp.\ strict henselizations (Algebra, Lemma \ref{algebra-lemma-henselian-functorial}, resp.\ Lemma \ref{algebra-lemma-strictly-henselian-functorial}). Then $\NL_{B/A} \otimes_B B^h \to \NL_{B^h/A^h}$ and $\NL_{B/A} \otimes_B B^{sh} \to \NL_{B^{sh}/A^{sh}}$ induce isomorphisms on cohomology groups. \end{lemma} 
\begin{lemma}[Cartier equality] \label{lemma-cartier-equality} Let $K/k$ be a finitely generated field extension. Then $\Omega_{K/k}$ and $H_1(L_{K/k})$ are finite dimensional and $\text{trdeg}_k(K) = \dim_K \Omega_{K/k} - \dim_K H_1(L_{K/k})$. \end{lemma} 
\begin{lemma} \label{lemma-transitivity-gamma} Let $M/L/K$ be field extensions. Then the Jacobi-Zariski sequence $$ 0 \to H_1(L_{L/K}) \otimes_L M \to H_1(L_{M/K}) \to H_1(L_{M/L}) \to \Omega_{L/K} \otimes_L M \to \Omega_{M/K} \to \Omega_{M/L} \to 0 $$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-gamma-commutative-diagram} Given a commutative diagram of fields $$ \xymatrix{ K \ar[r] & K' \\ k \ar[u] \ar[r] & k' \ar[u] } $$ with $k'/k$ and $K'/K$ finitely generated field extensions the kernel and cokernel of the maps $$ \alpha : \Omega_{K/k} \otimes_K K' \to \Omega_{K'/k'} \quad\text{and}\quad \beta : H_1(L_{K/k}) \otimes_K K' \to H_1(L_{K'/k'}) $$ are finite dimensional and $$ \dim \Ker(\alpha) - \dim \Coker(\alpha) -\dim \Ker(\beta) + \dim \Coker(\beta) = \text{trdeg}_k(k') - \text{trdeg}_K(K') $$ \end{lemma} 
\begin{proposition} \label{proposition-characterization-geometrically-regular} Let $k$ be a field of characteristic $p > 0$. Let $(A, \mathfrak m, K)$ be a Noetherian local $k$-algebra. The following are equivalent \begin{enumerate} \item $A$ is geometrically regular over $k$, \item for all $k \subset k' \subset k^{1/p}$ finite over $k$ the ring $A \otimes_k k'$ is regular, \item $A$ is regular and the canonical map $H_1(L_{K/k}) \to \mathfrak m/\mathfrak m^2$ is injective, and \item $A$ is regular and the map $\Omega_{k/\mathbf{F}_p} \otimes_k K \to \Omega_{A/\mathbf{F}_p} \otimes_A K$ is injective. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-geometrically-regular-over-field} Let $k$ be a field of characteristic $p > 0$. Let $(A, \mathfrak m, K)$ be a Noetherian local $k$-algebra. Assume $A$ is geometrically regular over $k$. Let $K/F/k$ be a finitely generated subextension. Let $\varphi : k[y_1, \ldots, y_m] \to A$ be a $k$-algebra map such that $y_i$ maps to an element of $F$ in $K$ and such that $\text{d}y_1, \ldots, \text{d}y_m$ map to a basis of $\Omega_{F/k}$. Set $\mathfrak p = \varphi^{-1}(\mathfrak m)$. Then $$ k[y_1, \ldots, y_m]_\mathfrak p \to A $$ is flat and $A/\mathfrak pA$ is regular. \end{lemma} 
\begin{definition}[Topological rings] \label{definition-topological-ring} \begin{reference} \cite[Chapter 0, Sections 7.1 and 7.2]{EGA1} \end{reference} Let $R$ be a ring and let $M$ be an $R$-module. \begin{enumerate} \item We say $R$ is a {\it topological ring} if $R$ is endowed with a topology such that both addition and multiplication are continuous as maps $R \times R \to R$ where $R \times R$ has the product topology. In this case we say $M$ is a {\it topological module} if $M$ is endowed with a topology such that addition $M \times M \to M$ and scalar multiplication $R \times M \to M$ are continuous. \item A {\it homomorphism of topological modules} is just a continuous $R$-module map. A {\it homomorphism of topological rings} is a ring homomorphism which is continuous for the given topologies. \item We say $M$ is {\it linearly topologized} if $0$ has a fundamental system of neighbourhoods consisting of submodules. We say $R$ is {\it linearly topologized} if $0$ has a fundamental system of neighbourhoods consisting of ideals. \item If $R$ is linearly topologized, we say that $I \subset R$ is an {\it ideal of definition} if $I$ is open and if every neighbourhood of $0$ contains $I^n$ for some $n$. \item If $R$ is linearly topologized, we say that $R$ is {\it pre-admissible} if $R$ has an ideal of definition. \item If $R$ is linearly topologized, we say that $R$ is {\it admissible} if it is pre-admissible and complete\footnote{By our conventions this includes separated.}. \item If $R$ is linearly topologized, we say that $R$ is {\it pre-adic} if there exists an ideal of definition $I$ such that $\{I^n\}_{n \geq 0}$ forms a fundamental system of neighbourhoods of $0$. \item If $R$ is linearly topologized, we say that $R$ is {\it adic} if $R$ is pre-adic and complete. \end{enumerate} Note that a (pre)adic topological ring is the same thing as a (pre)admissible topological ring which has an ideal of definition $I$ such that $I^n$ is open for all $n \geq 1$. \end{definition} 
\begin{lemma} \label{lemma-continuous} Let $\varphi : R \to S$ be a ring map. Let $I \subset R$ and $J \subset S$ be ideals and endow $R$ with the $I$-adic topology and $S$ with the $J$-adic topology. Then $\varphi$ is a homomorphism of topological rings if and only if $\varphi(I^n) \subset J$ for some $n \geq 1$. \end{lemma} 
\begin{lemma}[Baire category theorem] \label{lemma-baire-category-complete-module} Let $M$ be a topological abelian group. Assume $M$ is linearly topologized, complete, and has a countable fundamental system of neighbourhoods of $0$. If $U_n \subset M$, $n \geq 1$ are open dense subsets, then $\bigcap_{n \geq 1} U_n$ is dense. \end{lemma} 
\begin{lemma} \label{lemma-consequence-baire-complete-module} With same assumptions as Lemma \ref{lemma-baire-category-complete-module} if $M = \bigcup_{n \geq 1} N_n$ for some closed subgroups $N_n$, then $N_n$ is open for some $n$. \end{lemma} 
\begin{lemma}[Open mapping lemma] \label{lemma-open-mapping} Let $u : N \to M$ be a continuous map of linearly topologized abelian groups. Assume that $N$ is complete, $M$ separated, and $N$ has a countable fundamental system of neighbourhoods of $0$. Then exactly one of the following holds \begin{enumerate} \item $u$ is open, or \item for some open subgroup $N' \subset N$ the image $u(N')$ is nowhere dense in $M$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-formally-smooth} Let $R \to S$ be a homomorphism of topological rings with $R$ and $S$ linearly topologized. We say $S$ is {\it formally smooth over $R$} if for every commutative solid diagram $$ \xymatrix{ S \ar[r] \ar@{-->}[rd] & A/J \\ R \ar[r] \ar[u] & A \ar[u] } $$ of homomorphisms of topological rings where $A$ is a discrete ring and $J \subset A$ is an ideal of square zero, a dotted arrow exists which makes the diagram commute. \end{definition} 
\begin{lemma} \label{lemma-formally-smooth} Let $\varphi : R \to S$ be a ring map. \begin{enumerate} \item If $R \to S$ is formally smooth in the sense of Algebra, Definition \ref{algebra-definition-formally-smooth}, then $R \to S$ is formally smooth for any linear topology on $R$ and any pre-adic topology on $S$ such that $R \to S$ is continuous. \item Let $\mathfrak n \subset S$ and $\mathfrak m \subset R$ ideals such that $\varphi$ is continuous for the $\mathfrak m$-adic topology on $R$ and the $\mathfrak n$-adic topology on $S$. Then the following are equivalent \begin{enumerate} \item $\varphi$ is formally smooth for the $\mathfrak m$-adic topology on $R$ and the $\mathfrak n$-adic topology on $S$, and \item $\varphi$ is formally smooth for the discrete topology on $R$ and the $\mathfrak n$-adic topology on $S$. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-formally-smooth-adic} Let $R \to S$ be a ring map. Let $\mathfrak n \subset S$ be an ideal. If the equivalent conditions (2)(a) and (2)(b) of Lemma \ref{lemma-formally-smooth} hold, then we say $R \to S$ is {\it formally smooth for the $\mathfrak n$-adic topology}. \end{definition} 
\begin{lemma} \label{lemma-formally-smooth-completion} Let $(R, \mathfrak m)$ and $(S, \mathfrak n)$ be rings endowed with finitely generated ideals. Endow $R$ and $S$ with the $\mathfrak m$-adic and $\mathfrak n$-adic topologies. Let $R \to S$ be a homomorphism of topological rings. The following are equivalent \begin{enumerate} \item $R \to S$ is formally smooth for the $\mathfrak n$-adic topology, \item $R \to S^\wedge$ is formally smooth for the $\mathfrak n^\wedge$-adic topology, \item $R^\wedge \to S^\wedge$ is formally smooth for the $\mathfrak n^\wedge$-adic topology. \end{enumerate} Here $R^\wedge$ and $S^\wedge$ are the $\mathfrak m$-adic and $\mathfrak n$-adic completions of $R$ and $S$. \end{lemma} 
\begin{lemma} \label{lemma-lift-continuous} Let $R \to S$ be a ring map. Let $\mathfrak n$ be an ideal of $S$. Assume that $R \to S$ is formally smooth in the $\mathfrak n$-adic topology. Consider a solid commutative diagram $$ \xymatrix{ S \ar[r]_\psi \ar@{-->}[rd] & A/J \\ R \ar[r] \ar[u] & A \ar[u] } $$ of homomorphisms of topological rings where $A$ is adic and $A/J$ is the quotient (as topological ring) of $A$ by a closed ideal $J \subset A$ such that $J^t$ is contained in an ideal of definition of $A$ for some $t \geq 1$. Then there exists a dotted arrow in the category of topological rings which makes the diagram commute. \end{lemma} 
\begin{lemma} \label{lemma-increase-ideal} Let $R \to S$ be a ring map. Let $\mathfrak n \subset \mathfrak n' \subset S$ be ideals. If $R \to S$ is formally smooth for the $\mathfrak n$-adic topology, then $R \to S$ is formally smooth for the $\mathfrak n'$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-compose-formally-smooth} A composition of formally smooth continuous homomorphisms of linearly topologized rings is formally smooth. \end{lemma} 
\begin{lemma} \label{lemma-base-change-fs} Let $R$, $S$ be rings. Let $\mathfrak n \subset S$ be an ideal. Let $R \to S$ be formally smooth for the $\mathfrak n$-adic topology. Let $R \to R'$ be any ring map. Then $R' \to S' = S \otimes_R R'$ is formally smooth in the $\mathfrak n' = \mathfrak nS'$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-descent-fs} Let $R$, $S$ be rings. Let $\mathfrak n \subset S$ be an ideal. Let $R \to R'$ be a ring map. Set $S' = S \otimes_R R'$ and $\mathfrak n' = \mathfrak nS$. If \begin{enumerate} \item the map $R \to R'$ embeds $R$ as a direct summand of $R'$ as an $R$-module, and \item $R' \to S'$ is formally smooth for the $\mathfrak n'$-adic topology, \end{enumerate} then $R \to S$ is formally smooth in the $\mathfrak n$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-fs-local} Let $(R, \mathfrak m) \to (S, \mathfrak n)$ be a local homomorphism of local rings. The following are equivalent \begin{enumerate} \item $R \to S$ is formally smooth in the $\mathfrak n$-adic topology, \item for every solid commutative diagram $$ \xymatrix{ S \ar[r] \ar@{-->}[rd] & A/J \\ R \ar[r] \ar[u] & A \ar[u] } $$ of local homomorphisms of local rings where $J \subset A$ is an ideal of square zero, $\mathfrak m_A^n = 0$ for some $n > 0$, and $S \to A/J$ induces an isomorphism on residue fields, a dotted arrow exists which makes the diagram commute. \end{enumerate} If $S$ is Noetherian these conditions are also equivalent to \begin{enumerate} \item[(3)] same as in (2) but only for diagrams where in addition $A \to A/J$ is a small extension (Algebra, Definition \ref{algebra-definition-small-extension}). \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-fs-implies-regular} Let $k$ be a field and let $(A, \mathfrak m, K)$ be a Noetherian local $k$-algebra. If $k \to A$ is formally smooth for the $\mathfrak m$-adic topology, then $A$ is a regular local ring. \end{lemma} 
\begin{lemma} \label{lemma-lift-residue-field} Let $k$ be a field. Let $(A, \mathfrak m, \kappa)$ be a complete local $k$-algebra. If $\kappa/k$ is separable, then there exists a $k$-algebra map $\kappa \to A$ such that $\kappa \to A \to \kappa$ is $\text{id}_\kappa$. \end{lemma} 
\begin{lemma} \label{lemma-power-series-over-residue-field} Let $k$ be a field. Let $(A, \mathfrak m, \kappa)$ be a complete local $k$-algebra. If $\kappa/k$ is separable and $A$ regular, then there exists an isomorphism of $A \cong \kappa[[t_1, \ldots, t_d]]$ as $k$-algebras. \end{lemma} 
\begin{lemma} \label{lemma-regular-implies-fs} Let $k$ be a field. Let $(A, \mathfrak m, K)$ be a regular local $k$-algebra such that $K/k$ is separable. Then $k \to A$ is formally smooth in the $\mathfrak m$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth-finite-type} Let $A \to B$ be a finite type ring map with $A$ Noetherian. Let $\mathfrak q \subset B$ be a prime ideal lying over $\mathfrak p \subset A$. The following are equivalent \begin{enumerate} \item $A \to B$ is smooth at $\mathfrak q$, and \item $A_\mathfrak p \to B_\mathfrak q$ is formally smooth in the $\mathfrak q$-adic topology. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-power-series-ring-over-Cohen-fs} Let $K$ be a field of characteristic $0$ and $A = K[[x_1, \ldots, x_n]]$. Let $L$ be a field of characteristic $p > 0$ and $B = L[[x_1, \ldots, x_n]]$. Let $\Lambda$ be a Cohen ring. Let $C = \Lambda[[x_1, \ldots, x_n]]$. \begin{enumerate} \item $\mathbf{Q} \to A$ is formally smooth in the  $\mathfrak m$-adic topology. \item $\mathbf{F}_p \to B$ is formally smooth in the  $\mathfrak m$-adic topology. \item $\mathbf{Z} \to C$ is formally smooth in the $\mathfrak m$-adic topology. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quotient-power-series-ring-over-Cohen} Let $K$ be a field and $A = K[[x_1, \ldots, x_n]]$. Let $\Lambda$ be a Cohen ring and let $B = \Lambda[[x_1, \ldots, x_n]]$. \begin{enumerate} \item If $y_1, \ldots, y_n \in A$ is a regular system of parameters then $K[[y_1, \ldots, y_n]] \to A$ is an isomorphism. \item If $z_1, \ldots, z_r \in A$ form part of a regular system of parameters for $A$, then $r \leq n$ and $A/(z_1, \ldots, z_r) \cong K[[y_1, \ldots, y_{n - r}]]$. \item If $p, y_1, \ldots, y_n \in B$ is a regular system of parameters then $\Lambda[[y_1, \ldots, y_n]] \to B$ is an isomorphism. \item If $p, z_1, \ldots, z_r \in B$ form part of a regular system of parameters for $B$, then $r \leq n$ and $B/(z_1, \ldots, z_r) \cong \Lambda[[y_1, \ldots, y_{n - r}]]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-embed-map-Noetherian-complete-local-rings} Let $A \to B$ be a local homomorphism of Noetherian complete local rings. Then there exists a commutative diagram $$ \xymatrix{ S \ar[r] & B \\ R \ar[u] \ar[r] & A \ar[u] } $$ with the following properties: \begin{enumerate} \item the horizontal arrows are surjective, \item if the characteristic of $A/\mathfrak m_A$ is zero, then $S$ and $R$ are power series rings over fields, \item if the characteristic of $A/\mathfrak m_A$ is $p > 0$, then $S$ and $R$ are power series rings over Cohen rings, and \item $R \to S$ maps a regular system of parameters of $R$ to part of a regular system of parameters of $S$. \end{enumerate} In particular $R \to S$ is flat (see Algebra, Lemma \ref{algebra-lemma-flat-over-regular}) with regular fibre $S/\mathfrak m_R S$ (see Algebra, Lemma \ref{algebra-lemma-regular-ring-CM}). \end{lemma} 
\begin{lemma} \label{lemma-dominate-two-surjections} Let $S \to R$ and $S' \to R$ be surjective maps of complete Noetherian local rings. Then $S \times_R S'$ is a complete Noetherian local ring. \end{lemma} 
\begin{theorem} \label{theorem-regular-fs} Let $k$ be a field. Let $(A, \mathfrak m, K)$ be a Noetherian local $k$-algebra. If the characteristic of $k$ is zero then the following are equivalent \begin{enumerate} \item $A$ is a regular local ring, and \item $k \to A$ is formally smooth in the $\mathfrak m$-adic topology. \end{enumerate} If the characteristic of $k$ is $p > 0$ then the following are equivalent \begin{enumerate} \item $A$ is geometrically regular over $k$, \item $k \to A$ is formally smooth in the $\mathfrak m$-adic topology. \item for all $k \subset k' \subset k^{1/p}$ finite over $k$ the ring $A \otimes_k k'$ is regular, \item $A$ is regular and the canonical map $H_1(L_{K/k}) \to \mathfrak m/\mathfrak m^2$ is injective, and \item $A$ is regular and the map $\Omega_{k/\mathbf{F}_p} \otimes_k K \to \Omega_{A/\mathbf{F}_p} \otimes_A K$ is injective. \end{enumerate} \end{theorem} 
\begin{lemma} \label{lemma-formally-smooth-flat} Let $A \to B$ be a local homomorphism of Noetherian local rings. Assume $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. Then $A \to B$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth-JZ} Let $A \to B$ be a local homomorphism of Noetherian local rings. Assume $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. Let $K$ be the residue field of $B$. Then the Jacobi-Zariski sequence for $A \to B \to K$ gives an exact sequence $$ 0 \to H_1(\NL_{K/A}) \to \mathfrak m_B/\mathfrak m_B^2 \to \Omega_{B/A} \otimes_B K \to \Omega_{K/A} \to 0 $$ \end{lemma} 
\begin{proposition} \label{proposition-fs-flat-fibre-fs} Let $A \to B$ be a local homomorphism of Noetherian local rings. Let $k$ be the residue field of $A$ and $\overline{B} = B \otimes_A k$ the special fibre. The following are equivalent \begin{enumerate} \item $A \to B$ is flat and $\overline{B}$ is geometrically regular over $k$, \item $A \to B$ is flat and $k \to \overline{B}$ is formally smooth in the $\mathfrak m_{\overline{B}}$-adic topology, and \item $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-lift-fs} Let $A$ be a Noetherian complete local ring with residue field $k$. Let $B$ be a Noetherian complete local $k$-algebra. Assume $k \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. Then there exists a Noetherian complete local ring $C$ and a local homomorphism $A \to C$ which is formally smooth in the $\mathfrak m_C$-adic topology such that $C \otimes_A k \cong B$. \end{lemma} 
\begin{definition} \label{definition-regular} A ring map $R \to \Lambda$ is {\it regular} if it is flat and for every prime $\mathfrak p \subset R$ the fibre ring $$ \Lambda \otimes_R \kappa(\mathfrak p) = \Lambda_\mathfrak p/\mathfrak p\Lambda_\mathfrak p $$ is Noetherian and geometrically regular over $\kappa(\mathfrak p)$. \end{definition} 
\begin{lemma}[Regular is a local property] \label{lemma-regular-local} Let $R \to \Lambda$ be a ring map with $\Lambda$ Noetherian. The following are equivalent \begin{enumerate} \item $R \to \Lambda$ is regular, \item $R_\mathfrak p \to \Lambda_\mathfrak q$ is regular for all $\mathfrak q \subset \Lambda$ lying over $\mathfrak p \subset R$, and \item $R_\mathfrak m \to \Lambda_{\mathfrak m'}$ is regular for all maximal ideals $\mathfrak m' \subset \Lambda$ lying over $\mathfrak m$ in $R$. \end{enumerate} \end{lemma} 
\begin{lemma}[Regular maps and base change] \label{lemma-regular-base-change} Let $R \to \Lambda$ be a regular ring map. For any finite type ring map $R \to R'$ the base change $R' \to \Lambda \otimes_R R'$ is regular too. \end{lemma} 
\begin{lemma}[Composition of regular maps] \label{lemma-regular-composition} Let $A \to B$ and $B \to C$ be regular ring maps. If the fibre rings of $A \to C$ are Noetherian, then $A \to C$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-colimit-smooth-regular} Let $R$ be a ring. Let $(A_i, \varphi_{ii'})$ be a directed system of smooth $R$-algebras. Set $\Lambda = \colim A_i$. If the fibre rings $\Lambda \otimes_R \kappa(\mathfrak p)$ are Noetherian for all $\mathfrak p \subset R$, then $R \to \Lambda$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-regular-field-extension} Let $K/k$ be a field extension. Then $k \to K$ is a regular ring map if and only if $K$ is a separable field extension of $k$. \end{lemma} 
\begin{lemma} \label{lemma-regular-permanence} Let $A \to B \to C$ be ring maps. If $A \to C$ is regular and $B \to C$ is flat and surjective on spectra, then $A \to B$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-reduced-goes-up} Let $\varphi : R \to S$ be a ring map. Assume \begin{enumerate} \item $\varphi$ is regular, \item $S$ is Noetherian, and \item $R$ is Noetherian and reduced. \end{enumerate} Then $S$ is reduced. \end{lemma} 
\begin{lemma} \label{lemma-normal-goes-up} Let $\varphi : R \to S$ be a ring map. Assume \begin{enumerate} \item $\varphi$ is regular, \item $S$ is Noetherian, and \item $R$ is Noetherian and normal. \end{enumerate} Then $S$ is normal. \end{lemma} 
\begin{lemma} \label{lemma-completion-dimension} Let $A$ be a Noetherian local ring. Then $\dim(A) = \dim(A^\wedge)$. \end{lemma} 
\begin{lemma} \label{lemma-completion-depth} Let $A$ be a Noetherian local ring. Then $\text{depth}(A) = \text{depth}(A^\wedge)$. \end{lemma} 
\begin{lemma} \label{lemma-completion-CM} Let $A$ be a Noetherian local ring. Then $A$ is Cohen-Macaulay if and only if $A^\wedge$ is so. \end{lemma} 
\begin{lemma} \label{lemma-completion-regular} Let $A$ be a Noetherian local ring. Then $A$ is regular if and only if $A^\wedge$ is so. \end{lemma} 
\begin{lemma} \label{lemma-completion-dvr} Let $A$ be a Noetherian local ring. Then $A$ is a discrete valuation ring if and only if $A^\wedge$ is so. \end{lemma} 
\begin{lemma} \label{lemma-completion-reduced} Let $A$ be a Noetherian local ring. \begin{enumerate} \item If $A^\wedge$ is reduced, then so is $A$. \item In general $A$ reduced does not imply $A^\wedge$ is reduced. \item If $A$ is Nagata, then $A$ is reduced if and only if $A^\wedge$ is reduced. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-completion-normal} Let $A$ be a Noetherian local ring. If $A^\wedge$ is normal, then so is $A$. \end{lemma} 
\begin{lemma} \label{lemma-flat-completion} Let $A \to B$ be a local homomorphism of Noetherian local rings. Then the induced map of completions $A^\wedge \to B^\wedge$ is flat if and only if $A \to B$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-flat-unramified} Let $A \to B$ be a flat local homomorphism of Noetherian local rings such that $\mathfrak m_A B = \mathfrak m_B$ and $\kappa(\mathfrak m_A) = \kappa(\mathfrak m_B)$. Then $A \to B$ induces an isomorphism $A^\wedge \to B^\wedge$ of completions. \end{lemma} 
\begin{lemma} \label{lemma-Noetherian-etale-extension} If $A \to B$ is an \'etale ring map and $\mathfrak q$ is a prime of $B$ lying over $\mathfrak p \subset A$, then $A_{\mathfrak p}$ is Noetherian if and only if $B_{\mathfrak q}$ is Noetherian. \end{lemma} 
\begin{lemma} \label{lemma-dimension-etale-extension} If $A \to B$ is an \'etale ring map and $\mathfrak q$ is a prime of $B$ lying over $\mathfrak p \subset A$, then $\dim(A_{\mathfrak p}) = \dim(B_{\mathfrak q})$. \end{lemma} 
\begin{lemma} \label{lemma-regular-etale-extension} If $A \to B$ is an \'etale ring map and $\mathfrak q$ is a prime of $B$ lying over $\mathfrak p \subset A$, then $A_{\mathfrak p}$ is regular if and only if $B_{\mathfrak q}$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-Dedekind-etale-extension} If $A \to B$ is an \'etale ring map and $A$ is a Dedekind domain, then $B$ is a finite product of Dedekind domains. In particular, the localizations $B_\mathfrak q$ for $\mathfrak q \subset B$ maximal are discrete valuation rings. \end{lemma} 
\begin{lemma} \label{lemma-dumb-properties-henselization} Let $(R, \mathfrak m, \kappa)$ be a local ring. Then we have the following \begin{enumerate} \item $R \to R^h \to R^{sh}$ are faithfully flat ring maps, \item $\mathfrak m R^h = \mathfrak m^h$ and $\mathfrak m R^{sh} = \mathfrak m^h R^{sh} = \mathfrak m^{sh}$, \item $R/\mathfrak m^n = R^h/\mathfrak m^nR^h$ for all $n$, \item there exist elements $x_i \in R^{sh}$ such that $R^{sh}/\mathfrak m^nR^{sh}$ is a free $R/\mathfrak m^n$-module on $x_i \bmod \mathfrak m^nR^{sh}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-henselization-formally-smooth} Let $(R, \mathfrak m, \kappa)$ be a local ring. Then \begin{enumerate} \item $R \to R^h$, $R^h \to R^{sh}$, and $R \to R^{sh}$ are formally \'etale, \item $R \to R^h$, $R^h \to R^{sh}$, resp.\ $R \to R^{sh}$ are formally smooth in the $\mathfrak m^h$, $\mathfrak m^{sh}$, resp.\ $\mathfrak m^{sh}$-topology. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-henselization-noetherian} \begin{reference} \cite[IV, Theorem 18.6.6 and Proposition 18.8.8]{EGA} \end{reference} Let $R$ be a local ring. The following are equivalent \begin{enumerate} \item $R$ is Noetherian, \item $R^h$ is Noetherian, and \item $R^{sh}$ is Noetherian. \end{enumerate} In this case we have \begin{enumerate} \item[(a)] $(R^h)^\wedge$ and $(R^{sh})^\wedge$ are Noetherian complete local rings, \item[(b)] $R^\wedge \to (R^h)^\wedge$ is an isomorphism, \item[(c)] $R^h \to (R^h)^\wedge$ and $R^{sh} \to (R^{sh})^\wedge$ are flat, \item[(d)] $R^\wedge \to (R^{sh})^\wedge$ is formally smooth in the $\mathfrak m_{(R^{sh})^\wedge}$-adic topology, \item[(e)] $(R^\wedge)^{sh} = R^\wedge \otimes_{R^h} R^{sh}$, and \item[(f)] $((R^\wedge)^{sh})^\wedge = (R^{sh})^\wedge$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-henselization-reduced} \begin{slogan} Reducedness passes to the (strict) henselization. \end{slogan} Let $R$ be a local ring. The following are equivalent: $R$ is reduced, the henselization $R^h$ of $R$ is reduced, and the strict henselization $R^{sh}$ of $R$ is reduced. \end{lemma} 
\begin{lemma} \label{lemma-henselization-nil} Let $R$ be a local ring. Let $nil(R)$ denote the ideal of nilpotent elements of $R$. Then $nil(R)R^h = nil(R^h)$ and $nil(R)R^{sh} = nil(R^{sh})$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-normal} Let $R$ be a local ring. The following are equivalent: $R$ is a normal domain, the henselization $R^h$ of $R$ is a normal domain, and the strict henselization $R^{sh}$ of $R$ is a normal domain. \end{lemma} 
\begin{lemma} \label{lemma-henselization-dimension} Given any local ring $R$ we have $\dim(R) = \dim(R^h) = \dim(R^{sh})$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-depth} Given a Noetherian local ring $R$ we have $\text{depth}(R) = \text{depth}(R^h) = \text{depth}(R^{sh})$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-CM} Let $R$ be a Noetherian local ring. The following are equivalent: $R$ is Cohen-Macaulay, the henselization $R^h$ of $R$ is Cohen-Macaulay, and the strict henselization $R^{sh}$ of $R$ is Cohen-Macaulay. \end{lemma} 
\begin{lemma} \label{lemma-henselization-regular} Let $R$ be a Noetherian local ring. The following are equivalent: $R$ is a regular local ring, the henselization $R^h$ of $R$ is a regular local ring, and the strict henselization $R^{sh}$ of $R$ is a regular local ring. \end{lemma} 
\begin{lemma} \label{lemma-henselization-dvr} Let $R$ be a Noetherian local ring. Then $R$ is a discrete valuation ring if and only if $R^h$ is a discrete valuation ring if and only if $R^{sh}$ is a discrete valuation ring. \end{lemma} 
\begin{lemma} \label{lemma-filtered-colimit-etale-noetherian-fibres} Let $A$ be a ring. Let $B$ be a filtered colimit of \'etale $A$-algebras. Let $\mathfrak p$ be a prime of $A$. If $B$ is Noetherian, then there are finitely many primes $\mathfrak q_1, \ldots, \mathfrak q_r$ lying over $\mathfrak p$, we have $B \otimes_A \kappa(\mathfrak p) = \prod \kappa(\mathfrak q_i)$, and each of the field extensions $\kappa(\mathfrak q_i)/\kappa(\mathfrak p)$ is separable algebraic. \end{lemma} 
\begin{lemma} \label{lemma-fibres-henselization} Let $R$ be a Noetherian local ring. Let $\mathfrak p \subset R$ be a prime. Then $$ R^h \otimes_R \kappa(\mathfrak p) = \prod\nolimits_{i = 1, \ldots, t} \kappa(\mathfrak q_i) \quad\text{resp.}\quad R^{sh} \otimes_R \kappa(\mathfrak p) = \prod\nolimits_{i = 1, \ldots, s} \kappa(\mathfrak r_i) $$ where $\mathfrak q_1, \ldots, \mathfrak q_t$, resp.\ $\mathfrak r_1, \ldots, \mathfrak r_s$ are the prime of $R^h$, resp.\ $R^{sh}$ lying over $\mathfrak p$. Moreover, the field extensions $\kappa(\mathfrak q_i)/\kappa(\mathfrak p)$ resp.\ $\kappa(\mathfrak r_i)/\kappa(\mathfrak p)$ are separable algebraic. \end{lemma} 
\begin{definition} \label{definition-p-basis} Let $p$ be a prime number. Let $k \to K$ be an extension of fields of characteristic $p$. Denote $kK^p$ the compositum of $k$ and $K^p$ in $K$. \begin{enumerate} \item A subset $\{x_i\} \subset K$ is called {\it p-independent over $k$} if the elements $x^E = \prod x_i^{e_i}$ where $0 \leq e_i < p$ are linearly independent over $kK^p$. \item A subset $\{x_i\}$ of $K$ is called a {\it p-basis of $K$ over $k$} if the elements $x^E$ form a basis of $K$ over $kK^p$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-p-basis} Let $K/k$ be a field extension. Assume $k$ has characteristic $p > 0$. Let $\{x_i\}$ be a subset of $K$. The following are equivalent \begin{enumerate} \item the elements $\{x_i\}$ are $p$-independent over $k$, and \item the elements $\text{d}x_i$ are $K$-linearly independent in $\Omega_{K/k}$. \end{enumerate} Any $p$-independent collection can be extended to a $p$-basis of $K$ over $k$. In particular, the field $K$ has a $p$-basis over $k$. Moreover, the following are equivalent: \begin{enumerate} \item[(a)] $\{x_i\}$ is a $p$-basis of $K$ over $k$, and \item[(b)] $\text{d}x_i$ is a basis of the $K$-vector space $\Omega_{K/k}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-intersection-subfields-subspace} Let $K/k$ be a field extension. Let $\{K_\alpha\}_{\alpha \in A}$ be a collection of subfields of $K$ with the following properties \begin{enumerate} \item $k \subset K_\alpha$ for all $\alpha \in A$, \item $k = \bigcap_{\alpha \in A} K_\alpha$, \item for $\alpha, \alpha' \in A$ there exists an $\alpha'' \in A$ such that $K_{\alpha''} \subset K_\alpha \cap K_{\alpha'}$. \end{enumerate} Then for $n \geq 1$ and $V \subset K^{\oplus n}$ a $K$-vector space we have $V \cap k^{\oplus n} \not = 0$ if and only if $V \cap K_\alpha^{\oplus n} \not = 0$ for all $\alpha \in A$. \end{lemma} 
\begin{lemma} \label{lemma-intersection-subfields} Let $K$ be a field of characteristic $p$. Let $\{K_\alpha\}_{\alpha \in A}$ be a collection of subfields of $K$ with the following properties \begin{enumerate} \item $K^p \subset K_\alpha$ for all $\alpha \in A$, \item $K^p = \bigcap_{\alpha \in A} K_\alpha$, \item for $\alpha, \alpha' \in A$ there exists an $\alpha'' \in A$ such that $K_{\alpha''} \subset K_\alpha \cap K_{\alpha'}$. \end{enumerate} Then \begin{enumerate} \item the intersection of the kernels of the maps $\Omega_{K/\mathbf{F}_p} \to \Omega_{K/K_\alpha}$ is zero, \item for any finite extension $L/K$ we have $L^p = \bigcap_{\alpha \in A} L^pK_\alpha$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-power-series-ring-subfields} Let $k$ be a field of characteristic $p > 0$. Let $n, m \geq 0$. Let $K$ be the fraction field of $k[[x_1, \ldots, x_n]][y_1, \ldots, y_m]$. As $k'$ ranges through all subfields $k/k'/k^p$ with $[k : k'] < \infty$ the subfields $$ \text{fraction field of } k'[[x_1^p, \ldots, x_n^p]][y_1^p, \ldots, y_m^p] \subset K $$ form a family of subfields as in Lemma \ref{lemma-intersection-subfields}. Moreover, each of the ring extensions $k'[[x_1^p, \ldots, x_n^p]][y_1^p, \ldots, y_m^p] \subset k[[x_1, \ldots, x_n]][y_1, \ldots, y_m]$ is finite. \end{lemma} 
\begin{definition} \label{definition-J} \begin{reference} \cite[(32.B)]{MatCA} \end{reference} Let $R$ be a Noetherian ring. Let $X = \Spec(R)$. \begin{enumerate} \item We say $R$ is {\it J-0} if $\text{Reg}(X)$ contains a nonempty open. \item We say $R$ is {\it J-1} if $\text{Reg}(X)$ is open. \item We say $R$ is {\it J-2} if any finite type $R$-algebra is J-1. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-J-1} Let $R$ be a Noetherian ring. Let $X = \Spec(R)$. The ring $R$ is J-1 if and only if $V(\mathfrak p) \cap \text{Reg}(X)$ contains a nonempty open subset of $V(\mathfrak p)$ for all $\mathfrak p \in \text{Reg}(X)$. \end{lemma} 
\begin{lemma} \label{lemma-intersection-regular-with-closed} Let $R$ be a Noetherian ring. Let $X = \Spec(R)$. Assume that for all primes $\mathfrak p \subset R$ the ring $R/\mathfrak p$ is J-0. Then $R$ is J-1. \end{lemma} 
\begin{lemma} \label{lemma-J-0-goes-down} Let $R \to S$ be a ring map. Assume that \begin{enumerate} \item $R$ is a Noetherian domain, \item $R \to S$ is injective and of finite type, and \item $S$ is a domain and J-0. \end{enumerate} Then $R$ is J-0. \end{lemma} 
\begin{lemma} \label{lemma-J-0-goes-up} Let $R \to S$ be a ring map. Assume that \begin{enumerate} \item $R$ is a Noetherian domain and J-0, \item $R \to S$ is injective and of finite type, and \item $S$ is a domain, and \item the induced extension of fraction fields is separable. \end{enumerate} Then $S$ is J-0. \end{lemma} 
\begin{lemma} \label{lemma-J-2} Let $R$ be a Noetherian ring. The following are equivalent \begin{enumerate} \item $R$ is J-2, \item every finite type $R$-algebra which is a domain is J-0, \item every finite $R$-algebra is J-1, \item for every prime $\mathfrak p$ and every finite purely inseparable extension $L/\kappa(\mathfrak p)$ there exists a finite $R$-algebra $R'$ which is a domain, which is J-0, and whose field of fractions is $L$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derivation-extends} Let $R$ be a ring. Let $D : R \to R$ be a derivation. \begin{enumerate} \item For any ideal $I \subset R$ the derivation $D$ extends canonically to a derivation $D^\wedge : R^\wedge \to R^\wedge$ on the $I$-adic completion. \item For any multiplicative subset $S \subset R$ the derivation $D$ extends uniquely to the localization $S^{-1}R$ of $R$. \end{enumerate} If $R \subset R'$ is a finite type extension of rings such that $R_g \cong R'_g$ for some $g \in R$ which is a nonzerodivisor in $R'$, then $g^ND$ extends to $R'$ for some $N \geq 0$. \end{lemma} 
\begin{lemma} \label{lemma-quotient-regular} \begin{slogan} The Jacobian criterion for hypersurfaces, done right. \end{slogan} Let $R$ be a regular ring. Let $f \in R$. Assume there exists a derivation $D : R \to R$ such that $D(f)$ is a unit of $R/(f)$. Then $R/(f)$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-quotient-sequence-regular} Let $(R, \mathfrak m, \kappa)$ be a regular local ring. Let $m \geq 1$. Let $f_1, \ldots, f_m \in \mathfrak m$. Assume there exist derivations $D_1, \ldots, D_m : R \to R$ such that $\det_{1 \leq i, j \leq m}(D_i(f_j))$ is a unit of $R$. Then $R/(f_1, \ldots, f_m)$ is regular and $f_1, \ldots, f_m$ is a regular sequence. \end{lemma} 
\begin{lemma} \label{lemma-degree-p-extension-regular} Let $R$ be a regular ring. Let $f \in R$. Assume there exists a derivation $D : R \to R$ such that $D(f)$ is a unit of $R$. Then $R[z]/(z^n - f)$ is regular for any integer $n \geq 1$. More generally, $R[z]/(p(z) - f)$ is regular for any $p \in \mathbf{Z}[z]$. \end{lemma} 
\begin{lemma} \label{lemma-find-D} Let $p$ be a prime number. Let $B$ be a domain with $p = 0$ in $B$. Let $f \in B$ be an element which is not a $p$th power in the fraction field of $B$. If $B$ is of finite type over a Noetherian complete local ring, then there exists a derivation $D : B \to B$ such that $D(f)$ is not zero. \end{lemma} 
\begin{lemma} \label{lemma-complete-Noetherian-domain-J-0} Let $A$ be a Noetherian complete local domain. Then $A$ is J-0. \end{lemma} 
\begin{proposition} \label{proposition-ubiquity-J-2} The following types of rings are J-2: \begin{enumerate} \item fields, \item Noetherian complete local rings, \item $\mathbf{Z}$, \item Noetherian local rings of dimension $1$, \item Nagata rings of dimension $1$, \item Dedekind domains with fraction field of characteristic zero, \item finite type ring extensions of any of the above. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-lift-derivation-through-fs} Let $A \to B$ be a local homomorphism of Noetherian local rings. Let $D : A \to A$ be a derivation. Assume that $B$ is complete and $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. Then there exists an extension $D' : B \to B$ of $D$. \end{lemma} 
\begin{proposition} \label{proposition-fs-regular} Let $A \to B$ be a local homomorphism of Noetherian complete local rings. Let $k$ be the residue field of $A$ and $\overline{B} = B \otimes_A k$ the special fibre. The following are equivalent \begin{enumerate} \item $A \to B$ is regular, \item $A \to B$ is flat and $\overline{B}$ is geometrically regular over $k$, \item $A \to B$ is flat and $k \to \overline{B}$ is formally smooth in the $\mathfrak m_{\overline{B}}$-adic topology, and \item $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. \end{enumerate} \end{proposition} 
\begin{definition} \label{definition-G-ring} A ring $R$ is called a {\it G-ring} if $R$ is Noetherian and for every prime $\mathfrak p$ of $R$ the ring map $R_\mathfrak p \to (R_\mathfrak p)^\wedge$ is regular. \end{definition} 
\begin{lemma} \label{lemma-check-G-ring-easy} Let $R$ be a Noetherian ring. Then $R$ is a G-ring if and only if for every pair of primes $\mathfrak q \subset \mathfrak p \subset R$ the algebra $$ (R/\mathfrak q)_\mathfrak p^\wedge \otimes_{R/\mathfrak q} \kappa(\mathfrak q) $$ is geometrically regular over $\kappa(\mathfrak q)$. \end{lemma} 
\begin{lemma} \label{lemma-G-ring-goes-up-quasi-finite} Let $R \to R'$ be a finite type map of Noetherian rings and let $$ \xymatrix{ \mathfrak q' \ar[r] & \mathfrak p' \ar[r] & R' \\ \mathfrak q \ar[r] \ar@{-}[u] & \mathfrak p \ar[r] \ar@{-}[u] & R \ar[u] } $$ be primes. Assume $R \to R'$ is quasi-finite at $\mathfrak p'$. \begin{enumerate} \item If the formal fibre $R_\mathfrak p^\wedge \otimes_R \kappa(\mathfrak q)$ is geometrically regular over $\kappa(\mathfrak q)$, then the formal fibre $R'_{\mathfrak p'} \otimes_{R'} \kappa(\mathfrak q')$ is geometrically regular over $\kappa(\mathfrak q')$. \item If the formal fibres of $R_\mathfrak p$ are geometrically regular, then the formal fibres of $R'_{\mathfrak p'}$ are geometrically regular. \item If $R \to R'$ is quasi-finite and $R$ is a G-ring, then $R'$ is a G-ring. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-G-ring} Let $R$ be a Noetherian ring. Then $R$ is a G-ring if and only if for every finite free ring map $R \to S$ the formal fibres of $S$ are regular rings. \end{lemma} 
\begin{lemma} \label{lemma-helper-G-ring} Let $k$ be a field of characteristic $p$. Let $A = k[[x_1, \ldots, x_n]][y_1, \ldots, y_n]$ and denote $K$ the fraction field of $A$. Let $\mathfrak p \subset A$ be a prime. Then $A_\mathfrak p^\wedge \otimes_A K$ is geometrically regular over $K$. \end{lemma} 
\begin{proposition} \label{proposition-Noetherian-complete-G-ring} A Noetherian complete local ring is a G-ring. \end{proposition} 
\begin{lemma} \label{lemma-check-G-ring-maximal-ideals} Let $R$ be a Noetherian ring. Then $R$ is a G-ring if and only if $R_\mathfrak m$ has geometrically regular formal fibres for every maximal ideal $\mathfrak m$ of $R$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-G-ring} Let $R$ be a Noetherian local ring which is a G-ring. Then the henselization $R^h$ and the strict henselization $R^{sh}$ are G-rings. \end{lemma} 
\begin{lemma} \label{lemma-another-helper-G-ring} Let $p$ be a prime number. Let $A$ be a Noetherian complete local domain with fraction field $K$ of characteristic $p$. Let $\mathfrak q \subset A[x]$ be a maximal ideal lying over the maximal ideal of $A$ and let $(0) \not = \mathfrak r \subset \mathfrak q$ be a prime lying over $(0) \subset A$. Then $A[x]_\mathfrak q^\wedge \otimes_{A[x]} \kappa(\mathfrak r)$ is geometrically regular over $\kappa(\mathfrak r)$. \end{lemma} 
\begin{proposition} \label{proposition-finite-type-over-G-ring} Let $R$ be a G-ring. If $R \to S$ is essentially of finite type then $S$ is a G-ring. \end{proposition} 
\begin{proposition} \label{proposition-ubiquity-G-ring} The following types of rings are G-rings: \begin{enumerate} \item fields, \item Noetherian complete local rings, \item $\mathbf{Z}$, \item Dedekind domains with fraction field of characteristic zero, \item finite type ring extensions of any of the above. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-henselian-local-limit-G-rings} Let $(A, \mathfrak m)$ be a henselian local ring. Then $A$ is a filtered colimit of a system of henselian local G-rings with local transition maps. \end{lemma} 
\begin{lemma} \label{lemma-map-G-ring-to-completion-regular} \begin{reference} \cite[Theorem 79]{MatCA} \end{reference} Let $A$ be a G-ring. Let $I \subset A$ be an ideal and let $A^\wedge$ be the completion of $A$ with respect to $I$. Then $A \to A^\wedge$ is regular. \end{lemma} 
\begin{lemma} \label{lemma-henselization-pair-G-ring} \begin{slogan} Being a G-ring is stable under Henselizations along ideals \end{slogan} \begin{reference} \cite[Theorem 5.3 i)]{Greco} \end{reference} Let $A$ be a G-ring. Let $I \subset A$ be an ideal. Let $(A^h, I^h)$ be the henselization of the pair $(A, I)$, see Lemma \ref{lemma-henselization}. Then $A^h$ is a G-ring. \end{lemma} 
\begin{lemma} \label{lemma-check-P-ring-easy} Let $R$ be a Noetherian ring. Let $P$ be a property as above. Then $R$ is a $P$-ring if and only if for every pair of primes $\mathfrak q \subset \mathfrak p \subset R$ the $\kappa(\mathfrak q)$-algebra $$ (R/\mathfrak q)_\mathfrak p^\wedge \otimes_{R/\mathfrak q} \kappa(\mathfrak q) $$ has property $P$. \end{lemma} 
\begin{lemma} \label{lemma-P-local} Let $R \to \Lambda$ be a homomorphism of Noetherian rings. Assume $P$ has property (B). The following are equivalent \begin{enumerate} \item the fibres of $R \to \Lambda$ have $P$, \item the fibres of $R_\mathfrak p \to \Lambda_\mathfrak q$ have $P$ for all $\mathfrak q \subset \Lambda$ lying over $\mathfrak p \subset R$, and \item the fibres of $R_\mathfrak m \to \Lambda_{\mathfrak m'}$ have $P$ for all maximal ideals $\mathfrak m' \subset \Lambda$ lying over $\mathfrak m$ in $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-P-ring-goes-up-quasi-finite} Let $R \to R'$ be a finite type map of Noetherian rings and let $$ \xymatrix{ \mathfrak q' \ar[r] & \mathfrak p' \ar[r] & R' \\ \mathfrak q \ar[r] \ar@{-}[u] & \mathfrak p \ar[r] \ar@{-}[u] & R \ar[u] } $$ be primes. Assume $R \to R'$ is quasi-finite at $\mathfrak p'$. Assume $P$ satisfies (A) and (B). \begin{enumerate} \item If $\kappa(\mathfrak q) \to R_\mathfrak p^\wedge \otimes_R \kappa(\mathfrak q)$ has $P$, then $\kappa(\mathfrak q') \to R'_{\mathfrak p'} \otimes_{R'} \kappa(\mathfrak q')$ has $P$. \item If the formal fibres of $R_\mathfrak p$ have $P$, then the formal fibres of $R'_{\mathfrak p'}$ have $P$. \item If $R \to R'$ is quasi-finite and $R$ is a $P$-ring, then $R'$ is a $P$-ring. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-P-ring-maximal-ideals} Let $R$ be a Noetherian ring. Assume $P$ satisfies (C) and (D). Then $R$ is a $P$-ring if and only if the formal fibres of $R_\mathfrak m$ have $P$ for every maximal ideal $\mathfrak m$ of $R$. \end{lemma} 
\begin{proposition} \label{proposition-finite-type-over-P-ring} Let $R$ be a $P$-ring where $P$ satisfies (A), (B), (C), and (D). If $R \to S$ is essentially of finite type then $S$ is a $P$-ring. \end{proposition} 
\begin{lemma} \label{lemma-map-P-ring-to-completion-P} Let $A$ be a $P$-ring where $P$ satisfies (B) and (D). Let $I \subset A$ be an ideal and let $A^\wedge$ be the completion of $A$ with respect to $I$. Then the fibres of $A \to A^\wedge$ have $P$. \end{lemma} 
\begin{lemma} \label{lemma-henselization-pair-P-ring} \begin{slogan} Henselization of a ring inherits good properties of formal fibers \end{slogan} Let $A$ be a $P$-ring where $P$ satisfies (B), (C), (D), and (E). Let $I \subset A$ be an ideal. Let $(A^h, I^h)$ be the henselization of the pair $(A, I)$, see Lemma \ref{lemma-henselization}. Then $A^h$ is a $P$-ring. \end{lemma} 
\begin{lemma} \label{lemma-henselization-P-ring} Let $R$ be a Noetherian local ring which is a $P$-ring where $P$ satisfies (B), (C), (D), and (E). Then the henselization $R^h$ and the strict henselization $R^{sh}$ are $P$-rings. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-reduced} Properties (A), (B), (C), (D), and (E) hold for $P(k \to R) =$``$R$ is geometrically reduced over $k$''. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-normal} Properties (A), (B), (C), (D), and (E) hold for $P(k \to R) =$``$R$ is geometrically normal over $k$''. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-Sk} Fix $n \geq 1$. Properties (A), (B), (C), (D), and (E) hold for $P(k \to R) =$``$R$ has $(S_n)$''. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-CM} Properties (A), (B), (C), (D), and (E) hold for $P(k \to R) =$``$R$ is Cohen-Macaulay''. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-Rk} Fix $n \geq 0$. Properties (A), (B), (C), (D), and (E) hold for $P(k \to R) =$``$R \otimes_k k'$ has $(R_n)$ for all finite extensions $k'/k$''. \end{lemma} 
\begin{definition} \label{definition-excellent} Let $R$ be a ring. \begin{enumerate} \item We say $R$ is {\it quasi-excellent} if $R$ is Noetherian, a G-ring, and J-2. \item We say $R$ is {\it excellent} if $R$ is quasi-excellent and universally catenary. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-finite-type-over-excellent} Any localization of a finite type ring over a (quasi-)excellent ring is (quasi-)excellent. \end{lemma} 
\begin{proposition} \label{proposition-ubiquity-excellent} The following types of rings are excellent: \begin{enumerate} \item fields, \item Noetherian complete local rings, \item $\mathbf{Z}$, \item Dedekind domains with fraction field of characteristic zero, \item finite type ring extensions of any of the above. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-Nagata-local-ring} Let $(A, \mathfrak m)$ be a Noetherian local ring. The following are equivalent \begin{enumerate} \item $A$ is Nagata, and \item the formal fibres of $A$ are geometrically reduced. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quasi-excellent-nagata} A quasi-excellent ring is Nagata. \end{lemma} 
\begin{lemma} \label{lemma-completion-normal-local-ring} Let $(A, \mathfrak m)$ be a Noetherian local ring. If $A$ is normal and the formal fibres of $A$ are normal (for example if $A$ is excellent or quasi-excellent), then $A^\wedge$ is normal. \end{lemma} 
\begin{lemma} \label{lemma-injective-abelian} An abelian group $J$ is an injective object in the category of abelian groups if and only if $J$ is divisible. \end{lemma} 
\begin{definition} \label{definition-projective} Let $R$ be a ring. An $R$-module $J$ is {\it injective} if and only if the functor $\Hom_R(-, J) : \text{Mod}_R \to \text{Mod}_R$ is an exact functor. \end{definition} 
\begin{lemma} \label{lemma-relation-ext-ext} Let $R$ be a ring. Let $\mathcal{A}$ be the abelian category of $R$-modules. There is a canonical isomorphism $\Ext_\mathcal{A}(M, N) = \Ext^1_R(M, N)$ compatible with the long exact sequences of Algebra, Lemmas \ref{algebra-lemma-long-exact-seq-ext} and \ref{algebra-lemma-reverse-long-exact-seq-ext} and the $6$-term exact sequences of Homology, Lemma \ref{homology-lemma-six-term-sequence-ext}. \end{lemma} 
\begin{lemma} \label{lemma-characterize-injective} Let $R$ be a ring. Let $J$ be an $R$-module. The following are equivalent \begin{enumerate} \item $J$ is injective, \item $\Ext^1_R(M, J) = 0$ for every $R$-module $M$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-characterize-injective-bis} Let $R$ be a ring. Let $J$ be an $R$-module. The following are equivalent \begin{enumerate} \item $J$ is injective, \item $\Ext^1_R(R/I, J) = 0$ for every ideal $I \subset R$, and \item for an ideal $I \subset R$ and module map $I \to J$ there exists an extension $R \to J$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-simple-functors} Let $R$ be a ring. \begin{enumerate} \item For any $R$-module $M$ over $R$ we denote $M^\vee = \Hom(M, \mathbf{Q}/\mathbf{Z})$ with its natural $R$-module structure. We think of {\it $M \mapsto M^\vee$} as a contravariant functor from the category of $R$-modules to itself. \item For any $R$-module $M$ we denote $$ F(M) = \bigoplus\nolimits_{m \in M} R[m] $$ the {\it free module} with basis given by the elements $[m]$ with $m \in M$. We let $F(M)\to M$, $\sum f_i [m_i] \mapsto \sum f_i m_i$ be the natural surjection of $R$-modules. We think of $M \mapsto (F(M) \to M)$ as a functor from the category of $R$-modules to the category of arrows in $R$-modules. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-vee-exact} Let $R$ be a ring. The functor $M \mapsto M^\vee$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-ev-injective} For any $R$-module $M$ the evaluation map $ev : M \to (M^\vee)^\vee$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-JM-injective} Let $R$ be a ring. For every $R$-module $M$ the $R$-module $J(M)$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-injectives-modules} Let $R$ be a ring. The construction above defines a covariant functor $M \mapsto (M \to J(M))$ from the category of $R$-modules to the category of arrows of $R$-modules such that for every module $M$ the output $M \to J(M)$ is an injective map of $M$ into an injective $R$-module $J(M)$. \end{lemma} 
\begin{lemma} \label{lemma-K-injective-flat} Let $R \to S$ be a flat ring map. If $I^\bullet$ is a K-injective complex of $S$-modules, then $I^\bullet$ is K-injective as a complex of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-K-injective-epimorphism} Let $R \to S$ be an epimorphism of rings. Let $I^\bullet$ be a complex of $S$-modules. If $I^\bullet$ is K-injective as a complex of $R$-modules, then $I^\bullet$ is a K-injective complex of $S$-modules. \end{lemma} 
\begin{lemma} \label{lemma-hom-K-injective} Let $A \to B$ be a ring map. If $I^\bullet$ is a K-injective complex of $A$-modules, then $\Hom_A(B, I^\bullet)$ is a K-injective complex of $B$-modules. \end{lemma} 
\begin{lemma} \label{lemma-symmetric-monoidal-cat-complexes} Let $R$ be a ring. The category $\text{Comp}(R)$ of complexes of $R$-modules endowed with the functor $(L^\bullet, M^\bullet) \mapsto \text{Tot}(L^\bullet \otimes_R M^\bullet)$ and associativity and commutativity constraints as above is a symmetric monoidal category. \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-homotopy} Let $R$ be a ring. Let $P^\bullet$ be a complex of $R$-modules. Let $\alpha, \beta : L^\bullet \to M^\bullet$ be homotopic maps of complexes. Then $\alpha$ and $\beta$ induce homotopic maps $$ \text{Tot}(\alpha \otimes \text{id}_P), \text{Tot}(\beta \otimes \text{id}_P) : \text{Tot}(L^\bullet \otimes_R P^\bullet) \longrightarrow \text{Tot}(M^\bullet \otimes_R P^\bullet). $$ In particular the construction $L^\bullet \mapsto \text{Tot}(L^\bullet \otimes_R P^\bullet)$ defines an endo-functor of the homotopy category of complexes. \end{lemma} 
\begin{lemma} \label{lemma-symmetric-monoidal-homotopy-category} Let $R$ be a ring. The homotopy category $K(R)$ of complexes of $R$-modules endowed with the functor $(L^\bullet, M^\bullet) \mapsto \text{Tot}(L^\bullet \otimes_R M^\bullet)$ and associativity and commutativity constraints as above is a symmetric monoidal category. \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-exact} Let $R$ be a ring. Let $P^\bullet$ be a complex of $R$-modules. The functors $$ K(R) \longrightarrow K(R), \quad L^\bullet \longmapsto \text{Tot}(P^\bullet \otimes_R L^\bullet) $$ and $$ K(R) \longrightarrow K(R), \quad L^\bullet \longmapsto \text{Tot}(L^\bullet \otimes_R P^\bullet) $$ are exact functors of triangulated categories. \end{lemma} 
\begin{definition} \label{definition-K-flat} Let $R$ be a ring. A complex $K^\bullet$ is called {\it K-flat} if for every acyclic complex $M^\bullet$ the total complex $\text{Tot}(M^\bullet \otimes_R K^\bullet)$ is acyclic. \end{definition} 
\begin{lemma} \label{lemma-K-flat-quasi-isomorphism} Let $R$ be a ring. Let $K^\bullet$ be a K-flat complex. Then the functor $$ K(R) \longrightarrow K(R), \quad L^\bullet \longmapsto \text{Tot}(L^\bullet \otimes_R K^\bullet) $$ transforms quasi-isomorphisms into quasi-isomorphisms. \end{lemma} 
\begin{lemma} \label{lemma-base-change-K-flat} Let $R \to R'$ be a ring map. If $K^\bullet$ is a K-flat complex of $R$-modules, then $K^\bullet \otimes_R R'$ is a K-flat complex of $R'$-modules. \end{lemma} 
\begin{lemma} \label{lemma-tensor-product-K-flat} Let $R$ be a ring. If $K^\bullet$, $L^\bullet$ are K-flat complexes of $R$-modules, then $\text{Tot}(K^\bullet \otimes_R L^\bullet)$ is a K-flat complex of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-two-out-of-three} Let $R$ be a ring. Let $(K_1^\bullet, K_2^\bullet, K_3^\bullet)$ be a distinguished triangle in $K(R)$. If two out of three of $K_i^\bullet$ are K-flat, so is the third. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-two-out-of-three-ses} Let $R$ be a ring. Let $0 \to K_1^\bullet \to K_2^\bullet \to K_3^\bullet \to 0$ be a short exact sequence of complexes. If $K_3^n$ is flat for all $n \in \mathbf{Z}$ and two out of three of $K_i^\bullet$ are K-flat, so is the third. \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-quasi-isomorphism} Let $R$ be a ring. Let $P^\bullet$ be a bounded above complex of flat $R$-modules. Then $P^\bullet$ is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-colimit-K-flat} Let $R$ be a ring. Let $K_1^\bullet \to K_2^\bullet \to \ldots$ be a system of K-flat complexes. Then $\colim_i K_i^\bullet$ is K-flat. More generally any filtered colimit of K-flat complexes is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-universally-acyclic-K-flat} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. If $K^\bullet \otimes_R M$ is acyclic for all finitely presented $R$-modules $M$, then $K^\bullet$ is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-K-flat-resolution} Let $R$ be a ring. For any complex $M^\bullet$ there exists a K-flat complex $K^\bullet$ whose terms are flat $R$-modules and a quasi-isomorphism $K^\bullet \to M^\bullet$ which is termwise surjective. \end{lemma} 
\begin{lemma} \label{lemma-derived-tor-quasi-isomorphism-other-side} Let $R$ be a ring. Let $\alpha : P^\bullet \to Q^\bullet$ be a quasi-isomorphism of K-flat complexes of $R$-modules. For every complex $L^\bullet$ of $R$-modules the induced map $$ \text{Tot}(\text{id}_L \otimes \alpha) : \text{Tot}(L^\bullet \otimes_R P^\bullet) \longrightarrow \text{Tot}(L^\bullet \otimes_R Q^\bullet) $$ is a quasi-isomorphism. \end{lemma} 
\begin{definition} \label{definition-derived-tor} Let $R$ be a ring. Let $M^\bullet$ be an object of $D(R)$. The {\it derived tensor product} $$ - \otimes_R^{\mathbf{L}} M^\bullet : D(R) \longrightarrow D(R) $$ is the exact functor of triangulated categories described above. \end{definition} 
\begin{lemma} \label{lemma-flip-douoble-tensor-product} Let $R$ be a ring. Let $K^\bullet, L^\bullet$ be complexes of $R$-modules. There is a canonical isomorphism $$ K^\bullet \otimes_R^\mathbf{L} L^\bullet \longrightarrow L^\bullet \otimes_R^\mathbf{L} K^\bullet $$ functorial in both complexes which uses a sign of $(-1)^{pq}$ for the map $K^p \otimes_R L^q \to L^q \otimes_R K^p$ (see proof for explanation). \end{lemma} 
\begin{lemma} \label{lemma-triple-tensor-product} Let $R$ be a ring. Let $K^\bullet, L^\bullet, M^\bullet$ be complexes of $R$-modules. There is a canonical isomorphism $$ (K^\bullet \otimes_R^\mathbf{L} L^\bullet) \otimes_R^\mathbf{L} M^\bullet = K^\bullet \otimes_R^\mathbf{L} (L^\bullet \otimes_R^\mathbf{L} M^\bullet) $$ functorial in all three complexes. \end{lemma} 
\begin{lemma} \label{lemma-factor-through-K-flat} Let $R$ be a ring. Let $a : K^\bullet \to L^\bullet$ be a map of complexes of $R$-modules. If $K^\bullet$ is K-flat, then there exist a complex $N^\bullet$ and maps of complexes $b : K^\bullet \to N^\bullet$ and $c : N^\bullet \to L^\bullet$ such that \begin{enumerate} \item $N^\bullet$ is K-flat, \item $c$ is a quasi-isomorphism, \item $a$ is homotopic to $c \circ b$. \end{enumerate} If the terms of $K^\bullet$ are flat, then we may choose $N^\bullet$, $b$, and $c$ such that the same is true for $N^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-derived-base-change} The construction above is independent of choices and defines an exact functor of triangulated categories $- \otimes_R^\mathbf{L} N^\bullet : D(R) \to D(A)$. There is a functorial isomorphism $$ E^\bullet \otimes_R^\mathbf{L} N^\bullet = (E^\bullet \otimes_R^\mathbf{L} A) \otimes_A^\mathbf{L} N^\bullet $$ for $E^\bullet$ in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-functoriality-derived-base-change} Let $R \to A$ be a ring map. Let $f : L^\bullet \to N^\bullet$ be a map of complexes of $A$-modules. Then $f$ induces a transformation of functors $$ 1 \otimes f : - \otimes_A^\mathbf{L} L^\bullet \longrightarrow - \otimes_A^\mathbf{L} N^\bullet $$ If $f$ is a quasi-isomorphism, then $1 \otimes f$ is an isomorphism of functors. \end{lemma} 
\begin{lemma} \label{lemma-tensor-hom-adjoint} Let $R \to A$ be a ring map. The functor $D(R) \to D(A)$, $E \mapsto E \otimes_R^\mathbf{L} A$ of Lemma \ref{lemma-derived-base-change} is left adjoint to the restriction functor $D(A) \to D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-double-base-change} Let $A \to B \to C$ be ring maps. Let $N^\bullet$ be a complex of $B$-modules and $K^\bullet$ a complex of $C$-modules. The compositions of the functors $$ D(A) \xrightarrow{- \otimes_A^\mathbf{L} N^\bullet} D(B) \xrightarrow{- \otimes_B^\mathbf{L} K^\bullet} D(C) $$ is the functor $- \otimes_A^\mathbf{L} (N^\bullet \otimes_B^\mathbf{L} K^\bullet) : D(A) \to D(C)$. If $M$, $N$, $K$ are modules over $A$, $B$, $C$, then we have $$ (M \otimes_A^\mathbf{L} N) \otimes_B^\mathbf{L} K = M \otimes_A^\mathbf{L} (N \otimes_B^\mathbf{L} K) = (M \otimes_A^\mathbf{L} C) \otimes_C^\mathbf{L} (N \otimes_B^\mathbf{L} K) $$ in $D(C)$. We also have a canonical isomorphism $$ (M \otimes_A^\mathbf{L} N) \otimes_B^\mathbf{L} K \longrightarrow (M \otimes_A^\mathbf{L} K) \otimes_C^\mathbf{L} (N \otimes_B^\mathbf{L} C) $$ using signs. Similar results holds for complexes. \end{lemma} 
\begin{definition} \label{definition-tor-independent} Let $R$ be a ring. Let $A$, $B$ be $R$-algebras. We say $A$ and $B$ are {\it Tor independent over $R$} if $\text{Tor}_p^R(A, B) = 0$ for all $p > 0$. \end{definition} 
\begin{lemma} \label{lemma-base-change-comparison} The comparison map (\ref{equation-comparison-map}) is an isomorphism if $A' = A \otimes_R R'$ and $A$ and $R'$ are Tor independent over $R$. \end{lemma} 
\begin{lemma} \label{lemma-tor-independent-flat} Consider a commutative diagram of rings $$ \xymatrix{ A' & R' \ar[r] \ar[l] & B' \\ A \ar[u] & R \ar[l] \ar[u] \ar[r] & B \ar[u] } $$ Assume that $R'$ is flat over $R$ and $A'$ is flat over $A \otimes_R R'$ and $B'$ is flat over $R' \otimes_R B$. Then $$ \text{Tor}_i^R(A, B) \otimes_{(A \otimes_R B)} (A' \otimes_{R'} B') = \text{Tor}_i^{R'}(A', B') $$ \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-tor-independent} Let $R \to A$ and $R \to B$ be ring maps. Let $R \to R'$ be a ring map and set $A' = A \otimes_R R'$ and $B' = B \otimes_R R'$. If $A$ and $B$ are tor independent over $R$ and $R \to R'$ is flat, then $A'$ and $B'$ are tor independent over $R'$. \end{lemma} 
\begin{lemma} \label{lemma-lemma-tor-independent-flat-compare} Assumptions as in Lemma \ref{lemma-tor-independent-flat}. For $M \in D(A)$ there are canonical isomorphisms $$ H^i((M \otimes_A^\mathbf{L} A') \otimes_{R'}^\mathbf{L} B') = H^i(M \otimes_R^\mathbf{L} B) \otimes_{(A \otimes_R B)} (A' \otimes_{R'} B') $$ of $A' \otimes_{R'} B'$-modules. \end{lemma} 
\begin{lemma} \label{lemma-tor-independent} Let $R$ be a ring. Let $A$, $B$ be $R$-algebras. The following are equivalent \begin{enumerate} \item $A$ and $B$ are Tor independent over $R$, \item for every pair of primes $\mathfrak p \subset A$ and $\mathfrak q \subset B$ lying over the same prime $\mathfrak r \subset R$ the rings $A_\mathfrak p$ and $B_\mathfrak q$ are Tor independent over $R_\mathfrak r$, and \item For every prime $\mathfrak s$ of $A \otimes_R B$ the module $$ \text{Tor}_i^R(A, B)_\mathfrak s = \text{Tor}_i^{R_\mathfrak r}(A_\mathfrak p, B_\mathfrak q)_\mathfrak s $$ (where $\mathfrak p = A \cap \mathfrak s$, $\mathfrak q = B \cap \mathfrak s$ and $\mathfrak r = R \cap \mathfrak s$) is zero. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-functoriality-product-tor} Let $R$ be a ring. Let $A, B, C$ be $R$-algebras and let $B \to C$ be an $R$-algebra map. Then the induced map $$ \text{Tor}^R_{\star}(B, A) \longrightarrow \text{Tor}^R_{\star}(C, A) $$ is an $A$-algebra homomorphism. \end{lemma} 
\begin{definition} \label{definition-pseudo-coherent} Let $R$ be a ring. Denote $D(R)$ its derived category. Let $m \in \mathbf{Z}$. \begin{enumerate} \item An object $K^\bullet$ of $D(R)$ is {\it $m$-pseudo-coherent} if there exists a bounded complex $E^\bullet$ of finite free $R$-modules and a morphism $\alpha : E^\bullet \to K^\bullet$ such that $H^i(\alpha)$ is an isomorphism for $i > m$ and $H^m(\alpha)$ is surjective. \item An object $K^\bullet$ of $D(R)$ is {\it pseudo-coherent} if it is quasi-isomorphic to a bounded above complex of finite free $R$-modules. \item An $R$-module $M$ is called {\it $m$-pseudo-coherent} if $M[0]$ is an $m$-pseudo-coherent object of $D(R)$. \item An $R$-module $M$ is called {\it pseudo-coherent}\footnote{This clashes with what is meant by a pseudo-coherent module in \cite{Bourbaki-CA}.} if $M[0]$ is a pseudo-coherent object of $D(R)$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-cone-pseudo-coherent} Let $R$ be a ring and $m \in \mathbf{Z}$. Let $(K^\bullet, L^\bullet, M^\bullet, f, g, h)$ be a distinguished triangle in $D(R)$. \begin{enumerate} \item If $K^\bullet$ is $(m + 1)$-pseudo-coherent and $L^\bullet$ is $m$-pseudo-coherent then $M^\bullet$ is $m$-pseudo-coherent. \item If $K^\bullet, M^\bullet$ are $m$-pseudo-coherent, then $L^\bullet$ is $m$-pseudo-coherent. \item If $L^\bullet$ is $(m + 1)$-pseudo-coherent and $M^\bullet$ is $m$-pseudo-coherent, then $K^\bullet$ is $(m + 1)$-pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-cohomology} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. Let $m \in \mathbf{Z}$. \begin{enumerate} \item If $K^\bullet$ is $m$-pseudo-coherent and $H^i(K^\bullet) = 0$ for $i > m$, then $H^m(K^\bullet)$ is a finite type $R$-module. \item If $K^\bullet$ is $m$-pseudo-coherent and $H^i(K^\bullet) = 0$ for $i > m + 1$, then $H^{m + 1}(K^\bullet)$ is a finitely presented $R$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-n-pseudo-module} Let $R$ be a ring. Let $M$ be an $R$-module. Then \begin{enumerate} \item $M$ is $0$-pseudo-coherent if and only if $M$ is a finite $R$-module, \item $M$ is $(-1)$-pseudo-coherent if and only if $M$ is a finitely presented $R$-module, \item $M$ is $(-d)$-pseudo-coherent if and only if there exists a resolution $$ R^{\oplus a_d} \to R^{\oplus a_{d - 1}} \to \ldots \to R^{\oplus a_0} \to M \to 0 $$ of length $d$, and \item $M$ is pseudo-coherent if and only if there exists an infinite resolution $$ \ldots \to R^{\oplus a_1} \to R^{\oplus a_0} \to M \to 0 $$ by finite free $R$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. The following are equivalent \begin{enumerate} \item $K^\bullet$ is pseudo-coherent, \item $K^\bullet$ is $m$-pseudo-coherent for every $m \in \mathbf{Z}$, and \item $K^\bullet$ is quasi-isomorphic to a bounded above complex of finite projective $R$-modules. \end{enumerate} If (1), (2), and (3) hold and $H^i(K^\bullet) = 0$ for $i > b$, then we can find a quasi-isomorphism $F^\bullet \to K^\bullet$ with $F^i$ finite free $R$-modules and $F^i = 0$ for $i > b$. \end{lemma} 
\begin{lemma} \label{lemma-two-out-of-three-pseudo-coherent} Let $R$ be a ring. Let $(K^\bullet, L^\bullet, M^\bullet, f, g, h)$ be a distinguished triangle in $D(R)$. If two out of three of $K^\bullet, L^\bullet, M^\bullet$ are pseudo-coherent then the third is also pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-recognize-pseudo-coherent} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. Let $m \in \mathbf{Z}$. \begin{enumerate} \item If $H^i(K^\bullet) = 0$ for all $i \geq m$, then $K^\bullet$ is $m$-pseudo-coherent. \item If $H^i(K^\bullet) = 0$ for $i > m$ and $H^m(K^\bullet)$ is a finite $R$-module, then $K^\bullet$ is $m$-pseudo-coherent. \item If $H^i(K^\bullet) = 0$ for $i > m + 1$, the module $H^{m + 1}(K^\bullet)$ is of finite presentation, and $H^m(K^\bullet)$ is of finite type, then $K^\bullet$ is $m$-pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-summands-pseudo-coherent} Let $R$ be a ring. Let $m \in \mathbf{Z}$. If $K^\bullet \oplus L^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) so are $K^\bullet$ and $L^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-complex-pseudo-coherent-modules} Let $R$ be a ring. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a bounded above complex of $R$-modules such that $K^i$ is $(m - i)$-pseudo-coherent for all $i$. Then $K^\bullet$ is $m$-pseudo-coherent. In particular, if $K^\bullet$ is a bounded above complex of pseudo-coherent $R$-modules, then $K^\bullet$ is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-pseudo-coherent} Let $R$ be a ring. Let $m \in \mathbf{Z}$. Let $K^\bullet \in D^{-}(R)$ such that $H^i(K^\bullet)$ is $(m - i)$-pseudo-coherent (resp.\ pseudo-coherent) for all $i$. Then $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent). \end{lemma} 
\begin{lemma} \label{lemma-finite-push-pseudo-coherent} Let $A \to B$ be a ring map. Assume that $B$ is pseudo-coherent as an $A$-module. Let $K^\bullet$ be a complex of $B$-modules. The following are equivalent \begin{enumerate} \item $K^\bullet$ is $m$-pseudo-coherent as a complex of $B$-modules, and \item $K^\bullet$ is $m$-pseudo-coherent as a complex of $A$-modules. \end{enumerate} The same equivalence holds for pseudo-coherence. \end{lemma} 
\begin{lemma} \label{lemma-pull-pseudo-coherent} Let $A \to B$ be a ring map. Let $K^\bullet$ be an $m$-pseudo-coherent (resp.\ pseudo-coherent) complex of $A$-modules. Then $K^\bullet \otimes_A^{\mathbf{L}} B$ is an $m$-pseudo-coherent (resp.\ pseudo-coherent) complex of $B$-modules. \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-pseudo-coherent} Let $A \to B$ be a flat ring map. Let $M$ be an $m$-pseudo-coherent (resp.\ pseudo-coherent) $A$-module. Then $M \otimes_A B$ is an $m$-pseudo-coherent (resp.\ pseudo-coherent) $B$-module. \end{lemma} 
\begin{lemma} \label{lemma-glue-pseudo-coherent} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ be elements which generate the unit ideal. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $R$-modules. If for each $i$ the complex $K^\bullet \otimes_R R_{f_i}$ is $m$-pseudo-coherent (resp.\ pseudo-coherent), then $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent). \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-pseudo-coherent} Let $R$ be a ring. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $R$-modules. Let $R \to R'$ be a faithfully flat ring map. If the complex $K^\bullet \otimes_R R'$ is $m$-pseudo-coherent (resp.\ pseudo-coherent), then $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent). \end{lemma} 
\begin{lemma} \label{lemma-tensor-pseudo-coherent} Let $R$ be a ring. Let $K, L$ be objects of $D(R)$. \begin{enumerate} \item If $K$ is $n$-pseudo-coherent and $H^i(K) = 0$ for $i > a$ and $L$ is $m$-pseudo-coherent and $H^j(L) = 0$ for $j > b$, then $K \otimes_R^\mathbf{L} L$ is $t$-pseudo-coherent with $t = \max(m + a, n + b)$. \item If $K$ and $L$ are pseudo-coherent, then $K \otimes_R^\mathbf{L} L$ is pseudo-coherent. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Noetherian-pseudo-coherent} Let $R$ be a Noetherian ring. Then \begin{enumerate} \item A complex of $R$-modules $K^\bullet$ is $m$-pseudo-coherent if and only if $K^\bullet \in D^{-}(R)$ and $H^i(K^\bullet)$ is a finite $R$-module for $i \geq m$. \item A complex of $R$-modules $K^\bullet$ is pseudo-coherent if and only if $K^\bullet \in D^{-}(R)$ and $H^i(K^\bullet)$ is a finite $R$-module for all $i$. \item An $R$-module is pseudo-coherent if and only if it is finite. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-coherent-pseudo-coherent} Let $R$ be a coherent ring (Algebra, Definition \ref{algebra-definition-coherent}). Let $K \in D^-(R)$. The following are equivalent \begin{enumerate} \item $K$ is $m$-pseudo-coherent, \item $H^m(K)$ is a finite $R$-module and $H^i(K)$ is coherent for $i > m$, and \item $H^m(K)$ is a finite $R$-module and $H^i(K)$ is finitely presented for $i > m$. \end{enumerate} Thus $K$ is pseudo-coherent if and only if $H^i(K)$ is a coherent module for all $i$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherence-colimit-ext} Let $R$ be a ring. Let $M = \colim M_i$ be a filtered colimit of $R$-modules. Let $K \in D(R)$ be $m$-pseudo-coherent. Then $\colim \Ext^n_R(K, M_i) = \Ext^n_R(K, M)$ for $n < -m$ and $\colim \Ext^{-m}_R(K, M_i) \to \Ext^{-m}_R(K, M)$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-characterize-pseudo-coherent-colimit-ext} Let $R$ be a ring. Let $K \in D^-(R)$. Let $m \in \mathbf{Z}$. Then $K$ is $m$-pseudo-coherent if and only if for any filtered colimit $M = \colim M_i$ of $R$-modules we have $\colim \Ext^n_R(K, M_i) = \Ext^n_R(K, M)$ for $n < -m$ and $\colim \Ext^{-m}_R(K, M_i) \to \Ext^{-m}_R(K, M)$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherence-and-ext} Let $R$ be a ring. Let $L$, $M$, $N$ be $R$-modules. \begin{enumerate} \item If $M$ is finitely presented and $L$ is flat, then the canonical map $\Hom_R(M, N) \otimes_R L \to \Hom_R(M, N \otimes_R L)$ is an isomorphism. \item If $M$ is $(-m)$-pseudo-coherent and $L$ is flat, then the canonical map $\Ext^i_R(M, N) \otimes_R L \to \Ext^i_R(M, N \otimes_R L)$ is an isomorphism for $i < m$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherence-and-base-change-ext} Let $R \to R'$ be a flat ring map. Let $M$, $N$ be $R$-modules. \begin{enumerate} \item If $M$ is a finitely presented $R$-module, then $\Hom_R(M, N) \otimes_R R' = \Hom_{R'}(M \otimes_R R', N \otimes_R R')$. \item If $M$ is $(-m)$-pseudo-coherent, then $\Ext^i_R(M, N) \otimes_R R' = \Ext^i_{R'}(M \otimes_R R', N \otimes_R R')$ for $i < m$. \end{enumerate} In particular if $R$ is Noetherian and $M$ is a finite module this holds for all $i$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-tensor} Let $R$ be a ring. Let $K \in D^-(R)$. The following are equivalent: \begin{enumerate} \item $K$ is pseudo-coherent, \item for every family $(Q_{\alpha})_{\alpha \in A}$ of $R$-modules, the canonical map $$ \alpha : K \otimes_R^\mathbf{L} \left( \prod\nolimits_\alpha Q_{\alpha} \right) \longrightarrow \prod\nolimits_\alpha (K \otimes_R^\mathbf{L} Q_{\alpha}) $$ is an isomorphism in $D(R)$, \item for every $R$-module $Q$ and every set $A$, the canonical map $$ \beta : K \otimes_R^\mathbf{L} Q^A \longrightarrow (K \otimes_R^\mathbf{L} Q)^A $$ is an isomorphism in $D(R)$, and \item for every set $A$, the canonical map $$ \gamma : K \otimes_R^\mathbf{L} R^A \longrightarrow K^A $$ is an isomorphism in $D(R)$. \end{enumerate} Given $m \in \mathbf{Z}$ the following are equivalent \begin{enumerate} \item[(a)] $K$ is $m$-pseudo-coherent, \item[(b)] for every family $(Q_{\alpha})_{\alpha \in A}$ of $R$-modules, with $\alpha$ as above $H^i(\alpha)$ is an isomorphism for $i > m$ and surjective for $i = m$, \item[(c)] for every $R$-module $Q$ and every set $A$, with $\beta$ as above $H^i(\beta)$ is an isomorphism for $i > m$ and surjective for $i = m$, \item[(d)] for every set $A$, with $\gamma$ as above $H^i(\gamma)$ is an isomorphism for $i > m$ and surjective for $i = m$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-detect-cohomology-pseudo-coherent} Let $R$ be a ring. Let $K \in D(R)$ be pseudo-coherent. Let $i \in \mathbf{Z}$. There exists a finitely presented $R$-module $M$ and a map $K \to M[-i]$ in $D(R)$ which induces an injection $H^i(K) \to M$. \end{lemma} 
\begin{lemma} \label{lemma-detect-cohomology} Let $A$ be a Noetherian ring. Let $K \in D(A)$ be pseudo-coherent, i.e., $K \in D^-(A)$ with finite cohomology modules. Let $\mathfrak m$ be a maximal ideal of $A$. If $H^i(K)/\mathfrak m H^i(K) \not = 0$, then there exists a finite $A$-module $E$ annihilated by a power of $\mathfrak m$ and a map $K \to E[-i]$ which is nonzero on $H^i(K)$. \end{lemma} 
\begin{definition} \label{definition-tor-amplitude} Let $R$ be a ring. Denote $D(R)$ its derived category. Let $a, b \in \mathbf{Z}$. \begin{enumerate} \item An object $K^\bullet$ of $D(R)$ has {\it tor-amplitude in $[a, b]$} if $H^i(K^\bullet \otimes_R^\mathbf{L} M) = 0$ for all $R$-modules $M$ and all $i \not \in [a, b]$. \item An object $K^\bullet$ of $D(R)$ has {\it finite tor dimension} if it has tor-amplitude in $[a, b]$ for some $a, b$. \item An $R$-module $M$ has {\it tor dimension $\leq d$} if $M[0]$ as an object of $D(R)$ has tor-amplitude in $[-d, 0]$. \item An $R$-module $M$ has {\it finite tor dimension} if $M[0]$ as an object of $D(R)$ has finite tor dimension. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-last-one-flat} Let $R$ be a ring. Let $K^\bullet$ be a bounded above complex of flat $R$-modules with tor-amplitude in $[a, b]$. Then $\Coker(d_K^{a - 1})$ is a flat $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude} Let $R$ be a ring. Let $K^\bullet$ be an object of $D(R)$. Let $a, b \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item $K^\bullet$ has tor-amplitude in $[a, b]$. \item $K^\bullet$ is quasi-isomorphic to a complex $E^\bullet$ of flat $R$-modules with $E^i = 0$ for $i \not \in [a, b]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-bounded-below-tor-amplitude} Let $R$ be a ring. Let $a \in \mathbf{Z}$ and let $K$ be an object of $D(R)$. The following are equivalent \begin{enumerate} \item $K$ has tor-amplitude in $[a, \infty]$, and \item $K$ is quasi-isomorphic to a K-flat complex $E^\bullet$ whose terms are flat $R$-modules with $E^i = 0$ for $i \not \in [a, \infty]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cone-tor-amplitude} Let $R$ be a ring. Let $(K^\bullet, L^\bullet, M^\bullet, f, g, h)$ be a distinguished triangle in $D(R)$. Let $a, b \in \mathbf{Z}$. \begin{enumerate} \item If $K^\bullet$ has tor-amplitude in $[a + 1, b + 1]$ and $L^\bullet$ has tor-amplitude in $[a, b]$ then $M^\bullet$ has tor-amplitude in $[a, b]$. \item If $K^\bullet, M^\bullet$ have tor-amplitude in $[a, b]$, then $L^\bullet$ has tor-amplitude in $[a, b]$. \item If $L^\bullet$ has tor-amplitude in $[a + 1, b + 1]$ and $M^\bullet$ has tor-amplitude in $[a, b]$, then $K^\bullet$ has tor-amplitude in $[a + 1, b + 1]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tor-dimension} Let $R$ be a ring. Let $M$ be an $R$-module. Let $d \geq 0$. The following are equivalent \begin{enumerate} \item $M$ has tor dimension $\leq d$, and \item there exists a resolution $$ 0 \to F_d \to \ldots \to F_1 \to F_0 \to M \to 0 $$ with $F_i$ a flat $R$-module. \end{enumerate} In particular an $R$-module has tor dimension $0$ if and only if it is a flat $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-summands-tor-amplitude} Let $R$ be a ring. Let $a, b \in \mathbf{Z}$. If $K^\bullet \oplus L^\bullet$ has tor amplitude in $[a, b]$ so do $K^\bullet$ and $L^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-complex-finite-tor-dimension-modules} Let $R$ be a ring. Let $K^\bullet$ be a bounded complex of $R$-modules such that $K^i$ has tor amplitude in $[a - i, b - i]$ for all $i$. Then $K^\bullet$ has tor amplitude in $[a, b]$. In particular if $K^\bullet$ is a finite complex of $R$-modules of finite tor dimension, then $K^\bullet$ has finite tor dimension. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-tor-amplitude} Let $R$ be a ring. Let $a, b \in \mathbf{Z}$. Let $K^\bullet \in D^b(R)$ such that $H^i(K^\bullet)$ has tor amplitude in $[a - i, b - i]$ for all $i$. Then $K^\bullet$ has tor amplitude in $[a, b]$. In particular if $K^\bullet \in D^b(R)$ and all its cohomology groups have finite tor dimension then $K^\bullet$ has finite tor dimension. \end{lemma} 
\begin{lemma} \label{lemma-push-tor-amplitude} Let $A \to B$ be a ring map. Let $K^\bullet$ and $L^\bullet$ be complexes of $B$-modules. Let $a, b, c, d \in \mathbf{Z}$. If \begin{enumerate} \item $K^\bullet$ as a complex of $B$-modules has tor amplitude in $[a, b]$, \item $L^\bullet$ as a complex of $A$-modules has tor amplitude in $[c, d]$, \end{enumerate} then $K^\bullet \otimes^\mathbf{L}_B L^\bullet$ as a complex of $A$-modules has tor amplitude in $[a + c, b + d]$. \end{lemma} 
\begin{lemma} \label{lemma-flat-push-tor-amplitude} Let $A \to B$ be a ring map. Assume that $B$ is flat as an $A$-module. Let $K^\bullet$ be a complex of $B$-modules. Let $a, b \in \mathbf{Z}$. If $K^\bullet$ as a complex of $B$-modules has tor amplitude in $[a, b]$, then $K^\bullet$ as a complex of $A$-modules has tor amplitude in $[a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-finite-tor-dimension-push-tor-amplitude} Let $A \to B$ be a ring map. Assume that $B$ has tor dimension $\leq d$ as an $A$-module. Let $K^\bullet$ be a complex of $B$-modules. Let $a, b \in \mathbf{Z}$. If $K^\bullet$ as a complex of $B$-modules has tor amplitude in $[a, b]$, then $K^\bullet$ as a complex of $A$-modules has tor amplitude in $[a - d, b]$. \end{lemma} 
\begin{lemma} \label{lemma-pull-tor-amplitude} Let $A \to B$ be a ring map. Let $a, b \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $A$-modules with tor amplitude in $[a, b]$. Then $K^\bullet \otimes_A^{\mathbf{L}} B$ as a complex of $B$-modules has tor amplitude in $[a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-finite-tor-dimension} Let $A \to B$ be a flat ring map. Let $d \geq 0$. Let $M$ be an $A$-module of tor dimension $\leq d$. Then $M \otimes_A B$ is a $B$-module of tor dimension $\leq d$. \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude-localization} Let $A  \to B$ be a ring map. Let $K^\bullet$ be a complex of $B$-modules. Let $a, b \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item $K^\bullet$ has tor amplitude in $[a, b]$ as a complex of $A$-modules, \item $K^\bullet_\mathfrak q$ has tor amplitude in $[a, b]$ as a complex of $A_\mathfrak p$-modules for every prime $\mathfrak q \subset B$ with $\mathfrak p = A \cap \mathfrak q$, \item $K^\bullet_\mathfrak m$ has tor amplitude in $[a, b]$ as a complex of $A_\mathfrak p$-modules for every maximal ideal $\mathfrak m \subset B$ with $\mathfrak p = A \cap \mathfrak m$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-glue-tor-amplitude} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ be elements which generate the unit ideal. Let $a, b \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $R$-modules. If for each $i$ the complex $K^\bullet \otimes_R R_{f_i}$ has tor amplitude in $[a, b]$, then $K^\bullet$ has tor amplitude in $[a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-tor-amplitude} Let $R$ be a ring. Let $a, b \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $R$-modules. Let $R \to R'$ be a faithfully flat ring map. If the complex $K^\bullet \otimes_R R'$ has tor amplitude in $[a, b]$, then $K^\bullet$ has tor amplitude in $[a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-no-change-tor-amplitude} Given ring maps $R \to A \to B$ with $A \to B$ faithfully flat and $K \in D(A)$ the tor amplitude of $K$ over $R$ is the same as the tor amplitude of $K \otimes_A^\mathbf{L} B$ over $R$. \end{lemma} 
\begin{lemma} \label{lemma-finite-gl-dim-tor-dimension} Let $R$ be a ring of finite global dimension $d$. Then \begin{enumerate} \item every module has tor dimension $\leq d$, \item a complex of $R$-modules $K^\bullet$ with $H^i(K^\bullet) \not = 0$ only if $i \in [a, b]$ has tor amplitude in $[a - d, b]$, and \item a complex of $R$-modules $K^\bullet$ has finite tor dimension if and only if $K^\bullet \in D^b(R)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-tor-dimension-modulo-nilpotent} Let $R' \to R$ be a surjective ring map whose kernel is a nilpotent ideal. Let $K' \in D(R')$ and set $K = K' \otimes_{R'}^\mathbf{L} R$. Let $a, b \in \mathbf{Z}$. Then $K$ has tor amplitude in $[a, b]$ if and only if $K'$ does. \end{lemma} 
\begin{definition} \label{definition-projective-dimension} Let $R$ be a ring. Let $K$ be an object of $D(R)$. We say $K$ has {\it finite projective dimension} if $K$ can be represented by a bounded complex of projective modules. We say $K$ has {\it projective-amplitude in $[a, b]$} if  $K$ is quasi-isomorphic to a complex $$ \ldots \to 0 \to P^a \to P^{a + 1} \to \ldots \to P^{b - 1} \to P^b \to 0 \to \ldots $$ where $P^i$ is a projective $R$-module for all $i \in \mathbf{Z}$. \end{definition} 
\begin{lemma} \label{lemma-projective-amplitude} Let $R$ be a ring. Let $K$ be an object of $D(R)$. Let $a, b \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item $K$ has projective-amplitude in $[a, b]$, \item $\Ext^i_R(K, N) = 0$ for all $R$-modules $N$ and all $i \not \in [-b, -a]$, \item $H^n(K) = 0$ for $n > b$ and $\Ext^i_R(K, N) = 0$ for all $R$-modules $N$ and all $i > -a$, and \item $H^n(K) = 0$ for $n \not \in [a - 1, b]$ and $\Ext^{-a + 1}_R(K, N) = 0$ for all $R$-modules $N$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-injective-dimension} Let $R$ be a ring. Let $K$ be an object of $D(R)$. We say $K$ has {\it finite injective dimension} if $K$ can be represented by a finite complex of injective $R$-modules. We say $K$ has {\it injective-amplitude in $[a, b]$} if $K$ is isomorphic to a complex $$ \ldots \to 0 \to I^a \to I^{a + 1} \to \ldots \to I^{b - 1} \to I^b \to 0 \to \ldots $$ with $I^i$ an injective $R$-module for all $i \in \mathbf{Z}$. \end{definition} 
\begin{lemma} \label{lemma-injective-amplitude} Let $R$ be a ring. Let $K$ be an object of $D(R)$. Let $a, b \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item $K$ has injective-amplitude in $[a, b]$, \item $\Ext^i_R(N, K) = 0$ for all $R$-modules $N$ and all $i \not \in [a, b]$, \item $\Ext^i(R/I, K) = 0$ for all ideals $I \subset R$ and all $i \not \in [a, b]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-injective-dimension} Let $R$ be a ring. Let $K \in D(R)$. \begin{enumerate} \item If $K$ is in $D^b(R)$ and $H^i(K)$ has finite injective dimension for all $i$, then $K$ has finite injective dimension. \item If $K^\bullet$ represents $K$, is a bounded complex of $R$-modules, and $K^i$ has finite injective dimension for all $i$, then $K$ has finite injective dimension. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-injective-dimension-Noetherian-radical} Let $R$ be a Noetherian ring. Let $I \subset R$ be an ideal contained in the Jacobson radical of $R$. Let $K \in D^+(R)$ have finite cohomology modules. Then the following are equivalent \begin{enumerate} \item $K$ has finite injective dimension, and \item there exists a $b$ such that $\Ext^i_R(R/J, K) = 0$ for $i > b$ and any ideal $J \supset I$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-injective-dimension-Noetherian-local} Let $(R, \mathfrak m, \kappa)$ be a local Noetherian ring. Let $K \in D^+(R)$ have finite cohomology modules. Then the following are equivalent \begin{enumerate} \item $K$ has finite injective dimension, and \item $\Ext^i_R(\kappa, K) = 0$ for $i \gg 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ideal-factor-through-projective} Let $R$ be a ring. Let $M$, $N$ be $R$-modules. \begin{enumerate} \item Given an $R$-module map $\varphi : M \to N$ the following are equivalent: (a) $\varphi$ factors through a projective $R$-module, and (b) $\varphi$ factors through a free $R$-module. \item The set of $\varphi : M \to N$ satisfying the equivalent conditions of (1) is an $R$-submodule of $\Hom_R(M, N)$. \item Given maps $\psi : M' \to M$ and $\xi : N \to N'$, if $\varphi : M \to N$ satisfies the equivalent conditions of (1), then $\xi \circ \varphi \circ \psi : M' \to N'$ does too. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-factor-through-finite-projective} Let $R$ be a ring. Let $\varphi : M \to N$ be an $R$-module map. If $\varphi$ factors through a projective module and $M$ is a finite $R$-module, then $\varphi$ factors through a finite projective module. \end{lemma} 
\begin{lemma} \label{lemma-near-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $M$ be an $R$-module. The following conditions are equivalent \begin{enumerate} \item for every $a \in I$ the map $a : M \to M$ factors through a projective $R$-module, \item for every $a \in I$ the map $a : M \to M$ factors through a free $R$-module, and \item $\Ext^1_R(M, N)$ is annihilated by $I$ for every $R$-module $N$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-near-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $M$ be an $R$-module. We say $M$ is {\it $I$-projective}\footnote{This is nonstandard notation.} if the equivalent conditions of Lemma \ref{lemma-near-projective} hold. \end{definition} 
\begin{lemma} \label{lemma-torsion-near-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $M$ be an $R$-module. If $M$ is annihilated by $I$, then $M$ is $I$-projective. \end{lemma} 
\begin{lemma} \label{lemma-ses-near-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $$ 0 \to K \to P \to M \to 0 $$ be a short exact sequence of $R$-modules. If $M$ is $I$-projective and $P$ is projective, then $K$ is $I$-projective. \end{lemma} 
\begin{lemma} \label{lemma-dual-near-projective} Let $R$ be a ring. Let $I \subset R$ be an ideal. If $M$ is a finite, $I$-projective $R$-module, then $M^\vee = \Hom_R(M, R)$ is $I$-projective. \end{lemma} 
\begin{lemma} \label{lemma-compose} Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$ of $R$-modules there is a canonical isomorphism $$ \Hom^\bullet(K^\bullet, \Hom^\bullet(L^\bullet, M^\bullet)) = \Hom^\bullet(\text{Tot}(K^\bullet \otimes_R L^\bullet), M^\bullet) $$ of complexes of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-composition} Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$ of $R$-modules there is a canonical morphism $$ \text{Tot}\left( \Hom^\bullet(L^\bullet, M^\bullet) \otimes_R \Hom^\bullet(K^\bullet, L^\bullet) \right) \longrightarrow \Hom^\bullet(K^\bullet, M^\bullet) $$ of complexes of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-diagonal-better} Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$ of $R$-modules there is a canonical morphism $$ \text{Tot}(K^\bullet \otimes_R \Hom^\bullet(M^\bullet, L^\bullet)) \longrightarrow \Hom^\bullet(M^\bullet, \text{Tot}(K^\bullet \otimes_R L^\bullet)) $$ of complexes of $R$-modules functorial in all three complexes. \end{lemma} 
\begin{lemma} \label{lemma-diagonal} Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet$ of $R$-modules there is a canonical morphism $$ K^\bullet \longrightarrow \Hom^\bullet(L^\bullet, \text{Tot}(K^\bullet \otimes_R L^\bullet)) $$ of complexes of $R$-modules functorial in both complexes. \end{lemma} 
\begin{lemma} \label{lemma-evaluate-and-more} Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$ of $R$-modules there is a canonical morphism $$ \text{Tot}(\Hom^\bullet(L^\bullet, M^\bullet) \otimes_R K^\bullet) \longrightarrow \Hom^\bullet(\Hom^\bullet(K^\bullet, L^\bullet), M^\bullet) $$ of complexes of $R$-modules functorial in all three complexes. \end{lemma} 
\begin{lemma} \label{lemma-left-dual-module} Let $R$ be a ring. Let $M$ be an $R$-module. Let  $N, \eta, \epsilon$ be a left dual of $M$ in the monoidal category of $R$-modules, see Categories, Definition \ref{categories-definition-dual}. Then \begin{enumerate} \item $M$ and $N$ are finite projective $R$-modules, \item the map $e : \Hom_R(M, R) \to N$, $\lambda \mapsto (\lambda \otimes 1)(\eta)$ is an isomorphism, \item we have $\epsilon(n, m) = e^{-1}(n)(m)$ for $n \in N$ and $m \in M$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-left-dual-complex} Let $R$ be a ring. Let $M^\bullet$ be a complex of $R$-modules. Let $N^\bullet, \eta, \epsilon$ be a left dual of $M^\bullet$ in the monoidal category of complexes of $R$-modules. Then \begin{enumerate} \item $M^\bullet$ and $N^\bullet$ are bounded, \item $M^n$ and $N^n$ are finite projective $R$-modules, \item writing $\epsilon = \sum \epsilon_n$ with $\epsilon_n : N^{-n} \otimes_R M^n \to R$ and $\eta = \sum \eta_n$ with $\eta_n : R \to  M^n \otimes_R N^{-n}$ then $(N^{-n}, \eta_n, \epsilon_n)$ is the left dual of $M^n$ as in Lemma \ref{lemma-left-dual-module}, \item the differential $d_N^n : N^n \to N^{n + 1}$ is equal to $-(-1)^n$ times the map $$ N^n = \Hom_R(M^{-n}, R) \xrightarrow{d_M^{-n - 1}} \Hom_R(M^{-n - 1}, R) = N^{n + 1} $$ where the equality signs are the identifications from Lemma \ref{lemma-left-dual-module} part (2). \end{enumerate} Conversely, given a bounded complex $M^\bullet$ of finite projective $R$-modules, setting $N^n = \Hom_R(M^{-n}, R)$ with differentials as above, setting $\epsilon = \sum \epsilon_n$ with $\epsilon_n : N^{-n} \otimes_R M^n \to R$ given by evaluation, and setting $\eta = \sum \eta_n$ with $\eta_n : R \to M^n \otimes_R N^{-n}$ mapping $1$ to $\text{id}_{M_n}$ we obtain a left dual of $M^\bullet$ in the monoidal category of complexes of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom} Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. There is a canonical isomorphism $$ R\Hom_R(K, R\Hom_R(L, M)) = R\Hom_R(K \otimes_R^\mathbf{L} L, M) $$ in $D(R)$ functorial in $K, L, M$ which recovers (\ref{equation-internal-hom}) by taking $H^0$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-out-of-projective} Let $R$ be a ring. Let $P^\bullet$ be a bounded above complex of projective $R$-modules. Let $L^\bullet$ be a complex of $R$-modules. Then $R\Hom_R(P^\bullet, L^\bullet)$ is represented by the complex $\Hom^\bullet(P^\bullet, L^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate} Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. There is a canonical morphism $$ R\Hom_R(L, M) \otimes_R^\mathbf{L} K \longrightarrow R\Hom_R(R\Hom_R(K, L), M) $$ in $D(R)$ functorial in $K, L, M$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-composition} Let $R$ be a ring. Given $K, L, M$ in $D(R)$ there is a canonical morphism $$ R\Hom_R(L, M) \otimes_R^\mathbf{L} R\Hom_R(K, L) \longrightarrow R\Hom_R(K, M) $$ in $D(R)$ functorial in $K, L, M$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-diagonal-better} Let $R$ be a ring. Given complexes $K, L, M$ in $D(R)$ there is a canonical morphism $$ K \otimes_R^\mathbf{L} R\Hom_R(M, L) \longrightarrow R\Hom_R(M, K \otimes_R^\mathbf{L} L) $$ in $D(R)$ functorial in $K$, $L$, $M$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-diagonal} Let $R$ be a ring. Given complexes $K, L$ in $D(R)$ there is a canonical morphism $$ K \longrightarrow R\Hom_R(L, K \otimes_R^\mathbf{L} L) $$ in $D(R)$ functorial in both $K$ and $L$. \end{lemma} 
\begin{definition} \label{definition-perfect} Let $R$ be a ring. Denote $D(R)$ the derived category of the abelian category of $R$-modules. \begin{enumerate} \item An object $K$ of $D(R)$ is {\it perfect} if it is quasi-isomorphic to a bounded complex of finite projective $R$-modules. \item An $R$-module $M$ is {\it perfect} if $M[0]$ is a perfect object in $D(R)$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-perfect} Let $K^\bullet$ be an object of $D(R)$. The following are equivalent \begin{enumerate} \item $K^\bullet$ is perfect, and \item $K^\bullet$ is pseudo-coherent and has finite tor dimension. \end{enumerate} If (1) and (2) hold and $K^\bullet$ has tor-amplitude in $[a, b]$, then $K^\bullet$ is quasi-isomorphic to a complex $E^\bullet$ of finite projective $R$-modules with $E^i = 0$ for $i \not \in [a, b]$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-module} Let $M$ be a module over a ring $R$. The following are equivalent \begin{enumerate} \item $M$ is a perfect module, and \item there exists a resolution $$ 0 \to F_d \to \ldots \to F_1 \to F_0 \to M \to 0 $$ with each $F_i$ a finite projective $R$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-two-out-of-three-perfect} Let $R$ be a ring. Let $(K^\bullet, L^\bullet, M^\bullet, f, g, h)$ be a distinguished triangle in $D(R)$. If two out of three of $K^\bullet, L^\bullet, M^\bullet$ are perfect then the third is also perfect. \end{lemma} 
\begin{lemma} \label{lemma-summands-perfect} Let $R$ be a ring. If $K^\bullet \oplus L^\bullet$ is perfect, then so are $K^\bullet$ and $L^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-complex-perfect-modules} Let $R$ be a ring. Let $K^\bullet$ be a bounded complex of perfect $R$-modules. Then $K^\bullet$ is a perfect complex. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-perfect} Let $R$ be a ring. If $K^\bullet \in D^b(R)$ and all its cohomology modules are perfect, then $K^\bullet$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-perfect-push-perfect} Let $A \to B$ be a ring map. Assume that $B$ is perfect as an $A$-module. Let $K^\bullet$ be a perfect complex of $B$-modules. Then $K^\bullet$ is perfect as a complex of $A$-modules. \end{lemma} 
\begin{lemma} \label{lemma-pull-perfect} Let $A \to B$ be a ring map. Let $K^\bullet$ be a perfect complex of $A$-modules. Then $K^\bullet \otimes_A^{\mathbf{L}} B$ is a perfect complex of $B$-modules. \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-perfect} Let $A \to B$ be a flat ring map. Let $M$ be a perfect $A$-module. Then $M \otimes_A B$ is a perfect $B$-module. \end{lemma} 
\begin{lemma} \label{lemma-tensor-perfect} Let $R$ be a ring. If $K$ and $L$ are perfect objects of $D(R)$, then $K \otimes_R^\mathbf{L} L$ is a perfect object too. \end{lemma} 
\begin{lemma} \label{lemma-glue-perfect} Let $R$ be a ring. Let $f_1, \ldots, f_r \in R$ be elements which generate the unit ideal. Let $K^\bullet$ be a complex of $R$-modules. If for each $i$ the complex $K^\bullet \otimes_R R_{f_i}$ is perfect, then $K^\bullet$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-flat-descent-perfect} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. Let $R \to R'$ be a faithfully flat ring map. If the complex $K^\bullet \otimes_R R'$ is perfect, then $K^\bullet$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-regular-perfect} Let $R$ be a regular ring. Then \begin{enumerate} \item an $R$-module is perfect if and only if it is a finite $R$-module, and \item a complex of $R$-modules $K^\bullet$ is perfect if and only if $K^\bullet \in D^b(R)$ and each $H^i(K^\bullet)$ is a finite $R$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-dual-perfect-complex} Let $A$ be a ring. Let $K \in D(A)$ be perfect. Then $K^\vee = R\Hom_A(K, A)$ is a perfect complex and $K \cong (K^\vee)^\vee$. There are functorial isomorphisms $$ L \otimes_A^\mathbf{L} K^\vee = R\Hom_A(K, L) \quad\text{and}\quad H^0(L \otimes_A^\mathbf{L} K^\vee) = \Ext_A^0(K, L) $$ for $L \in D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-colim-and-lim-of-duals} \begin{slogan} Trivial duality for systems of perfect objects. \end{slogan} Let $A$ be a ring. Let $(K_n)_{n \in \mathbf{N}}$ be a system of perfect objects of $D(A)$. Let $K = \text{hocolim} K_n$ be the derived colimit (Derived Categories, Definition \ref{derived-definition-derived-colimit}). Then for any object $E$ of $D(A)$ we have $$ R\Hom_A(K, E) = R\lim E \otimes^\mathbf{L}_A K_n^\vee $$ where $(K_n^\vee)$ is the inverse system of dual perfect complexes. \end{lemma} 
\begin{lemma} \label{lemma-colimit-perfect-complexes} Let $R = \colim_{i \in I} R_i$ be a filtered colimit of rings. \begin{enumerate} \item Given a perfect $K$ in $D(R)$ there exists an $i \in I$ and a perfect $K_i$ in $D(R_i)$ such that $K \cong K_i \otimes_{R_i}^\mathbf{L} R$ in $D(R)$. \item Given $0 \in I$ and $K_0, L_0 \in D(R_0)$ with $K_0$ perfect, we have $$ \Hom_{D(R)}(K_0 \otimes_{R_0}^\mathbf{L} R, L_0 \otimes_{R_0}^\mathbf{L} R) = \colim_{i \geq 0} \Hom_{D(R_i)}(K_0 \otimes_{R_0}^\mathbf{L} R_i, L_0 \otimes_{R_0}^\mathbf{L} R_i) $$ \end{enumerate} In other words, the triangulated category of perfect complexes over $R$ is the colimit of the triangulated categories of perfect complexes over $R_i$. \end{lemma} 
\begin{lemma} \label{lemma-lift-acyclic-complex} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $\mathcal{P}$ be a class of $R$-modules. Assume \begin{enumerate} \item each $P \in \mathcal{P}$ is a projective $R$-module, \item if $P_1 \in \mathcal{P}$ and $P_1 \oplus P_2 \in \mathcal{P}$, then $P_2 \in \mathcal{P}$, and \item if $f : P_1 \to P_2$, $P_1, P_2 \in \mathcal{P}$ is surjective modulo $I$, then $f$ is surjective. \end{enumerate} Then given any bounded above acyclic complex $E^\bullet$ whose terms are of the form $P/IP$ for $P \in \mathcal{P}$ there exists a bounded above acyclic complex $P^\bullet$ whose terms are in $\mathcal{P}$ lifting $E^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-lift-complex} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $\mathcal{P}$ be a class of $R$-modules. Let $K \in D(R)$ and let $E^\bullet$ be a complex of $R/I$-modules representing $K \otimes_R^\mathbf{L} R/I$. Assume \begin{enumerate} \item each $P \in \mathcal{P}$ is a projective $R$-module, \item $P_1 \in \mathcal{P}$ and $P_1 \oplus P_2 \in \mathcal{P}$ if and only if $P_1, P_2 \in \mathcal{P}$, \item if $f : P_1 \to P_2$, $P_1, P_2 \in \mathcal{P}$ is surjective modulo $I$, then $f$ is surjective, \item $E^\bullet$ is bounded above and $E^i$ is of the form $P/IP$ for $P \in \mathcal{P}$, and \item $K$ can be represented by a bounded above complex whose terms are in $\mathcal{P}$. \end{enumerate} Then there exists a bounded above complex $P^\bullet$ whose terms are in $\mathcal{P}$ with $P^\bullet/IP^\bullet$ isomorphic to $E^\bullet$ and representing $K$ in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-lift-complex-projectives} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $E^\bullet$ be a complex of $R/I$-modules. Let $K$ be an object of $D(R)$. Assume that \begin{enumerate} \item $E^\bullet$ is a bounded above complex of projective $R/I$-modules, \item $K \otimes_R^\mathbf{L} R/I$ is represented by $E^\bullet$ in $D(R/I)$, and \item $I$ is a nilpotent ideal. \end{enumerate} Then there exists a bounded above complex $P^\bullet$ of projective $R$-modules representing $K$ in $D(R)$ such that $P^\bullet \otimes_R R/I$ is isomorphic to $E^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-check-pseudo-coherent-modulo-nilpotent} Let $R' \to R$ be a surjective ring map whose kernel is a nilpotent ideal. Let $K' \in D(R')$ and set $K = K' \otimes_{R'}^\mathbf{L} R$. Then $K$ is pseudo-coherent if and only if $K'$ is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-lift-complex-stably-frees} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $E^\bullet$ be a complex of $R/I$-modules. Let $K$ be an object of $D(R)$. Assume that \begin{enumerate} \item $E^\bullet$ is a bounded above complex of finite stably free $R/I$-modules, \item $K \otimes_R^\mathbf{L} R/I$ is represented by $E^\bullet$ in $D(R/I)$, \item $K^\bullet$ is pseudo-coherent, and \item every element of $1 + I$ is invertible. \end{enumerate} Then there exists a bounded above complex $P^\bullet$ of finite stably free $R$-modules representing $K$ in $D(R)$ such that $P^\bullet \otimes_R R/I$ is isomorphic to $E^\bullet$. Moreover, if $E^i$ is free, then $P^i$ is free. \end{lemma} 
\begin{lemma} \label{lemma-lift-pseudo-coherent-from-residue-field} Let $(R, \mathfrak m, \kappa)$ be a local ring. Let $K \in D(R)$ be pseudo-coherent. Set $d_i = \dim_\kappa H^i(K \otimes_R^\mathbf{L} \kappa)$. Then $d_i < \infty$ and for some $b \in \mathbf{Z}$ we have $d_i = 0$ for $i > b$. Then there exists a complex $$ \ldots \to R^{\oplus d_{b - 2}} \to R^{\oplus d_{b - 1}} \to R^{\oplus d_b} \to 0 \to \ldots $$ representing $K$ in $D(R)$. Moreover, this complex is unique up to isomorphism(!). \end{lemma} 
\begin{lemma} \label{lemma-lift-perfect-from-residue-field} Let $R$ be a ring. Let $\mathfrak p \subset R$ be a prime. Let $K \in D(R)$ be perfect. Set $d_i = \dim_{\kappa(\mathfrak p)} H^i(K \otimes_R^\mathbf{L} \kappa(\mathfrak p))$. Then $d_i < \infty$ and only a finite number are nonzero. Then there exists an $f \in R$, $f \not \in \mathfrak p$ and a complex $$ \ldots \to 0 \to R_f^{\oplus d_a} \to R_f^{\oplus d_{a + 1}} \to \ldots \to R_f^{\oplus d_{b - 1}} \to R_f^{\oplus d_b} \to 0 \to \ldots $$ representing $K \otimes_R^\mathbf{L} R_f$ in $D(R_f)$. \end{lemma} 
\begin{lemma} \label{lemma-compare-representatives-perfect} Let $R$ be a ring. Let $\mathfrak p \subset R$ be a prime. Let $M^\bullet$ and $N^\bullet$ be bounded complexes of finite projective $R$-modules representing the same object of $D(R)$. Then there exists an $f \in R$, $f \not \in \mathfrak p$ such that there is an isomorphism (!) of complexes $$ M^\bullet_f \oplus P^\bullet \cong N^\bullet_f \oplus Q^\bullet $$ where $P^\bullet$ and $Q^\bullet$ are finite direct sums of trivial complexes, i.e., complexes of the form the form $\ldots \to 0 \to R_f \xrightarrow{1} R_f \to 0 \to \ldots$ (placed in arbitrary degrees). \end{lemma} 
\begin{lemma} \label{lemma-lift-complex-finite-projectives} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $E^\bullet$ be a complex of $R/I$-modules. Let $K$ be an object of $D(R)$. Assume that \begin{enumerate} \item $E^\bullet$ is a bounded above complex of finite projective $R/I$-modules, \item $K \otimes_R^\mathbf{L} R/I$ is represented by $E^\bullet$ in $D(R/I)$, \item $K$ is pseudo-coherent, and \item $(R, I)$ is a henselian pair. \end{enumerate} Then there exists a bounded above complex $P^\bullet$ of finite projective $R$-modules representing $K$ in $D(R)$ such that $P^\bullet \otimes_R R/I$ is isomorphic to $E^\bullet$. Moreover, if $E^i$ is free, then $P^i$ is free. \end{lemma} 
\begin{lemma} \label{lemma-splitting-unique} Let $R$ be a ring. Let $K$ and $L$ be objects of $D(R)$. Assume $L$ has projective-amplitude in $[a, b]$, for example if $L$ is perfect of tor-amplitude in $[a, b]$. \begin{enumerate} \item If $H^i(K) = 0$ for $i \geq a$, then $\Hom_{D(R)}(L, K) = 0$. \item If $H^i(K) = 0$ for $i \geq a + 1$, then given any distinguished triangle $K \to M \to L \to K[1]$ there is an isomorphism $M \cong K \oplus L$ in $D(R)$ compatible with the maps in the distinguished triangle. \item If $H^i(K) = 0$ for $i \geq a$, then the isomorphism in (2) exists and is unique. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-better-cut-complex-in-two} Let $R$ be a ring. Let $\mathfrak p \subset R$ be a prime ideal. Let $K^\bullet$ be a pseudo-coherent complex of $R$-modules. Assume that for some $i \in \mathbf{Z}$ the map $$ H^i(K^\bullet) \otimes_R \kappa(\mathfrak p) \longrightarrow H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) $$ is surjective. Then there exists an $f \in R$, $f \not \in \mathfrak p$ such that $\tau_{\geq i + 1}(K^\bullet \otimes_R R_f)$ is a perfect object of $D(R_f)$ with tor amplitude in $[i + 1, \infty]$ and a canonical isomorphism $$ K^\bullet \otimes_R R_f \cong \tau_{\leq i}(K^\bullet \otimes_R R_f) \oplus \tau_{\geq i + 1}(K^\bullet \otimes_R R_f) $$ in $D(R_f)$. \end{lemma} 
\begin{lemma} \label{lemma-isolate-a-cohomology-group} Let $R$ be a ring. Let $\mathfrak p \subset R$ be a prime ideal. Let $K^\bullet$ be a pseudo-coherent complex of $R$-modules. Assume that for some $i \in \mathbf{Z}$ the maps $$ H^i(K^\bullet) \otimes_R \kappa(\mathfrak p) \longrightarrow H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) \quad\text{and}\quad H^{i - 1}(K^\bullet) \otimes_R \kappa(\mathfrak p) \longrightarrow H^{i - 1}(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) $$ are surjective. Then there exists an $f \in R$, $f \not \in \mathfrak p$ such that \begin{enumerate} \item $\tau_{\geq i + 1}(K^\bullet \otimes_R R_f)$ is a perfect object of $D(R_f)$ with tor amplitude in $[i + 1, \infty]$, \item $H^i(K^\bullet)_f$ is a finite free $R_f$-module, and \item there is a canonical direct sum decomposition $$ K^\bullet \otimes_R R_f \cong \tau_{\leq i - 1}(K^\bullet \otimes_R R_f) \oplus H^i(K^\bullet)_f[-i] \oplus \tau_{\geq i + 1}(K^\bullet \otimes_R R_f) $$ in $D(R_f)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cut-complex-in-two} Let $R$ be a ring. Let $\mathfrak p \subset R$ be a prime ideal. Let $i \in \mathbf{Z}$. Let $K^\bullet$ be a pseudo-coherent complex of $R$-modules such that $H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) = 0$. Then there exists an $f \in R$, $f \not \in \mathfrak p$ and a canonical direct sum decomposition $$ K^\bullet \otimes_R R_f = \tau_{\geq i + 1}(K^\bullet \otimes_R R_f) \oplus \tau_{\leq i - 1}(K^\bullet \otimes_R R_f) $$ in $D(R_f)$ with $\tau_{\geq i + 1}(K^\bullet \otimes_R R_f)$ a perfect complex with tor-amplitude in $[i + 1, \infty]$. \end{lemma} 
\begin{lemma} \label{lemma-split-using-ext-injective} Let $R$ be a ring. Let $K \in D^-(R)$. Let $a \in \mathbf{Z}$. Assume that for any injective $R$-module map $M \to M'$ the map $\Ext^{-a}_R(K, M) \to \Ext^{-a}_R(K, M')$ is injective. Then there is a unique direct sum decomposition $K \cong \tau_{\leq a}K \oplus \tau_{\geq a + 1}K$ and $\tau_{\geq a + 1}K$ has projective-amplitude in $[a + 1, b]$ for some $b$. \end{lemma} 
\begin{lemma} \label{lemma-split-using-ext-zero} Let $R$ be a ring. Let $K \in D^-(R)$. Let $a \in \mathbf{Z}$. Assume $\Ext^{-a}_R(K, M) = 0$ for any $R$-module $M$. Then there is a unique direct sum decomposition $K \cong \tau_{\leq a - 1}K \oplus \tau_{\geq a + 1}K$ and $\tau_{\geq a + 1}K$ has projective-amplitude in $[a + 1, b]$ for some $b$. \end{lemma} 
\begin{lemma} \label{lemma-lift-bounded-pseudo-coherent-to-perfect} Let $R$ be a ring and let $\mathfrak p \subset R$ be a prime. Let $K$ be pseudo-coherent and bounded below. Set $d_i = \dim_{\kappa(\mathfrak p)} H^i(K \otimes_R^\mathbf{L} \kappa(\mathfrak p))$. If there exists an $a \in \mathbf{Z}$ such that $d_i = 0$ for $i < a$, then there exists an $f \in R$, $f \not \in \mathfrak p$ and a complex $$ \ldots \to 0 \to R_f^{\oplus d_a} \to R_f^{\oplus d_{a + 1}} \to \ldots \to R_f^{\oplus d_{b - 1}} \to R_f^{\oplus d_b} \to 0 \to \ldots $$ representing $K \otimes_R^\mathbf{L} R_f$ in $D(R_f)$. In particular $K \otimes_R^\mathbf{L} R_f$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-check-perfect-pointwise} Let $R$ be a ring. Let $a, b \in \mathbf{Z}$. Let $K^\bullet$ be a pseudo-coherent complex of $R$-modules. The following are equivalent \begin{enumerate} \item $K^\bullet$ is perfect with tor amplitude in $[a, b]$, \item for every prime $\mathfrak p$ we have $H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) = 0$ for all $i \not \in [a, b]$, and \item for every maximal ideal $\mathfrak m$ we have $H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak m)) = 0$ for all $i \not \in [a, b]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-perfect-stalks} Let $R$ be a ring. Let $K^\bullet$ be a pseudo-coherent complex of $R$-modules. Consider the following conditions \begin{enumerate} \item $K^\bullet$ is perfect, \item for every prime ideal $\mathfrak p$ the complex $K^\bullet \otimes_R R_{\mathfrak p}$ is perfect, \item for every maximal ideal $\mathfrak m$ the complex $K^\bullet \otimes_R R_{\mathfrak m}$ is perfect, \item for every prime $\mathfrak p$ we have $H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak p)) = 0$ for all $i \ll 0$, \item for every maximal ideal $\mathfrak m$ we have $H^i(K^\bullet \otimes_R^{\mathbf{L}} \kappa(\mathfrak m)) = 0$ for all $i \ll 0$. \end{enumerate} We always have the implications $$ (1) \Rightarrow (2) \Leftrightarrow (3) \Leftrightarrow (3) \Leftrightarrow (4) \Leftrightarrow (5) $$ If $K^\bullet$ is bounded below, then all conditions are equivalent. \end{lemma} 
\begin{lemma} \label{lemma-projective-amplitude-pseudo-coherent} Let $R$ be a ring. Let $K$ be a pseudo-coherent object of $D(R)$. Let $a, b \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item $K$ has projective-amplitude in $[a, b]$, \item $K$ is perfect of tor-amplitude in $[a, b]$, \item $\Ext^i_R(K, N) = 0$ for all finitely presented $R$-modules $N$ and all $i \not \in [-b, -a]$, \item $H^n(K) = 0$ for $n > b$ and $\Ext^i_R(K, N) = 0$ for all finitely presented $R$-modules $N$ and all $i > -a$, and \item $H^n(K) = 0$ for $n \not \in [a - 1, b]$ and $\Ext^{-a + 1}_R(K, N) = 0$ for all finitely presented $R$-modules $N$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-over-polynomial-ring} Let $A \to B$ be a ring map. Let $a, b \in \mathbf{Z}$. Let $d \geq 0$. Let $K^\bullet$ be a complex of $B$-modules. Assume \begin{enumerate} \item the ring map $A \to B$ is flat, \item for every prime $\mathfrak p \subset A$ the ring $B \otimes_A \kappa(\mathfrak p)$ has finite global dimension $\leq d$, \item $K^\bullet$ is pseudo-coherent as a complex of $B$-modules, and \item $K^\bullet$ has tor amplitude in $[a, b]$ as a complex of $A$-modules. \end{enumerate} Then $K^\bullet$ is perfect as a complex of $B$-modules with tor amplitude in $[a - d, b]$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-over-regular-local-ring} Let $A \to B$ be a local ring homomorphism. Let $a, b \in \mathbf{Z}$. Let $d \geq 0$. Let $K^\bullet$ be a complex of $B$-modules. Assume \begin{enumerate} \item the ring map $A \to B$ is flat, \item the ring $B/\mathfrak m_AB$ is regular of dimension $d$, \item $K^\bullet$ is pseudo-coherent as a complex of $B$-modules, and \item $K^\bullet$ has tor amplitude in $[a, b]$ as a complex of $A$-modules, in fact it suffices if $H^i(K^\bullet \otimes_A^\mathbf{L} \kappa(\mathfrak m_A))$ is nonzero only for $i \in [a, b]$. \end{enumerate} Then $K^\bullet$ is perfect as a complex of $B$-modules with tor amplitude in $[a - d, b]$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-ring-classical-generator} Let $R$ be a ring. The full subcategory $D_{perf}(R) \subset D(R)$ of perfect objects is the smallest strictly full, saturated, triangulated subcategory containing $R = R[0]$. In other words $D_{perf}(R) = \langle R \rangle$. In particular, $R$ is a classical generator for $D_{perf}(R)$. \end{lemma} 
\begin{lemma} \label{lemma-commutes-with-countable-sums} Let $R$ be a ring. Let $K \in D(R)$ be an object such that for every countable set of objects $E_n \in D(R)$ the canonical map $$ \bigoplus \Hom_{D(R)}(K, E_n) \longrightarrow \Hom_{D(R)}(K, \bigoplus E_n) $$ is a bijection. Then, given any system $L_n^\bullet$ of complexes over $\mathbf{N}$ we have that $$ \colim \Hom_{D(R)}(K, L^\bullet_n) \longrightarrow \Hom_{D(R)}(K, L^\bullet) $$ is a bijection, where $L^\bullet$ is the termwise colimit, i.e., $L^m = \colim L_n^m$ for all $m \in \mathbf{Z}$. \end{lemma} 
\begin{proposition} \label{proposition-perfect-is-compact} Let $R$ be a ring. For an object $K$ of $D(R)$ the following are equivalent \begin{enumerate} \item $K$ is perfect, and \item $K$ is a compact object of $D(R)$. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-perfect-modulo-nilpotent-ideal} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $K$ be an object of $D(R)$. Assume that \begin{enumerate} \item $K \otimes_R^\mathbf{L} R/I$ is perfect in $D(R/I)$, and \item $I$ is a nilpotent ideal. \end{enumerate} Then $K$ is perfect in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-modulo-two-ideals} Let $R$ be a ring. Let $I, J \subset R$ be ideals. Let $K$ be an object of $D(R)$. Assume that \begin{enumerate} \item $K \otimes_R^\mathbf{L} R/I$ is perfect in $D(R/I)$, and \item $K \otimes_R^\mathbf{L} R/J$ is perfect in $D(R/J)$. \end{enumerate} Then $K \otimes_R^\mathbf{L} R/IJ$ is perfect in $D(R/IJ)$. \end{lemma} 
\begin{lemma} \label{lemma-ghost-lemma} \begin{reference} \cite{Kelly} \end{reference} Let $R$ be a ring. Let $n \geq 1$. Let $K \in \langle R \rangle_n$ with notation as in Derived Categories, Section \ref{derived-section-generators}. Consider maps $$ K \xrightarrow{f_1} K_1 \xrightarrow{f_2} K_2 \xrightarrow{f_3} \ldots \xrightarrow{f_n} K_n $$ in $D(R)$. If $H^i(f_j) = 0$ for all $i, j$, then $f_n \circ \ldots \circ f_1 = 0$. \end{lemma} 
\begin{lemma} \label{lemma-not-regular-not-strong} Let $R$ be a Noetherian ring. If $R$ is a strong generator for $D_{perf}(R)$, then $R$ is regular of finite dimension. \end{lemma} 
\begin{lemma} \label{lemma-ext-regular} Let $R$ be a Noetherian regular ring of dimension $d < \infty$. Let $K, L \in D^-(R)$. Assume there exists an $k$ such that $H^i(K) = 0$ for $i \leq k$ and $H^i(L) = 0$ for $i \geq k - d + 1$. Then $\Hom_{D(R)}(K, L) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-split-complex-regular} Let $R$ be a Noetherian regular ring of dimension $1 \leq d < \infty$. Let $K \in D(R)$ be perfect and let $k \in \mathbf{Z}$ such that $H^i(K) = 0$ for $i = k - d + 2, \ldots, k$ (empty condition if $d = 1$). Then $K = \tau_{\leq k - d + 1}K \oplus \tau_{\geq k + 1}K$. \end{lemma} 
\begin{lemma} \label{lemma-regular-strong-generator} Let $R$ be a Noetherian regular ring of finite dimension. Then $R$ is a strong generator for the full subcategory $D_{perf}(R) \subset D(R)$ of perfect objects. \end{lemma} 
\begin{proposition} \label{proposition-regular-strong-generator} Let $R$ be a Noetherian ring. The following are equivalent \begin{enumerate} \item $R$ is regular of finite dimension, \item $D_{perf}(R)$ has a strong generator, and \item $R$ is a strong generator for $D_{perf}(R)$. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-relatively-finitely-presented} Let $R \to A$ be a ring map of finite type. Let $M$ be an $A$-module. The following are equivalent \begin{enumerate} \item for some presentation $\alpha : R[x_1, \ldots, x_n] \to A$ the module $M$ is a finitely presented $R[x_1, \ldots, x_n]$-module, \item for all presentations $\alpha : R[x_1, \ldots, x_n] \to A$ the module $M$ is a finitely presented $R[x_1, \ldots, x_n]$-module, and \item for any surjection $A' \to A$ where $A'$ is a finitely presented $R$-algebra, the module $M$ is finitely presented as $A'$-module. \end{enumerate} In this case $M$ is a finitely presented $A$-module. \end{lemma} 
\begin{definition} \label{definition-relatively-finitely-presented} Let $R \to A$ be a finite type ring map. Let $M$ be an $A$-module. We say $M$ is an $A$-module {\it finitely presented relative to $R$} if the equivalent conditions of Lemma \ref{lemma-relatively-finitely-presented} hold. \end{definition} 
\begin{lemma} \label{lemma-finite-extension} Let $R$ be a ring. Let $A \to B$ be a finite map of finite type $R$-algebras. Let $M$ be a $B$-module. Then $M$ is an $A$-module finitely presented relative to $R$ if and only if $M$ is a $B$-module finitely presented relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-localize-relative-finite-presentation} Let $R$ be a ring, $f \in R$ an element, $R_f \to A$ is a finite type ring map, $g \in A$, and $M$ an $A$-module. If $M$ of finite presentation relative to $R_f$, then $M_g$ is an $A_g$-module of finite presentation relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-relative-finite-presentation} Let $R \to A$ be a finite type ring map. Let $M$ be an $A$-module finitely presented relative to $R$. For any ring map $R \to R'$ the $A \otimes_R R'$-module $$ M \otimes_A A' = M \otimes_R R' $$ is finitely presented relative to $R'$. \end{lemma} 
\begin{lemma} \label{lemma-pull-relative-finite-presentation} Let $R \to A$ be a finite type ring map. Let $M$ be an $A$-module finitely presented relative to $R$. Let $A \to A'$ be a ring map of finite presentation. The $A'$-module $M \otimes_A A'$ is finitely presented relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-composition-relative-finite-presentation} Let $R \to A \to B$ be finite type ring maps. Let $M$ be a $B$-module. If $M$ is finitely presented relative to $A$ and $A$ is of finite presentation over $R$, then $M$ is finitely presented relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-glue-relative-finite-presentation} Let $R \to A$ be a finite type ring map. Let $M$ be an $A$-module. Let $f_1, \ldots, f_r \in A$ generate the unit ideal. The following are equivalent \begin{enumerate} \item each $M_{f_i}$ is finitely presented relative to $R$, and \item $M$ is finitely presented relative to $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ses-relatively-finite-presentation} Let $R \to A$ be a finite type ring map. Let $0 \to M' \to M \to M'' \to 0$ be a short exact sequence of $A$-modules. \begin{enumerate} \item If $M', M''$ are finitely presented relative to $R$, then so is $M$. \item If $M'$ is a finite type $A$-module and $M$ is finitely presented relative to $R$, then $M''$ is finitely presented relative to $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-sum-relatively-finite-presentation} Let $R \to A$ be a finite type ring map. Let $M, M'$ be $A$-modules. If $M \oplus M'$ is finitely presented relative to $R$, then so are $M$ and $M'$. \end{lemma} 
\begin{lemma} \label{lemma-pull-push} Let $R$ be a ring. Let $K^\bullet$ be a complex of $R$-modules. Consider the $R$-algebra map $R[x] \to R$ which maps $x$ to zero. Then $$ K^\bullet \otimes_{R[x]}^{\mathbf{L}} R \cong K^\bullet \oplus K^\bullet[1] $$ in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-add-variable-pseudo-coherent} Let $R$ be a ring and $K^\bullet$ a complex of $R$-modules. Let $m \in \mathbf{Z}$. Consider the $R$-algebra map $R[x] \to R$ which maps $x$ to zero. Then $K^\bullet$ is $m$-pseudo-coherent as a complex of $R$-modules if and only if $K^\bullet$ is $m$-pseudo-coherent as a complex of $R[x]$-modules. \end{lemma} 
\begin{lemma} \label{lemma-relatively-pseudo-coherent} Let $R \to A$ be a ring map of finite type. Let $K^\bullet$ be a complex of $A$-modules. Let $m \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item for some presentation $\alpha : R[x_1, \ldots, x_n] \to A$ the complex $K^\bullet$ is an $m$-pseudo-coherent complex of $R[x_1, \ldots, x_n]$-modules, \item for all presentations $\alpha : R[x_1, \ldots, x_n] \to A$ the complex $K^\bullet$ is an $m$-pseudo-coherent complex of $R[x_1, \ldots, x_n]$-modules. \end{enumerate} In particular the same equivalence holds for pseudo-coherence. \end{lemma} 
\begin{definition} \label{definition-relatively-pseudo-coherent} Let $R \to A$ be a finite type ring map. Let $K^\bullet$ be a complex of $A$-modules. Let $M$ be an $A$-module. Let $m \in \mathbf{Z}$. \begin{enumerate} \item We say $K^\bullet$ is {\it $m$-pseudo-coherent relative to $R$} if the equivalent conditions of Lemma \ref{lemma-relatively-pseudo-coherent} hold. \item We say $K^\bullet$ is {\it pseudo-coherent relative to $R$} if $K^\bullet$ is $m$-pseudo-coherent relative to $R$ for all $m \in \mathbf{Z}$. \item We say $M$ is {\it $m$-pseudo-coherent relative to $R$} if $M[0]$ is $m$-pseudo-coherent relative to $R$. \item We say $M$ is {\it pseudo-coherent relative to $R$} if $M[0]$ is pseudo-coherent relative to $R$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-finite-extension-pseudo-coherent} Let $R$ be a ring. Let $A \to B$ be a finite map of finite type $R$-algebras. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $B$-modules. Then $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$ if and only if $K^\bullet$ seen as a complex of $A$-modules is $m$-pseudo-coherent (pseudo-coherent) relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-cone-relatively-pseudo-coherent} Let $R$ be a ring. Let $R \to A$ be a finite type ring map. Let $m \in \mathbf{Z}$. Let $(K^\bullet, L^\bullet, M^\bullet, f, g, h)$ be a distinguished triangle in $D(A)$. \begin{enumerate} \item If $K^\bullet$ is $(m + 1)$-pseudo-coherent relative to $R$ and $L^\bullet$ is $m$-pseudo-coherent relative to $R$ then $M^\bullet$ is $m$-pseudo-coherent relative to $R$. \item If $K^\bullet, M^\bullet$ are $m$-pseudo-coherent relative to $R$, then $L^\bullet$ is $m$-pseudo-coherent relative to $R$. \item If $L^\bullet$ is $(m + 1)$-pseudo-coherent relative to $R$ and $M^\bullet$ is $m$-pseudo-coherent relative to $R$, then $K^\bullet$ is $(m + 1)$-pseudo-coherent relative to $R$. \end{enumerate} Moreover, if two out of three of $K^\bullet, L^\bullet, M^\bullet$ are pseudo-coherent relative to $R$, the so is the third. \end{lemma} 
\begin{lemma} \label{lemma-rel-n-pseudo-module} Let $R \to A$ be a finite type ring map. Let $M$ be an $A$-module. Then \begin{enumerate} \item $M$ is $0$-pseudo-coherent relative to $R$ if and only if $M$ is a finite type $A$-module, \item $M$ is $(-1)$-pseudo-coherent relative to $R$ if and only if $M$ is a finitely presented relative to $R$, \item $M$ is $(-d)$-pseudo-coherent relative to $R$ if and only if for every surjection $R[x_1, \ldots, x_n] \to A$ there exists a resolution $$ R[x_1, \ldots, x_n]^{\oplus a_d} \to R[x_1, \ldots, x_n]^{\oplus a_{d - 1}} \to \ldots \to R[x_1, \ldots, x_n]^{\oplus a_0} \to M \to 0 $$ of length $d$, and \item $M$ is pseudo-coherent relative to $R$ if and only if for every presentation $R[x_1, \ldots, x_n] \to A$ there exists an infinite resolution $$ \ldots \to R[x_1, \ldots, x_n]^{\oplus a_1} \to R[x_1, \ldots, x_n]^{\oplus a_0} \to M \to 0 $$ by finite free $R[x_1, \ldots, x_n]$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-summands-relative-pseudo-coherent} Let $R \to A$ be a finite type ring map. Let $m \in \mathbf{Z}$. Let $K^\bullet, L^\bullet \in D(A)$. If $K^\bullet \oplus L^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$ so are $K^\bullet$ and $L^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-complex-relative-pseudo-coherent-modules} Let $R \to A$ be a finite type ring map. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a bounded above complex of $A$-modules such that $K^i$ is $(m - i)$-pseudo-coherent relative to $R$ for all $i$. Then $K^\bullet$ is $m$-pseudo-coherent relative to $R$. In particular, if $K^\bullet$ is a bounded above complex of $A$-modules pseudo-coherent relative to $R$, then $K^\bullet$ is pseudo-coherent relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-relative-pseudo-coherent} Let $R \to A$ be a finite type ring map. Let $m \in \mathbf{Z}$. Let $K^\bullet \in D^{-}(A)$ such that $H^i(K^\bullet)$ is $(m - i)$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$ for all $i$. Then $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-localize-relative-pseudo-coherent} Let $R$ be a ring, $f \in R$ an element, $R_f \to A$ is a finite type ring map, $g \in A$, and $K^\bullet$ a complex of $A$-modules. If $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R_f$, then $K^\bullet \otimes_A A_g$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-relative-pseudo-coherent} Let $R \to A$ be a finite type ring map. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $A$-modules which is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. Let $R \to R'$ be a ring map such that $A$ and $R'$ are Tor independent over $R$. Set $A' = A \otimes_R R'$. Then $K^\bullet \otimes_A^{\mathbf{L}} A'$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R'$. \end{lemma} 
\begin{lemma} \label{lemma-pull-relative-pseudo-coherent} Let $R \to A \to B$ be finite type ring maps. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $A$-modules. Assume $B$ as a $B$-module is pseudo-coherent relative to $A$. If $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$, then $K^\bullet \otimes_A^{\mathbf{L}} B$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-pull-relative-pseudo-coherent-module} Let $R \to A \to B$ be finite type ring maps. Let $m \in \mathbf{Z}$. Let $M$ be an $A$-module. Assume $B$ is flat over $A$ and $B$ as a $B$-module is pseudo-coherent relative to $A$. If $M$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$, then $M \otimes_A B$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-composition-relative-pseudo-coherent} Let $R$ be a ring. Let $A \to B$ be a map of finite type $R$-algebras. Let $m \in \mathbf{Z}$. Let $K^\bullet$ be a complex of $B$-modules. Assume $A$ is pseudo-coherent relative to $R$. Then the following are equivalent \begin{enumerate} \item $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $A$, and \item $K^\bullet$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-glue-relative-pseudo-coherent} Let $R \to A$ be a finite type ring map. Let $K^\bullet$ be a complex of $A$-modules. Let $m \in \mathbf{Z}$. Let $f_1, \ldots, f_r \in A$ generate the unit ideal. The following are equivalent \begin{enumerate} \item each $K^\bullet \otimes_A A_{f_i}$ is $m$-pseudo-coherent relative to $R$, and \item $K^\bullet$ is $m$-pseudo-coherent relative to $R$. \end{enumerate} The same equivalence holds for pseudo-coherence relative to $R$. \end{lemma} 
\begin{lemma} \label{lemma-Noetherian-relative-pseudo-coherent} Let $R$ be a Noetherian ring. Let $R \to A$ be a finite type ring map. Then \begin{enumerate} \item A complex of $A$-modules $K^\bullet$ is $m$-pseudo-coherent relative to $R$ if and only if $K^\bullet \in D^{-}(A)$ and $H^i(K^\bullet)$ is a finite $A$-module for $i \geq m$. \item A complex of $A$-modules $K^\bullet$ is pseudo-coherent relative to $R$ if and only if $K^\bullet \in D^{-}(A)$ and $H^i(K^\bullet)$ is a finite $A$-module for all $i$. \item An $A$-module is pseudo-coherent relative to $R$ if and only if it is finite. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-pseudo-coherent-perfect} Let $A \to B$ be a ring map. \begin{enumerate} \item We say $A \to B$ is a {\it pseudo-coherent ring map} if it is of finite type and $B$, as a $B$-module, is pseudo-coherent relative to $A$. \item We say $A \to B$ is a {\it perfect ring map} if it is a pseudo-coherent ring map such that $B$ as an $A$-module has finite tor dimension. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-perfect-ring-map} A ring map $A \to B$ is perfect if and only if $B = A[x_1, \ldots, x_n]/I$ and $B$ as an $A[x_1, \ldots, x_n]$-module has a finite resolution by finite projective $A[x_1, \ldots, x_n]$-modules. \end{lemma} 
\begin{lemma} \label{lemma-Noetherian-pseudo-coherent-ring-map} A finite type ring map of Noetherian rings is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-presentation-perfect} A ring map which is flat and of finite presentation is perfect. \end{lemma} 
\begin{lemma} \label{lemma-regular-perfect-ring-map} Let $A \to B$ be a finite type ring map with $A$ a regular ring of finite dimension. Then $A \to B$ is perfect. \end{lemma} 
\begin{lemma} \label{lemma-lci-perfect} A local complete intersection homomorphism is perfect. \end{lemma} 
\begin{lemma} \label{lemma-relative-pseudo-coherent-is-moot} Let $R \to A$ be a pseudo-coherent ring map. Let $K \in D(A)$. The following are equivalent \begin{enumerate} \item $K$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) relative to $R$, and \item $K$ is $m$-pseudo-coherent (resp.\ pseudo-coherent) in $D(A)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-more-relative-pseudo-coherent-is-moot} Let $R \to B \to A$ be ring maps with $\varphi : B \to A$ surjective and $R \to B$ and $R \to A$ flat and of finite presentation. For $K \in D(A)$ denote $\varphi_*K \in D(B)$ the restriction. The following are equivalent \begin{enumerate} \item $K$ is pseudo-coherent, \item $K$ is pseudo-coherent relative to $R$, \item $K$ is pseudo-coherent relative to $A$, \item $\varphi_*K$ is pseudo-coherent, \item $\varphi_*K$ is pseudo-coherent relative to $R$. \end{enumerate} Similar holds for $m$-pseudo-coherence. \end{lemma} 
\begin{definition} \label{definition-relatively-perfect} Let $R \to A$ be a flat ring map of finite presentation. An object $K$ of $D(A)$ is {\it $R$-perfect} or {\it perfect relative to $R$} if $K$ is pseudo-coherent (Definition \ref{definition-pseudo-coherent}) and has finite tor dimension over $R$ (Definition \ref{definition-tor-amplitude}). \end{definition} 
\begin{lemma} \label{lemma-cone-relatively-perfect} Let $R \to A$ be a flat ring map of finite presentation. The $R$-perfect objects of $D(A)$ form a saturated\footnote{Derived Categories, Definition \ref{derived-definition-saturated}.} triangulated strictly full subcategory. \end{lemma} 
\begin{lemma} \label{lemma-perfect-relatively-perfect} Let $R \to A$ be a flat ring map of finite presentation. A perfect object of $D(A)$ is $R$-perfect. If $K, M \in D(A)$ then $K \otimes_A^\mathbf{L} M$ is $R$-perfect if $K$ is perfect and $M$ is $R$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-structure-relatively-perfect} Let $R \to A$ be a flat ring map of finite presentation. Let $K \in D(A)$. The following are equivalent \begin{enumerate} \item $K$ is $R$-perfect, and \item $K$ is isomorphic to a finite complex of $R$-flat, finitely presented $A$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-base-change-relatively-perfect} Let $R \to A$ be a flat ring map of finite presentation. Let $R \to R'$ be a ring map and set $A' = A \otimes_R R'$. If $K \in D(A)$ is $R$-perfect, then $K \otimes_A^\mathbf{L} A'$ is $R'$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-compute-RHom-relatively-perfect} Let $R \to A$ be a flat ring map. Let $K, L \in D(A)$ with $K$ pseudo-coherent and $L$ finite tor dimension over $R$. We may choose \begin{enumerate} \item a bounded above complex $P^\bullet$ of finite free $A$-modules representing $K$, and \item a bounded complex of $R$-flat $A$-modules $F^\bullet$ representing $L$. \end{enumerate} Given these choices we have \begin{enumerate} \item[(a)] $E^\bullet = \Hom^\bullet(P^\bullet, F^\bullet)$ is a bounded below complex of $R$-flat $A$-modules representing $R\Hom_A(K, L)$, \item[(b)] for any ring map $R \to R'$ with $A' = A \otimes_R R'$ the complex $E^\bullet \otimes_R R'$ represents $R\Hom_{A'}(K \otimes_A^\mathbf{L} A', L \otimes_A^\mathbf{L} A')$. \end{enumerate} If in addition $R \to A$ is of finite presentation and $L$ is $R$-perfect, then we may choose $F^p$ to be finitely presented $A$-modules and consequently $E^n$ will be finitely presented $A$-modules as well. \end{lemma} 
\begin{lemma} \label{lemma-colimit-relatively-perfect} Let $R = \colim_{i \in I} R_i$ be a filtered colimit of rings. Let $0 \in I$ and $R_0 \to A_0$ be a flat ring map of finite presentation. For $i \geq 0$ set $A_i = R_i \otimes_{R_0} A_0$ and set $A = R \otimes_{R_0} A_0$. \begin{enumerate} \item Given an $R$-perfect $K$ in $D(A)$ there exists an $i \in I$ and an $R_i$-perfect $K_i$ in $D(A_i)$ such that $K \cong K_i \otimes_{A_i}^\mathbf{L} A$ in $D(A)$. \item Given $K_0, L_0 \in D(A_0)$ with $K_0$ pseudo-coherent and $L_0$ finite tor dimension over $R_0$, then we have $$ \Hom_{D(A)}(K_0 \otimes_{A_0}^\mathbf{L} A, L_0 \otimes_{A_0}^\mathbf{L} A) = \colim_{i \geq 0} \Hom_{D(A_i)}(K_0 \otimes_{A_0}^\mathbf{L} A_i, L_0 \otimes_{A_0}^\mathbf{L} A_i) $$ \end{enumerate} In particular, the triangulated category of $R$-perfect complexes over $A$ is the colimit of the triangulated categories of $R_i$-perfect complexes over $A_i$. \end{lemma} 
\begin{lemma} \label{lemma-thickening-relatively-perfect} Let $R' \to A'$ be a flat ring map of finite presentation. Let $R' \to R$ be a surjective ring map whose kernel is a nilpotent ideal. Set $A = A' \otimes_{R'} R$. Let $K' \in D(A')$ and set $K = K' \otimes_{A'}^\mathbf{L} A$ in $D(A)$. If $K$ is $R$-perfect, then $K'$ is $R'$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-lift-from-fibre-relatively-perfect} Let $R$ be a ring. Let $A = R[x_1, \ldots, x_d]/I$ be flat and of finite presentation over $R$. Let $\mathfrak q \subset A$ be a prime ideal lying over $\mathfrak p \subset R$. Let $K \in D(A)$ be pseudo-coherent. Let $a, b \in \mathbf{Z}$. If $H^i(K_\mathfrak q \otimes_{R_\mathfrak p}^\mathbf{L} \kappa(\mathfrak p))$ is nonzero only for $i \in [a, b]$, then $K_\mathfrak q$ has tor amplitude in $[a - d, b]$ over $R$. \end{lemma} 
\begin{lemma} \label{lemma-bounded-on-fibres-relatively-perfect} Let $R \to A$ be a ring map which is flat and of finite presentation. Let $K \in D(A)$ be pseudo-coherent. The following are equivalent \begin{enumerate} \item $K$ is $R$-perfect, and \item $K$ is bounded below and for every prime ideal $\mathfrak p \subset R$ the object $K \otimes_R^\mathbf{L} \kappa(\mathfrak p)$ is bounded below. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ext-1-zero} Let $R$ be a ring. Let $K \in D(R)$ with $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. The following are equivalent \begin{enumerate} \item $H^{-1}(K) = 0$ and $H^0(K)$ is a projective module and \item $\Ext^1_R(K, M) = 0$ for every $R$-module $M$. \end{enumerate} If $R$ is Noetherian and $H^i(K)$ is a finite $R$-module for $i = -1, 0$, then these are also equivalent to \begin{enumerate} \item[(3)] $\Ext^1_R(K, M) = 0$ for every finite $R$-module $M$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-represent-two-term-complex} Let $R$ be a ring. Let $K$ be an object of $D(R)$ with $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. Then \begin{enumerate} \item $K$ can be represented by a two term complex $K^{-1} \to K^0$ with $K^0$ a free module, and \item if $R$ is Noetherian and $H^i(K)$ is a finite $R$-module for $i = -1, 0$, then $K$ can be represented by a two term complex $K^{-1} \to K^0$ with $K^0$ a finite free module and $K^{-1}$ finite. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-map-out-of-almost-free} Let $R$ be a ring. Let $M^\bullet$ be a complex of modules over $R$ with $M^i = 0$ for $i > 0$ and $M^0$ a projective $R$-module. Let $K^\bullet$ be a second complex. \begin{enumerate} \item Assume $K^i = 0$ for $i \leq -2$. Then $\Hom_{D(R)}(M^\bullet, K^\bullet) = \Hom_{K(R)}(M^\bullet, K^\bullet)$. \item Assume $K^i = 0$ for $i \not \in [-1, 0]$ and $K^0$ a projective $R$-module. Then for a map of complexes $a^\bullet : M^\bullet \to K^\bullet$, the following are equivalent \begin{enumerate} \item $a^\bullet$ induces the zero map $\Ext^1_R(K^\bullet, N) \to \Ext^1_R(M^\bullet, N)$ for all $R$-modules $N$, and \item there is a map $h^0 : M^0 \to K^{-1}$ such that $a^{-1} + h^0 \circ d^{-1}_K = 0$. \end{enumerate} \item Assume $K^i = 0$ for $i \leq -3$. Let $\alpha \in \Hom_{D(R)}(M^\bullet, K^\bullet)$. If the composition of $\alpha$ with $K^\bullet \to K^{-2}[2]$ comes from an $R$-module map $a : M^{-2} \to K^{-2}$ with $a \circ d_M^{-3} = 0$, then $\alpha$ can be represented by a map of complexes $a^\bullet : M^\bullet \to K^\bullet$ with $a^{-2} = a$. \item In (2) for any second map of complexes $(a')^\bullet : M^\bullet \to K^\bullet$ representing $\alpha$ with $a = (a')^{-2}$ there exist $h^i : M^i \to K^{i - 1}$ for $i = 0, -1$ such that $$ h^{-1} \circ d_M^{-2} = 0, \quad (a')^{-1} = a^{-1} + d_K^{-2} \circ h^{-1} + h^0 \circ d_M^{-1},\quad (a')^0 = a^0 + d_K^{-1} \circ h^0 $$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ext-1-annihilated-definite} Let $R$ be a ring and let $I \subset R$ be an ideal. Let $K \in D(R)$. Assume $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. The following are equivalent \begin{enumerate} \item $\Ext^1_R(K, N)$ is annihilated by $I$ for all $R$-modules $N$, \item $K$ can be represented by a complex $K^{-1} \to K^0$ with $K^0$ free such that for any $a \in I$ the map $a : K^{-1} \to K^{-1}$ factors through $d_K^{-1} : K^{-1} \to K^0$, \item whenever $K$ is represented by a two term complex $K^{-1} \to K^0$ with $K^0$ projective, then for any $a \in I$ the map $a : K^{-1} \to K^{-1}$ factors through $d_K^{-1} : K^{-1} \to K^0$. \end{enumerate} If $R$ is Noetherian and $H^i(K)$ is a finite $R$-module for $i = -1, 0$, then these are also equivalent to \begin{enumerate} \item[(4)] $\Ext^1_R(K, N)$ is annihilated by $I$ for every finite $R$-module $N$, \item[(5)] $K$ can be represented by a complex $K^{-1} \to K^0$ with $K^0$ finite free and $K^{-1}$ finite such that for any $a \in I$ the map $a : K^{-1} \to K^{-1}$ factors through $d_K^{-1} : K^{-1} \to K^0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-two-term-base-change} Let $R$ be a ring. Let $K$ be an object of $D(R)$ with $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. Let $K^{-1} \to K^0$ be a two term complex of $R$-modules representing $K$ such that $K^0$ is a flat $R$-module (for example projective or free). Let $R \to R'$ be a ring map. Then the complex $K^\bullet \otimes_R R'$ represents $\tau_{\geq -1}(K \otimes_R^\mathbf{L} R')$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-property-ext-1-annihilated} Let $I$ be an ideal of a ring $R$. Let $K$ be an object of $D(R)$ with $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. Let $R \to R'$ be a ring map. If $K$ satisfies the equivalent conditions (1), (2), and (3) of Lemma \ref{lemma-ext-1-annihilated-definite} with respect to $(R, I)$, then $\tau_{\geq -1}(K \otimes_R^\mathbf{L} R')$ satisfies the equivalent conditions (1), (2), and (3) of Lemma \ref{lemma-ext-1-annihilated-definite} with respect to $(R', IR')$ \end{lemma} 
\begin{lemma} \label{lemma-two-term-surjection-map-zero} Let $R$ be a ring. Let $\alpha : K \to K'$ be a morphism of $D(R)$. Assume \begin{enumerate} \item $H^i(K) = H^i(K') = 0$ for $i \not \in \{-1, 0\}$ \item $H^0(\alpha)$ is an isomorphism and $H^{-1}(\alpha)$ is surjective. \end{enumerate} For any $f \in R$ if $f : K \to K$ is $0$, then $f : K' \to K'$ is $0$. \end{lemma} 
\begin{lemma} \label{lemma-surjection-property-ext-1-annihilated} Let $I$ be an ideal of a ring $R$. Let $\alpha : K \to K'$ be a morphism of $D(R)$. Assume \begin{enumerate} \item $H^i(K) = H^i(K') = 0$ for $i \not \in \{-1, 0\}$ \item $H^0(\alpha)$ is an isomorphism and $H^{-1}(\alpha)$ is surjective. \end{enumerate} If $K$ satisfies the equivalent conditions (1), (2), and (3) of Lemma \ref{lemma-ext-1-annihilated-definite}, then $K'$ does too. \end{lemma} 
\begin{lemma} \label{lemma-ext-1-annihilated} Let $R$ be ring and let $I \subset R$ be an ideal. Let $K \in D(R)$ with $H^i(K) = 0$ for $i \not \in \{-1, 0\}$. The following are equivalent \begin{enumerate} \item there exists a $c \geq 0$ such that the equivalent conditions (1), (2), (3) of Lemma \ref{lemma-ext-1-annihilated-definite} hold for $K$ and the ideal $I^c$, \item there exists a $c \geq 0$ such that (a) $I^c$ annihilates $H^{-1}(K)$ and (b) $H^0(K)$ is an $I^c$-projective module (see Section \ref{section-near-projective}). \end{enumerate} If $R$ is Noetherian and $H^i(K)$ is a finite $R$-module for $i = -1, 0$, then these are also equivalent to \begin{enumerate} \item[(3)] there exists a $c \geq 0$ such that the equivalent conditions (4), (5) of Lemma \ref{lemma-ext-1-annihilated-definite} hold for $K$ and the ideal $I^c$, \item[(4)] $H^{-1}(K)$ is $I$-power torsion and there exist $f_1, \ldots, f_s \in R$ with $V(f_1, \ldots, f_s) \subset V(I)$ such that the localizations $H^0(K)_{f_i}$ are projective $R_{f_i}$-modules, \item[(5)] $H^{-1}(K)$ is $I$-power torsion and there exist $f_1, \ldots, f_s \in I$ with $V(f_1, \ldots, f_s) = V(I)$ such that the localizations $H^0(K)_{f_i}$ are projective $R_{f_i}$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-zero-in-derived} Let $R$ be a ring. Let $K_j \in D(R)$, $j = 1, 2, 3$ with $H^i(K_j) = 0$ for $i \not \in \{-1, 0\}$. Let $\varphi : K_1 \to K_2$ and $\psi : K_2 \to K_3$ be maps in $D(R)$. If $H^0(\varphi) = 0$ and $H^{-1}(\psi) = 0$, then $\varphi \circ \psi = 0$. \end{lemma} 
\begin{lemma} \label{lemma-silly} Let $R$ be a ring. Let $K \in D(R)$ be given by a two term complex of the form $R^{\oplus n} \to R^{\oplus n}$. Denote $A \in \text{Mat}(n \times n, R)$ the matrix of the differential. Then $\det(a) : K \to K$ is zero in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-tensor-NL} Let $R \to S$ and $S \to S'$ be ring maps. The canonical map $\NL_{S/R} \otimes_S^\mathbf{L} S' \to \NL_{S/R} \otimes_S S'$ induces an isomorphism $\tau_{\geq -1}(\NL_{S/R} \otimes_S^\mathbf{L} S') \to \NL_{S/R} \otimes_S S'$ in $D(S')$. Similarly, given a presentation $\alpha$ of $S$ over $R$ the canonical map $\NL(\alpha) \otimes_S^\mathbf{L} S' \to \NL(\alpha) \otimes_S S'$ induces an isomorphism $\tau_{\geq -1}(\NL(\alpha) \otimes_S^\mathbf{L} S') \to \NL(\alpha) \otimes_S S'$ in $D(S')$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-NL} Let $R \to S$ and $R \to R'$ be ring maps. Let $\alpha : P \to S$ be a presentation of $S$ over $R$. Then $\alpha' : P \otimes_R R' \to S \otimes_R R'$ is a presentation of $S' = S \otimes_R R'$ over $R'$. The canonical map $$ NL(\alpha) \otimes_S S' \to \NL(\alpha') $$ is an isomorphism on $H^0$ and surjective on $H^{-1}$. In particular, the canonical map $$ \NL_{S/R} \otimes_S S' \to \NL_{S'/R'} $$ is an isomorphism on $H^0$ and surjective on $H^{-1}$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-NL-flat} Consider a cocartesian diagram of rings $$ \xymatrix{ B \ar[r] & B' \\ A \ar[r] \ar[u] & A' \ar[u] } $$ If $B$ is flat over $A$, then the canonical map $\NL_{B/A} \otimes_B B' \to \NL_{B'/A'}$ is a quasi-isomorphism. If in addition $\NL_{B/A}$ has tor-amplitude in $[-1, 0]$ then $\NL_{B/A} \otimes_B^\mathbf{L} B' \to \NL_{B'/A'}$ is a quasi-isomorphism too. \end{lemma} 
\begin{lemma} \label{lemma-lci-NL} Let $A \to B$ be a local complete intersection as in Definition \ref{definition-local-complete-intersection}. Then $\NL_{B/A}$ is a perfect object of $D(B)$ with tor amplitude in $[-1, 0]$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-lci-bis} Consider a cocartesian diagram of rings $$ \xymatrix{ B \ar[r] & B' \\ A \ar[r] \ar[u] & A' \ar[u] } $$ If $A \to B$ and $A' \to B'$ are local complete intersections as in Definition \ref{definition-local-complete-intersection}, then the kernel of $H^{-1}(\NL_{B/A} \otimes_B B') \to H^{-1}(\NL_{B'/A'})$ is a finite projective $B'$-module. \end{lemma} 
\begin{lemma} \label{lemma-compute-Rlim} The functor $\lim : \textit{Ab}(\mathbf{N}) \to \textit{Ab}$ has a right derived functor \begin{equation} \label{equation-Rlim} R\lim : D(\textit{Ab}(\mathbf{N})) \longrightarrow D(\textit{Ab}) \end{equation} As usual we set $R^p\lim(K) = H^p(R\lim(K))$. Moreover, we have \begin{enumerate} \item for any $(A_n)$ in $\textit{Ab}(\mathbf{N})$ we have $R^p\lim A_n = 0$ for $p > 1$, \item the object $R\lim A_n$ of $D(\textit{Ab})$ is represented by the complex $$ \prod A_n \to \prod A_n,\quad (x_n) \mapsto (x_n - f_{n + 1}(x_{n + 1})) $$ sitting in degrees $0$ and $1$, \item if $(A_n)$ is ML, then $R^1\lim A_n = 0$, i.e., $(A_n)$ is right acyclic for $\lim$, \item every $K^\bullet \in D(\textit{Ab}(\mathbf{N}))$ is quasi-isomorphic to a complex whose terms are right acyclic for $\lim$, and \item if each $K^p = (K^p_n)$ is right acyclic for $\lim$, i.e., of $R^1\lim_n K^p_n = 0$, then $R\lim K$ is represented by the complex whose term in degree $p$ is $\lim_n K_n^p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-six-term-Rlim} Let $$ 0 \to (A_i) \to (B_i) \to (C_i) \to 0 $$ be a short exact sequence of inverse systems of abelian groups. Then there is an associated $6$ term exact sequence $0 \to \lim A_i \to \lim B_i \to \lim C_i \to R^1\lim A_i \to R^1\lim B_i \to R^1\lim C_i \to 0$. \end{lemma} 
\begin{lemma} \label{lemma-apply-Mittag-Leffler-again} Let $$ (A^{-2}_n \to A^{-1}_n \to A^0_n \to A^1_n) $$ be an inverse system of complexes of abelian groups and denote $A^{-2} \to A^{-1} \to A^0 \to A^1$ its limit. Denote $(H_n^{-1})$, $(H_n^0)$ the inverse systems of cohomologies, and denote $H^{-1}$, $H^0$ the cohomologies of $A^{-2} \to A^{-1} \to A^0 \to A^1$. If \begin{enumerate} \item $(A^{-2}_n)$ and $(A^{-1}_n)$ have vanishing $R^1\lim$, \item $(H^{-1}_n)$ has vanishing $R^1\lim$, \end{enumerate} then $H^0 = \lim H_n^0$. \end{lemma} 
\begin{lemma} \label{lemma-map-into-Rlim} Let $\mathcal{D}$ be a triangulated category. Let $(K_n)$ be an inverse system of objects of $\mathcal{D}$. Let $K$ be a derived limit of the system $(K_n)$. Then for every $L$ in $\mathcal{D}$ we have a short exact sequence $$ 0 \to R^1\lim \Hom_\mathcal{D}(L, K_n[-1]) \to \Hom_\mathcal{D}(L, K) \to \lim \Hom_\mathcal{D}(L, K_n) \to 0 $$ \end{lemma} 
\begin{lemma} \label{lemma-map-from-hocolim} Let $\mathcal{D}$ be a triangulated category. Let $(K_n)$ be a system of objects of $\mathcal{D}$. Let $K$ be a derived colimit of the system $(K_n)$. Then for every $L$ in $\mathcal{D}$ we have a short exact sequence $$ 0 \to R^1\lim \Hom_\mathcal{D}(K_n, L[-1]) \to \Hom_\mathcal{D}(K, L) \to \lim \Hom_\mathcal{D}(K_n, L) \to 0 $$ \end{lemma} 
\begin{lemma} \label{lemma-distinguished-triangle-Rlim} Let $K = (K_n^\bullet)$ be an object of $D(\textit{Ab}(\mathbf{N}))$. There exists a canonical distinguished triangle $$ R\lim K \to \prod\nolimits_n K_n^\bullet \to \prod\nolimits_n K_n^\bullet \to R\lim K[1] $$ in $D(\textit{Ab})$. In other words, $R\lim K$ is a derived limit of the inverse system $(K_n^\bullet)$ of $D(\textit{Ab})$, see Derived Categories, Definition \ref{derived-definition-derived-limit}. \end{lemma} 
\begin{lemma} \label{lemma-break-long-exact-sequence} With notation as in Lemma \ref{lemma-distinguished-triangle-Rlim} the long exact cohomology sequence associated to the distinguished triangle breaks up into short exact sequences $$ 0 \to R^1\lim_n H^{p - 1}(K_n^\bullet) \to H^p(R\lim K) \to \lim_n H^p(K_n^\bullet) \to 0 $$ \end{lemma} 
\begin{lemma} \label{lemma-lift-to-system-complexes-Ab} Let $(K_n)$ be an inverse system of objects of $D(\textit{Ab})$. Then there exists an object $M = (M_n^\bullet)$ of $D(\textit{Ab}(\mathbf{N}))$ and isomorphisms $M_n^\bullet \to K_n$ in $D(\textit{Ab})$ such that the diagrams $$ \xymatrix{ M_{n + 1}^\bullet \ar[d] \ar[r] & M_n^\bullet \ar[d] \\ K_{n + 1} \ar[r] & K_n } $$ commute in $D(\textit{Ab})$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-pro-equal} Let $E \to D$ be a morphism of $D(\textit{Ab}(\mathbf{N}))$. Let $(E_n)$, resp.\ $(D_n)$ be the system of objects of $D(\textit{Ab})$ associated to $E$, resp.\ $D$. If $(E_n) \to (D_n)$ is an isomorphism of pro-objects, then $R\lim E \to R\lim D$ is an isomorphism in $D(\textit{Ab})$. \end{lemma} 
\begin{lemma}[Emmanouil] \label{lemma-emmanouil} \begin{reference} Taken from \cite{Emmanouil}. \end{reference} Let $(A_n)$ be an inverse system of abelian groups. The following are equivalent \begin{enumerate} \item $(A_n)$ is Mittag-Leffler, \item $R^1\lim A_n = 0$ and the same holds for $\bigoplus_{i \in \mathbf{N}} (A_n)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Mittag-Leffler} Let $$ 0 \to (A_i) \to (B_i) \to (C_i) \to 0 $$ be a short exact sequence of inverse systems of abelian groups. If $(A_i)$ and $(C_i)$ are ML, then so is $(B_i)$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-zero-of-direct-sums} Let $(A_n)$ be an inverse system of abelian groups. The following are equivalent \begin{enumerate} \item $(A_n)$ is zero as a pro-object, \item $\lim A_n = 0$ and $R^1\lim A_n = 0$ and the same holds for $\bigoplus_{i \in \mathbf{N}} (A_n)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-compute-Rlim-modules} In the situation above. The functor $\lim : \textit{Mod}(\mathbf{N}, (A_n)) \to \text{Mod}_A$ has a right derived functor $$ R\lim : D(\textit{Mod}(\mathbf{N}, (A_n))) \longrightarrow D(A) $$ As usual we set $R^p\lim(K) = H^p(R\lim(K))$. Moreover, we have \begin{enumerate} \item for any $(M_n)$ in $\textit{Mod}(\mathbf{N}, (A_n))$ we have $R^p\lim M_n = 0$ for $p > 1$, \item the object $R\lim M_n$ of $D(\text{Mod}_A)$ is represented by the complex $$ \prod M_n \to \prod M_n,\quad (x_n) \mapsto (x_n - f_{n + 1}(x_{n + 1})) $$ sitting in degrees $0$ and $1$, \item if $(M_n)$ is ML, then $R^1\lim M_n = 0$, i.e., $(M_n)$ is right acyclic for $\lim$, \item every $K^\bullet \in D(\textit{Mod}(\mathbf{N}, (A_n)))$ is quasi-isomorphic to a complex whose terms are right acyclic for $\lim$, and \item if each $K^p = (K^p_n)$ is right acyclic for $\lim$, i.e., of $R^1\lim_n K^p_n = 0$, then $R\lim K$ is represented by the complex whose term in degree $p$ is $\lim_n K_n^p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-distinguished-triangle-Rlim-modules} Let $K = (K_n^\bullet)$ be an object of $D(\textit{Mod}(\mathbf{N}, (A_n)))$. There exists a canonical distinguished triangle $$ R\lim K \to \prod\nolimits_n K_n^\bullet \to \prod\nolimits_n K_n^\bullet \to R\lim K[1] $$ in $D(A)$. In other words, $R\lim K$ is a derived limit of the inverse system $(K_n^\bullet)$ of $D(A)$, see Derived Categories, Definition \ref{derived-definition-derived-limit}. \end{lemma} 
\begin{lemma} \label{lemma-break-long-exact-sequence-modules} With notation as in Lemma \ref{lemma-distinguished-triangle-Rlim-modules} the long exact cohomology sequence associated to the distinguished triangle breaks up into short exact sequences $$ 0 \to R^1\lim_n H^{p - 1}(K_n^\bullet) \to H^p(R\lim K) \to \lim_n H^p(K_n^\bullet) \to 0 $$ of $A$-modules. \end{lemma} 
\begin{lemma} \label{lemma-lift-to-system-complexes} Let $(A_n)$ be an inverse system of rings. Suppose that we are given \begin{enumerate} \item for every $n$ an object $K_n$ of $D(A_n)$, and \item for every $n$ a map $\varphi_n : K_{n + 1} \to K_n$ of $D(A_{n + 1})$ where we think of $K_n$ as an object of $D(A_{n + 1})$ by restriction via $A_{n + 1} \to A_n$. \end{enumerate} There exists an object $M = (M_n^\bullet) \in D(\textit{Mod}(\mathbf{N}, (A_n)))$ and isomorphisms $\psi_n : M_n^\bullet \to K_n$ in $D(A_n)$ such that the diagrams $$ \xymatrix{ M_{n + 1}^\bullet \ar[d]_{\psi_{n + 1}} \ar[r] & M_n^\bullet \ar[d]^{\psi_n} \\ K_{n + 1} \ar[r]^{\varphi_n} & K_n } $$ commute in $D(A_{n + 1})$. \end{lemma} 
\begin{lemma} \label{lemma-get-ML-system} Let $(A_n)$ be an inverse system of rings. Every $K \in D(\textit{Mod}(\mathbf{N}, (A_n)))$ can be represented by a system of complexes $(M_n^\bullet)$ such that all the transition maps $M_{n + 1}^\bullet \to M_n^\bullet$ are surjective. \end{lemma} 
\begin{lemma} \label{lemma-get-K-flat-system} Let $(A_n)$ be an inverse system of rings. Every $K \in D(\textit{Mod}(\mathbf{N}, (A_n)))$ can be represented by a system of complexes $(K_n^\bullet)$ such that each $K_n^\bullet$ is K-flat. \end{lemma} 
\begin{lemma} \label{lemma-derived-tensor-product-systems} Let $(A_n)$ be an inverse system of rings. Given $K, L \in D(\textit{Mod}(\mathbf{N}, (A_n)))$ there is a canonical derived tensor product $K \otimes^\mathbf{L} L$ in $D(\mathbf{N}, (A_n))$ compatible with the maps to $D(A_n)$. The construction is symmetric in $K$ and $L$ and an exact functor of triangulated categories in each variable. \end{lemma} 
\begin{lemma} \label{lemma-tensor-Rlim-exact} Let $A$ be a ring. Let $E \to D \to F \to E[1]$ be a distinguished triangle of $D(\mathbf{N}, A)$. Let $(E_n)$, resp.\ $(D_n)$, resp.\ $(F_n)$ be the system of objects of $D(A)$ associated to $E$, resp.\ $D$, resp.\ $F$. Then for every $K \in D(A)$ there is a canonical distinguished triangle $$ R\lim (K \otimes^\mathbf{L}_A E_n) \to R\lim (K \otimes^\mathbf{L}_A D_n) \to R\lim (K \otimes^\mathbf{L}_A F_n) \to R\lim (K \otimes^\mathbf{L}_A E_n)[1] $$ in $D(A)$ with notation as in Remark \ref{remark-constructing-tensor-with-limits-functorially}. \end{lemma} 
\begin{lemma} \label{lemma-tensor-Rlim-pro-equal} Let $A$ be a ring. Let $E \to D$ be a morphism of $D(\mathbf{N}, A)$. Let $(E_n)$, resp.\ $(D_n)$ be the system of objects of $D(A)$ associated to $E$, resp.\ $D$. If $(E_n) \to (D_n)$ is an isomorphism of pro-objects, then for every $K \in D(A)$ the corresponding map $$ R\lim (K \otimes^\mathbf{L}_A E_n) \longrightarrow R\lim (K \otimes^\mathbf{L}_A D_n) $$ in $D(A)$ is an isomorphism (notation as in Remark \ref{remark-constructing-tensor-with-limits-functorially}). \end{lemma} 
\begin{definition} \label{definition-f-power-torsion} Let $R$ be a ring. Let $M$ be an $R$-module. \begin{enumerate} \item Let $I \subset R$ be an ideal. We say $M$ is an {\it $I$-power torsion module} if for every $m \in M$ there exists an $n > 0$ such that $I^n m = 0$. \item Let $f \in R$. We say $M$ is {\it an $f$-power torsion module} if for each $m \in M$, there exists an $n > 0$ such that $f^n m = 0$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-I-power-torsion-presentation} Let $R$ be a ring. Let $I$ be an ideal of $R$. Let $M$ be an $I$-power torsion module. Then $M$ admits a resolution $$ \ldots \to K_2 \to K_1 \to K_0 \to M \to 0 $$ with each $K_i$ a direct sum of copies of $R/I^n$ for $n$ variable. \end{lemma} 
\begin{lemma} \label{lemma-torsion-free} Let $R$ be a ring. Let $I$ be an ideal of $R$. For any $R$-module $M$ set $M[I^n] = \{m \in M \mid I^nm = 0\}$. If $I$ is finitely generated then the following are equivalent \begin{enumerate} \item $M[I] = 0$, \item $M[I^n] = 0$ for all $n \geq 1$, and \item if $I = (f_1, \ldots, f_t)$, then the map $M \to \bigoplus M_{f_i}$ is injective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-divide-by-torsion} Let $R$ be a ring. Let $I$ be a finitely generated ideal of $R$. \begin{enumerate} \item For any $R$-module $M$ we have $(M/M[I^\infty])[I] = 0$. \item An extension of $I$-power torsion modules is $I$-power torsion. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-I-power-torsion} Let $I$ be a finitely generated ideal of a ring $R$. The $I$-power torsion modules form a Serre subcategory of the abelian category $\text{Mod}_R$, see Homology, Definition \ref{homology-definition-serre-subcategory}. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-closed} Let $R$ be a ring and let $I \subset R$ be a finitely generated ideal. The subcategory $I^\infty\text{-torsion} \subset \text{Mod}_R$ depends only on the closed subset $Z = V(I) \subset \Spec(R)$. In fact, an $R$-module $M$ is $I$-power torsion if and only if its support is contained in $Z$. \end{lemma} 
\begin{lemma} \label{lemma-derived-vanishing-mod-I} Let $R$ be a ring. Let $I \subset R$ be an ideal. Let $K$ be an object of $D(R)$ such that $K \otimes_R^\mathbf{L} R/I = 0$ in $D(R)$. Then \begin{enumerate} \item $K \otimes_R^\mathbf{L} R/I^n = 0$ for all $n \geq 1$, \item $K \otimes_R^\mathbf{L} N = 0$ for any $I$-power torsion $R$-module $N$, \item $K \otimes_R^\mathbf{L} M = 0$ for any $M \in D^b(R)$ whose cohomology modules are $I$-power torsion. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-torsion-completion} \begin{reference} Slight generalization of \cite[Lemme~1]{Beauville-Laszlo}. \end{reference} Let $R \to R'$ be a ring map. Let $I \subset R$ be an ideal such that $R/I^n \to R'/I^nR'$ is an isomorphism for $n > 0$. For any $I$-power torsion $R$-module $M$ the map $M \to M \otimes_R R'$ is an isomorphism. For example, if $I$ is finitely generated and $R^\wedge$ is the completion of $R$ with respect to $I$, then we have $M \cong M \otimes_R R^\wedge$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-flatness-on-torsion} Let $\varphi : R \to S$ be a ring map. Let $I \subset R$ be an ideal. The following are equivalent \begin{enumerate} \item $\varphi$ is flat and $R/I \to S/IS$ is faithfully flat, \item $\varphi$ is flat, and the map $\Spec(S/IS) \to \Spec(R/I)$ is surjective. \item $\varphi$ is flat, and the base change functor $M \mapsto M \otimes_R S$ is faithful on modules annihilated by $I$, and \item $\varphi$ is flat, and the base change functor $M \mapsto M \otimes_R S$ is faithful on $I$-power torsion modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-neighbourhood-isomorphism} Assume $(\varphi : R \to S, I)$ satisfies the equivalent conditions of Lemma \ref{lemma-characterize-flatness-on-torsion}. The following are equivalent \begin{enumerate} \item for any $I$-power torsion module $M$, the natural map $M \to M \otimes_R S$ is an isomorphism, and \item $R/I \to S/IS$ is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-neighbourhood-equivalence} Assume $\varphi : R \to S$ is a flat ring map and $I \subset R$ is a finitely generated ideal such that $R/I \to S/IS$ is an isomorphism. Then \begin{enumerate} \item for any $R$-module $M$ the map $M \to M \otimes_R S$ induces an isomorphism $M[I^\infty] \to (M \otimes_R S)[(IS)^\infty]$ of $I$-power torsion submodules, \item the natural map $$ \Hom_R(M, N) \longrightarrow \Hom_S(M \otimes_R S, N \otimes_R S) $$ is an isomorphism if either $M$ or $N$ is $I$-power torsion, and \item the base change functor $M \mapsto M \otimes_R S$ defines an equivalence of categories between $I$-power torsion modules and $IS$-power torsion modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-map-identifies-koszul-and-cech-complexes} Assume $\varphi : R \to S$ is a flat ring map and $I \subset R$ is a finitely generated ideal such that $R/I \to S/IS$ is an isomorphism. For any $f_1, \ldots, f_r \in R$ such that $V(f_1, \ldots, f_r) = V(I)$ \begin{enumerate} \item the map of Koszul complexes $K(R, f_1, \ldots, f_r) \to K(S, f_1, \ldots, f_r)$ is a quasi-isomorphism, and \item The map of extended alternating {\v C}ech complexes $$ \xymatrix{ R \to \prod_{i_0} R_{f_{i_0}} \to \prod_{i_0 < i_1} R_{f_{i_0}f_{i_1}} \to \ldots \to R_{f_1\ldots f_r} \ar[d] \\ S \to \prod_{i_0} S_{f_{i_0}} \to \prod_{i_0 < i_1} S_{f_{i_0}f_{i_1}} \to \ldots \to S_{f_1\ldots f_r} } $$ is a quasi-isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-naive-Koszul-complex} Let $R$ be a ring. Let $I = (f_1, \ldots, f_n)$ be a finitely generated ideal of $R$. Let $M$ be the $R$-module generated by elements $e_1, \ldots, e_n$ subject to the relations $f_i e_j - f_j e_i = 0$. There exists a short exact sequence $$ 0 \to K \to M \to I \to 0 $$ such that $K$ is annihilated by $I$. \end{lemma} 
\begin{lemma} \label{lemma-explicit-ext} Let $R$ be a ring. Let $I = (f_1, \ldots, f_n)$ be a finitely generated ideal of $R$. For any $R$-module $N$ set $$ H_1(N, f_\bullet) = \frac{\{(x_1, \ldots, x_n) \in N^{\oplus n} \mid f_i x_j = f_j x_i \}} {\{f_1x, \ldots, f_nx) \mid x \in N\}} $$ For any $R$-module $N$ there exists a canonical short exact sequence $$ 0 \to \Ext_R(R/I, N) \to H_1(N, f_\bullet) \to \Hom_R(K, N) $$ where $K$ is as in Lemma \ref{lemma-naive-Koszul-complex}. \end{lemma} 
\begin{lemma} \label{lemma-koszul-homology-annihilated} Let $R$ be a ring. Let $I = (f_1, \ldots, f_n)$ be a finitely generated ideal of $R$. For any $R$-module $N$ the Koszul homology group $H_1(N, f_\bullet)$ defined in Lemma \ref{lemma-explicit-ext} is annihilated by $I$. \end{lemma} 
\begin{lemma} \label{lemma-neighbourhood-extensions} Assume $\varphi : R \to S$ is a flat ring map and $I \subset R$ is a finitely generated ideal such that $R/I \to S/IS$ is an isomorphism. Let $M$, $N$ be $R$-modules. Assume $M$ is $I$-power torsion. Given an short exact sequence $$ 0 \to N \otimes_R S \to \tilde E \to M \otimes_R S \to 0 $$ there exists a commutative diagram $$ \xymatrix{ 0 \ar[r] & N \ar[r] \ar[d] & E \ar[r] \ar[d] & M \ar[r] \ar[d] & 0 \\ 0 \ar[r] & N \otimes_R S \ar[r] & \tilde E \ar[r] & M \otimes_R S \ar[r] & 0 } $$ with exact rows. \end{lemma} 
\begin{lemma} \label{lemma-recover-module-from-glueing-data} Assume $\varphi : R \to S$ is a flat ring map and $I = (f_1, \ldots, f_t) \subset R$ is an ideal such that $R/I \to S/IS$ is an isomorphism. Let $M$ be an $R$-module. Then the complex (\ref{equation-glueing-complex}) is exact. \end{lemma} 
\begin{lemma} \label{lemma-H0-Can-adjoint} In Remark \ref{remark-glueing-data} the functor $H^0 : \text{Glue}(R \to S, f_1, \ldots, f_t) \to \text{Mod}_R$ is a right adjoint to the functor $\text{Can} : \text{Mod}_R \to \text{Glue}(R \to S, f_1, \ldots, f_t)$. \end{lemma} 
\begin{lemma} \label{lemma-H0-inverse} Assume $\varphi : R \to S$ is a flat ring map and $I = (f_1, \ldots, f_t) \subset R$ is an ideal such that $R/I \to S/IS$ is an isomorphism. Then the functor $H^0$ is a left quasi-inverse to the functor $\text{Can}$ of Remark \ref{remark-glueing-data}. \end{lemma} 
\begin{lemma} \label{lemma-exact} Assume $\varphi : R \to S$ is a flat ring map and let $I = (f_1, \ldots, f_t) \subset R$ be an ideal. Then $\text{Glue}(R \to S, f_1, \ldots, f_t)$ is an abelian category, and the functor $\text{Can}$ is exact and commutes with arbitrary colimits. \end{lemma} 
\begin{lemma} \label{lemma-equivalence-I-unit} Let $\varphi : R \to S$ be a flat ring map and $(f_1, \ldots, f_t) = R$. Then $\text{Can}$ and $H^0$ are quasi-inverse equivalences of categories $$ \text{Mod}_R = \text{Glue}(R \to S, f_1, \ldots, f_t) $$ \end{lemma} 
\begin{lemma} \label{lemma-base-change-glue} Let $\varphi : R \to S$ be a flat ring map and $I = (f_1, \ldots, f_t)$ and ideal. Let $R \to R'$ be a flat ring map, and set $S' = S \otimes_R R'$. Then we obtain a commutative diagram of categories and functors $$ \xymatrix{ \text{Mod}_R \ar[r]_-{\text{Can}} \ar[d]_{-\otimes_R R'} & \text{Glue}(R \to S, f_1, \ldots, f_t) \ar[r]_-{H^0} \ar[d]^{-\otimes_R R'} & \text{Mod}_R \ar[d]^{-\otimes_R R'} \\ \text{Mod}_{R'} \ar[r]^-{\text{Can}} & \text{Glue}(R' \to S', f_1, \ldots, f_t) \ar[r]^-{H^0} & \text{Mod}_{R'} } $$ \end{lemma} 
\begin{proposition} \label{proposition-equivalence} Assume $\varphi : R \to S$ is a flat ring map and $I = (f_1, \ldots, f_t) \subset R$ is an ideal such that $R/I \to S/IS$ is an isomorphism. Then $\text{Can}$ and $H^0$ are quasi-inverse equivalences of categories $$ \text{Mod}_R = \text{Glue}(R \to S, f_1, \ldots, f_t) $$ \end{proposition} 
\begin{lemma} \label{lemma-application-formal-glueing} Let $\varphi : R \to S$ be a flat ring map and let $I \subset R$ be a finitely generated ideal such that $R/I \to S/IS$ is an isomorphism.  \begin{enumerate} \item Given an $R$-module $N$, an $S$-module $M'$ and an $S$-module map $\varphi : M' \to N \otimes_R S$ whose kernel and cokernel are $I$-power torsion, there exists an $R$-module map $\psi : M \to N$ and an isomorphism $M \otimes_R S = M'$ compatible with $\varphi$ and $\psi$. \item Given an $R$-module $M$, an $S$-module $N'$ and an $S$-module map $\varphi : M \otimes_R S \to N'$ whose kernel and cokernel are $I$-power torsion, there exists an $R$-module map $\psi : M \to N$ and an isomorphism $N \otimes_R S = N'$ compatible with $\varphi$ and $\psi$. \end{enumerate} In both cases we have $\Ker(\varphi) \cong \Ker(\psi)$ and $\Coker(\varphi) \cong \Coker(\psi)$. \end{lemma} 
\begin{theorem} \label{theorem-formal-glueing} Let $R$ be a ring, and let $f \in R$. Let $\varphi : R \to S$ be a flat ring map inducing an isomorphism $R/fR \to S/fS$. Then the functor $$ \text{Mod}_R \longrightarrow \text{Mod}_S \times_{\text{Mod}_{S_f}} \text{Mod}_{R_f}, \quad M \longmapsto (M \otimes_R S, M_f, \text{can}) $$ is an equivalence. \end{theorem} 
\begin{proposition} \label{proposition-formal-glueing} Let $R$ be a Noetherian ring. Let $f \in R$ be an element. Let $R^\wedge$ be the $f$-adic completion of $R$. Then the functor $M \mapsto (M^\wedge, M_f, \text{can})$ defines an equivalence $$ \text{Mod}^{fg}_R \longrightarrow \text{Mod}^{fg}_{R^\wedge} \times_{\text{Mod}^{fg}_{(R^\wedge)_f}} \text{Mod}^{fg}_{R_f} $$ \end{proposition} 
\begin{lemma} \label{lemma-same-quotients} Let $R$ be a ring and let $f \in R$. For every positive integer $n$ the map $R/f^nR \to R^\wedge/f^n R^\wedge$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-BL-faithful} Let $R$ be a ring, let $f \in R$, and let $R \to R'$ be a ring map which induces isomorphisms $R/f^nR \to R'/f^nR'$ for $n > 0$. The $R$-module $R' \oplus R_f$ is faithful: for every nonzero $R$-module $M$, the module $M \otimes_R (R' \oplus R_f)$ is also nonzero. For example, if $M$ is nonzero, then $M \otimes_R (R^\wedge \oplus R_f)$ is nonzero. \end{lemma} 
\begin{lemma} \label{lemma-cover-spec} Let $R$ be a ring, let $f \in R$, and let $R \to R'$ be a ring map which induces an isomorphism $R/fR \to R'/fR'$. The map $\Spec(R') \amalg \Spec(R_f) \to \Spec(R)$ is surjective. For example, the map $\Spec(R^\wedge) \amalg \Spec(R_f) \to \Spec(R)$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-faithful-descent} \begin{reference} Slight generalization of \cite[Lemme~2(a)]{Beauville-Laszlo}. \end{reference} Let $R$ be a ring, let $f \in R$, and let $R \to R'$ be a ring map which induces isomorphisms $R/f^nR \to R'/f^nR'$ for $n > 0$. An $R$-module $M$ is finitely generated if and only if the ($R' \oplus R_f$)-module $M \otimes_R (R' \oplus R_f)$ is finitely generated. For example, if $M \otimes_R (R^\wedge \oplus R_f)$ is finitely generated as a module over $R^\wedge \oplus R_f$, then $M$ is a finitely generated $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-same-f-torsion} Let $R$ be a ring, let $f \in R$, and let $R \to R'$ be a ring map which induces isomorphisms $R/f^nR \to R'/f^nR'$ for $n > 0$. The sequence (\ref{equation-BL-cech-re}) is \begin{enumerate} \item exact on the right, \item exact on the left if and only if $R[f^\infty] \to R'[f^\infty]$ is injective, and \item exact in the middle if and only if $R[f^\infty] \to R'[f^\infty]$ is surjective. \end{enumerate} In particular, $(R \to R', f)$ is a glueing pair if and only if $R[f^\infty] \to R'[f^\infty]$ is bijective. For example, $(R, f)$ is a glueing pair if and only if $R[f^\infty] \to R^\wedge[f^\infty]$ is bijective. \end{lemma} 
\begin{lemma} \label{lemma-same-f-torsion-module} Let $R$ be a ring, let $f \in R$, and let $R \to R'$ be a ring map which induces isomorphisms $R/f^nR \to R'/f^nR'$ for $n > 0$. The sequence (\ref{equation-BL-cech-mod-re}) is \begin{enumerate} \item exact on the right, \item exact on the left if and only if $M[f^\infty] \to (M \otimes_R R')[f^\infty]$ is injective, and \item exact in the middle if and only if $M[f^\infty] \to (M \otimes_R R')[f^\infty]$ is surjective. \end{enumerate} Thus $M$ is glueable for $(R \to R', f)$ if and only if $M[f^\infty] \to (M \otimes_R R')[f^\infty]$ is bijective. If $(R \to R', f)$ is a glueing pair, then $M$ is glueable for $(R \to R', f)$ if and only if $M[f^\infty] \to (M \otimes_R R')[f^\infty]$ is injective. For example, if $(R, f)$ is a glueing pair, then $M$ is glueable if and only if $M[f^\infty] \to (M \otimes_R R^\wedge)[f^\infty]$ is injective. \end{lemma} 
\begin{lemma} \label{lemma-first-tor} Let $(R \to R', f)$ be a glueing pair. Then $\text{Tor}^R_1(R', f^n R) = 0$ for each $n > 0$. \end{lemma} 
\begin{lemma} \label{lemma-first-tor-total} Let $(R \to R',f)$ be a glueing pair. Then $\text{Tor}^R_1(R', R/R[f^\infty]) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-BL3} \begin{reference} Slight generalization of \cite[Lemme 3(a)]{Beauville-Laszlo} \end{reference} Let $(R \to R', f)$ be a glueing pair. For every $R$-module $M$, we have $\text{Tor}^R_1(R', \Coker(M \to M_f)) = 0$. \end{lemma} 
\begin{theorem} \label{theorem-BL-glueing} \begin{reference} Slight generalization of the main theorem of \cite{Beauville-Laszlo}. \end{reference} Let $(R \to R',f)$ be a glueing pair. The functor $\text{Can} : \text{Mod}_R \longrightarrow \text{Glue}(R \to R', f)$ determines an equivalence of the category of $R$-modules glueable for $(R \to R', f)$ and the category $\text{Glue}(R \to R', f)$ of glueing data. \end{theorem} 
\begin{lemma} \label{lemma-BL-flat} Let $(R \to R', f)$ be a glueing pair. Let $M$ be an $R$-module which is not necessarily glueable for $(R \to R', f)$. Then $M$ is flat over $R$ if and only if $M \otimes_R R'$ is flat over $R'$ and $M_f$ is flat over $R_f$. \end{lemma} 
\begin{lemma} \label{lemma-BL-properties} Let $(R \to R', f)$ be a glueing pair. Let $M$ be an $R$-module which is not necessarily glueable for $(R \to R', f)$. Then $M$ is a finite projective $R$-module if and only if $M \otimes_R R'$ is finite projective over $R'$ and $M_f$ is finite projective over $R_f$. \end{lemma} 
\begin{lemma} \label{lemma-hom-from-Af} Let $A$ be a ring. Let $f \in A$. Let $K \in D(A)$. The following are equivalent \begin{enumerate} \item $\Ext^n_A(A_f, K) = 0$ for all $n$, \item $\Hom_{D(A)}(E, K) = 0$ for all $E$ in $D(A_f)$, \item $T(K, f) = 0$, \item for every $p \in \mathbf{Z}$ we have $T(H^p(K), f) = 0$, \item for every $p \in \mathbf{Z}$ we have $\Hom_A(A_f, H^p(K)) = 0$ and $\Ext^1_A(A_f, H^p(K)) = 0$, \item $R\Hom_A(A_f, K) = 0$, \item the map $\prod_{n \geq 0} K \to \prod_{n \geq 0} K$, $(x_0, x_1, \ldots) \mapsto (x_0 - fx_1, x_1 - fx_2, \ldots)$ is an isomorphism in $D(A)$, and \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ideal-of-elements-complete-wrt} Let $A$ be a ring. Let $K \in D(A)$. The set $I$ of $f \in A$ such that $T(K, f) = 0$ is a radical ideal of $A$. \end{lemma} 
\begin{lemma} \label{lemma-complete-derived-complete} Let $A$ be a ring. Let $I \subset A$ be an ideal. Let $M$ be an $A$-module. \begin{enumerate} \item If $M$ is $I$-adically complete, then $T(M, f) = 0$ for all $f \in I$. \item Conversely, if $T(M, f) = 0$ for all $f \in I$ and $I$ is finitely generated, then $M \to \lim M/I^nM$ is surjective. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-derived-complete} Let $A$ be a ring. Let $K \in D(A)$. Let $I \subset A$ be an ideal. We say $K$ is {\it derived complete with respect to $I$} if for every $f \in I$ we have $T(K, f) = 0$. If $M$ is an $A$-module, then we say $M$ is {\it derived complete with respect to $I$} if $M[0] \in D(A)$ is derived complete with respect to $I$. \end{definition} 
\begin{proposition} \label{proposition-derived-complete-modules} Let $I \subset A$ be a finitely generated ideal of a ring $A$. Let $M$ be an $A$-module. The following are equivalent \begin{enumerate} \item $M$ is $I$-adically complete, and \item $M$ is derived complete with respect to $I$ and $\bigcap I^nM = 0$. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-serre-subcategory} Let $I$ be an ideal of a ring $A$. \begin{enumerate} \item The derived complete $A$-modules form a weak Serre subcategory $\mathcal{C}$ of $\text{Mod}_A$. \item $D_\mathcal{C}(A) \subset D(A)$ is the full subcategory of derived complete objects. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derived-complete-zero} Let $I$ be a finitely generated ideal of a ring $A$. Let $M$ be a derived complete $A$-module. If $M/IM = 0$, then $M = 0$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-is-derived-complete} Let $A$ be a ring and $I \subset A$ an ideal. If $A$ is derived complete (eg.\ $I$-adically complete) then any pseudo-coherent object of $D(A)$ is derived complete. \end{lemma} 
\begin{lemma} \label{lemma-double-localize} Let $A$ be a ring. Let $f, g \in A$. Then for $K \in D(A)$ we have $R\Hom_A(A_f, R\Hom_A(A_g, K)) = R\Hom_A(A_{fg}, K)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-completion} \begin{slogan} Derived completions along finitely generated ideals exist, and can be computed by a {\v C}ech procedure. \end{slogan} Let $I$ be a finitely generated ideal of a ring $A$. The inclusion functor $D_{comp}(A, I) \to D(A)$ has a left adjoint, i.e., given any object $K$ of $D(A)$ there exists a map $K \to K^\wedge$ of $K$ into a derived complete object of $D(A)$ such that the map $$ \Hom_{D(A)}(K^\wedge, E) \longrightarrow \Hom_{D(A)}(K, E) $$ is bijective whenever $E$ is a derived complete object of $D(A)$. In fact, if $I$ is generated by $f_1, \ldots, f_r \in A$, then we have $$ K^\wedge = R\Hom\left((A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to \prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to \ldots \to A_{f_1\ldots f_r}), K\right) $$ functorially in $K$. \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-vanishes} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $K^\bullet$ be a complex of $A$-modules such that $f : K^\bullet \to K^\bullet$ is an isomorphism for some $f \in I$, i.e., $K^\bullet$ is a complex of $A_f$-modules. Then the derived completion of $K^\bullet$ is zero. \end{lemma} 
\begin{lemma} \label{lemma-completion-RHom} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $K, L \in D(A)$. Then $$ R\Hom_A(K, L)^\wedge = R\Hom_A(K, L^\wedge) = R\Hom_A(K^\wedge, L^\wedge) $$ \end{lemma} 
\begin{lemma} \label{lemma-naive-derived-completion} Let $A$ be a ring and let $I \subset A$ be an ideal. Let $(K_n)$ be an inverse system of objects of $D(A)$ such that for all $f \in I$ and $n$ there exists an $e = e(n, f)$ such that $f^e$ is zero on $K_n$. Then for $K \in D(A)$ the object $K' = R\lim (K \otimes_A^\mathbf{L} K_n)$ is derived complete with respect to $I$. \end{lemma} 
\begin{lemma} \label{lemma-koszul-derived-completion-complete} In Situation \ref{situation-koszul}. For $K \in D(A)$ the object $K' = R\lim (K \otimes_A^\mathbf{L} K_n^\bullet)$ is derived complete with respect to $I$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-derived-complete-Koszul} In Situation \ref{situation-koszul}. Let $K \in D(A)$. The following are equivalent \begin{enumerate} \item $K$ is derived complete with respect to $I$, and \item the canonical map $K \to R\lim (K \otimes_A^\mathbf{L} K_n^\bullet)$ is an isomorphism of $D(A)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-koszul} In Situation \ref{situation-koszul}. The functor which sends $K \in D(A)$ to the derived limit $K' = R\lim( K \otimes_A^\mathbf{L} K_n^\bullet )$ is the left adjoint to the inclusion functor $D_{comp}(A) \to D(A)$ constructed in Lemma \ref{lemma-derived-completion}. \end{lemma} 
\begin{lemma} \label{lemma-derived-complete-zero-bis} \begin{slogan} Derived Nakayama \end{slogan} \begin{reference} A related result is \cite[Proposition 6.5]{Dwyer-Greenlees}. The derived Nakayama lemma can for example be found in Bhatt's 3rd lecture on Prismatic cohomology at Columbia University in Fall 2018 as Section 2 property (2). Leonid Positselski proposed a proof in \url{https://mathoverflow.net/a/331501}. However, we follow the proof suggested by Anonymous in the comments. \end{reference} Let $I$ be a finitely generated ideal of a ring $A$. Let $K$ be a derived complete object of $D(A)$. If $K \otimes_A^\mathbf{L} A/I = 0$, then $K = 0$. \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-finite-cohomological-dimension} Let $A$ be a ring and let $I \subset A$ be an ideal which can be generated by $r$ elements. Then derived completion has finite cohomological dimension: \begin{enumerate} \item Let $K \to L$ be a morphism in $D(A)$ such that $H^i(K) \to H^i(L)$ is an isomorphism for $i \geq 1$ and surjective for $i = 0$. Then $H^i(K^\wedge) \to H^i(L^\wedge)$ is an isomorphism for $i \geq 1$ and surjective for $i = 0$. \item Let $K \to L$ be a morphism of $D(A)$ such that $H^i(K) \to H^i(L)$ is an isomorphism for $i \leq -1$ and injective for $i = 0$. Then $H^i(K^\wedge) \to H^i(L^\wedge)$ is an isomorphism for $i \leq -r - 1$ and injective for $i = -r$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-spectral-sequence} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $K^\bullet$ be a filtered complex of $A$-modules. There exists a canonical spectral sequence $(E_r, \text{d}_r)_{r \geq 1}$ of bigraded derived complete $A$-modules with $d_r$ of bidegree $(r, -r + 1)$ and with $$ E_1^{p, q} = H^{p + q}((\text{gr}^pK^\bullet)^\wedge) $$ If the filtration on each $K^n$ is finite, then the spectral sequence is bounded and converges to $H^*((K^\bullet)^\wedge)$. \end{lemma} 
\begin{lemma} \label{lemma-restriction-derived-complete} Let $A \to B$ be a ring map. Let $I \subset A$ be an ideal. The inverse image of $D_{comp}(A, I)$ under the restriction functor $D(B) \to D(A)$ is $D_{comp}(B, IB)$. \end{lemma} 
\begin{lemma} \label{lemma-restriction-derived-complete-equivalence} Let $A \to B$ be a ring map. Let $I \subset A$ be a finitely generated ideal. If $A \to B$ is flat and $A/I \cong B/IB$, then the restriction functor $D(B) \to D(A)$ induces an equivalence $D_{comp}(B, IB) \to D_{comp}(A, I)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-complete-modules} Let $A$ be a ring and let $I \subset A$ be an ideal. The category $\mathcal{C}$ of derived complete modules is abelian, has arbitrary limits, and the inclusion functor $F : \mathcal{C} \to \text{Mod}_A$ is exact and commutes with limits. If $I$ is finitely generated, then $\mathcal{C}$ has arbitrary colimits and $F$ has a left adjoint \end{lemma} 
\begin{lemma} \label{lemma-lift-universally} Let $A$ be a ring. Let $f \in A$. If there exists an integer $c \geq 1$ such that $A[f^c] = A[f^{c + 1}] = A[f^{c + 2}] = \ldots$ (for example if $A$ is Noetherian), then for all $n \geq 1$ there exist maps $$ (A \xrightarrow{f^n} A) \longrightarrow A/(f^n), \quad\text{and}\quad A/(f^{n + c}) \longrightarrow (A \xrightarrow{f^n} A) $$ in $D(A)$ inducing an isomorphism of the pro-objects $\{A/(f^n)\}$ and $\{(f^n : A \to A)\}$ in $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-when-does-it-work} Let $A$ be a ring and $f \in A$. Set $I = (f)$. In this situation we have the naive derived completion $K \mapsto K' = R\lim (K \otimes_A^\mathbf{L} A/f^nA)$ and the derived completion $$ K \mapsto K^\wedge = R\lim (K \otimes_A^\mathbf{L} (A \xrightarrow{f^n} A)) $$ of Lemma \ref{lemma-derived-completion-koszul}. The natural transformation of functors $K^\wedge \to K'$ is an isomorphism if and only if the $f$-power torsion of $A$ is bounded. \end{lemma} 
\begin{lemma} \label{lemma-compare-completion-derived-completion} Let $A$ be a ring and let $f \in A$. Let $K$ be an object of $D(A)$. Denote $K_n = K \otimes_A^\mathbf{L} (A \xrightarrow{f^n} A)$. For all $p \in \mathbf{Z}$ there is a commutative diagram $$ \xymatrix{ & 0 & 0 \\ 0 \ar[r] & \widehat{H^p(K)} \ar[r] \ar[u] & \lim H^p(K_n) \ar[r] \ar[u] & T_f(H^{p + 1}(K)) \ar[r] & 0 \\ 0 \ar[r] & H^0(H^p(K)^\wedge) \ar[r] \ar[u] & H^p(K^\wedge) \ar[r] \ar[u] & T_f(H^{p + 1}(K)) \ar[r] \ar@{=}[u] & 0 \\ & R^1\lim H^p(K)[f^n] \ar[u] \ar[r]^\cong & R^1\lim H^{p - 1}(K_n) \ar[u] \\ & 0 \ar[u] & 0 \ar[u] } $$ with exact rows and columns where $\widehat{H^p(K)} = \lim H^p(K)/f^nH^p(K)$ is the usual $f$-adic completion. The left vertical short exact sequence and the middle horizontal short exact sequence are taken from Example \ref{example-spectral-sequence-principal} The middle vertical short exact sequence is the one from Lemma \ref{lemma-break-long-exact-sequence-modules}. \end{lemma} 
\begin{lemma}[Bhatt] \label{lemma-torsion-and-derived-complete} Let $I$ be a finitely generated ideal in a ring $A$. Let $M$ be a derived complete $A$-module. If $M$ is an $I$-power torsion module, then $I^nM = 0$ for some $n$. \end{lemma} 
\begin{lemma} \label{lemma-kernel-to-completion-square-zero} Let $f \in A$ be an element of a ring. Set $J = \bigcap f^nA$. Let $M$ be an $A$-module derived complete with respect to $f$. Then $JM' = 0$ where $M' = \Ker(M \to \lim M/f^nM)$. In particular, if $A$ is derived complete then $J$ is an ideal of square zero. \end{lemma} 
\begin{lemma} \label{lemma-derived-complete-henselian} Let $A$ be a ring derived complete with respect to an ideal $I$. Then $(A, I)$ is a henselian pair. \end{lemma} 
\begin{lemma} \label{lemma-kernel-to-completion-nilpotent} Let $A$ be a ring derived complete with respect to an ideal $I$. Set $J = \bigcap I^n$. If $I$ can be generated by $r$ elements then $J^N = 0$ where $N = 2^r$. \end{lemma} 
\begin{lemma} \label{lemma-reduced-derived-complete-complete} Let $A$ be a reduced ring derived complete with respect to a finitely generated ideal $I$. Then $A$ is $I$-adically complete. \end{lemma} 
\begin{lemma} \label{lemma-sequence-Koszul-complexes} In Situation \ref{situation-koszul}. If $A$ is Noetherian, then the pro-objects $\{K_n^\bullet\}$ and $\{A/(f_1^n, \ldots, f_r^n)\}$ of $D(A)$ are isomorphic\footnote{In particular, for every $n$ there exists an $m \geq n$ such that $K_m^\bullet \to K_n^\bullet$ factors through the map $K_m^\bullet \to A/(f_1^m, \ldots, f_r^m)$.}. \end{lemma} 
\begin{proposition} \label{proposition-noetherian-naive-completion-is-completion} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. The functor which sends $K \in D(A)$ to the derived limit $K' = R\lim( K \otimes_A^\mathbf{L} A/I^n )$ is the left adjoint to the inclusion functor $D_{comp}(A) \to D(A)$ constructed in Lemma \ref{lemma-derived-completion}. \end{proposition} 
\begin{lemma} \label{lemma-noetherian-calculate} Let $I$ be an ideal of a Noetherian ring $A$. Let $M$ be an $A$-module with derived completion $M^\wedge$. Then there are short exact sequences $$ 0 \to R^1\lim \text{Tor}_{i + 1}^A(M, A/I^n) \to H^{-i}(M^\wedge) \to \lim \text{Tor}_i^A(M, A/I^n) \to 0 $$ A similar result holds for $M \in D^-(A)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-pseudo-coherent} Let $A$ be a Noetherian ring and $I \subset A$ an ideal. Let $K$ be an object of $D(A)$ such that $H^n(K)$ a finite $A$-module for all $n \in \mathbf{Z}$. Then the cohomology modules $H^n(K^\wedge)$ of the derived completion are the $I$-adic completions of the cohomology modules $H^n(K)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-complete-finite} Let $I$ be an ideal of a Noetherian ring $A$. Let $M$ be a derived complete $A$-module. If $M/IM$ is a finite $A/I$-module, then $M = \lim M/I^nM$ and $M$ is a finite $A^\wedge$-module. \end{lemma} 
\begin{lemma} \label{lemma-when-derived-completion-is-completion} Let $I$ be an ideal in a Noetherian ring $A$. \begin{enumerate} \item If $M$ is a finite $A$-module and $N$ is a flat $A$-module, then the derived $I$-adic completion of $M \otimes_A N$ is the usual $I$-adic completion of $M \otimes_A N$. \item If $M$ is a finite $A$-module and $f \in A$, then the derived $I$-adic completion of $M_f$ is the usual $I$-adic completion of $M_f$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-tensor-finite} Let $I$ be an ideal in a Noetherian ring $A$. Let ${}^\wedge$ denote derived completion with respect to $I$. Let $K \in D^-(A)$. \begin{enumerate} \item If $M$ is a finite $A$-module, then $(K \otimes_A^\mathbf{L} M)^\wedge = K^\wedge \otimes_A^\mathbf{L} M$. \item If $L \in D(A)$ is pseudo-coherent, then $(K \otimes_A^\mathbf{L} L)^\wedge = K^\wedge \otimes_A^\mathbf{L} L$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-eta-first-property} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a complex of $f$-torsion free $A$-modules. There is a canonical isomorphism $$ f^i : H^i(M^\bullet)/H^i(M^\bullet)[f] \longrightarrow H^i(\eta_fM^\bullet) $$ given by multiplication by $f^i$. \end{lemma} 
\begin{lemma} \label{lemma-eta-qis} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. If $M^\bullet \to N^\bullet$ is a quasi-isomorphism of complexes of $f$-torsion free $A$-modules, then the induced map $\eta_fM^\bullet \to \eta_fN^\bullet$ is a quasi-isomorphism too. \end{lemma} 
\begin{lemma} \label{lemma-Leta} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. There is an additive functor\footnote{Beware that this functor isn't exact, i.e., does not transform distinguished triangles into distinguished triangles. See Example \ref{example-eta-not-distinguished}.} $L\eta_f : D(A) \to D(A)$ such that if $M \in D(A)$ is represented by a complex $M^\bullet$ of $f$-torsion free $A$-modules, then $L\eta_fM = \eta_fM^\bullet$ and similarly for morphisms. \end{lemma} 
\begin{lemma} \label{lemma-eta-second-property} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a complex of $f$-torsion free $A$-modules. There is a canonical map of complexes $$ \eta_fM^\bullet \otimes_A A/fA \longrightarrow H^\bullet(M^\bullet/f) $$ which is a quasi-isomorphism where the right hand side is the complex (\ref{equation-complex-bocksteins}). \end{lemma} 
\begin{lemma} \label{lemma-vanishing-beta} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a complex of $f$-torsion free $A$-modules. For $i \in \mathbf{Z}$ the following are equivalent \begin{enumerate} \item $\Ker(d^i \bmod f^2)$ surjects onto $\Ker(d^i \bmod f)$, \item $\beta : H^i(M^\bullet \otimes_A f^iA/f^{i + 1}A) \to H^{i + 1}(M^\bullet \otimes_A f^{i + 1}A/f^{i + 2}A)$ is zero. \end{enumerate} These equivalent conditions are implied by the condition $H^{i + 1}(M^\bullet)[f] = 0$. \end{lemma} 
\begin{lemma} \label{lemma-eta-vanishing-beta} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a complex of $f$-torsion free $A$-modules. If $\Ker(d^i \bmod f^2)$ surjects onto $\Ker(d^i \bmod f)$, then the canonical map $$ (1, d^i) : (\eta_fM)^i / f(\eta_fM)^i \longrightarrow f^iM^i/f^{i + 1}M^i \oplus f^{i + 1}M^{i + 1}/f^{i + 2}M^{i + 1} $$ identifies the left hand side with a direct sum of submodules of the right hand side. \end{lemma} 
\begin{lemma} \label{lemma-eta-third-property} Let $A$ be a ring and let $f, g \in A$ be nonzerodivisors. Let $M^\bullet$ be a complex of $A$-modules such that $fg$ is a nonzerodivisor on all $M^i$. Then $\eta_f\eta_gM^\bullet = \eta_{fg}M^\bullet$. \end{lemma} 
\begin{lemma} \label{lemma-eta-flat-base-change} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $A \to B$ be a flat ring map and let $g \in B$ the image of $f$. Let $M^\bullet$ be a complex of $f$-torsion free $A$-modules. Then $g$ is a nonzerodivisor, $M^\bullet \otimes_A B$ is a complex of $g$-torsion free modules, and $\eta_fM^\bullet \otimes_A B = \eta_g(M^\bullet \otimes_A B)$. \end{lemma} 
\begin{lemma} \label{lemma-ideal-well-defined} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ and $N^\bullet$ be two bounded complexes of finite free $A$-modules representing the same object of $D(A)$. Then $$ f^m I_i(M^\bullet, f) = f^n I_i(N^\bullet, f) $$ as ideals of $A$ for integers $n, m \geq 0$ such that $$ m + \sum\nolimits_{j \geq i} (-1)^{j - i}rk(M^j) = n + \sum\nolimits_{j \geq i} (-1)^{j - i}rk(N^j) $$ \end{lemma} 
\begin{lemma} \label{lemma-eta-change-unit} Let $f \in A$ be a nonzerodivisor of a ring $A$. Let $u \in A$ be a unit. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. Then $I_i(M^\bullet, f) = I_i(M^\bullet, uf)$. \end{lemma} 
\begin{lemma} \label{lemma-eta-base-change-pre} Let $A \to B$ be a ring map. Let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. Assume $f$ maps to a nonzerodivisor $g$ in $B$. Then $I_i(M^\bullet, f)B = I_i(M^\bullet \otimes_A B, g)$. \end{lemma} 
\begin{lemma} \label{lemma-eta-cohomology-free} Let $A$ be a ring, let $\mathfrak p \subset A$ be a prime ideal, and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. If $H^i(M^\bullet)_\mathfrak p$ is free for all $i$, then $I_i(M^\bullet, f)_\mathfrak p$ is a principal ideal and in fact generated by a power of $f$ for all $i$. \end{lemma} 
\begin{lemma} \label{lemma-eta-locally-free} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. Assume $I_i(M^\bullet, f)$ is a principal ideal. Then $(\eta_fM)^i$ is locally free of rank $r_i$ and the map $(1, d^i) : (\eta_fM)^i \to f^iM^i \oplus f^{i + 1}M^{i + 1}$ is the inclusion of a direct summand. \end{lemma} 
\begin{lemma} \label{lemma-eta-base-change} Let $A \to B$ be a ring map. Let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. Assume $f$ maps to a nonzerodivisor $g$ in $B$ and $I_i(M^\bullet, f)$ is a principal ideal for all $i \in \mathbf{Z}$. Then there is a canonical isomorphism $\eta_fM^\bullet \otimes_A B = \eta_g(M^\bullet \otimes_A B)$. \end{lemma} 
\begin{lemma} \label{lemma-ideal-direct-summand} Let $A$ be a ring. Let $M$, $N_1$, $N_2$ be finite projective $A$-modules. Let $s : M \to N_1 \oplus N_2$ be a split injection. There exists a finitely generated ideal $J \subset A$ with the following property: a ring map $A \to B$ factors through $A/J$ if and only if $s \otimes \text{id}_B$ identifies $M \otimes_A B$ with a direct sum of submodules of $N_1 \otimes_A B \oplus N_2 \otimes_A B$. \end{lemma} 
\begin{lemma} \label{lemma-eta-vanishing-beta-plus-pre} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ and $N^\bullet$ be two bounded complexes of finite free $A$-modules representing the same object in $D(A)$. Assume $I_i(M^\bullet, f)$ is a principal ideal for all $i \in \mathbf{Z}$. Then $J_i(M^\bullet, f) = J_i(N^\bullet, f)$ as ideals in $A/fA$. \end{lemma} 
\begin{lemma} \label{lemma-eta-vanishing-beta-plus} Let $A$ be a ring and let $f \in A$ be a nonzerodivisor. Let $M^\bullet$ be a bounded complex of finite free $A$-modules. Assume $I_i(M^\bullet, f)$ is a principal ideal for all $i \in \mathbf{Z}$. Consider the ideal $J(M^\bullet, f) = \sum_i J_i(M^\bullet, f)$ of $A/fA$. Consider the set of prime ideals \begin{align*} E & = \{f \in \mathfrak p \subset A \mid \Ker(d^i \bmod f^2)_\mathfrak p \text{ surjects onto } \Ker(d^i \bmod f)_\mathfrak p \text{ for all }i \in \mathbf{Z}\} \\ & = \{f \in \mathfrak p \subset A \mid \text{the localizations }\beta_\mathfrak p \text{ of the Bockstein operators are zero}\} \end{align*} Then we have \begin{enumerate} \item $J(M^\bullet, f)$ is finitely generated, \item $A/fA \to C = (A/fA)/J(M^\bullet, f)$ is surjective of finite presentation, \item $J(M^\bullet, f)_\mathfrak p = 0$ for $\mathfrak p \in E$, \item if $f \in \mathfrak p$ and $H^i(M^\bullet)_\mathfrak p$ is free for all $i \in \mathbf{Z}$, then $\mathfrak p \in E$, and \item the cohomology modules of $\eta_f M^\bullet \otimes_A C$ are finite locally free $C$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Rlim-pseudo-coherent-gives-pseudo-coherent} Let $A = \lim A_n$ be a limit of an inverse system $(A_n)$ of rings. Suppose given $K_n \in D(A_n)$ and maps $K_{n + 1} \to K_n$ in $D(A_{n + 1})$. Assume \begin{enumerate} \item the transition maps $A_{n + 1} \to A_n$ are surjective with locally nilpotent kernels, \item $K_1$ is pseudo-coherent, and \item the maps induce isomorphisms $K_{n + 1} \otimes_{A_{n + 1}}^\mathbf{L} A_n \to K_n$. \end{enumerate} Then $K = R\lim K_n$ is a pseudo-coherent object of $D(A)$ and $K \otimes_A^\mathbf{L} A_n \to K_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-pseudo-coherent-gives-complete-pseudo-coherent} Let $A$ be a ring and $I \subset A$ an ideal. Suppose given $K_n \in D(A/I^n)$ and maps $K_{n + 1} \to K_n$ in $D(A/I^{n + 1})$. Assume \begin{enumerate} \item $A$ is $I$-adically complete, \item $K_1$ is pseudo-coherent, and \item the maps induce isomorphisms $K_{n + 1} \otimes_{A/I^{n + 1}}^\mathbf{L} A/I^n \to K_n$. \end{enumerate} Then $K = R\lim K_n$ is a pseudo-coherent, derived complete object of $D(A)$ and $K \otimes_A^\mathbf{L} A/I^n \to K_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-perfect-gives-perfect} \begin{reference} \cite[Lemma 4.2]{Bhatt-Algebraize} \end{reference} Let $A = \lim A_n$ be a limit of an inverse system $(A_n)$ of rings. Suppose given $K_n \in D(A_n)$ and maps $K_{n + 1} \to K_n$ in $D(A_{n + 1})$. Assume \begin{enumerate} \item the transition maps $A_{n + 1} \to A_n$ are surjective with locally nilpotent kernels, \item $K_1$ is a perfect object, and \item the maps induce isomorphisms $K_{n + 1} \otimes_{A_{n + 1}}^\mathbf{L} A_n \to K_n$. \end{enumerate} Then $K = R\lim K_n$ is a perfect object of $D(A)$ and $K \otimes_A^\mathbf{L} A_n \to K_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-perfect-gives-complete} Let $A$ be a ring and $I \subset A$ an ideal. Suppose given $K_n \in D(A/I^n)$ and maps $K_{n + 1} \to K_n$ in $D(A/I^{n + 1})$. Assume \begin{enumerate} \item $A$ is $I$-adically complete, \item $K_1$ is a perfect object, and \item the maps induce isomorphisms $K_{n + 1} \otimes_{A/I^{n + 1}}^\mathbf{L} A/I^n \to K_n$. \end{enumerate} Then $K = R\lim K_n$ is a perfect, derived complete object of $D(A)$ and $K \otimes_A^\mathbf{L} A/I^n \to K_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma} \label{lemma-Rlim-gives-complete} Let $A$ be a ring and $I \subset A$ an ideal. Suppose given $K_n \in D(A/I^n)$ and maps $K_{n + 1} \to K_n$ in $D(A/I^{n + 1})$. If \begin{enumerate} \item $A$ is Noetherian, \item $K_1$ is bounded above, and \item the maps induce isomorphisms $K_{n + 1} \otimes_{A/I^{n + 1}}^\mathbf{L} A/I^n \to K_n$, \end{enumerate} then $K = R\lim K_n$ is a derived complete object of $D^-(A)$ and $K \otimes_A^\mathbf{L} A/I^n \to K_n$ is an isomorphism for all $n$. \end{lemma} 
\begin{lemma}[Koll\'ar-Kov\'acs] \label{lemma-kollar-kovacs} \begin{reference} Email from Kovacs of 23/02/2018. \end{reference} Let $I$ be an ideal of a Noetherian ring $A$. Let $K \in D(A)$. Set $K_n = K \otimes_A^\mathbf{L} A/I^n$. Assume for all $i \in \mathbf{Z}$ we have \begin{enumerate} \item $H^i(K)$ is a finite $A$-module, and \item the system $H^i(K_n)$ satisfies Mittag-Leffler. \end{enumerate} Then $\lim H^i(K)/I^nH^i(K)$ is equal to $\lim H^i(K_n)$ for all $i \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate-isomorphism} Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. the map $$ R\Hom_R(L, M) \otimes_R^\mathbf{L} K \longrightarrow R\Hom_R(R\Hom_R(K, L), M) $$ of Lemma \ref{lemma-internal-hom-evaluate} is an isomorphism in the following two cases \begin{enumerate} \item $K$ perfect, or \item $K$ is pseudo-coherent, $L \in D^+(R)$, and $M$ finite injective dimension. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate-isomorphism-technical} Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. the map $$ R\Hom_R(L, M) \otimes_R^\mathbf{L} K \longrightarrow R\Hom_R(R\Hom_R(K, L), M) $$ of Lemma \ref{lemma-internal-hom-evaluate} is an isomorphism if the following three conditions are satisfied \begin{enumerate} \item $L, M$ have finite injective dimension, \item $R\Hom_R(L, M)$ has finite tor dimension, \item for every $n \in \mathbf{Z}$ the truncation $\tau_{\leq n}K$ is pseudo-coherent \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-evaluate-tensor-isomorphism} Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. The map $$ K \otimes_R^\mathbf{L} R\Hom_R(M, L) \longrightarrow R\Hom_R(M, K \otimes_R^\mathbf{L} L) $$ of Lemma \ref{lemma-internal-hom-diagonal-better} is an isomorphism in the following cases \begin{enumerate} \item $M$ perfect, or \item $K$ is perfect, or \item $M$ is pseudo-coherent, $L \in D^+(R)$, and $K$ has tor amplitude in $[a, \infty]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-hom-complex-K-flat} Let $R$ be a ring. Let $P^\bullet$ be a bounded above complex of projective $R$-modules. Let $K^\bullet$ be a K-flat complex of $R$-modules. If $P^\bullet$ is a perfect object of $D(R)$, then $\Hom^\bullet(P^\bullet, K^\bullet)$ is K-flat and represents $R\Hom_R(P^\bullet, K^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-upgrade-adjoint-tensor-RHom} Let $R \to R'$ be a ring map. For $K \in D(R)$ and $M \in D(R')$ there is a canonical isomorphism $$ R\Hom_R(K, M) = R\Hom_{R'}(K \otimes_R^\mathbf{L} R', M) $$ \end{lemma} 
\begin{lemma} \label{lemma-base-change-RHom} Let $R \to R'$ be a ring map. Let $K, M \in D(R)$. The map (\ref{equation-base-change-RHom}) $$ R\Hom_R(K, M) \otimes_R^\mathbf{L} R' \longrightarrow R\Hom_{R'}(K \otimes_R^\mathbf{L} R', M \otimes_R^\mathbf{L} R') $$ is an isomorphism in $D(R')$ in the following cases \begin{enumerate} \item $K$ is perfect, \item $R'$ is perfect as an $R$-module, \item $R \to R'$ is flat, $K$ is pseudo-coherent, and $M \in D^{+}(R)$, or \item $R'$ has finite tor dimension as an $R$-module, $K$ is pseudo-coherent, and $M \in D^{+}(R)$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-consequence-Artin-Rees} Let $I$ be an ideal of a Noetherian ring $A$. Let $ K \xrightarrow{\alpha} L \xrightarrow{\beta} M $ be a complex of finite $A$-modules. Set $H = \Ker(\beta)/\Im(\alpha)$. For $n \geq 0$ let $$ K/I^nK \xrightarrow{\alpha_n} L/I^nL \xrightarrow{\beta_n} M/I^nM $$ be the induced complex. Set $H_n = \Ker(\beta_n)/\Im(\alpha_n)$. Then there are canonical $A$-module maps giving a commutative diagram $$ \xymatrix{ & & & H \ar[lld] \ar[ld] \ar[d] \\ \ldots \ar[r] & H_3 \ar[r] & H_2 \ar[r] & H_1 } $$ Moreover, there exists a $c > 0$ and canonical $A$-module maps $H_n \to H/I^{n - c}H$ for $n \geq c$ such that the compositions $$ H/I^n H \to H_n \to  H/I^{n - c}H \quad\text{and}\quad H_n \to H/I^{n - c}H \to H_{n - c} $$ are the canonical ones. Moreover, we have \begin{enumerate} \item $(H_n)$ and $(H/I^nH)$ are isomorphic as pro-objects of $\text{Mod}_A$, \item $\lim H_n = \lim H/I^n H$, \item the inverse system $(H_n)$ is Mittag-Leffler, \item the image of $H_{n + c} \to H_n$ is equal to the image of $H \to H_n$, \item the composition $I^cH_n \to H_n \to H/I^{n - c}H \to H_n/I^{n - c}H_n$ is the inclusion $I^cH_n \to H_n$ followed by the quotient map $H_n \to H_n/I^{n - c}H_n$, and \item the kernel and cokernel of $H/I^nH \to H_n$ is annihilated by $I^c$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-kollar-kovacs-pseudo-coherent} \begin{reference} Email from Kovacs of 23/02/2018. \end{reference} Let $I$ be an ideal of a Noetherian ring $A$. Let $K \in D(A)$ be pseudo-coherent. Set $K_n = K \otimes_A^\mathbf{L} A/I^n$. Then for all $i \in \mathbf{Z}$ the system $H^i(K_n)$ satisfies Mittag-Leffler and $\lim H^i(K)/I^nH^i(K)$ is equal to $\lim H^i(K_n)$. \end{lemma} 
\begin{lemma} \label{lemma-derived-completion-plain-completion} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M^\bullet$ be a bounded complex of finite $A$-modules. The inverse system of maps $$ M^\bullet \otimes_A^\mathbf{L} A/I^n \longrightarrow M^\bullet/I^nM^\bullet $$ defines an isomorphism of pro-objects of $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-hom-systems-ML} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$, $N$ be finite $A$-modules. Set $M_n = M/I^nM$ and $N_n = N/I^nN$. Then \begin{enumerate} \item the systems $(\Hom_A(M_n, N_n))$ and $(\text{Isom}_A(M_n, N_n))$ are Mittag-Leffler, \item there exists a $c \geq 0$ such that the kernels and cokernels of $$ \Hom_A(M, N)/I^n\Hom_A(M, N) \to \Hom_A(M_n, N_n) $$ are killed by $I^c$ for all $n$, \item we have $\lim \Hom_A(M_n, N_n) =\Hom_A(M, N)^\wedge = \Hom_{A^\wedge}(M^\wedge, N^\wedge)$ \item $\lim \text{Isom}_A(M_n, N_n) = \text{Isom}_{A^\wedge}(M^\wedge, N^\wedge)$. \end{enumerate} Here ${}^\wedge$ denotes usual $I$-adic completion. \end{lemma} 
\begin{lemma} \label{lemma-isomorphic-completions} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$, $N$ be finite $A$-modules. Set $M_n = M/I^nM$ and $N_n = N/I^nN$. If $M_n \cong N_n$ for all $n$, then $M^\wedge \cong N^\wedge$ as $A^\wedge$-modules. \end{lemma} 
\begin{lemma} \label{lemma-iso} A morphism $(c, \varphi_n)$ of the category of Remark \ref{remark-weird-systems} is an isomorphism if and only if there exists a $c' \geq 0$ such that $\Ker(\varphi_n)$ and $\Coker(\varphi_n)$ are $I^{c'}$-torsion for all $n \gg 0$. \end{lemma} 
\begin{lemma} \label{lemma-dejong-kollar-kovacs} \begin{reference} Email correspondence between Janos Kollar, Sandor Kovacs, and Johan de Jong of 23/02/2018. \end{reference} Let $I$ be an ideal of the Noetherian ring $A$. Let $M$ and $N$ be finite $A$-modules. Write $A_n = A/I^n$, $M_n = M/I^nM$, and $N_n = N/I^nN$. For every $i \geq 0$ the objects $$ \{\Ext^i_A(M, N)/I^n\Ext^i_A(M, N)\}_{n \geq 1} \quad\text{and}\quad \{\Ext^i_{A_n}(M_n, N_n)\}_{n \geq 1} $$ are isomorphic in the category $\mathcal{C}$ of Remark \ref{remark-weird-systems}. \end{lemma} 
\begin{lemma} \label{lemma-not-awkward} \begin{reference} Email correspondence between Janos Kollar, Sandor Kovacs, and Johan de Jong of 23/02/2018. \end{reference} Let $A \to B$ be a flat homomorphism of Noetherian rings. Let $I \subset A$ be an ideal. Let $M, N$ be $A$-modules. Set $B_n = B/I^nB$, $M_n = M/I^nM$, $N_n = N/I^nN$. If $M$ is flat over $A$, then we have $$ \lim \Ext^i_B(M, N)/I^n \Ext^i_B(M, N) = \lim \Ext^i_{B_n}(M_n, N_n) $$ for all $i \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-consequence-Artin-Rees-bis} Let $I$ be an ideal of a Noetherian ring $A$. Let $ K \xrightarrow{\alpha} L \xrightarrow{\beta} M $ be a complex of finite $A$-modules. Set $H = \Ker(\beta)/\Im(\alpha)$. For $n \geq 0$ let $$ I^nK \xrightarrow{\alpha_n} I^nL \xrightarrow{\beta_n} I^nM $$ be the induced complex. Set $H_n = \Ker(\beta_n)/\Im(\alpha_n)$. Then there are canonical $A$-module maps $$ \ldots \to H_3 \to H_2 \to H_1 \to H $$ There exists a $c > 0$ such that for $n \geq c$ the image of $H_n \to H$ is contained in $I^{n - c}H$ and there is a canonical $A$-module map $I^nH \to H_{n - c}$ such that the compositions $$ I^n H \to H_{n - c} \to  I^{n - 2c}H \quad\text{and}\quad H_n \to I^{n - c}H \to H_{n - 2c} $$ are the canonical ones. In particular, the inverse systems $(H_n)$ and $(I^nH)$ are isomorphic as pro-objects of $\text{Mod}_A$. \end{lemma} 
\begin{lemma} \label{lemma-ext-factors} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$, $N$ be $A$-modules with $M$ finite. For each $p > 0$ there exists a $c \geq 0$ such that for $n \geq c$ the map $\Ext_A^p(M, N) \to \Ext_A^p(I^nM, N)$ factors through $\Ext^p_A(I^nM, I^{n - c}N) \to \Ext_A^p(I^nM, N)$. \end{lemma} 
\begin{lemma} \label{lemma-ext-annihilated} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$, $N$ be $A$-modules with $M$ finite and $N$ annihilated by a power of $I$. For each $p > 0$ there exists an $n$ such that the map $\Ext_A^p(M, N) \to \Ext_A^p(I^nM, N)$ is zero. \end{lemma} 
\begin{lemma} \label{lemma-ext-induced-toplogy} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $K \in D(A)$ be pseudo-coherent and let $M$ be a finite $A$-module. For each $p \in \mathbf{Z}$ there exists an $c$ such that the image of $\Ext_A^p(K, I^nM) \to \Ext_A^p(K, M)$ is contained in $I^{n - c}\Ext_A^p(K, M)$ for $n \geq c$. \end{lemma} 
\begin{lemma} \label{lemma-sequence-powers-pro-bounded} In Situation \ref{situation-koszul} assume $A$ is Noetherian. With notation as above, the inverse system $(I^n)$ is pro-isomorphic in $D(A)$ to the inverse system $(I_n^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-tensoring-Deligne-system} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M^\bullet$ be a bounded complex of finite $A$-modules. The inverse system of maps $$ I^n \otimes_A^\mathbf{L} M^\bullet \longrightarrow I^nM^\bullet $$ defines an isomorphism of pro-objects of $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-factor-through-derived-tensor-product} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$ be a finite $A$-module. There exists an integer $n > 0$ such that $I^nM \to M$ factors through the map $I \otimes_A^\mathbf{L} M \to M$ in $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-ext-annihilated-into} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $K \in D(A)$ be pseudo-coherent. Let $a \in \mathbf{Z}$. Assume that for every finite $A$-module $M$ the modules $\Ext^i_A(K, M)$ are $I$-power torsion for $i \geq a$. Then for $i \geq a$ and $M$ finite the system $\Ext^i_A(K, M/I^nM)$ is essentially constant with value $$ \Ext^i_A(K, M) = \lim \Ext^i_A(K, M/I^nM) $$ \end{lemma} 
\begin{lemma} \label{lemma-tor-annihilated} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $M$ be a finite $A$-module. Let $N$ be an $A$-module annihilated by $I$. There exists an integer $n > 0$ such that $\text{Tor}^A_p(I^nM, N) \to \text{Tor}^A_p(M, N)$ is zero for all $p \geq 0$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-tensor-limit} Let $R$ be a ring. Let $K \in D(R)$ be pseudo-coherent. Let $(M_n)$ be an inverse system of $R$-modules. Then $R\lim K \otimes_R^\mathbf{L} M_n = K \otimes_R^\mathbf{L} R\lim M_n$. \end{lemma} 
\begin{lemma} \label{lemma-additivity-of-pd} Let $R$ be a Noetherian local ring. Let $I \subset R$ be an ideal and let $E$ be a nonzero module over $R/I$. If $R/I$ has finite projective dimension and $E$ has finite projective dimension over $R/I$, then $E$ has finite projective dimension over $R$ and $$ \text{pd}_R(E) = \text{pd}_R(R/I) + \text{pd}_{R/I}(E) $$ \end{lemma} 
\begin{lemma} \label{lemma-enlarge} Let $A \to B$ be a ring map. There exists a cardinal $\kappa = \kappa(A \to B)$ with the following property: Let $M^\bullet$, resp.\ $N^\bullet$ be a complex of $A$-modules, resp.\ $B$-modules. Let $a : M^\bullet \to N^\bullet$ be a map of complexes of $A$-modules which induces an isomorphism $M^\bullet \otimes_A^\mathbf{L} B \to N^\bullet$ in $D(B)$. Let $M_1^\bullet \subset M^\bullet$, resp.\ $N_1^\bullet \subset N^\bullet$ be a subcomplex of $A$-modules, resp.\ $B$-modules such that $a(M_1^\bullet) \subset N_1^\bullet$. Then there exist subcomplexes $$ M_1^\bullet \subset M_2^\bullet \subset M^\bullet \quad\text{and}\quad N_1^\bullet \subset N_2^\bullet \subset N^\bullet $$ such that $a(M_2^\bullet) \subset N_2^\bullet$ with the following properties: \begin{enumerate} \item $\Ker(H^i(M_1^\bullet \otimes_A^\mathbf{L} B) \to H^i(N_1^\bullet))$ maps to zero in $H^i(M_2^\bullet \otimes_A^\mathbf{L} B)$, \item $\Im(H^i(N_1^\bullet) \to H^i(N_2^\bullet))$ is contained in $\Im(H^i(M_2^\bullet \otimes_A^\mathbf{L} B) \to H^2(N_2^\bullet))$, \item $|\bigcup M_2^i \cup \bigcup N_2^i| \leq \max(\kappa, |\bigcup M_1^i \cup \bigcup N_1^i|)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-vanishing-coh-prod-totalization} Let $A_0^\bullet \to A_1^\bullet \to A_2^\bullet \to \ldots$ be a complex of complexes of abelian groups. Assume $H^{-p}(A_p^\bullet) = 0$ for all $p \geq 0$. Set $A^{p, q} = A_p^q$ and view $A^{\bullet, \bullet}$ as a double complex. Then $H^0(\text{Tot}_\pi(A^{\bullet, \bullet})) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-prod-qis-gives-qis} Let $$ (A_0^\bullet \to A_1^\bullet \to A_2^\bullet \to \ldots) \longrightarrow (B_0^\bullet \to B_1^\bullet \to B_2^\bullet \to \ldots) $$ be a map between two complexes of complexes of abelian groups. Set $A^{p, q} = A_p^q$, $B^{p, q} = B_p^q$ to obtain double complexes. Let $\text{Tot}_\pi(A^{\bullet, \bullet})$ and $\text{Tot}_\pi(B^{\bullet, \bullet})$ be the product total complexes associated to the double complexes. If each $A_p^\bullet \to B_p^\bullet$ is a quasi-isomorphism, then $\text{Tot}_\pi(A^{\bullet, \bullet}) \to \text{Tot}_\pi(B^{\bullet, \bullet})$ is a quasi-isomorphism. \end{lemma} 
\begin{definition} \label{definition-weakly-etale} A ring $A$ is called {\it absolutely flat} if every $A$-module is flat over $A$. A ring map $A \to B$ is {\it weakly \'etale} or {\it absolutely flat} if both $A \to B$ and $B \otimes_A B \to B$ are flat. \end{definition} 
\begin{lemma} \label{lemma-key} Let $A \to B$ be a ring map such that $B \otimes_A B \to B$ is flat. Let $N$ be a $B$-module. If $N$ is flat as an $A$-module, then $N$ is flat as a $B$-module. \end{lemma} 
\begin{definition} \label{definition-weak-dimension} Let $A$ be a ring. Let $d \geq 0$ be an integer. We say that $A$ has {\it weak dimension $\leq d$} if every $A$-module has tor dimension $\leq d$. \end{definition} 
\begin{lemma} \label{lemma-weak-dimension-goes-up} Let $A \to B$ be a weakly \'etale ring map. If $A$ has weak dimension at most $d$, then so does $B$. \end{lemma} 
\begin{lemma} \label{lemma-absolutely-flat} Let $A$ be a ring. The following are equivalent \begin{enumerate} \item $A$ has weak dimension $\leq 0$, \item $A$ is absolutely flat, and \item $A$ is reduced and every prime is maximal. \end{enumerate} In this case every local ring of $A$ is a field. \end{lemma} 
\begin{lemma} \label{lemma-product-fields-absolutely-flat} A product of fields is an absolutely flat ring. \end{lemma} 
\begin{lemma} \label{lemma-base-change-weakly-etale} Let $A \to B$ and $A \to A'$ be ring maps. Let $B' = B \otimes_A A'$ be the base change of $B$. \begin{enumerate} \item If $B \otimes_A B \to B$ is flat, then $B' \otimes_{A'} B' \to B'$ is flat. \item If $A \to B$ is weakly \'etale, then $A' \to B'$ is weakly \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-absolutely-flat-over-absolutely-flat} Let $A \to B$ be a ring map such that $B \otimes_A B \to B$ is flat. \begin{enumerate} \item If $A$ is an absolutely flat ring, then so is $B$. \item If $A$ is reduced and $A \to B$ is weakly \'etale, then $B$ is reduced. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-composition-weakly-etale} Let $A \to B$ and $B \to C$ be ring maps. \begin{enumerate} \item If $B \otimes_A B \to B$ and $C \otimes_B C \to C$ are flat, then $C \otimes_A C \to C$ is flat. \item If $A \to B$ and $B \to C$ are weakly \'etale, then $A \to C$ is weakly \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-go-down} Let $A \to B \to C$ be ring maps. \begin{enumerate} \item If $B \to C$ is faithfully flat and $C \otimes_A C \to C$ is flat, then $B \otimes_A B \to B$ is flat. \item If $B \to C$ is faithfully flat and $A \to C$ is weakly \'etale, then $A \to B$ is weakly \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-weakly-etale-permanence} Let $A$ be a ring. Let $B \to C$ be an $A$-algebra map of weakly \'etale $A$-algebras. Then $B \to C$ is weakly \'etale. \end{lemma} 
\begin{lemma} \label{lemma-formally-unramified} Let $A \to B$ be a ring map such that $B \otimes_A B \to B$ is flat. Then $\Omega_{B/A} = 0$, i.e., $B$ is formally unramified over $A$. \end{lemma} 
\begin{lemma} \label{lemma-weakly-etale-finite-type} Let $A \to B$ be a ring map such that $B \otimes_A B \to B$ is flat. \begin{enumerate} \item If $A \to B$ is of finite type, then $A \to B$ is unramified. \item If $A \to B$ is of finite presentation and flat, then $A \to B$ is \'etale. \end{enumerate} In particular a weakly \'etale ring map of finite presentation is \'etale. \end{lemma} 
\begin{lemma} \label{lemma-when-weakly-etale} Let $A \to B$ be a ring map. Then $A \to B$ is weakly \'etale in each of the following cases \begin{enumerate} \item $B = S^{-1}A$ is a localization of $A$, \item $A \to B$ is \'etale, \item $B$ is a filtered colimit of weakly \'etale $A$-algebras. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-absolutely-flat-fields} Let $L/K$ be an extension of fields. If $L \otimes_K L \to L$ is flat, then $L$ is an algebraic separable extension of $K$. \end{lemma} 
\begin{lemma} \label{lemma-absolutely-flat-over-field} Let $B$ be an algebra over a field $K$. The following are equivalent \begin{enumerate} \item $B \otimes_K B \to B$ is flat, \item $K \to B$ is weakly \'etale, and \item $B$ is a filtered colimit of \'etale $K$-algebras. \end{enumerate} Moreover, every finitely generated $K$-subalgebra of $B$ is \'etale over $K$. \end{lemma} 
\begin{lemma} \label{lemma-weakly-etale-residue-field-extensions} Let $A \to B$ be a ring map. If $A \to B$ is weakly \'etale, then $A \to B$ induces separable algebraic residue field extensions. \end{lemma} 
\begin{lemma} \label{lemma-weak-dimension-at-most-1} Let $A$ be a ring. The following are equivalent \begin{enumerate} \item $A$ has weak dimension $\leq 1$, \item every ideal of $A$ is flat, \item every finitely generated ideal of $A$ is flat, \item every submodule of a flat $A$-module is flat, and \item every local ring of $A$ is a valuation ring. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-product-weak-dimension-at-most-1} Let $J$ be a set. For each $j \in J$ let $A_j$ be a valuation ring with fraction field $K_j$. Set $A = \prod A_j$ and $K = \prod K_j$. Then $A$ has weak dimension at most $1$ and $A \to K$ is a localization. \end{lemma} 
\begin{lemma} \label{lemma-product-found-valuation-rings} Let $A$ be a normal domain with fraction field $K$. There exists a cartesian diagram $$ \xymatrix{ A \ar[d] \ar[r] & K \ar[d] \\ V \ar[r] & L } $$ of rings where $V$ has weak dimension at most $1$ and $V \to L$ is a flat, injective, epimorphism of rings. \end{lemma} 
\begin{lemma} \label{lemma-weak-dimension-at-most-1-integrally-closed} Let $A$ be a ring of weak dimension at most $1$. If $A \to B$ is a flat, injective, epimorphism of rings, then $A$ is integrally closed in $B$. \end{lemma} 
\begin{lemma} \label{lemma-normality-goes-up} Let $A$ be a normal domain with fraction field $K$. Let $A \to B$ be weakly \'etale. Then $B$ is integrally closed in $B \otimes_A K$. \end{lemma} 
\begin{lemma} \label{lemma-integral-over-henselian} Let $A \to B$ be a ring homomorphism. Assume \begin{enumerate} \item $A$ is a henselian local ring, \item $A \to B$ is integral, \item $B$ is a domain. \end{enumerate} Then $B$ is a henselian local ring and $A \to B$ is a local homomorphism. If $A$ is strictly henselian, then $B$ is a strictly henselian local ring and the extension $\kappa(\mathfrak m_B)/\kappa(\mathfrak m_A)$ of residue fields is purely inseparable. \end{lemma} 
\begin{theorem}[Olivier] \label{theorem-olivier} Let $A \to B$ be a local homomorphism of local rings. If $A$ is strictly henselian and $A \to B$ is weakly \'etale, then $A = B$. \end{theorem} 
\begin{lemma} \label{lemma-class-weakly-etale-over-field} Let $K$ be a field. If $B$ is weakly \'etale over $K$, then \begin{enumerate} \item $B$ is reduced, \item $B$ is integral over $K$, \item any finitely generated $K$-subalgebra of $B$ is a finite product of finite separable extensions of $K$, \item $B$ is a field if and only if $B$ does not have nontrivial idempotents and in this case it is a separable algebraic extension of $K$, \item any sub or quotient $K$-algebra of $B$ is weakly \'etale over $K$, \item if $B'$ is weakly \'etale over $K$, then $B \otimes_K B'$ is weakly \'etale over $K$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-max-weakly-etale-subalgebra} Let $K$ be a field. Let $A$ be a $K$-algebra. There exists a maximal weakly \'etale $K$-subalgebra $B_{max} \subset A$. \end{lemma} 
\begin{lemma} \label{lemma-properties-of-max-weakly-etale-subalgebra} Let $K$ be a field. For a $K$-algebra $A$ denote $B_{max}(A)$ the maximal weakly \'etale $K$-subalgebra of $A$ as in Lemma \ref{lemma-max-weakly-etale-subalgebra}. Then \begin{enumerate} \item any $K$-algebra map $A' \to A$ induces a $K$-algebra map $B_{max}(A') \to B_{max}(A)$, \item if $A' \subset A$, then $B_{max}(A') = B_{max}(A) \cap A'$, \item if $A = \colim A_i$ is a filtered colimit, then $B_{max}(A) = \colim B_{max}(A_i)$, \item the map $B_{max}(A) \to B_{max}(A_{red})$ is an isomorphism, \item $B_{max}(A_1 \times \ldots \times A_n) = B_{max}(A_1) \times \ldots \times B_{max}(A_n)$, \item if $A$ has no nontrivial idempotents, then $B_{max}(A)$ is a field and a separable algebraic extension of $K$, \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-change-fields-max-weakly-etale-subalgebra} Let $L/K$ be an extension of fields. Let $A$ be a $K$-algebra. Let $B \subset A$ be the maximal weakly \'etale $K$-subalgebra of $A$ as in Lemma \ref{lemma-max-weakly-etale-subalgebra}. Then $B \otimes_K L$ is the maximal weakly \'etale $L$-subalgebra of $A \otimes_K L$. \end{lemma} 
\begin{definition} \label{definition-unibranch} \begin{reference} \cite[Chapter 0 (23.2.1)]{EGA4} \end{reference} Let $A$ be a local ring. We say $A$ is {\it unibranch} if the reduction $A_{red}$ is a domain and if the integral closure $A'$ of $A_{red}$ in its field of fractions is local. We say $A$ is {\it geometrically unibranch} if $A$ is unibranch and moreover the residue field of $A'$ is purely inseparable over the residue field of $A$. \end{definition} 
\begin{lemma} \label{lemma-branches} Let $A$ be a local ring. Assume $A$ has finitely many minimal prime ideals. Let $A'$ be the integral closure of $A$ in the total ring of fractions of $A_{red}$. Let $A^h$ be the henselization of $A$. Consider the maps $$ \Spec(A') \leftarrow \Spec((A')^h) \rightarrow \Spec(A^h) $$ where $(A')^h = A' \otimes_A A^h$. Then \begin{enumerate} \item the left arrow is bijective on maximal ideals, \item the right arrow is bijective on minimal primes, \item every minimal prime of $(A')^h$ is contained in a unique maximal ideal and every maximal ideal contains exactly one minimal prime. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-unibranch} \begin{reference} \cite[Chapter IV Proposition 18.6.12]{EGA4} \end{reference} Let $A$ be a local ring. Let $A^h$ be the henselization of $A$. The following are equivalent \begin{enumerate} \item $A$ is unibranch, and \item $A^h$ has a unique minimal prime. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-geometric-branches} Let $(A, \mathfrak m, \kappa)$ be a local ring. Assume $A$ has finitely many minimal prime ideals. Let $A'$ be the integral closure of $A$ in the total ring of fractions of $A_{red}$. Choose an algebraic closure $\overline{\kappa}$ of $\kappa$ and denote $\kappa^{sep} \subset \overline{\kappa}$ the separable algebraic closure of $\kappa$. Let $A^{sh}$ be the strict henselization of $A$ with respect to $\kappa^{sep}$. Consider the maps $$ \Spec(A') \xleftarrow{c} \Spec((A')^{sh}) \xrightarrow{e} \Spec(A^{sh}) $$ where $(A')^{sh} = A' \otimes_A A^{sh}$. Then \begin{enumerate} \item for $\mathfrak m' \subset A'$ maximal the residue field $\kappa'$ is algebraic over $\kappa$ and the fibre of $c$ over $\mathfrak m'$ can be canonically identified with $\Hom_\kappa(\kappa', \overline{\kappa})$, \item the right arrow is bijective on minimal primes, \item every minimal prime of $(A')^{sh}$ is contained in a unique maximal ideal and every maximal ideal contains a unique minimal prime. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-geometrically-unibranch} \begin{reference} \cite[Lemma 2.2]{Etale-coverings} and \cite[Chapter IV Proposition 18.8.15]{EGA4} \end{reference} Let $A$ be a local ring. Let $A^{sh}$ be a strict henselization of $A$. The following are equivalent \begin{enumerate} \item $A$ is geometrically unibranch, and \item $A^{sh}$ has a unique minimal prime. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-number-of-branches} Let $A$ be a local ring with henselization $A^h$ and strict henselization $A^{sh}$. The {\it number of branches of $A$} is the number of minimal primes of $A^h$ if finite and $\infty$ otherwise. The {\it number of geometric branches of $A$} is the number of minimal primes of $A^{sh}$ if finite and $\infty$ otherwise. \end{definition} 
\begin{lemma} \label{lemma-number-of-branches-1} Let $(A, \mathfrak m, \kappa)$ be a local ring. \begin{enumerate} \item If $A$ has infinitely many minimal prime ideals, then the number of (geometric) branches of $A$ is $\infty$. \item The number of branches of $A$ is $1$ if and only if $A$ is unibranch. \item The number of geometric branches of $A$ is $1$ if and only if $A$ is geometrically unibranch. \end{enumerate} Assume $A$ has finitely many minimal primes and let $A'$ be the integral closure of $A$ in the total ring of fractions of $A_{red}$. Then \begin{enumerate} \item[(4)] the number of branches of $A$ is the number of maximal ideals $\mathfrak m'$ of $A'$, \item[(5)] to get the number of geometric branches of $A$ we have to count each maximal ideal $\mathfrak m'$ of $A'$ with multiplicity given by the separable degree of $\kappa(\mathfrak m')/\kappa$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-invariance-number-branches-smooth} Let $A \to B$ be a local homomorphism of local rings which is the localization of a smooth ring map. \begin{enumerate} \item The number of geometric branches of $A$ is equal to the number of geometric branches of $B$. \item If $A \to B$ induces a purely inseparable extension of residue fields, then the number of branches of $A$ is the number of branches of $B$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ideal-inverse-nonzero} Let $A$ and $B$ be domains and let $A \to B$ be a ring map. Assume $A \to B$ has additionally at least one of the following properties \begin{enumerate} \item it is the localization of an \'etale ring map, \item it is flat and the localization of an unramified ring map, \item it is flat and the localization of a quasi-finite ring map, \item it is flat and the localization of an integral ring map, \item it is flat and there are no nontrivial specializations between points of fibres of $\Spec(B) \to \Spec(A)$, \item $\Spec(B) \to \Spec(A)$ maps the generic point to the generic point and there are no nontrivial specializations between points of fibres, or \item exactly one point of $\Spec(B)$ is mapped to the generic point of $\Spec(A)$. \end{enumerate} Then $A \cap J$ is nonzero for every nonzero ideal $J$ of $B$. \end{lemma} 
\begin{lemma} \label{lemma-local-unramified-extension-unibranch-domain-is-etale} Let $A \to B$ be a ring map. Let $\mathfrak q \subset B$ be a prime ideal lying over the prime $\mathfrak p \subset A$. Assume \begin{enumerate} \item $A$ is a domain, \item $A_\mathfrak p$ is geometrically unibranch, \item $A \to B$ is unramified at $\mathfrak q$, and \item $A_\mathfrak p \to B_\mathfrak q$ is injective. \end{enumerate} Then there exists a $g \in B$, $g \not \in \mathfrak q$ such that $B_g$ is \'etale over $A$. \end{lemma} 
\begin{lemma} \label{lemma-unramified-extension-unibranch-domain-is-etale} \begin{reference} Generalization of \cite[Expose I, Theorem 9.5 part (ii)]{SGA1} \end{reference} Let $(A, \mathfrak m)$ be a geometrically unibranch local domain. Let $A \to B$ be an injective local homomorphism of local rings, which is essentially of finite type. If $\mathfrak m B$ is the maximal ideal of $B$ and the induced extension of residue fields is separable, then $A \to B$ is the localization of an \'etale ring map. \end{lemma} 
\begin{lemma} \label{lemma-minimal-primes-tensor-strictly-henselian} Let $k$ be an algebraically closed field. Let $A$, $B$ be strictly henselian local $k$-algebras with residue field equal to $k$. Let $C$ be the strict henselization of $A \otimes_k B$ at the maximal ideal $\mathfrak m_A \otimes_k B + A \otimes_k \mathfrak m_B$. Then the minimal primes of $C$ correspond $1$-to-$1$ to pairs of minimal primes of $A$ and $B$. \end{lemma} 
\begin{lemma} \label{lemma-nr-branches-completion} Let $(A, \mathfrak m)$ be a Noetherian local ring. \begin{enumerate} \item The map $A^h \to A^\wedge$ defines a surjective map from minimal primes of $A^\wedge$ to minimal primes of $A^h$. \item The number of branches of $A$ is at most the number of branches of $A^\wedge$. \item The number of geometric branches of $A$ is at most the number of geometric branches of $A^\wedge$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-equal-nr-branches-completion} Let $(A, \mathfrak m)$ be a Noetherian local ring. The number of branches of $A$ is the same as the number of branches of $A^\wedge$ if and only if $\sqrt{\mathfrak qA^\wedge}$ is prime for every minimal prime $\mathfrak q \subset A^h$ of the henselization. \end{lemma} 
\begin{lemma} \label{lemma-glueing-sum-components-open} Let $A$ be a ring and let $I$ be a finitely generated ideal. Let $A \to C$ be a ring map such that for all $f \in I$ the ring map $A_f \to C_f$ is localization at an idempotent. Then there exists a surjection $A \to C'$ such that $A_f \to (C \times C')_f$ is an isomorphism for all $f \in I$. \end{lemma} 
\begin{lemma} \label{lemma-quotient-by-idempotent} Let $A$ be a Noetherian ring and $I$ an ideal. Let $B$ be a finite type $A$-algebra. Let $B^\wedge \to C$ be a surjective ring map with kernel $J$ where $B^\wedge$ is the $I$-adic completion. If $J/J^2$ is annihilated by $I^c$ for some $c \geq 0$, then $C$ is isomorphic to the completion of a finite type $A$-algebra. \end{lemma} 
\begin{lemma} \label{lemma-one-dimensional-formal-branch} Let $(A, \mathfrak m)$ be a Noetherian local ring with henselization $A^h$. Let $\mathfrak q \subset A^\wedge$ be a minimal prime with $\dim(A^\wedge/\mathfrak q) = 1$. Then there exists a minimal prime $\mathfrak q^h$ of $A^h$ such that $\mathfrak q = \sqrt{\mathfrak q^hA^\wedge}$. \end{lemma} 
\begin{lemma} \label{lemma-completion-disconnected} Let $(A, \mathfrak m)$ be a Noetherian local ring. The punctured spectrum of $A^\wedge$ is disconnected if and only if the punctured spectrum of $A^h$ is disconnected. \end{lemma} 
\begin{lemma} \label{lemma-one-dimensional-number-of-branches} Let $(A, \mathfrak m)$ be a Noetherian local ring of dimension $1$. Then the number of (geometric) branches of $A$ and $A^\wedge$ is the same. \end{lemma} 
\begin{lemma} \label{lemma-geometrically-normal-formal-fibres-number-of-branches} \begin{reference} \cite[Theorem 2.3]{Beddani} \end{reference} Let $(A, \mathfrak m)$ be a Noetherian local ring. If the formal fibres of $A$ are geometrically normal (for example if $A$ is excellent or quasi-excellent), then $A$ is Nagata and the number of (geometric) branches of $A$ and $A^\wedge$ is the same. \end{lemma} 
\begin{definition} \label{definition-formally-catenary} A Noetherian local ring $A$ is {\it formally catenary} if for every minimal prime $\mathfrak p \subset A$ the spectrum of $A^\wedge/\mathfrak p A^\wedge$ is equidimensional. \end{definition} 
\begin{lemma} \label{lemma-not-formally-catenary} Let $(A, \mathfrak m)$ be a Noetherian local ring which is not formally catenary. Then $A$ is not universally catenary. \end{lemma} 
\begin{lemma} \label{lemma-flat-under-catenary-equidimensional} Let $A \to B$ be a flat local ring map of local Noetherian rings. Assume $B$ is catenary and is $\Spec(B)$ equidimensional. Then \begin{enumerate} \item $\Spec(B/\mathfrak p B)$ is equidimensional for all $\mathfrak p \subset A$ and \item $A$ is catenary and $\Spec(A)$ is equidimensional. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-formally-catenary} Let $A$ be a formally catenary Noetherian local ring. Then $A$ is universally catenary. \end{lemma} 
\begin{proposition}[Ratliff] \label{proposition-ratliff} \begin{reference} \cite{Ratliff} \end{reference} A Noetherian local ring is universally catenary if and only if it is formally catenary. \end{proposition} 
\begin{lemma} \label{lemma-geometrically-normal-fibres-universally-catenary} \begin{reference} \cite[Corollary 2.3]{Heinzer-Rotthaus-Wiegand} \end{reference} Let $(A, \mathfrak m)$ be a Noetherian local ring with geometrically normal formal fibres. Then \begin{enumerate} \item $A^h$ is universally catenary, and \item if $A$ is unibranch (for example normal), then $A$ is universally catenary. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pol-lifting} Let $\varphi : A \to B$ be a surjection of rings. Let $G$ be a finite group of order $n$ acting on $\varphi : A \to B$. If $b \in B^G$, then there exists a monic polynomial $P \in A^G[T]$ which maps to $(T - b)^n$ in $B^G[T]$. \end{lemma} 
\begin{lemma} \label{lemma-invariants-modulo} Let $R$ be a ring. Let $G$ be a finite group acting on $R$. Let $I \subset R$ be an ideal such that $\sigma(I) \subset I$ for all $\sigma \in G$. Then $R^G/I^G \subset (R/I)^G$ is an integral extension of rings which induces a homeomorphism on spectra and purely inseparable extensions of residue fields. \end{lemma} 
\begin{lemma} \label{lemma-pol-in-ideal} Let $G$ be a finite group of order $n$ acting on a ring $R$. Let $J \subset R^G$ be an ideal. For $x \in JR$ we have $\prod_{\sigma \in G} (T - \sigma(x)) = T^n + a_1 T^{n - 1} + \ldots + a_n$ with $a_i \in J$. \end{lemma} 
\begin{lemma} \label{lemma-invariants-modulo-bis} Let $R$ be a ring. Let $G$ be a finite group of order $n$ acting on $R$. Let $J \subset R^G$ be an ideal. Then $R^G/J \to (R/JR)^G$ is ring map such that \begin{enumerate} \item for $b \in (R/JR)^G$ there is a monic polynomial $P \in R^G/J[T]$ whose image in $(R/JR)^G[T]$ is $(T - b)^n$, \item for $a \in \Ker(R^G/J \to (R/JR)^G)$ we have $(T - a)^n = T^n$ in $R^G/J[T]$. \end{enumerate} In particular, $R^G/J \to (R/JR)^G$ is an integral ring map which induces homeomorphisms on spectra and purely inseparable extensions of residue fields. \end{lemma} 
\begin{lemma} \label{lemma-functor-invariants-tensor} Let $R$ be a ring. Let $G$ be a finite group of order $n$ acting on $R$. Let $A$ be an $R^G$-algebra. \begin{enumerate} \item for $b \in (A \otimes_{R^G} R)^G$ there exists a monic polynomial $P \in A[T]$ whose image in $(A \otimes_{R^G} R)^G[T]$ is $(T - b)^n$, \item for $a \in \Ker(A \to (A \otimes_{R^G} R)^G)$ we have $(T - a)^n = T^n$ in $A[T]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-base-change-invariants} Let $R$ be a ring. Let $G$ be a finite group acting on $R$. Let $R^G \to A$ be a ring map. The map $$ A \to (A \otimes_{R^G} R)^G $$ is an isomorphism if $R^G \to A$ is flat. In general the map is integral, induces a homeomorphism on spectra, and induces purely inseparable residue field extensions. \end{lemma} 
\begin{lemma} \label{lemma-one-orbit} Let $G$ be a finite group acting on a ring $R$. For any two primes $\mathfrak q, \mathfrak q' \subset R$ lying over the same prime in $R^G$ there exists a $\sigma \in G$ with $\sigma(\mathfrak q) = \mathfrak q'$. \end{lemma} 
\begin{lemma} \label{lemma-one-orbit-geometric} Let $G$ be a finite group acting on a ring $R$. Let $\mathfrak q \subset R$ be a prime lying over $\mathfrak p \subset R^G$. Then $\kappa(\mathfrak q)/\kappa(\mathfrak p)$ is an algebraic normal extension and the map $$ D = \{\sigma \in G \mid \sigma(\mathfrak q) = \mathfrak q\} \longrightarrow \text{Aut}(\kappa(\mathfrak q)/\kappa(\mathfrak p)) $$ is surjective\footnote{Recall that we use the notation $\text{Gal}$ only in the case of Galois extensions.}. \end{lemma} 
\begin{lemma} \label{lemma-one-orbit-geometric-galois} Let $A$ be a normal domain with fraction field $K$. Let $L/K$ be a (possibly infinite) Galois extension. Let $G = \text{Gal}(L/K)$ and let $B$ be the integral closure of $A$ in $L$. \begin{enumerate} \item For any two primes $\mathfrak q, \mathfrak q' \subset B$ lying over the same prime in $A$ there exists a $\sigma \in G$ with $\sigma(\mathfrak q) = \mathfrak q'$. \item Let $\mathfrak q \subset B$ be a prime lying over $\mathfrak p \subset A$. Then $\kappa(\mathfrak q)/\kappa(\mathfrak p)$ is an algebraic normal extension and the map $$ D = \{\sigma \in G \mid \sigma(\mathfrak q) = \mathfrak q\} \longrightarrow \text{Aut}(\kappa(\mathfrak q)/\kappa(\mathfrak p)) $$ is surjective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-one-orbit-geometric-galois-compare} Let $A$ be a normal domain with fraction field $K$. Let $M/L/K$ be a tower of (possibly infinite) Galois extensions of $K$. Let $H = \text{Gal}(M/K)$ and $G = \text{Gal}(L/K)$ and let $C$ and $B$ be the integral closure of $A$ in $M$ and $L$. Let $\mathfrak r \subset C$ and $\mathfrak q = B \cap \mathfrak r$. Set $D_\mathfrak r = \{\tau \in H \mid \tau(\mathfrak r) = \mathfrak r\}$ and $I_\mathfrak r = \{\tau \in D_\mathfrak r \mid \tau \bmod \mathfrak r = \text{id}_{\kappa(\mathfrak r)}\}$ and similarly for $D_\mathfrak q$ and $I_\mathfrak q$. Under the map $H \to G$ the induced maps $D_\mathfrak r \to D_\mathfrak q$ and $I_\mathfrak r \to I_\mathfrak q$ are surjective. \end{lemma} 
\begin{definition} \label{definition-extension-discrete-valuation-rings} We say that $A \to B$ or $A \subset B$ is an {\it extension of discrete valuation rings} if $A$ and $B$ are discrete valuation rings and $A \to B$ is injective and local. In particular, if $\pi_A$ and $\pi_B$ are uniformizers of $A$ and $B$, then $\pi_A = u \pi_B^e$ for some $e \geq 1$ and unit $u$ of $B$. The integer $e$ does not depend on the choice of the uniformizers as it is also the unique integer $\geq 1$ such that $$ \mathfrak m_A B = \mathfrak m_B^e $$ The integer $e$ is called the {\it ramification index} of $B$ over $A$. We say that $B$ is {\it weakly unramified} over $A$ if $e = 1$. If the extension of residue fields $\kappa_A = A/\mathfrak m_A \subset \kappa_B = B/\mathfrak m_B$ is finite, then we set $f = [\kappa_B : \kappa_A]$ and we call it the {\it residual degree} or {\it residue degree} of the extension $A \subset B$. \end{definition} 
\begin{lemma} \label{lemma-inequality} Let $A \subset B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. If the extension $L/K$ is finite, then the residue field extension is finite and we have $ef \leq [L : K]$. \end{lemma} 
\begin{lemma} \label{lemma-multiplicative-e-f} Let $A \subset B \subset C$ be extensions of discrete valuation rings. Then the ramification indices of $B/A$ and $C/B$ multiply to give the ramification index of $C/A$. In a formula $e_{C/A} = e_{B/A} e_{C/B}$. Similarly for the residual degrees in case they are finite. \end{lemma} 
\begin{lemma} \label{lemma-ramification-index-a-power-of-p} Let $A \subset B$ be an extension of discrete valuation rings inducing the field extension $K \subset L$. If the characteristic of $K$ is $p > 0$ and $L$ is purely inseparable over $K$, then the ramification index $e$ is a power of $p$. \end{lemma} 
\begin{lemma} \label{lemma-extension-dvrs-formally-smooth} Let $A \subset B$ be an extension of discrete valuation rings. The following are equivalent \begin{enumerate} \item $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology, and \item $A \to B$ is weakly unramified and $\kappa_B/\kappa_A$ is a separable field extension. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-types-of-extensions} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite separable extension. With $B$ and $\mathfrak m_i$, $i = 1, \ldots, n$ as in Remark \ref{remark-finite-separable-extension} we say the extension $L/K$ is \begin{enumerate} \item {\it unramified with respect to $A$} if $e_i = 1$ and the extension $\kappa(\mathfrak m_i)/\kappa_A$ is separable for all $i$, \item {\it tamely ramified with respect to $A$} if either the characteristic of $\kappa_A$ is $0$ or the characteristic of $\kappa_A$ is $p > 0$, the field extensions $\kappa(\mathfrak m_i)/\kappa_A$ are separable, and the ramification indices $e_i$ are prime to $p$, and \item {\it totally ramified with respect to $A$} if $n = 1$ and the residue field extension $\kappa(\mathfrak m_1)/\kappa_A$ is trivial. \end{enumerate} If the discrete valuation ring $A$ is clear from context, then we sometimes say $L/K$ is unramified, totally ramified, or tamely ramified for short. \end{definition} 
\begin{lemma} \label{lemma-permanence-unramified} Let $A$ be a discrete valuation ring with fraction field $K$. \begin{enumerate} \item If $M/L/K$ are finite separable extensions and $M$ is unramified with respect to $A$, then $L$ is unramified with respect to $A$. \item If $L/K$ is a finite separable extension which is unramified with respect to $A$, then there exists a Galois extension $M/K$ containing $L$ which is unramified with respect to $A$. \item If $L_1/K$, $L_2/K$ are finite separable extensions which are unramified with respect to $A$, then there exists a a finite separable extension $L/K$ which is unramified with respect to $A$ containing $L_1$ and $L_2$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-composition-unramified} Let $A$ be a discrete valuation ring with fraction field $K$. Let $M/L/K$ be finite separable extensions. Let $B$ be the integral closure of $A$ in $L$. If $L/K$ is unramified with respect to $A$ and $M/L$ is unramified with respect to $B_\mathfrak m$ for every maximal ideal $\mathfrak m$ of $B$, then $M/K$ is unramified with respect to $A$. \end{lemma} 
\begin{lemma} \label{lemma-galois} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite Galois extension with Galois group $G$. Then $G$ acts on the ring $B$ of Remark \ref{remark-finite-separable-extension} and acts transitively on the set of maximal ideals of $B$. \end{lemma} 
\begin{lemma} \label{lemma-galois-conclusion} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite Galois extension. Then there are $e \geq 1$ and $f \geq 1$ such that $e_i = e$ and $f_i = f$ for all $i$ (notation as in Remark \ref{remark-finite-separable-extension}). In particular $[L : K] = n e f$. \end{lemma} 
\begin{definition} \label{definition-decomposition-inertia} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite Galois extension with Galois group $G$. Let $B$ be the integral closure of $A$ in $L$. Let $\mathfrak m \subset B$ be a maximal ideal. \begin{enumerate} \item The {\it decomposition group of $\mathfrak m$} is the subgroup $D = \{\sigma \in G \mid \sigma(\mathfrak m) = \mathfrak m\}$. \item The {\it inertia group of $\mathfrak m$} is the kernel $I$ of the map $D \to \text{Aut}(\kappa(\mathfrak m)/\kappa_A)$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-galois-galois} Let $A$ be a discrete valuation ring with fraction field $K$ and residue field $\kappa$. Let $L/K$ be a finite Galois extension with Galois group $G$. Let $B$ be the integral closure of $A$ in $L$. Let $\mathfrak m$ be a maximal ideal of $B$. Then \begin{enumerate} \item the field extension $\kappa(\mathfrak m)/\kappa$ is normal, and \item $D \to \text{Aut}(\kappa(\mathfrak m)/\kappa)$ is surjective. \end{enumerate} If for some (equivalently all) maximal ideal(s) $\mathfrak m \subset B$ the field extension $\kappa(\mathfrak m)/\kappa$ is separable, then \begin{enumerate} \item[(3)] $\kappa(\mathfrak m)/\kappa$ is Galois, and \item[(4)] $D \to \text{Gal}(\kappa(\mathfrak m)/\kappa)$ is surjective. \end{enumerate} Here $D \subset G$ is the decomposition group of $\mathfrak m$. \end{lemma} 
\begin{lemma} \label{lemma-galois-inertia} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite Galois extension with Galois group $G$. Let $B$ be the integral closure of $A$ in $L$. Let $\mathfrak m \subset B$ be a maximal ideal. The inertia group $I$ of $\mathfrak m$ sits in a canonical exact sequence $$ 1 \to P \to I \to I_t \to 1 $$ such that \begin{enumerate} \item $P = \{\sigma \in D \mid \sigma|_{B/\mathfrak m^2} = \text{id}_{B/\mathfrak m^2}\}$ where $D$ is the decomposition group, \item $P$ is a normal subgroup of $D$, \item $P$ is a $p$-group if the characteristic of $\kappa_A$ is $p > 0$ and $P = \{1\}$ if the characteristic of $\kappa_A$ is zero, \item $I_t$ is cyclic of order the prime to $p$ part of the integer $e$, and \item there is a canonical isomorphism $\theta : I_t \to \mu_e(\kappa(\mathfrak m))$. \end{enumerate} Here $e$ is the integer of Lemma \ref{lemma-galois-conclusion}. \end{lemma} 
\begin{definition} \label{definition-wild-inertia} With assumptions and notation as in Lemma \ref{lemma-galois-inertia}. \begin{enumerate} \item The {\it wild inertia group of $\mathfrak m$} is the subgroup $P$. \item The {\it tame inertia group of $\mathfrak m$} is the quotient $I \to I_t$. \end{enumerate} We denote $\theta : I \to \mu_e(\kappa(\mathfrak m))$ the surjective map (\ref{equation-inertia-character}) whose kernel is $P$ and which induces the isomorphism $I_t \to \mu_e(\kappa(\mathfrak m))$. \end{definition} 
\begin{lemma} \label{lemma-inertia-character} With assumptions and notation as in Lemma \ref{lemma-galois-inertia}. The inertia character $\theta : I \to \mu_e(\kappa(\mathfrak m))$ satisfies the following property $$ \theta(\tau \sigma \tau^{-1}) = \tau(\theta(\sigma)) $$ for $\tau \in D$ and $\sigma \in I$. \end{lemma} 
\begin{lemma} \label{lemma-inertial-invariants-unramified} Let $A$ be a discrete valuation ring with fraction field $K$. Let $L/K$ be a finite Galois extension. Let $\mathfrak m \subset B$ be a maximal ideal of the integral closure of $A$ in $L$. Let $I \subset G$ be the inertia group of $\mathfrak m$. Then $B^I$ is the integral closure of $A$ in $L^I$ and $A \to (B^I)_{B^I \cap \mathfrak m}$ is \'etale. \end{lemma} 
\begin{lemma} \label{lemma-compare-inertia} Let $A$ be a discrete valuation ring with fraction field $K$. Let $M/L/K$ be a tower with $M/K$ and $L/K$ finite Galois. Let $C$, $B$ be the integral closure of $A$ in $M$, $L$. Let $\mathfrak m' \subset C$ be a maximal ideal and set $\mathfrak m = \mathfrak m' \cap B$. Let $$ P \subset I \subset D \subset \text{Gal}(L/K) \quad\text{and}\quad P' \subset I' \subset D' \subset \text{Gal}(M/K) $$ be the wild inertia, inertia, decomposition group of $\mathfrak m$ and $\mathfrak m'$. Then the canonical surjection $\text{Gal}(M/K) \to \text{Gal}(L/K)$ induces surjections $P' \to P$, $I' \to I$, and $D' \to D$. Moreover these fit into commutative diagrams $$ \vcenter{ \xymatrix{ D' \ar[r] \ar[d] & \text{Aut}(\kappa(\mathfrak m')/\kappa_A) \ar[d] \\ D \ar[r] & \text{Aut}(\kappa(\mathfrak m)/\kappa_A) } } \quad\text{and}\quad \vcenter{ \xymatrix{ I' \ar[r]_-{\theta'} \ar[d] & \mu_{e'}(\kappa(\mathfrak m')) \ar[d]^{(-)^{e'/e}} \\ I \ar[r]^-\theta & \mu_e(\kappa(\mathfrak m)) } } $$ where $e'$ and $e$ are the ramification indices of $A \to C_{\mathfrak m'}$ and $A \to B_\mathfrak m$. \end{lemma} 
\begin{lemma}[Krasner's lemma] \label{lemma-krasner} Let $A$ be a complete local domain of dimension $1$. Let $P(t) \in A[t]$ be a polynomial with coefficients in $A$. Let $\alpha \in A$ be a root of $P$ but not a root of the derivative $P' = \text{d}P/\text{d}t$. For every $c \geq 0$ there exists an integer $n$ such that for any $Q \in A[t]$ whose coefficients are in $\mathfrak m_A^n$ the polynomial $P + Q$ has a root $\beta \in A$ with $\beta - \alpha \in \mathfrak m_A^c$. \end{lemma} 
\begin{lemma} \label{lemma-approximate-separable-extension} Let $A$ be a discrete valuation ring with field of fractions $K$. Let $A^\wedge$ be the completion of $A$ with fraction field $K^\wedge$. If $M/K^\wedge$ is a finite separable extension, then there exists a finite separable extension $L/K$ such that $M = K^\wedge \otimes_K L$. \end{lemma} 
\begin{definition} \label{definition-mixed} Let $A$ be a discrete valuation ring. We say $A$ has {\it mixed characteristic} if the characteristic of the residue field of $A$ is $p > 0$ and the characteristic of the fraction field of $A$ is $0$. In this case we obtain an extension of discrete valuation rings $\mathbf{Z}_{(p)} \subset A$ and the {\it absolute ramification index} of $A$ is the ramification index of this extension. \end{definition} 
\begin{lemma} \label{lemma-pull-root-uniformizer} Let $A$ be a discrete valuation ring with uniformizer $\pi$. Let $n \geq 2$. Then $K_1 = K[\pi^{1/n}]$ is a degree $n$ extension of $K$ and the integral closure $A_1$ of $A$ in $K_1$ is the ring $A[\pi^{1/n}]$ which is a discrete valuation ring with ramification index $n$ over $A$. \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth-goes-up} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. Assume that $A \to B$ is formally smooth in the $\mathfrak m_B$-adic topology. Then for any finite extension $K_1/K$ we have $L_1 = L \otimes_K K_1$, $B_1 = B \otimes_A A_1$, and each extension $(A_1)_{\mathfrak m_i} \subset (B_1)_{\mathfrak m_{ij}}$ (see Remark \ref{remark-construction}) is formally smooth in the $\mathfrak m_{ij}$-adic topology. \end{lemma} 
\begin{lemma}[Abhyankar's lemma] \label{lemma-abhyankar} Let $A \subset B$ be an extension of discrete valuation rings. Assume that either the residue characteristic of $A$ is $0$ or it is $p$, the ramification index $e$ is prime to $p$, and $\kappa_B/\kappa_A$ is a separable field extension. Let $K_1/K$ be a finite extension. Using the notation of Remark \ref{remark-construction} assume $e$ divides the ramification index of $A \subset (A_1)_{\mathfrak m_i}$ for some $i$. Then $(A_1)_{\mathfrak m_i} \subset (B_1)_{\mathfrak m_{ij}}$ is formally smooth in the $\mathfrak m_{ij}$-adic topology for all $j = 1, \ldots, m_i$. \end{lemma} 
\begin{lemma} \label{lemma-composition-tame} Let $A$ be a discrete valuation ring with fraction field $K$. Let $M/L/K$ be finite separable extensions. Let $B$ be the integral closure of $A$ in $L$. If $L/K$ is tamely ramified with respect to $A$ and $M/L$ is tamely ramified with respect to $B_\mathfrak m$ for every maximal ideal $\mathfrak m$ of $B$, then $M/K$ is tamely ramified with respect to $A$. \end{lemma} 
\begin{lemma} \label{lemma-subextension-tame} Let $A$ be a discrete valuation ring with fraction field $K$. If $M/L/K$ are finite separable extensions and $M$ is tamely ramified with respect to $A$, then $L$ is tamely ramified with respect to $A$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-tame} Let $A$ be a discrete valuation ring with fraction field $K$. Let $\pi \in A$ be a uniformizer. Let $L/K$ be a finite separable extension. The following are equivalent \begin{enumerate} \item $L$ is tamely ramified with respect to $A$, \item there exists an $e \geq 1$ invertible in $\kappa_A$ and an extension $L'/K' = K[\pi^{1/e}]$ unramified with respect to $A' = A[\pi^{1/e}]$ such that $L$ is contained in $L'$, and \item there exists an $e_0 \geq 1$ invertible in $\kappa_A$ such that for every $d \geq 1$ invertible in $\kappa_A$ (2) holds with $e = de_0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-permanence-tame} Let $A$ be a discrete valuation ring with fraction field $K$. \begin{enumerate} \item If $L/K$ is a finite separable extension which is tamely ramified with respect to $A$, then there exists a Galois extension $M/K$ containing $L$ which is tamely ramified with respect to $A$. \item If $L_1/K$, $L_2/K$ are finite separable extensions which are tamely ramified with respect to $A$, then there exists a a finite separable extension $L/K$ which is tamely ramified with respect to $A$ containing $L_1$ and $L_2$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tame-goes-up} Let $A \subset B$ be an extension of discrete valuation rings. Denote $L/K$ the corresponding extension of fraction fields. Let $K'/K$ be a finite separable extension. Then $$ K' \otimes_K L = \prod L'_i $$ is a finite product of fields and the following is true \begin{enumerate} \item If $K'$ is unramified with respect to $A$, then each $L'_i$ is unramified with respect to $B$. \item If $K'$ is tamely ramified with respect to $A$, then each $L'_i$ is tamely ramified with respect to $B$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-solution} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. \begin{enumerate} \item We say a finite field extension $K_1/K$ is a {\it weak solution for $A \subset B$} if all the extensions $(A_1)_{\mathfrak m_i} \subset (B_1)_{\mathfrak m_{ij}}$ of Remark \ref{remark-construction} are weakly unramified. \item We say a finite field extension $K_1/K$ is a {\it solution for $A \subset B$} if each extension $(A_1)_{\mathfrak m_i} \subset (B_1)_{\mathfrak m_{ij}}$ of Remark \ref{remark-construction} is formally smooth in the $\mathfrak m_{ij}$-adic topology. \end{enumerate} We say a solution $K_1/K$ is a {\it separable solution} if $K_1/K$ is separable. \end{definition} 
\begin{lemma} \label{lemma-weakly-unramified-goes-up-along-totally-ramified} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. Assume that $A \to B$ is weakly unramified. Then for any finite separable extension $K_1/K$ totally ramified with respect to $A$ we have that $L_1 = L \otimes_K K_1$ is a field, $A_1$ and $B_1 = B \otimes_A A_1$ are discrete valuation rings, and the extension $A_1 \subset B_1$ (see Remark \ref{remark-construction}) is weakly unramified. \end{lemma} 
\begin{lemma} \label{lemma-solutions-go-down} Let $A \to B \to C$ be extensions of discrete valuation rings with fraction fields $K \subset L \subset M$. Let $K_1/K$ be a finite extension. \begin{enumerate} \item If $K_1$ is a (weak) solution for $A \to C$, then $K_1$ is a (weak) solution for $A \to B$. \item If $K_1$ is a (weak) solution for $A \to B$ and $L_1 = (L \otimes_K K_1)_{red}$ is a product of fields which are (weak) solutions for $B \to C$, then $K_1$ is a (weak) solution for $A \to C$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-solution-after-strict-henselization} Let $A \to B$ be an extension of discrete valuation rings. There exists a commutative diagram $$ \xymatrix{ B \ar[r] & B' \\ A \ar[r] \ar[u] & A' \ar[u] } $$ of extensions of discrete valuation rings such that \begin{enumerate} \item the extensions $K'/K$ and $L'/L$ of fraction fields are separable algebraic, \item the residue fields of $A'$ and $B'$ are separable algebraic closures of the residue fields of $A$ and $B$, and \item if a solution, weak solution, or separable solution exists for $A' \to B'$, then a solution, weak solution, or separable solution exists for $A \to B$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-galois-relative} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. Let $K_1/K$ be a normal extension. Say $G = \text{Aut}(K_1/K)$. Then $G$ acts on the rings $K_1$, $L_1$, $A_1$ and $B_1$ of Remark \ref{remark-construction} and acts transitively on the set of maximal ideals of $B_1$. \end{lemma} 
\begin{lemma} \label{lemma-make-degree-q-extension} Let $A$ be a discrete valuation ring with uniformizer $\pi$. If the residue characteristic of $A$ is $p > 0$, then for every $n > 1$ and $p$-power $q$ there exists a degree $q$ separable extension $L/K$ totally ramified with respect to $A$ such that the integral closure $B$ of $A$ in $L$ has ramification index $q$ and a uniformizer $\pi_B$ such that $\pi_B^q = \pi + \pi^n b$ and $\pi_B^q = \pi + (\pi_B)^{nq}b'$ for some $b, b' \in B$. \end{lemma} 
\begin{lemma} \label{lemma-pre-purely-inseparable-case} Let $A$ be a discrete valuation ring. Assume the reside field $\kappa_A$ has characteristic $p > 0$ and that $a \in A$ is an element whose residue class in $\kappa_A$ is not a $p$th power. Then $a$ is not a $p$th power in $K$ and the integral closure of $A$ in $K[a^{1/p}]$ is the ring $A[a^{1/p}]$ which is a discrete valuation ring weakly unramified over $A$. \end{lemma} 
\begin{lemma} \label{lemma-purely-inseparable-case} Let $A \subset B \subset C$ be extensions of discrete valuation rings with fractions fields $K \subset L \subset M$. Let $\pi \in A$ be a uniformizer. Assume \begin{enumerate} \item $B$ is a Nagata ring, \item $A \subset B$ is weakly unramified, \item $M$ is a degree $p$ purely inseparable extension of $L$. \end{enumerate} Then either \begin{enumerate} \item $A \to C$ is weakly unramified, or \item $C = B[\pi^{1/p}]$, or \item there exists a degree $p$ separable extension $K_1/K$ totally ramified with respect to $A$ such that $L_1 = L \otimes_K K_1$ and $M_1 = M \otimes_K K_1$ are fields and the maps of integral closures $A_1 \to B_1 \to C_1$ are weakly unramified extensions of discrete valuation rings. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cohen} Let $A$ be a local ring annihilated by a prime $p$ whose maximal ideal is nilpotent. There exists a ring map $\sigma : \kappa_A \to A$ which is a section to the residue map $A \to \kappa_A$. If $A \to A'$ is a local homomorphism of local rings, then we can choose a similar ring map $\sigma' : \kappa_{A'} \to A'$ compatible with $\sigma$ provided that the extension $\kappa_{A'}/\kappa_A$ is separable. \end{lemma} 
\begin{lemma} \label{lemma-pre-characteristic-p-case} Let $A$ be a discrete valuation ring with fraction field $K$ of characteristic $p > 0$. Let $\xi \in K$. Let $L$ be an extension of $K$ obtained by adjoining a root of $z^p - z = \xi$. Then $L/K$ is Galois and one of the following happens \begin{enumerate} \item $L = K$, \item $L/K$ is unramified with respect to $A$ of degree $p$, \item $L/K$ is totally ramified with respect to $A$ with ramification index $p$, and \item the integral closure $B$ of $A$ in $L$ is a discrete valuation ring, $A \subset B$ is weakly unramified, and $A \to B$ induces a purely inseparable residue field extension of degree $p$. \end{enumerate} Let $\pi$ be a uniformizer of $A$. We have the following implications: \begin{enumerate} \item[(A)] If $\xi \in A$, then we are in case (1) or (2). \item[(B)] If $\xi = \pi^{-n}a$ where $n > 0$ is not divisible by $p$ and $a$ is a unit in $A$, then we are in case (3) \item[(C)] If $\xi = \pi^{-n} a$ where $n > 0$ is divisible by $p$ and the image of $a$ in $\kappa_A$ is not a $p$th power, then we are in case (4). \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-characteristic-p-case} Let $A \subset B \subset C$ be extensions of discrete valuation rings with fractions fields $K \subset L \subset M$. Assume \begin{enumerate} \item $A \subset B$ weakly unramified, \item the characteristic of $K$ is $p$, \item $M$ is a degree $p$ Galois extension of $L$, and \item $\kappa_A = \bigcap_{n \geq 1} \kappa_B^{p^n}$. \end{enumerate} Then there exists a finite Galois extension $K_1/K$ totally ramified with respect to $A$ which is a weak solution for $A \to C$. \end{lemma} 
\begin{lemma} \label{lemma-prepare} Let $A$ be a ring which contains a primitive $p$th root of unity $\zeta$. Set $w = 1 - \zeta$. Then $$ P(z) = \frac{(1 + wz)^p - 1}{w^p} = z^p - z + \sum\nolimits_{0 < i < p} a_i z^i $$ is an element of $A[z]$ and in fact $a_i \in (w)$. Moreover, we have $$ P(z_1 + z_2 + w z_1 z_2) = P(z_1) + P(z_2) + w^p P(z_1) P(z_2) $$ in the polynomial ring $A[z_1, z_2]$. \end{lemma} 
\begin{lemma} \label{lemma-extension-defined-by-nice-polynial} Let $A$ be a discrete valuation ring of mixed characteristic $(0, p)$ which contains a primitive $p$th root of $1$. Let $P(t) \in A[t]$ be the polynomial of Lemma \ref{lemma-prepare}. Let $\xi \in K$. Let $L$ be an extension of $K$ obtained by adjoining a root of $P(z) = \xi$. Then $L/K$ is Galois and one of the following happens \begin{enumerate} \item $L = K$, \item $L/K$ is unramified with respect to $A$ of degree $p$, \item $L/K$ is totally ramified with respect to $A$ with ramification index $p$, and \item the integral closure $B$ of $A$ in $L$ is a discrete valuation ring, $A \subset B$ is weakly unramified, and $A \to B$ induces a purely inseparable residue field extension of degree $p$. \end{enumerate} Let $\pi$ be a uniformizer of $A$. We have the following implications: \begin{enumerate} \item[(A)] If $\xi \in A$, then we are in case (1) or (2). \item[(B)] If $\xi = \pi^{-n}a$ where $n > 0$ is not divisible by $p$ and $a$ is a unit in $A$, then we are in case (3) \item[(C)] If $\xi = \pi^{-n} a$ where $n > 0$ is divisible by $p$ and the image of $a$ in $\kappa_A$ is not a $p$th power, then we are in case (4). \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-make-finite-level} Let $A \subset B \subset C$ be extensions of discrete valuation rings with fractions fields $K \subset L \subset M$. Assume that \begin{enumerate} \item $A$ has mixed characteristic $(0, p)$, \item $A \subset B$ is weakly unramified, \item $B$ contains a primitive $p$th root of $1$, and \item $M/L$ is Galois of degree $p$. \end{enumerate} Then there exists a finite Galois extension $K_1/K$ totally ramified with respect to $A$ which is either a weak solution for $A \to C$ or is such that $M_1/L_1$ is a degree $p$ extension of finite level. \end{lemma} 
\begin{lemma} \label{lemma-lowering-the-level} Let $A \subset B \subset C$ be extensions of discrete valuation rings with fractions fields $K \subset L \subset M$. Assume \begin{enumerate} \item $A$ has mixed characteristic $(0, p)$, \item $A \subset B$ weakly unramified, \item $B$ contains a primitive $p$th root of $1$, \item $M/L$ is a degree $p$ extension of finite level $l > 0$, \item $\kappa_A = \bigcap_{n \geq 1} \kappa_B^{p^n}$. \end{enumerate} Then there exists a finite separable extension $K_1$ of $K$ totally ramified with respect to $A$ such that either $K_1$ is a weak solution for $A \to C$, or the extension $M_1/L_1$ is a degree $p$ extension of finite level $\leq \max(0, l - 1, 2l - p)$. \end{lemma} 
\begin{lemma} \label{lemma-special-case} Let $A \subset B \subset C$ be extensions of discrete valuation rings with fraction fields $K \subset L \subset M$. Assume \begin{enumerate} \item the residue field $k$ of $A$ is algebraically closed of characteristic $p > 0$, \item $A$ and $B$ are complete, \item $A \to B$ is weakly unramified, \item $M$ is a finite extension of $L$, \item $k = \bigcap\nolimits_{n \geq 1} \kappa_B^{p^n}$ \end{enumerate} Then there exists a finite extension $K_1/K$ which is a weak solution for $A \to C$. \end{lemma} 
\begin{theorem}[Epp] \label{theorem-epp} Let $A \subset B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. If the characteristic of $\kappa_A$ is $p > 0$, assume that every element of $$ \bigcap\nolimits_{n \geq 1} \kappa_B^{p^n} $$ is separable algebraic over $\kappa_A$. Then there exists a finite extension $K_1/K$ which is a weak solution for $A \to B$ as defined in Definition \ref{definition-solution}. \end{theorem} 
\begin{lemma} \label{lemma-solution-goes-up} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. If $K_1/K$ is a solution for $A \subset B$, then for any finite extension $K_2/K_1$ the extension $K_2/K$ is a solution for $A \subset B$. \end{lemma} 
\begin{lemma} \label{lemma-nagata-goes-down} Let $A \subset B$ be an extension of discrete valuation rings. If $B$ is Nagata and the extension $L/K$ of fraction fields is separable, then $A$ is Nagata. \end{lemma} 
\begin{lemma} \label{lemma-construct-extension} Let $A' \subset A$ be an extension of rings. Let $f \in A'$. Assume that (a) $A$ is finite over $A'$, (b) $f$ is a nonzerodivisor on $A$, and (c) $A'_f = A_f$. Then there exists an integer $n_0 > 0$ such that for all $n \geq n_0$ the following is true: given a ring $B'$, a nonzerodivisor $g \in B'$, and an isomorphism $\varphi' : A'/f^n A' \to B'/g^n B'$ with $\varphi'(f) \equiv g$, there is a finite extension $B' \subset B$ and an isomorphism $\varphi : A/fA \to B/gB$ compatible with $\varphi'$. \end{lemma} 
\begin{lemma} \label{lemma-approximate-solution} Let $p$ be a prime number. Let $A \subset B$ be an extension of discrete valuation rings with fraction field extension $L/K$. Let $K_2/K_1/K$ be a tower of finite field extensions. Assume \begin{enumerate} \item $K$ has characteristic $p$, \item $L/K$ is separable, \item $B$ is Nagata, \item $K_2$ is a solution for $A \subset B$, \item $K_2/K_1$ is purely inseparable of degree $p$. \end{enumerate} Then there exists a separable extension $K_3/K_1$ which is a solution for $A \subset B$. \end{lemma} 
\begin{lemma} \label{lemma-separable-solution-separable-solution} Let $A \subset B$ be an extension of discrete valuation rings. Assume \begin{enumerate} \item the extension $L/K$ of fraction fields is separable, \item $B$ is Nagata, and \item there exists a solution for $A \subset B$. \end{enumerate} Then there exists a separable solution for $A \subset B$. \end{lemma} 
\begin{lemma} \label{lemma-big-extension-is-ok} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. Assume $B$ is essentially of finite type over $A$. Let $K'/K$ be an algebraic extension of fields such that the integral closure $A'$ of $A$ in $K'$ is Noetherian. Then the integral closure $B'$ of $B$ in $L' = (L \otimes_K K')_{red}$ is Noetherian as well. Moreover, the map $\Spec(B') \to \Spec(A')$ is surjective and the corresponding residue field extensions are finitely generated field extensions. \end{lemma} 
\begin{proposition} \label{proposition-epp-essentially-finite-type} \begin{reference} See \cite[Lemma 2.13]{alterations} for a special case. \end{reference} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. If $B$ is essentially of finite type over $A$, then there exists a finite extension $K_1/K$ which is a solution for $A \to B$ as defined in Definition \ref{definition-solution}. \end{proposition} 
\begin{lemma} \label{lemma-epp-essentially-finite-type-separable} Let $A \to B$ be an extension of discrete valuation rings with fraction fields $K \subset L$. Assume \begin{enumerate} \item $B$ is essentially of finite type over $A$, \item either $A$ or $B$ is a Nagata ring, and \item $L/K$ is separable. \end{enumerate} Then there exists a separable solution for $A \to B$ (Definition \ref{definition-solution}). \end{lemma} 
\begin{definition} \label{definition-invertible} Let $R$ be a ring. An $R$-module $M$ is {\it invertible} if the functor $$ \text{Mod}_R \longrightarrow \text{Mod}_R,\quad N \longmapsto M \otimes_R N $$ is an equivalence of categories. An invertible $R$-module is said to be {\it trivial} if it is isomorphic to $R$ as an $R$-module. \end{definition} 
\begin{lemma} \label{lemma-invertible} Let $R$ be a ring. Let $M$ be an $R$-module. Equivalent are \begin{enumerate} \item $M$ is finite locally free module of rank $1$, \item $M$ is invertible, and \item there exists an $R$-module $N$ such that $M \otimes_R N \cong R$. \end{enumerate} Moreover, in this case the module $N$ in (3) is isomorphic to $\Hom_R(M, R)$. \end{lemma} 
\begin{lemma} \label{lemma-UFD-Pic-trivial} Let $R$ be a UFD. Then $\Pic(R)$ is trivial. \end{lemma} 
\begin{lemma} \label{lemma-det-ses} Let $R$ be a ring. Let $$ 0 \to M' \to M \to M'' \to 0 $$ be a short exact sequence of finite projective $R$-modules. Then there is a canonical isomorphism $$ \gamma : \det(M') \otimes \det(M'') \longrightarrow \det(M) $$ \end{lemma} 
\begin{lemma} \label{lemma-det-ses-functorial} Let $R$ be a ring. Let $$ \xymatrix{ 0 \ar[r] & M' \ar[r] \ar[d]^u & M \ar[r] \ar[d]^v & M'' \ar[r] \ar[d]^w & 0 \\ 0 \ar[r] & K' \ar[r] & K \ar[r] & K'' \ar[r] & 0 } $$ be a commutative diagram of finite projective $R$-modules whose vertical arrows are isomorphisms. Then we get a commutative diagram of isomorphisms $$ \xymatrix{ \det(M') \otimes \det(M'') \ar[r]_-\gamma \ar[d]_{\det(u) \otimes \det(w)} & \det(M) \ar[d]^{\det(v)} \\ \det(K') \otimes \det(K'') \ar[r]^-\gamma & \det(K) } $$ where the horizontal arrows are the ones constructed in Lemma \ref{lemma-det-ses}. \end{lemma} 
\begin{lemma} \label{lemma-det-filtration} Let $R$ be a ring. Let $$ K \subset L \subset M $$ be $R$-modules such that $K$, $L/K$, and $M/L$ are finite projective $R$-modules. Then the diagram $$ \xymatrix{ \det(K) \otimes \det(L/K) \otimes \det(M/L) \ar[r] \ar[d] & \det(L) \otimes \det(M/L) \ar[d] \\ \det(K) \otimes \det(M/K) \ar[r] & \det(M) } $$ commutes where the maps are those of Lemma \ref{lemma-det-ses}. \end{lemma} 
\begin{lemma} \label{lemma-det-direct-sum} Let $R$ be a ring. Let $M'$ and $M''$ be two finite projective $R$-modules. Then the diagram $$ \xymatrix{ \det(M') \otimes \det(M'') \ar[r] \ar[d]_{\epsilon \cdot (\text{switch tensors})} & \det(M' \oplus M'') \ar[d]^{\det(\text{switch summands})} \\ \det(M'') \otimes \det(M') \ar[r] & \det(M'' \oplus M') } $$ commutes where $\epsilon = \det( -\text{id}_{M' \otimes M''}) \in R^*$ and the horizontal arrows are those of Lemma \ref{lemma-det-ses}. \end{lemma} 
\begin{lemma} \label{lemma-det-switch} Let $R$ be a ring. Let $M$, $N$ be finite projective $R$-modules. Let $a : M \to N$ and $b : N \to M$ be $R$-linear maps. Then $$ \det(\text{id} + a \circ b) = \det(\text{id} + b \circ a) $$ as elements of $R$. \end{lemma} 
\begin{lemma} \label{lemma-det} Let $R$ be a ring. There is a map $$ \det : K_0(R) \longrightarrow \Pic(R) $$ which maps $[M]$ to the class of the invertible module $\wedge^n(M)$ if $M$ is a finite locally free module of rank $n$. \end{lemma} 
\begin{lemma} \label{lemma-perfect-to-K-group} Let $R$ be a ring. There is a map $$ c : \text{perfect complexes over }R \longrightarrow K_0(R) $$ with the following properties \begin{enumerate} \item $c(K[n]) = (-1)^nc(K)$ for a perfect complex $K$, \item if $K \to L \to M \to K[1]$ is a distinguished triangle of perfect complexes, then $c(L) = c(K) + c(M)$, \item if $K$ is represented by a finite complex $M^\bullet$ consisting of finite projective modules, then $c(K) = \sum (-1)^i[M_i]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-to-K-group-universal} Let $R$ be a ring. Let $D_{perf}(R)$ be the derived category of perfect objects, see Lemma \ref{lemma-perfect-ring-classical-generator}. The map $c$ of Lemma \ref{lemma-perfect-to-K-group} gives an isomorphism $K_0(D_{perf}(R)) = K_0(R)$. \end{lemma} 
\begin{lemma} \label{lemma-ses} Let $(R, \mathfrak m, \kappa)$ be a local ring. Let $0 \to (M, \varphi) \to (M', \varphi') \to (M'', \varphi'') \to 0$ be a short exact sequence in the category discussed above. Then $$ \det\nolimits_\kappa(\varphi') = \det\nolimits_\kappa(\varphi)\det\nolimits_\kappa(\varphi''),\quad \text{Trace}_\kappa(\varphi') = \text{Trace}_\kappa(\varphi) +  \text{Trace}_\kappa(\varphi'') $$ Also, the characteristic polynomial of $\varphi'$ over $\kappa$ is the product of the characteristic polynomials of $\varphi$ and $\varphi''$. \end{lemma} 
\begin{lemma} \label{lemma-multiplication} Let $(R, \mathfrak m, \kappa) \to (R', \mathfrak m', \kappa')$ be a local homomorphism of local rings. Assume that $\kappa'/\kappa$ is a finite extension. Let $u \in R'$. Then for any finite length $R'$-module $M'$ we have $$ \det\nolimits_\kappa(u : M' \to M') = \text{Norm}_{\kappa'/\kappa}(u \bmod \mathfrak m')^m $$ where $m = \text{length}_{R'}(M')$. \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-det} Let $(R, \mathfrak m, \kappa) \to (R', \mathfrak m', \kappa')$ be a flat local homomorphism of local rings such that $m = \text{length}_{R'}(R'/\mathfrak mR') < \infty$. For any $(M, \varphi)$ as above, the element $\det_\kappa(\varphi)^m$ maps to $\det_{\kappa'}(\varphi \otimes 1 : M \otimes_R R' \to M \otimes_R R')$ in $\kappa'$. \end{lemma} 
\begin{lemma} \label{lemma-regular-local-Pic-zero} Let $R$ be a regular local ring. Let $f \in R$. Then $\Pic(R_f) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-regular-local-UFD} A regular local ring is a UFD. \end{lemma} 
\begin{lemma} \label{lemma-picard-group-generic-fibre-regular} Let $R$ be a valuation ring with fraction field $K$ and residue field $\kappa$. Let $R \to A$ be a homomorphism of rings such that \begin{enumerate} \item $A$ is local and $R \to A$ is local, \item $A$ is flat and essentially of finite type over $R$, \item $A \otimes_R \kappa$ regular. \end{enumerate} Then $\Pic(A \otimes_R K) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-canonical-element-well-defined} Let $R$ be a ring. Let $a^\bullet : K^\bullet \to L^\bullet$ be a map of complexes of $R$-modules satisfying (1), (2), (3) above. If $L^\bullet$ has rank $0$, then $\det(a^\bullet)$ maps the canonical element $\delta(K^\bullet)$ to $\delta(L^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-homotopic-surjections} Let $R$ be a ring. Let $a^\bullet : K^\bullet \to L^\bullet$ be a map of complexes of $R$-modules satisfying (1), (2), (3) above. Let $h : K^0 \to L^{-1}$ be a map such that $b^0 = a^0 + d \circ h$ and $b^{-1} = a^{-1} + h \circ d$ are surjective. Then $\det(a^\bullet) = \det(b^\bullet)$ as maps $\det(K^\bullet) \to \det(L^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-compose-surjections} Let $R$ be a ring. Let $a^\bullet : K^\bullet \to L^\bullet$ and $b^\bullet : L^\bullet \to M^\bullet$ be maps of complexes of $R$-modules satisfying (1), (2), (3) above. Then we have $\det(b^\bullet) \circ \det(a^\bullet) =  \det(b^\bullet \circ a^\bullet)$ as maps $\det(M^\bullet) \to \det(K^\bullet)$. \end{lemma} 
\begin{lemma} \label{lemma-determinant-two-term-complexes} Let $R$ be a ring. The constructions above determine a functor $$ \det : \left\{ \begin{matrix} \text{category of perfect complexes} \\ \text{with tor amplitude in }[-1, 0] \\ \text{morphisms are isomorphisms} \end{matrix} \right\} \longrightarrow \left\{ \begin{matrix} \text{category of invertible modules} \\ \text{morphisms are isomorphisms} \end{matrix} \right\} $$ Moreover, given a rank $0$ perfect object $L$ of $D(R)$ with tor-amplitude in $[-1, 0]$ there is a canonical element $\delta(L) \in \det(L)$ such that for any isomorphism $a : L \to K$ in $D(R)$ we have $\det(a)(\delta(L)) = \delta(K)$. \end{lemma} 
\begin{definition} \label{definition-extension-valuation-rings} We say that $A \to B$ or $A \subset B$ is an {\it extension of valuation rings} if $A$ and $B$ are valuation rings and $A \to B$ is injective and local. Such an extension induces a commutative diagram $$ \xymatrix{ A \setminus \{0\} \ar[r] \ar[d]_v & B \setminus \{0\} \ar[d]^v \\ \Gamma_A \ar[r] & \Gamma_B } $$ where $\Gamma_A$ and $\Gamma_B$ are the value groups. We say that $B$ is {\it weakly unramified} over $A$ if the lower horizontal arrow is a bijection. If the extension of residue fields $\kappa_A = A/\mathfrak m_A \subset \kappa_B = B/\mathfrak m_B$ is finite, then we set $f = [\kappa_B : \kappa_A]$ and we call it the {\it residual degree} or {\it residue degree} of the extension $A \subset B$. \end{definition} 
\begin{lemma} \label{lemma-inequality-general} Let $A \subset B$ be an extension of valuation rings with fraction fields $K \subset L$. If the extension $L/K$ is finite, then the residue field extension is finite, the index of $\Gamma_A$ in $\Gamma_B$ is finite, and $$ [\Gamma_B : \Gamma_A] [\kappa_B : \kappa_A] \leq [L : K]. $$ \end{lemma} 
\begin{lemma} \label{lemma-valuation-ring-purely-inseparable} Let $A$ be a valuation ring with fraction field $K$ of characteristic $p > 0$. Let $L/K$ be a purely inseparable extension. Then the integral closure $B$ of $A$ in $L$ is a valuation ring with fraction field $L$ and $A \subset B$ is an extension of valuation rings. \end{lemma} 
\begin{lemma} \label{lemma-extension-normal-domains-and-roots} Let $A \to B$ be a flat local homomorphism of Noetherian local normal domains. Let $f \in A$ and $h \in B$ such that $f = w h^n$ for some $n > 1$ and some unit $w$ of $B$. Assume that for every height $1$ prime $\mathfrak p \subset A$ there is a height $1$ prime $\mathfrak q \subset B$ lying over $\mathfrak p$ such that the extension $A_\mathfrak p \subset B_\mathfrak q$ is weakly unramified. Then $f = u g^n$ for some $g \in A$ and unit $u$ of $A$. \end{lemma} 
\begin{lemma} \label{lemma-etale-extension-valuation-ring} Let $A$ be a valuation ring. Let $A \to B$ be an \'etale ring map and let $\mathfrak m \subset B$ be a prime lying over the maximal ideal of $A$. Then $A \subset B_\mathfrak m$ is an extension of valuation rings which is weakly unramified. \end{lemma} 
\begin{lemma} \label{lemma-henselization-valuation-ring} Let $A$ be a valuation ring. Let $A^h$, resp.\ $A^{sh}$ be its henselization, resp.\ strict henselization. Then $$ A \subset A^h \subset A^{sh} $$ are extensions of valuation rings which induce bijections on value groups, i.e., which are weakly unramified. \end{lemma} 
\begin{lemma} \label{lemma-characterize-PD-modules} \begin{reference} \cite[Corollary 1]{Warfield-Purity} \end{reference} Let $P$ be a module over a ring $R$. The following are equivalent \begin{enumerate} \item $P$ is a direct summand of a direct sum of modules of the form $R/fR$, for $f \in R$ varying. \item for every short exact sequence $0 \to A \to B \to C \to 0$ of $R$-modules such that $fA = A \cap fB$ for all $f \in R$ the map $\Hom_R(P, B) \to \Hom_R(P, C)$ is surjective. \end{enumerate} \end{lemma} 
\begin{lemma}[Generalized valuation rings] \label{lemma-generalized-valuation-ring} \begin{reference} \cite{Warfield-Decomposition} \end{reference} Let $R$ be a nonzero ring. The following are equivalent \begin{enumerate} \item For $a, b \in R$ either $a$ divides $b$ or $b$ divides $a$. \item Every finitely generated ideal is principal and $R$ is local. \item The set of ideals of $R$ is linearly ordered by inclusion. \end{enumerate} This holds in particular if $R$ is a valuation ring. \end{lemma} 
\begin{lemma} \label{lemma-generalized-valuation-ring-modules} \begin{reference} \cite[Theorem 1]{Warfield-Decomposition} \end{reference} Let $R$ be a ring satisfying the equivalent conditions of Lemma \ref{lemma-generalized-valuation-ring}. Then every finitely presented $R$-module is isomorphic to a finite direct sum of modules of the form $R/fR$. \end{lemma} 
\begin{lemma} \label{lemma-warfield} \begin{reference} \cite[Theorem 3]{Warfield-Decomposition} \end{reference} Let $R$ be a ring such that every local ring of $R$ at a maximal ideal satisfies the equivalent conditions of Lemma \ref{lemma-generalized-valuation-ring}. Then every finitely presented $R$-module is a summand of a  finite direct sum of modules of the form $R/fR$ for $f$ in $R$ varying. \end{lemma} 
\begin{definition} \label{definition-bezout} Let $R$ be a domain. \begin{enumerate} \item We say $R$ is a {\it B\'ezout domain} if every finitely generated ideal of $R$ is principal. \item We say $R$ is an {\it elementary divisor domain} if for all $n , m \geq 1$ and every $n \times m$ matrix $A$, there exist invertible matrices $U, V$ of size $n \times n, m \times m$ such that $$ U A V = \left( \begin{matrix} f_1 & 0 & 0 & \ldots \\ 0 & f_2 & 0 & \ldots \\ 0 & 0 & f_3 & \ldots \\ \ldots & \ldots & \ldots & \ldots \end{matrix} \right) $$ with $f_1, \ldots, f_{\min(n, m)} \in R$ and $f_1 | f_2 | \ldots$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-elementary-divisor-is-bezout} An elementary divisor domain is B\'ezout. \end{lemma} 
\begin{lemma} \label{lemma-localize-bezout} The localization of a B\'ezout domain is B\'ezout. Every local ring of a B\'ezout domain is a valuation ring. A local domain is B\'ezout if and only if it is a valuation ring. \end{lemma} 
\begin{lemma} \label{lemma-split-off-free-part} Let $R$ be a B\'ezout domain. \begin{enumerate} \item Every finite submodule of a free module is finite free. \item Every finitely presented $R$-module $M$ is a direct sum of a finite free module and a torsion module $M_{tors}$ which is a summand of a module of the form $\bigoplus_{i = 1, \ldots, n} R/f_iR$ with $f_1, \ldots, f_n \in R$ nonzero. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-modules-PID} Let $R$ be a PID. Every finite $R$-module $M$ is of isomorphic to a module of the form $$ R^{\oplus r} \oplus \bigoplus\nolimits_{i = 1, \ldots, n} R/f_iR $$ for some $r, n \geq 0$ and $f_1, \ldots, f_n \in R$ nonzero. \end{lemma} 
\begin{lemma} \label{lemma-unimodular-vector} Let $R$ be a B\'ezout domain. Let $n \geq 1$ and $f_1, \ldots, f_n \in R$ generate the unit ideal. There exists an invertible $n \times n$ matrix in $R$ whose first row is $f_1 \ldots f_n$. \end{lemma} 
\begin{lemma} \label{lemma-polypoly} Let $(R,\mathfrak m)$ be a Noetherian local ring of dimension one, and let $x\in\mathfrak m$ be an element not contained in any minimal prime of $R$. Then \begin{enumerate} \item the function $P : n \mapsto \text{length}_R(R/x^n R)$ satisfies $P(n) \leq n P(1)$ for $n \geq 0$, \item if $x$ is a nonzerodivisor, then $P(n) = nP(1)$ for $n \geq 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-minprimespoly} Let $(R, \mathfrak m)$ be a Noetherian local ring of dimension $1$. Let $x \in \mathfrak m$ be an element not contained in any minimal prime of $R$. Let $t$ be the number of minimal prime ideals of $R$. Then $t \leq \text{length}_R(R/xR)$. \end{lemma} 
\begin{lemma} \label{lemma-sopexists} Let $(R,\mathfrak m)$ be a Noetherian local ring of dimension $d > 1$, let $f \in \mathfrak m$ be an element not contained in any minimal prime ideal of $R$, and let $k\in\mathbf{N}$. Then there exist elements $g_1, \ldots, g_{d - 1} \in \mathfrak m^k$ such that $f, g_1, \ldots, g_{d - 1}$ is a system of parameters. \end{lemma} 
\begin{lemma} \label{lemma-syspar} Let $(R,\mathfrak m)$ be a Noetherian local ring of dimension two, and let $f \in \mathfrak m$ be an element not contained in any minimal prime ideal of $R$. Then there exist $g \in \mathfrak m$ and $N \in \mathbf{N}$ such that \begin{enumerate} \item[(a)] $f,g$ form a system of parameters for $R$. \item[(b)] If $h \in \mathfrak m^N$, then $f + h, g$ is a system of parameters and $\text{length}_R (R/(f, g)) = \text{length}_R(R/(f + h, g))$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-radical-element} Let $R$ be a Noetherian local normal domain of dimension $2$. Let $\mathfrak p_1, \ldots, \mathfrak p_r$ be pairwise distinct primes of height $1$. There exists a nonzero element $f \in \mathfrak p_1 \cap \ldots \cap \mathfrak p_r$ such that $R/fR$ is reduced. \end{lemma} 
\begin{lemma} \label{lemma-divides-radical} Let $(A, \mathfrak m, \kappa)$ be a Noetherian normal local domain of dimension $2$. If $a \in \mathfrak m$ is nonzero, then there exists an element $c \in A$ such that $A/cA$ is reduced and such that $a$ divides $c^n$ for some $n$. \end{lemma} 
\begin{lemma} \label{lemma-multiplicity} Let $(R, \mathfrak m)$ be a Noetherian local ring of dimension $d$, let $g_1, \ldots, g_d$ be a system of parameters, and let $I = (g_1, \ldots, g_d)$. If $e_I/d!$ is the leading coefficient of the numerical polynomial $n \mapsto \text{length}_R(R/I^{n+1})$, then $e_I \leq \text{length}_R(R/I)$. \end{lemma} 
\begin{lemma} \label{lemma-minprimespolyhigher} Let $(R, \mathfrak m)$ be a Noetherian local ring of dimension $d$, let $t$ be the number of minimal prime ideals of $R$ of dimension $d$, and let $(g_1,\ldots,g_d)$ be a system of parameters. Then $t \leq \text{length}_R(R/(g_1,\ldots,g_n))$. \end{lemma} 
\begin{lemma} \label{lemma-sysparhigher} Let $(R, \mathfrak m)$ be a Noetherian local ring of dimension $d$, and let $f \in \mathfrak m$ be an element not contained in any minimal prime ideal of $R$. Then there exist elements $g_1, \ldots, g_{d - 1} \in \mathfrak m$ and $N \in \mathbf{N}$ such that \begin{enumerate} \item $f, g_1, \ldots, g_{d - 1}$ form a system of parameters for $R$ \item If $h \in \mathfrak m^N$, then $f + h, g_1, \ldots, g_{d - 1}$ is a system of parameters and we have $\text{length}_R R/(f, g_1, \ldots, g_{d-1}) = \text{length}_R R/(f + h, g_1, \ldots, g_{d-1})$. \end{enumerate} \end{lemma} 
\begin{proposition} \label{proposition-propdimd} \begin{reference} \cite[Lemma 3.14]{Artin-Lipman} has this result without the assumption that the ring is catenary \end{reference} Let $R$ be a catenary Noetherian local normal domain. Let $J \subset R$ be a radical ideal. Then there exists a nonzero element $f \in J$ such that $R/fR$ is reduced. \end{proposition} 
\begin{lemma} \label{lemma-symmetric-monoidal-derived} Let $R$ be a ring. The derived category $D(R)$ of $R$ is a symmetric monoidal category with tensor product given by derived tensor product and associativity and commutativity constraints as in Section \ref{section-sign-rules}. \end{lemma} 
\begin{lemma} \label{lemma-complex-bounded-above-free-colim-bounded-finite-free} Let $R$ be a ring. Let $F^\bullet$ be a bounded above complex of free $R$-modules. Given pairs $(n_i, f_i)$, $i = 1, \ldots, N$ with $n_i \in \mathbf{Z}$ and $f_i \in F^{n_i}$ there exists a subcomplex $G^\bullet \subset F^\bullet$ containing all $f_i$ which is bounded and consists of finite free $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-have-dual-derived} Let $R$ be a ring. Let $M$ be an object of $D(R)$. The following are equivalent \begin{enumerate} \item $M$ has a left dual in $D(R)$ as in Categories, Definition \ref{categories-definition-dual}, \item $M$ is a perfect object of $D(R)$. \end{enumerate} Moreover, in this case the left dual of $M$ is the object $M^\vee$ of Lemma \ref{lemma-dual-perfect-complex}. \end{lemma} 
\begin{lemma} \label{lemma-invertible-derived} Let $R$ be a ring. Let $M$ be an object of $D(R)$. The following are equivalent \begin{enumerate} \item $M$ is invertible in $D(R)$, see Categories, Definition \ref{categories-definition-invertible}, and \item for every prime ideal $\mathfrak p \subset R$ there exists an $f \in R$, $f \not \in \mathfrak p$ such that $M_f \cong R_f[-n]$ for some $n \in \mathbf{Z}$. \end{enumerate} Moreover, in this case \begin{enumerate} \item[(a)] $M$ is a perfect object of $D(R)$, \item[(b)] $M = \bigoplus H^n(M)[-n]$ in $D(R)$, \item[(c)] each $H^n(M)$ is a finite projective $R$-module, \item[(d)] we can write $R = \prod_{a \leq n \leq b} R_n$ such that $H^n(M)$ corresponds to an invertible $R_n$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-which-elements-split} In Situation \ref{situation-splitting} let $x \in \Omega$. There exists a canonical short exact sequence $$ 0 \to B(x) \to M(x) \to V(x) \to 0 $$ of $\kappa(x)$-vector spaces which the following property: for $s_1, \ldots, s_r \in M$ the following are equivalent \begin{enumerate} \item there exists an $f \in R$, $f \not \in x$ such that the map $s_1, \ldots, s_r : R^{\oplus r} \to M$ becomes the inclusion of a direct summand after inverting $f$, and \item $s_1(x), \ldots, s_r(x)$ map to linearly independent elements of $V(x)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-choose-values} In Situation \ref{situation-splitting} let $x_1, \ldots, x_n \in \Omega$ be pairwise distinct. Let $v_i \in V(x_i)$. Then there exists an $s \in M$ such that $s(x_i)$ maps to $v_i$ for $i = 1, \ldots, n$. \end{lemma} 
\begin{proposition} \label{proposition-splitting} \begin{reference} \cite[Theorem 2]{Serre-projective} \end{reference} In Situation \ref{situation-splitting} assume $\Omega$ is a Noetherian topological space. Let $s_1, \ldots, s_h \in M$. Let $Z(s_1, \ldots, s_h) \subset F \subset \Omega$ be closed. Let $x_1, \ldots, x_n \in F$ be pairwise distinct. Let $v_i  \in V(x_i)$. Let $k \geq 0$ be an integer such that $$ (*)\quad h + k \leq \dim_{\kappa(x)} V(x)\text{ for all }x \in \Omega $$ Then there exist $s \in M$ and $F' \subset \Omega$ closed such that \begin{enumerate} \item[(a)] $s(x_i)$ maps to $v_i$, \item[(b)] $Z(s_1, \ldots, s_h, s) \subset F \cup F'$, and \item[(c)] every irreducible component of $F'$ has codimension $\geq k$ in $\Omega$. \end{enumerate} \end{proposition} 
\begin{theorem} \label{theorem-splitting} \begin{reference} \cite[Theorem 1]{Serre-projective} \end{reference} Let $R$ be a ring whose max spectrum $\Omega \subset \Spec(R)$ is a Noetherian topological space of dimension $d < \infty$. Let $M$ be a finitely presented $R$-module such that for all $\mathfrak m \in \Omega$ the $R_\mathfrak m$-module $M_\mathfrak m$ has a free direct summand of rank $> d$. Then $M \cong R \oplus M'$. \end{theorem} 
\begin{lemma}[Eilenberg's lemma] \label{lemma-eilenberg-swindle} \begin{slogan} Eilenberg swindle \end{slogan} \begin{history} In \cite{Bass} we find: ``...is an elegant little swindle, observed several years ago by Eilenberg, and which might well have sprung from the brow of Barry Mazur.'' \end{history} \begin{reference} \cite[Eilenberg's lemma]{Bass} \end{reference} If $P \oplus Q \cong F$ with $F$ a nonfinitely generated free module, then $P \oplus F \cong F$. \end{lemma} 
\begin{lemma} \label{lemma-projective-plus-free-is-free} Let $R$ be a ring. Let $P$ be a projective module. There exists a free module $F$ such that $P \oplus F$ is free. \end{lemma} 
\begin{lemma} \label{lemma-element-projective} Let $R$ be a ring. Let $P$ be a projective module. Let $s \in P$. There exists a finite free module $F$ and a finite free direct summand $K \subset F \oplus P$ with $(0, s) \in K$. \end{lemma} 
\begin{lemma} \label{lemma-trick-to-find-good-element} Let $R$ be a ring with Jacobson radical $J$ such that $R/J$ is Noetherian. Let $P$ be a projective $R$-module such that $P_\mathfrak m$ has infinite rank for all maximal ideals $\mathfrak m$ of $R$. Let $s \in P$ and $M \subset P$ such that $Rs + M = P$. Then we can find $m \in M$ such that $R(s + m)$ is a free direct summand of $P$. \end{lemma} 
\begin{lemma} \label{lemma-element-in-free-summand} Let $R$ be a ring with Jacobson radical $J$ such that $R/J$ is Noetherian. Let $P$ be a projective $R$-module such that $P_\mathfrak m$ has infinite rank for all maximal ideals $\mathfrak m$ of $R$. Let $s \in P$. Then we can find a finite stably free direct summand $M \subset P$ such that $s \in M$. \end{lemma} 
\begin{theorem} \label{theorem-countable-free} \begin{reference} Commutative case of \cite[Theorem 3.1]{Bass} \end{reference} Let $R$ be a ring with Jacobson radical $J$ such that $R/J$ is Noetherian. Let $P$ be a countably generated projective $R$-module such that $P_\mathfrak m$ has infinite rank for all maximal ideals $\mathfrak m$ of $R$. Then $P$ is free. \end{theorem} 
