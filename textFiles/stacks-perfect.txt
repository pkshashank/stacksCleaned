\begin{lemma} \label{lemma-shriek-derived} Let $\mathcal{X}$ be an algebraic stack. Notation as in Cohomology of Stacks, Lemmas \ref{stacks-cohomology-lemma-lisse-etale} and \ref{stacks-cohomology-lemma-lisse-etale-modules}. \begin{enumerate} \item The functor $g_! : \textit{Ab}(\mathcal{X}_{lisse,\etale}) \to \textit{Ab}(\mathcal{X}_\etale)$ has a left derived functor $$ Lg_! : D(\mathcal{X}_{lisse,\etale}) \longrightarrow D(\mathcal{X}_\etale) $$ which is left adjoint to $g^{-1}$ and such that $g^{-1}Lg_! = \text{id}$. \item The functor $g_! :  \textit{Mod}(\mathcal{X}_{lisse,\etale}, \mathcal{O}_{\mathcal{X}_{lisse,\etale}}) \to \textit{Mod}(\mathcal{X}_\etale, \mathcal{O}_{\mathcal{X}})$ has a left derived functor $$ Lg_! : D(\mathcal{O}_{\mathcal{X}_{lisse,\etale}}) \longrightarrow D(\mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) $$ which is left adjoint to $g^*$ and such that $g^*Lg_! = \text{id}$. \item The functor $g_! : \textit{Ab}(\mathcal{X}_{flat,fppf}) \to \textit{Ab}(\mathcal{X}_{fppf})$ has a left derived functor $$ Lg_! : D(\mathcal{X}_{flat, fppf}) \longrightarrow D(\mathcal{X}_{fppf}) $$ which is left adjoint to $g^{-1}$ and such that $g^{-1}Lg_! = \text{id}$. \item The functor $g_! : \textit{Mod}(\mathcal{X}_{flat,fppf}, \mathcal{O}_{\mathcal{X}_{flat,fppf}}) \to \textit{Mod}(\mathcal{X}_{fppf}, \mathcal{O}_{\mathcal{X}})$ has a left derived functor $$ Lg_! : D(\mathcal{O}_{\mathcal{X}_{flat, fppf}}) \longrightarrow D(\mathcal{O}_\mathcal{X}) $$ which is left adjoint to $g^*$ and such that $g^*Lg_! = \text{id}$. \end{enumerate} Warning: It is not clear (a priori) that $Lg_!$ on modules agrees with $Lg_!$ on abelian sheaves, see Cohomology on Sites, Remark \ref{sites-cohomology-remark-when-derived-shriek-equal}. \end{lemma} 
\begin{lemma} \label{lemma-lisse-etale-functorial-derived} With assumptions and notation as in Cohomology of Stacks, Lemma \ref{stacks-cohomology-lemma-lisse-etale-functorial}. We have $$ g^{-1} \circ Rf_* = Rf'_* \circ (g')^{-1} \quad\text{and}\quad L(g')_! \circ (f')^{-1} = f^{-1} \circ Lg_! $$ on unbounded derived categories (both for the case of modules and for the case of abelian sheaves). \end{lemma} 
\begin{lemma} \label{lemma-higher-shriek-quasi-coherent} Let $\mathcal{X}$ be an algebraic stack. Notation as in Cohomology of Stacks, Lemma \ref{stacks-cohomology-lemma-lisse-etale}. \begin{enumerate} \item Let $\mathcal{H}$ be a quasi-coherent $\mathcal{O}_{\mathcal{X}_{lisse,\etale}}$-module  on the lisse-\'etale site of $\mathcal{X}$. For all $p \in \mathbf{Z}$ the sheaf $H^p(Lg_!\mathcal{H})$ is a locally quasi-coherent module with the flat base change property on $\mathcal{X}$. \item Let $\mathcal{H}$ be a quasi-coherent $\mathcal{O}_{\mathcal{X}_{flat,fppf}}$-module  on the flat-fppf site of $\mathcal{X}$. For all $p \in \mathbf{Z}$ the sheaf $H^p(Lg_!\mathcal{H})$ is a locally quasi-coherent module with the flat base change property on $\mathcal{X}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-higher-shriek-Z} Let $\mathcal{X}$ be an algebraic stack. We have $Lg_!\mathbf{Z} = \mathbf{Z}$ for either $Lg_!$ as in Lemma \ref{lemma-shriek-derived} part (1) or $Lg_!$ as in Lemma \ref{lemma-shriek-derived} part (3). \end{lemma} 
\begin{lemma} \label{lemma-lisse-etale-cohomology} Let $\mathcal{X}$ be an algebraic stack. Notation as in Lemma \ref{lemma-shriek-derived}. \begin{enumerate} \item For $K$ in $D(\mathcal{X}_\etale)$ we have \begin{enumerate} \item $R\Gamma(\mathcal{X}_\etale, K) = R\Gamma(\mathcal{X}_{lisse,\etale}, g^{-1}K)$, and \item $R\Gamma(x, K) = R\Gamma(\mathcal{X}_{lisse,\etale}/x, g^{-1}K)$ for any object $x$ of $\mathcal{X}_{lisse,\etale}$. \end{enumerate} \item For $K$ in $D(\mathcal{X}_{fppf})$ we have \begin{enumerate} \item $R\Gamma(\mathcal{X}_{fppf}, K) = R\Gamma(\mathcal{X}_{flat,fppf}, g^{-1}K)$, and \item $H^p(x, K) = R\Gamma(\mathcal{X}_{flat,fppf}/x, g^{-1}K)$ for any object $x$ of $\mathcal{X}_{flat,fppf}$. \end{enumerate} \end{enumerate} In both cases, the same holds for modules, since we have $g^{-1} = g^*$ and there is no difference in computing cohomology by Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-modules-abelian-unbounded}. \end{lemma} 
\begin{definition} \label{definition-derived} Let $\mathcal{X}$ be an algebraic stack. With notation as above we define the {\it derived category of $\mathcal{O}_\mathcal{X}$-modules with quasi-coherent cohomology sheaves} as the Verdier quotient\footnote{This definition is different from the one in the literature, see \cite[6.3]{olsson_sheaves}, but it agrees with that definition by Lemma \ref{lemma-derived-quasi-coherent}.} $$ D_\QCoh(\mathcal{O}_\mathcal{X}) = D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})/ D_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) $$ \end{definition} 
\begin{lemma} \label{lemma-compare-etale-fppf-QCoh} Let $\mathcal{X}$ be an algebraic stack. Abbreviate $\mathcal{P}_\mathcal{X} = \textit{Parasitic}(\mathcal{O}_\mathcal{X}) \cap \textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})$. The comparison morphism $\epsilon : \mathcal{X}_{fppf} \to \mathcal{X}_\etale$ induces a commutative diagram $$ \xymatrix{ D_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \ar[r] & D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \ar[r] & D(\mathcal{O}_\mathcal{X}) \\ D_{\mathcal{P}_\mathcal{X}}(\mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) \ar[r] \ar[u]^{\epsilon^*} & D_{\textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})}( \mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) \ar[r] \ar[u]^{\epsilon^*} & D(\mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) \ar[u]^{\epsilon^*} } $$ Moreover, the left two vertical arrows are equivalences of triangulated categories, hence we also obtain an equivalence $$ D_{\textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})} (\mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) / D_{\mathcal{P}_\mathcal{X}}(\mathcal{X}_\etale, \mathcal{O}_\mathcal{X}) \longrightarrow D_\QCoh(\mathcal{O}_\mathcal{X}) $$ \end{lemma} 
\begin{lemma} \label{lemma-derived-quasi-coherent} Let $\mathcal{X}$ be an algebraic stack. Set $\mathcal{P}_\mathcal{X} = \textit{Parasitic}(\mathcal{O}_\mathcal{X}) \cap \textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})$. \begin{enumerate} \item Let $\mathcal{F}^\bullet$ be an object of $D_{\textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})} (\mathcal{X}_\etale, \mathcal{O}_\mathcal{X})$. With $g$ as in Cohomology of Stacks, Lemma \ref{stacks-cohomology-lemma-lisse-etale} for the lisse-\'etale site we have \begin{enumerate} \item $g^*\mathcal{F}^\bullet$ is in $D_\QCoh(\mathcal{O}_{\mathcal{X}_{lisse,\etale}})$, \item $g^*\mathcal{F}^\bullet = 0$ if and only if $\mathcal{F}^\bullet$ is in $D_{\mathcal{P}_\mathcal{X}}(\mathcal{X}_\etale, \mathcal{O}_\mathcal{X})$, \item $Lg_!\mathcal{H}^\bullet$ is in $D_{\textit{LQCoh}^{fbc}(\mathcal{O}_\mathcal{X})}( \mathcal{X}_\etale, \mathcal{O}_\mathcal{X})$ for $\mathcal{H}^\bullet$ in $D_\QCoh(\mathcal{O}_{\mathcal{X}_{lisse,\etale}})$, and \item the functors $g^*$ and $Lg_!$ define mutually inverse functors $$ \xymatrix{ D_\QCoh(\mathcal{O}_\mathcal{X}) \ar@<1ex>[r]^-{g^*} & D_\QCoh(\mathcal{O}_{\mathcal{X}_{lisse,\etale}}) \ar@<1ex>[l]^-{Lg_!} } $$ \end{enumerate} \item Let $\mathcal{F}^\bullet$ be an object of $D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})$. With $g$ as in Cohomology of Stacks, Lemma \ref{stacks-cohomology-lemma-lisse-etale} for the flat-fppf site we have \begin{enumerate} \item $g^*\mathcal{F}^\bullet$ is in $D_\QCoh(\mathcal{O}_{\mathcal{X}_{flat, fppf}})$, \item $g^*\mathcal{F}^\bullet = 0$ if and only if $\mathcal{F}^\bullet$ is in $D_{\mathcal{P}_\mathcal{X}}(\mathcal{O}_\mathcal{X})$, \item $Lg_!\mathcal{H}^\bullet$ is in $D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})$ for $\mathcal{H}^\bullet$ in $D_\QCoh(\mathcal{O}_{\mathcal{X}_{flat,fppf}})$, and \item the functors $g^*$ and $Lg_!$ define mutually inverse functors $$ \xymatrix{ D_\QCoh(\mathcal{O}_\mathcal{X}) \ar@<1ex>[r]^-{g^*} & D_\QCoh(\mathcal{O}_{\mathcal{X}_{flat,fppf}}) \ar@<1ex>[l]^-{Lg_!} } $$ \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-bousfield-colocalization} Let $\mathcal{X}$ be an algebraic stack. Let $E$ be an object of $D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})$. There exists a canonical distinguished triangle $$ E' \to E \to P \to E'[1] $$ in $D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})$ such that $P$ is in $D_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}} (\mathcal{O}_\mathcal{X})$ and $$ \Hom_{D(\mathcal{O}_\mathcal{X})}(E', P') = 0 $$ for all $P'$ in $D_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X})$. \end{lemma} 
\begin{proposition} \label{proposition-derived-direct-image-quasi-coherent} Let $f : \mathcal{X} \to \mathcal{Y}$ be a quasi-compact and quasi-separated morphism of algebraic stacks. The functor $Rf_*$ induces a commutative diagram $$ \xymatrix{ D^{+}_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \ar[r] \ar[d]^{Rf_*} & D^{+}_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \ar[r] \ar[d]^{Rf_*} & D(\mathcal{O}_\mathcal{X}) \ar[d]^{Rf_*} \\ D^{+}_{\textit{Parasitic} \cap \textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{Y}) \ar[r] & D^{+}_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{Y}) \ar[r] & D(\mathcal{O}_\mathcal{Y}) } $$ and hence induces a functor $$ Rf_{\QCoh, *} : D^{+}_\QCoh(\mathcal{O}_\mathcal{X}) \longrightarrow D^{+}_\QCoh(\mathcal{O}_\mathcal{Y}) $$ on quotient categories. Moreover, the functor $R^if_\QCoh$ of Cohomology of Stacks, Proposition \ref{stacks-cohomology-proposition-direct-image-quasi-coherent} are equal to $H^i \circ Rf_{\QCoh, *}$ with $H^i$ as in (\ref{equation-Hi-quasi-coherent}). \end{proposition} 
\begin{proposition} \label{proposition-derived-pullback-quasi-coherent} Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks. The exact functor $f^*$ induces a commutative diagram $$ \xymatrix{ D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \ar[r] & D(\mathcal{O}_\mathcal{X}) \\ D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{Y}) \ar[r] \ar[u]^{f^*} & D(\mathcal{O}_\mathcal{Y}) \ar[u]^{f^*} } $$ The composition $$ D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{Y}) \xrightarrow{f^*} D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{X}) \xrightarrow{q_\mathcal{X}} D_\QCoh(\mathcal{O}_\mathcal{X}) $$ is left derivable with respect to the localization $D_{\textit{LQCoh}^{fbc}}(\mathcal{O}_\mathcal{Y}) \to D_\QCoh(\mathcal{O}_\mathcal{Y})$ and we may define $Lf^*_\QCoh$ as its left derived functor $$ Lf_\QCoh^* : D_\QCoh(\mathcal{O}_\mathcal{Y}) \longrightarrow D_\QCoh(\mathcal{O}_\mathcal{X}) $$ (see Derived Categories, Definitions \ref{derived-definition-right-derived-functor-defined} and \ref{derived-definition-everywhere-defined}). If $f$ is quasi-compact and quasi-separated, then $Lf^*_\QCoh$ and $Rf_{\QCoh, *}$ satisfy the following adjointness: $$ \Hom_{D_\QCoh(\mathcal{O}_\mathcal{X})}(Lf^*_\QCoh A, B) = \Hom_{D_\QCoh(\mathcal{O}_\mathcal{Y})}(A, Rf_{\QCoh, *}B) $$ for $A \in D_\QCoh(\mathcal{O}_\mathcal{Y})$ and $B \in D^{+}_\QCoh(\mathcal{O}_\mathcal{X})$. \end{proposition} 
\begin{lemma} \label{lemma-cohomology-parasitic} Let $\mathcal{X}$ be an algebraic stack. Let $K$ be an object of $D(\mathcal{X}_{fppf})$ whose cohomology sheaves are parasitic. Then $R\Gamma(x, K) = 0$ for all objects $x$ of $\mathcal{X}$ lying over a scheme $U$ such that $U \to \mathcal{X}$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-cohomology-parasitic-complex} Let $\mathcal{X}$ be an algebraic stack. Let $K$ be an object of $D(\mathcal{X}_{fppf})$ such that $R\Gamma(x, K) = 0$ for all objects $x$ of $\mathcal{X}$ lying over an affine scheme $U$ such that $U \to \mathcal{X}$ is flat. Then $H^i(\mathcal{X}, K) = 0$ for all $i$. \end{lemma} 
\begin{lemma} \label{lemma-higher-shriek-QC} Let $\mathcal{X}$ be an algebraic stack. Let $K$ be an object of $D_\QCoh(\mathcal{O}_{\mathcal{X}_{flat, fppf}})$. Then $Lg_!K$ satisfies the following property: for any morphism $x \to x'$ of $\mathcal{X}_{affine}$ the map $$ R\Gamma(x', Lg_!K) \otimes_{\mathcal{O}(x')}^\mathbf{L} \mathcal{O}(x) \longrightarrow R\Gamma(x, Lg_!K) $$ is a quasi-isomorphism. \end{lemma} 
\begin{proposition} \label{proposition-QC-compare} Let $\mathcal{X}$ be an algebraic stack. Then $\mathit{QC}(\mathcal{X})$ is canonically equivalent to $D_\QCoh(\mathcal{O}_\mathcal{X})$. \end{proposition} 
