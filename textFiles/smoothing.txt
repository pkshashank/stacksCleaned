\begin{definition} \label{definition-singular-ideal} Let $R \to A$ be a ring map. The {\it singular ideal of $A$ over $R$}, denoted $H_{A/R}$ is the unique radical ideal $H_{A/R} \subset A$ with $$ V(H_{A/R}) = \{\mathfrak q \in \Spec(A) \mid R \to A \text{ not smooth at }\mathfrak q\} $$ \end{definition} 
\begin{lemma} \label{lemma-find-strictly-standard} Let $R$ be a ring. Let $A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$. Let $\mathfrak q \subset A$ be a prime ideal. Assume $R \to A$ is smooth at $\mathfrak q$. Then there exists an $a \in A$, $a \not \in \mathfrak q$, an integer $c$, $0 \leq c \leq \min(n, m)$, subsets $U \subset \{1, \ldots, n\}$, $V \subset \{1, \ldots, m\}$ of cardinality $c$ such that $$ a = a' \det(\partial f_j/\partial x_i)_{j \in V, i \in U} $$ for some $a' \in A$ and $$ a f_\ell \in (f_j, j \in V) + (f_1, \ldots, f_m)^2 $$ for all $\ell \in \{1, \ldots, m\}$. \end{lemma} 
\begin{definition} \label{definition-strictly-standard} Let $R \to A$ be a ring map of finite presentation. We say an element $a \in A$ is {\it elementary standard in $A$ over $R$} if there exists a presentation $A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$ and $0 \leq c \leq \min(n, m)$ such that \begin{equation} \label{equation-elementary-standard-one} a = a' \det(\partial f_j/\partial x_i)_{i, j = 1, \ldots, c} \end{equation} for some $a' \in A$ and \begin{equation} \label{equation-elementary-standard-two} a f_{c + j} \in (f_1, \ldots, f_c) + (f_1, \ldots, f_m)^2 \end{equation} for $j = 1, \ldots, m - c$. We say $a \in A$ is {\it strictly standard in $A$ over $R$} if there exists a presentation $A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$ and $0 \leq c \leq \min(n, m)$ such that \begin{equation} \label{equation-strictly-standard-one} a = \sum\nolimits_{I \subset \{1, \ldots, n\},\ |I| = c} a_I \det(\partial f_j/\partial x_i)_{j = 1, \ldots, c,\ i \in I} \end{equation} for some $a_I \in A$ and \begin{equation} \label{equation-strictly-standard-two} a f_{c + j} \in (f_1, \ldots, f_c) + (f_1, \ldots, f_m)^2 \end{equation} for $j = 1, \ldots, m - c$. \end{definition} 
\begin{lemma} \label{lemma-parse-equation-strictly-standard-one} Let $R$ be a ring. Let $A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$ and write $I = (f_1, \ldots, f_m)$. Let $a \in A$. Then (\ref{equation-strictly-standard-one}) implies there exists an $A$-linear map $\psi : \bigoplus\nolimits_{i = 1, \ldots, n} A \text{d}x_i \to A^{\oplus c}$ such that the composition $$ A^{\oplus c} \xrightarrow{(f_1, \ldots, f_c)} I/I^2 \xrightarrow{f \mapsto \text{d}f} \bigoplus\nolimits_{i = 1, \ldots, n} A \text{d}x_i \xrightarrow{\psi} A^{\oplus c} $$ is multiplication by $a$. Conversely, if such a $\psi$ exists, then $a^c$ satisfies (\ref{equation-strictly-standard-one}). \end{lemma} 
\begin{lemma}[Elkik] \label{lemma-elkik} Let $R \to A$ be a ring map of finite presentation. The singular ideal $H_{A/R}$ is the radical of the ideal generated by strictly standard elements in $A$ over $R$ and also the radical of the ideal generated by elementary standard elements in $A$ over $R$. \end{lemma} 
\begin{lemma} \label{lemma-strictly-standard-base-change} Let $R \to A$ be a ring map of finite presentation. Let $R \to R'$ be a ring map. If $a \in A$ is elementary, resp.\ strictly standard in $A$ over $R$, then $a \otimes 1$ is elementary, resp.\ strictly standard in $A \otimes_R R'$ over $R'$. \end{lemma} 
\begin{lemma} \label{lemma-final-solve} Let $R \to A \to \Lambda$ be ring maps with $A$ of finite presentation over $R$. Assume that $H_{A/R} \Lambda = \Lambda$. Then there exists a factorization $A \to B \to \Lambda$ with $B$ smooth over $R$. \end{lemma} 
\begin{lemma} \label{lemma-improve-presentation} Let $R$ be a ring and let $A$ be a finitely presented $R$-algebra. There exists finite type $R$-algebra map $A \to C$ which has a retraction with the following two properties \begin{enumerate} \item for each $a \in A$ such that $R \to A_a$ is a local complete intersection (More on Algebra, Definition \ref{more-algebra-definition-local-complete-intersection}) the ring $C_a$ is smooth over $A_a$ and has a presentation $C_a = R[y_1, \ldots, y_m]/J$ such that $J/J^2$ is free over $C_a$, and \item for each $a \in A$ such that $A_a$ is smooth over $R$ the module $\Omega_{C_a/R}$ is free over $C_a$. \end{enumerate} \end{lemma} 
\begin{proposition} \label{proposition-lift-smooth} \begin{slogan} Smooth and syntomic algebras lift along surjections \end{slogan} Let $R \to R_0$ be a surjective ring map with kernel $I$. \begin{enumerate} \item If $R_0 \to A_0$ is a syntomic ring map, then there exists a syntomic ring map $R \to A$ such that $A/IA \cong A_0$. \item If $R_0 \to A_0$ is a smooth ring map, then there exists a smooth ring map $R \to A$ such that $A/IA \cong A_0$. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-syntomic-complete-intersection} Let $R \to A$ be a syntomic ring map. Then there exists a smooth $R$-algebra map $A \to C$ with a retraction such that $C$ is a global relative complete intersection over $R$, i.e., $$ C \cong R[x_1, \ldots, x_n]/(f_1, \ldots, f_c) $$ flat over $R$ and all fibres of dimension $n - c$. \end{lemma} 
\begin{lemma} \label{lemma-smooth-standard-smooth} Let $R \to A$ be a smooth ring map. Then there exists a smooth $R$-algebra map $A \to B$ with a retraction such that $B$ is standard smooth over $R$, i.e., $$ B \cong R[x_1, \ldots, x_n]/(f_1, \ldots, f_c) $$ and $\det(\partial f_j/\partial x_i)_{i, j = 1, \ldots, c}$ is invertible in $B$. \end{lemma} 
\begin{lemma} \label{lemma-colimit-standard-smooth} Let $R \to \Lambda$ be a ring map. If $\Lambda$ is a filtered colimit of smooth $R$-algebras, then $\Lambda$ is a filtered colimit of standard smooth $R$-algebras. \end{lemma} 
\begin{lemma} \label{lemma-standard-smooth-include-generators} Let $R \to A$ be a standard smooth ring map. Let $E \subset A$ be a finite subset of order $|E| = n$. Then there exists a presentation $A = R[x_1, \ldots, x_{n + m}]/(f_1, \ldots, f_c)$ with $c \geq n$, with $\det(\partial f_j/\partial x_i)_{i, j = 1, \ldots, c}$ invertible in $A$, and such that $E$ is the set of congruence classes of $x_1, \ldots, x_n$. \end{lemma} 
\begin{lemma} \label{lemma-compare-standard} Let $R \to A$ be a ring map of finite presentation. Let $a \in A$. Consider the following conditions on $a$: \begin{enumerate} \item $A_a$ is smooth over $R$, \item $A_a$ is smooth over $R$ and $\Omega_{A_a/R}$ is stably free, \item $A_a$ is smooth over $R$ and $\Omega_{A_a/R}$ is free, \item $A_a$ is standard smooth over $R$, \item $a$ is strictly standard in $A$ over $R$, \item $a$ is elementary standard in $A$ over $R$. \end{enumerate} Then we have \begin{enumerate} \item[(a)] (4) $\Rightarrow$ (3) $\Rightarrow$ (2) $\Rightarrow$ (1), \item[(b)] (6) $\Rightarrow$ (5), \item[(c)] (6) $\Rightarrow$ (4), \item[(d)] (5) $\Rightarrow$ (2), \item[(e)] (2) $\Rightarrow$ the elements $a^e$, $e \geq e_0$ are strictly standard in $A$ over $R$, \item[(f)] (4) $\Rightarrow$ the elements $a^e$, $e \geq e_0$ are elementary standard in $A$ over $R$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-neron-functorial} In Situation \ref{situation-neron} N\'eron's blowup is functorial in the following sense \begin{enumerate} \item if $a \in A$, $a \not \in \mathfrak p$, then N\'eron's blowup of $A_a$ is $A'_a$, and \item if $B \to A$ is a surjection of flat finite type $R$-algebras with kernel $I$, then $A'$ is the quotient of $B'/IB'$ by its $\pi$-power torsion. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-neron-blowup-smooth} In Situation \ref{situation-neron} assume that $R \to A$ is smooth at $\mathfrak p$ and that $R/\pi R \subset \Lambda/\pi \Lambda$ is a separable field extension. Then $R \to A'$ is smooth at $\mathfrak p'$ and there is a short exact sequence $$ 0 \to \Omega_{A/R} \otimes_A A'_{\mathfrak p'} \to \Omega_{A'/R, \mathfrak p'} \to (A'/\pi A')_{\mathfrak p'}^{\oplus c} \to 0 $$ where $c = \dim((A/\pi A)_\mathfrak p)$. \end{lemma} 
\begin{lemma} \label{lemma-neron-when-smooth} In Situation \ref{situation-neron} assume that $R \to A$ is smooth at $\mathfrak q$ and that we have a surjection of $R$-algebras $B \to A$ with kernel $I$. Assume $R \to B$ smooth at $\mathfrak p_B = (B \to A)^{-1}\mathfrak p$. If the cokernel of $$ I/I^2 \otimes_A \Lambda \to \Omega_{B/R} \otimes_B \Lambda $$ is a free $\Lambda$-module, then $R \to A$ is smooth at $\mathfrak p$. \end{lemma} 
\begin{lemma} \label{lemma-neron-desingularization} In Situation \ref{situation-neron} assume that $R \to A$ is smooth at $\mathfrak q$ and that $R/\pi R \subset \Lambda/\pi \Lambda$ is a separable extension of fields. Then after a finite number of affine N\'eron blowups the algebra $A$ becomes smooth over $R$ at $\mathfrak p$. \end{lemma} 
\begin{lemma} \label{lemma-neron-colimit} \begin{slogan} Unramified extensions of DVRs are ind-smooth AKA N\'eron desingularization \end{slogan} Let $R \subset \Lambda$ be an extension of discrete valuation rings which has ramification index $1$ and induces a separable extension of residue fields and of fraction fields. Then $\Lambda$ is a filtered colimit of smooth $R$-algebras. \end{lemma} 
\begin{lemma} \label{lemma-lift-once} Let $R \to \Lambda$ be a ring map. Let $I \subset R$ be an ideal. Assume that \begin{enumerate} \item $I^2 = 0$, and \item $\Lambda/I\Lambda$ is a filtered colimit of smooth $R/I$-algebras. \end{enumerate} Let $\varphi : A \to \Lambda$ be an $R$-algebra map with $A$ of finite presentation over $R$. Then there exists a factorization $$ A \to B/J \to \Lambda $$ where $B$ is a smooth $R$-algebra and $J \subset IB$ is a finitely generated ideal. \end{lemma} 
\begin{lemma} \label{lemma-lift-twice} Let $R \to \Lambda$ be a ring map. Let $I \subset R$ be an ideal. Assume that \begin{enumerate} \item $I^2 = 0$, \item $\Lambda/I\Lambda$ is a filtered colimit of smooth $R/I$-algebras, and \item $R \to \Lambda$ is flat. \end{enumerate} Let $\varphi : B \to \Lambda$ be an $R$-algebra map with $B$ smooth over $R$. Let $J \subset IB$ be a finitely generated ideal such that $\varphi(J) = 0$. Then there exists $R$-algebra maps $$ B \xrightarrow{\alpha} B' \xrightarrow{\beta} \Lambda $$ such that $B'$ is smooth over $R$, such that $\alpha(J) = 0$ and such that $\beta \circ \alpha = \varphi \bmod I\Lambda$. \end{lemma} 
\begin{proposition} \label{proposition-lift} \begin{slogan} Ind-smoothness of an algebra is stable under infinitesimal deformations \end{slogan} Let $R \to \Lambda$ be a ring map. Let $I \subset R$ be an ideal. Assume that \begin{enumerate} \item $I$ is nilpotent, \item $\Lambda/I\Lambda$ is a filtered colimit of smooth $R/I$-algebras, and \item $R \to \Lambda$ is flat. \end{enumerate} Then $\Lambda$ is a filtered colimit of smooth $R$-algebras. \end{proposition} 
\begin{lemma} \label{lemma-lifting} Let $R$ be a Noetherian ring. Let $\Lambda$ be an $R$-algebra. Let $\pi \in R$ and assume that $\text{Ann}_R(\pi) = \text{Ann}_R(\pi^2)$ and $\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$. Suppose we have $R$-algebra maps $R/\pi^2R \to \bar C \to \Lambda/\pi^2\Lambda$ with $\bar C$ of finite presentation. Then there exists an $R$-algebra homomorphism $D \to \Lambda$ and a commutative diagram $$ \xymatrix{ R/\pi^2R \ar[r] \ar[d] & \bar C \ar[r] \ar[d] & \Lambda/\pi^2\Lambda \ar[d] \\ R/\pi R \ar[r] & D/\pi D \ar[r] & \Lambda/\pi \Lambda } $$ with the following properties \begin{enumerate} \item[(a)] $D$ is of finite presentation, \item[(b)] $R \to D$ is smooth at any prime $\mathfrak q$ with $\pi \not \in \mathfrak q$, \item[(c)] $R \to D$ is smooth at any prime $\mathfrak q$ with $\pi \in \mathfrak q$ lying over a prime of $\bar C$ where $R/\pi^2 R \to \bar C$ is smooth, and \item[(d)] $\bar C/\pi \bar C \to D/\pi D$ is smooth at any prime lying over a prime of $\bar C$ where $R/\pi^2R \to \bar C$ is smooth. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-desingularize} Let $R$ be a Noetherian ring. Let $\Lambda$ be an $R$-algebra. Let $\pi \in R$ and assume that $\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$. Let $A \to \Lambda$ be an $R$-algebra map with $A$ of finite presentation. Assume \begin{enumerate} \item the image of $\pi$ is strictly standard in $A$ over $R$, and \item there exists a section $\rho : A/\pi^4 A \to R/\pi^4 R$ which is compatible with the map to $\Lambda/\pi^4 \Lambda$. \end{enumerate} Then we can find $R$-algebra maps $A \to B \to \Lambda$ with $B$ of finite presentation such that $\mathfrak a B \subset H_{B/R}$ where $\mathfrak a = \text{Ann}_R(\text{Ann}_R(\pi^2)/\text{Ann}_R(\pi))$. \end{lemma} 
\begin{lemma} \label{lemma-desingularize-strictly-standard} Let $R$ be a Noetherian ring. Let $\Lambda$ be an $R$-algebra. Let $\pi \in R$ and assume that $\text{Ann}_R(\pi) = \text{Ann}_R(\pi^2)$ and $\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$. Let $A \to \Lambda$ and $D \to \Lambda$ be $R$-algebra maps with $A$ and $D$ of finite presentation. Assume \begin{enumerate} \item $\pi$ is strictly standard in $A$ over $R$, and \item there exists an $R$-algebra map $A/\pi^4 A \to D/\pi^4 D$ compatible with the maps to $\Lambda/\pi^4 \Lambda$. \end{enumerate} Then we can find an $R$-algebra map $B \to \Lambda$ with $B$ of finite presentation and $R$-algebra maps $A \to B$ and $D \to B$ compatible with the maps to $\Lambda$ such that $H_{D/R}B \subset H_{B/D}$ and $H_{D/R}B \subset H_{B/R}$. \end{lemma} 
\begin{lemma} \label{lemma-desingularize-lifting-apply} Let $R$ be a Noetherian ring. Let $\Lambda$ be an $R$-algebra. Let $\pi \in R$ and assume that $\text{Ann}_R(\pi) = \text{Ann}_R(\pi^2)$ and $\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$. Let $A \to \Lambda$ be an $R$-algebra map with $A$ of finite presentation and assume $\pi$ is strictly standard in $A$ over $R$. Let $$ A/\pi^8A \to \bar C \to \Lambda/\pi^8\Lambda $$ be a factorization with $\bar C$ of finite presentation. Then we can find a factorization $A \to B \to \Lambda$ with $B$ of finite presentation such that $R_\pi \to B_\pi$ is smooth and such that $$ H_{\bar C/(R/\pi^8 R)} \cdot \Lambda/\pi^8\Lambda \subset \sqrt{H_{B/R} \Lambda} \bmod \pi^8\Lambda. $$ \end{lemma} 
\begin{lemma} \label{lemma-product} Let $R_i \to \Lambda_i$, $i = 1, 2$ be as in Situation \ref{situation-global}. If PT holds for $R_i \to \Lambda_i$, $i = 1, 2$, then PT holds for $R_1 \times R_2 \to \Lambda_1 \times \Lambda_2$. \end{lemma} 
\begin{lemma} \label{lemma-delocalize-base} Let $R \to A \to \Lambda$ be ring maps with $A$ of finite presentation over $R$. Let $S \subset R$ be a multiplicative set. Let $S^{-1}A \to B' \to S^{-1}\Lambda$ be a factorization with $B'$ smooth over $S^{-1}R$. Then we can find a factorization $A \to B \to \Lambda$ such that some $s \in S$ maps to an elementary standard element (Definition \ref{definition-strictly-standard}) in $B$ over $R$. \end{lemma} 
\begin{lemma} \label{lemma-reduce-to-field} \begin{slogan} Proving Popescu approximation reduces to algebras over a field \end{slogan} If for every Situation \ref{situation-global} where $R$ is a field PT holds, then PT holds in general. \end{lemma} 
\begin{lemma} \label{lemma-lift-solution} Let $R \to A \to \Lambda \supset \mathfrak q$ be as in Situation \ref{situation-local}. Let $r \geq 1$ and $\pi_1, \ldots, \pi_r \in R$ map to elements of $\mathfrak q$. Assume \begin{enumerate} \item for $i = 1, \ldots, r$ we have $$ \text{Ann}_{R/(\pi_1^8, \ldots, \pi_{i - 1}^8)R}(\pi_i) = \text{Ann}_{R/(\pi_1^8, \ldots, \pi_{i - 1}^8)R}(\pi_i^2) $$ and $$ \text{Ann}_{\Lambda/(\pi_1^8, \ldots, \pi_{i - 1}^8)\Lambda}(\pi_i) = \text{Ann}_{\Lambda/(\pi_1^8, \ldots, \pi_{i - 1}^8)\Lambda}(\pi_i^2) $$ \item for $i = 1, \ldots, r$ the element $\pi_i$ maps to a strictly standard element in $A$ over $R$. \end{enumerate} Then, if $$ R/(\pi_1^8, \ldots, \pi_r^8)R \to A/(\pi_1^8, \ldots, \pi_r^8)A \to \Lambda/(\pi_1^8, \ldots, \pi_r^8)\Lambda \supset \mathfrak q/(\pi_1^8, \ldots, \pi_r^8)\Lambda $$ can be resolved, so can $R \to A \to \Lambda \supset \mathfrak q$. \end{lemma} 
\begin{lemma} \label{lemma-delocalize-weak} \begin{reference} \cite[Lemma 12.2]{swan} or \cite[Lemma 2]{popescu-GND} \end{reference} Let $R \to A \to \Lambda \supset \mathfrak q$ be as in Situation \ref{situation-local}. Let $\mathfrak p = R \cap \mathfrak q$. Assume that $\mathfrak q$ is minimal over $\mathfrak h_A$ and that $R_\mathfrak p \to A_\mathfrak p \to \Lambda_\mathfrak q \supset \mathfrak q\Lambda_\mathfrak q$ can be resolved. Then there exists a factorization $A \to C \to \Lambda$ with $C$ of finite presentation such that $H_{C/R} \Lambda \not \subset \mathfrak q$. \end{lemma} 
\begin{lemma} \label{lemma-delocalize-height-zero} Let $R \to A \to \Lambda \supset \mathfrak q$ be as in Situation \ref{situation-local}. Let $\mathfrak p = R \cap \mathfrak q$. Assume \begin{enumerate} \item $\mathfrak q$ is minimal over $\mathfrak h_A$, \item $R_\mathfrak p \to A_\mathfrak p \to \Lambda_\mathfrak q \supset \mathfrak q\Lambda_\mathfrak q$ can be resolved, and \item $\dim(\Lambda_\mathfrak q) = 0$. \end{enumerate} Then $R \to A \to \Lambda \supset \mathfrak q$ can be resolved. \end{lemma} 
\begin{lemma}[Ogoma] \label{lemma-ogoma} Let $A$ be a Noetherian ring and let $M$ be a finite $A$-module. Let $S \subset A$ be a multiplicative set. If $\pi \in A$ and $\Ker(\pi : S^{-1}M \to S^{-1}M) = \Ker(\pi^2 : S^{-1}M \to S^{-1}M)$ then there exists an $s \in S$ such that for any $n > 0$ we have $\Ker(s^n\pi : M \to M) = \Ker((s^n\pi)^2 : M \to M)$. \end{lemma} 
\begin{lemma} \label{lemma-find-sequence} Let $\Lambda$ be a Noetherian ring. Let $I \subset \Lambda$ be an ideal. Let $I \subset \mathfrak q$ be a prime. Let $n, e$ be positive integers Assume that $\mathfrak q^n\Lambda_\mathfrak q \subset I\Lambda_\mathfrak q$ and that $\Lambda_\mathfrak q$ is a regular local ring of dimension $d$. Then there exists an $n > 0$ and $\pi_1, \ldots, \pi_d \in \Lambda$ such that \begin{enumerate} \item $(\pi_1, \ldots, \pi_d)\Lambda_\mathfrak q = \mathfrak q\Lambda_\mathfrak q$, \item $\pi_1^n, \ldots, \pi_d^n \in I$, and \item for $i = 1, \ldots, d$ we have $$ \text{Ann}_{\Lambda/(\pi_1^e, \ldots, \pi_{i - 1}^e)\Lambda}(\pi_i) = \text{Ann}_{\Lambda/(\pi_1^e, \ldots, \pi_{i - 1}^e)\Lambda}(\pi_i^2). $$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-resolve-special} Let $k \to A \to \Lambda \supset \mathfrak q$ be as in Situation \ref{situation-local} where \begin{enumerate} \item $k$ is a field, \item $\Lambda$ is Noetherian, \item $\mathfrak q$ is minimal over $\mathfrak h_A$, \item $\Lambda_\mathfrak q$ is a regular local ring, and \item the field extension $\kappa(\mathfrak q)/k$ is separable. \end{enumerate} Then $k \to A \to \Lambda \supset \mathfrak q$ can be resolved. \end{lemma} 
\begin{lemma} \label{lemma-helper} Let $k$ be a field of characteristic $p > 0$. Let $(\Lambda, \mathfrak m, K)$ be an Artinian local $k$-algebra. Assume that $\dim H_1(L_{K/k}) < \infty$. Then $\Lambda$ is a filtered colimit of Artinian local $k$-algebras $A$ with each map $A \to \Lambda$ flat, with $\mathfrak m_A \Lambda = \mathfrak m$, and with $A$ essentially of finite type over $k$. \end{lemma} 
\begin{lemma} \label{lemma-solution-modulo} Let $k$ be a field of characteristic $p > 0$. Let $\Lambda$ be a Noetherian geometrically regular $k$-algebra. Let $\mathfrak q \subset \Lambda$ be a prime ideal. Let $n \geq 1$ be an integer and let $E \subset \Lambda_\mathfrak q/\mathfrak q^n\Lambda_\mathfrak q$ be a finite subset. Then we can find $m \geq 0$ and $\varphi : k[y_1, \ldots, y_m] \to \Lambda$ with the following properties \begin{enumerate} \item setting $\mathfrak p = \varphi^{-1}(\mathfrak q)$ we have $\mathfrak q\Lambda_\mathfrak q = \mathfrak p \Lambda_\mathfrak q$ and $k[y_1, \ldots, y_m]_\mathfrak p \to \Lambda_\mathfrak q$ is flat, \item there is a factorization by homomorphisms of local Artinian rings $$ k[y_1, \ldots, y_m]_\mathfrak p/\mathfrak p^n k[y_1, \ldots, y_m]_\mathfrak p \to D \to \Lambda_\mathfrak q/\mathfrak q^n\Lambda_\mathfrak q $$ where the first arrow is essentially smooth and the second is flat, \item $E$ is contained in $D$ modulo $\mathfrak q^n\Lambda_\mathfrak q$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-enlarge-solution-modulo} Let $\varphi : k[y_1, \ldots, y_m] \to \Lambda$, $n$, $\mathfrak q$, $\mathfrak p$ and $$ k[y_1, \ldots, y_m]_\mathfrak p/\mathfrak p^n \to D \to \Lambda_\mathfrak q/\mathfrak q^n \Lambda_\mathfrak q $$ be as in Lemma \ref{lemma-solution-modulo}. Then for any $\lambda \in \Lambda \setminus \mathfrak q$ there exists an integer $q > 0$ and a factorization $$ k[y_1, \ldots, y_m]_\mathfrak p/\mathfrak p^n \to D \to D' \to \Lambda_\mathfrak q/\mathfrak q^n \Lambda_\mathfrak q $$ such that $D \to D'$ is an essentially smooth map of local Artinian rings, the last arrow is flat, and $\lambda^q$ is in $D'$. \end{lemma} 
\begin{lemma} \label{lemma-resolve-general} Let $k \to A \to \Lambda \supset \mathfrak q$ be as in Situation \ref{situation-local} where \begin{enumerate} \item $k$ is a field of characteristic $p > 0$, \item $\Lambda$ is Noetherian and geometrically regular over $k$, \item $\mathfrak q$ is minimal over $\mathfrak h_A$. \end{enumerate} Then $k \to A \to \Lambda \supset \mathfrak q$ can be resolved. \end{lemma} 
\begin{theorem}[Popescu] \label{theorem-popescu} Any regular homomorphism of Noetherian rings is a filtered colimit of smooth ring maps. \end{theorem} 
\begin{theorem} \label{theorem-approximation-property} Let $R$ be a Noetherian local ring. Let $f_1, \ldots, f_m \in R[x_1, \ldots, x_n]$. Suppose that $(a_1, \ldots, a_n) \in (R^\wedge)^n$ is a solution in $R^\wedge$. If $R$ is a henselian G-ring, then for every integer $N$ there exists a solution $(b_1, \ldots, b_n) \in R^n$ in $R$ such that $a_i - b_i \in \mathfrak m^NR^\wedge$. \end{theorem} 
\begin{theorem} \label{theorem-approximation-property-variant} Let $R$ be a Noetherian local ring. Let $f_1, \ldots, f_m \in R[x_1, \ldots, x_n]$. Suppose that $(a_1, \ldots, a_n) \in (R^\wedge)^n$ is a solution. If $R$ is a G-ring, then for every integer $N$ there exist \begin{enumerate} \item an \'etale ring map $R \to R'$, \item a maximal ideal $\mathfrak m' \subset R'$ lying over $\mathfrak m$ \item a solution $(b_1, \ldots, b_n) \in (R')^n$ in $R'$ \end{enumerate} such that $\kappa(\mathfrak m) = \kappa(\mathfrak m')$ and $a_i - b_i \in (\mathfrak m')^NR^\wedge$. \end{theorem} 
\begin{lemma} \label{lemma-approximation-property-variant} Let $R$ be a Noetherian ring. Let $\mathfrak p \subset R$ be a prime ideal. Let $f_1, \ldots, f_m \in R[x_1, \ldots, x_n]$. Suppose that $(a_1, \ldots, a_n) \in ((R_\mathfrak p)^\wedge)^n$ is a solution. If $R_\mathfrak p$ is a G-ring, then for every integer $N$ there exist \begin{enumerate} \item an \'etale ring map $R \to R'$, \item a prime ideal $\mathfrak p' \subset R'$ lying over $\mathfrak p$ \item a solution $(b_1, \ldots, b_n) \in (R')^n$ in $R'$ \end{enumerate} such that $\kappa(\mathfrak p) = \kappa(\mathfrak p')$ and $a_i - b_i \in (\mathfrak p')^N(R'_{\mathfrak p'})^\wedge$. \end{lemma} 
\begin{lemma} \label{lemma-henselian-pair} \begin{slogan} Approximation for henselian pairs. \end{slogan} Let $(A, I)$ be a henselian pair with $A$ Noetherian. Let $A^\wedge$ be the $I$-adic completion of $A$. Assume at least one of the following conditions holds \begin{enumerate} \item $A \to A^\wedge$ is a regular ring map, \item $A$ is a Noetherian G-ring, or \item $(A, I)$ is the henselization (More on Algebra, Lemma \ref{more-algebra-lemma-henselization}) of a pair $(B, J)$ where $B$ is a Noetherian G-ring. \end{enumerate} Given $f_1, \ldots, f_m \in A[x_1, \ldots, x_n]$ and $\hat{a}_1, \ldots, \hat{a}_n \in A^\wedge$ such that $f_j(\hat{a}_1, \ldots, \hat{a}_n) = 0$ for $j = 1, \ldots, m$, for every $N \geq 1$ there exist $a_1, \ldots, a_n \in A$ such that $\hat{a}_i - a_i \in I^N$ and such that $f_j(a_1, \ldots, a_n) = 0$ for $j = 1, \ldots, m$. \end{lemma} 
