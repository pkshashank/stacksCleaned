\begin{lemma} \label{lemma-section-support-in-locally-closed-pre} Let $X$ be a scheme. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Let $\varphi : U' \to U$ be a morphism of $X_\etale$. Let $Z' \subset U'$ be a closed subscheme such that $Z' \to U' \to U$ is a closed immersion with image $Z \subset U$. Then there is a canonical bijection $$ \{s \in \mathcal{F}(U) \mid \text{Supp}(s) \subset Z\} = \{s' \in \mathcal{F}(U') \mid \text{Supp}(s') \subset Z'\} $$ which is given by restriction if $\varphi^{-1}(Z) = Z'$. \end{lemma} 
\begin{lemma} \label{lemma-section-support-in-locally-closed} Let $X$ be a scheme. Let $Z \subset X$ be a locally closed subscheme. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Given $U, U' \subset X$ open containing $Z$ as a closed subscheme, there is a canonical bijection $$ \{s \in \mathcal{F}(U) \mid \text{Supp}(s) \subset Z\} = \{s \in \mathcal{F}(U') \mid \text{Supp}(s) \subset Z\} $$ which is given by restriction if $U' \subset U$. \end{lemma} 
\begin{lemma} \label{lemma-f-shriek-separated} Let $f : X \to Y$ be a morphism of schemes which is locally of finite type. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. The rule $$ Y_\etale \longrightarrow \textit{Ab},\quad V \longmapsto \{s \in f_*\mathcal{F}(V) = \mathcal{F}(X_V) \mid \text{Supp}(s) \subset X_V \text{ is proper over }V\} $$ is an abelian subsheaf of $f_*\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-separated-etale-shriek} Let $j : U \to X$ be a separated \'etale morphism. Let $\mathcal{F}$ be an abelian sheaf on $U_\etale$. The image of the injective map $j_!\mathcal{F} \to j_*\mathcal{F}$ of \'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-shriek-into-star-separated-etale} is the subsheaf of Lemma \ref{lemma-f-shriek-separated}. \end{lemma} 
\begin{definition} \label{definition-f-shriek-separated} Let $f : X \to Y$ be a morphism of schemes which is separated (!) and locally of finite type. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. The subsheaf $f_!\mathcal{F} \subset f_*\mathcal{F}$ constructed in Lemma \ref{lemma-f-shriek-separated} is called the {\it direct image with compact support}. \end{definition} 
\begin{lemma} \label{lemma-proper-f-shriek} Let $f : X \to Y$ be a proper morphism of schemes. Then $f_! = f_*$. \end{lemma} 
\begin{lemma} \label{lemma-compactify-f-shriek-separated} Let $Y$ be a scheme. Let $j : X \to \overline{X}$ be an open immersion of schemes over $Y$ with $\overline{X}$ proper over $Y$. Denote $f : X \to Y$ and $\overline{f} : \overline{X} \to Y$ the structure morphisms. For $\mathcal{F} \in \textit{Ab}(X_\etale)$ there is a canonical isomorphism (see proof) $$ f_!\mathcal{F} \longrightarrow \overline{f}_!j_!\mathcal{F} $$ As we have $\overline{f}_! = \overline{f}_*$ by Lemma \ref{lemma-proper-f-shriek} we obtain $\overline{f}_* \circ j_! = f_!$ as functors $\textit{Ab}(X_\etale) \to \textit{Ab}(Y_\etale)$. \end{lemma} 
\begin{definition} \label{definition-compact-support} Let $X$ be a separated scheme locally of finite type over a field $k$. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. We let $H^0_c(X, \mathcal{F}) \subset H^0(X, \mathcal{F})$ be the set of sections whose support is proper over $k$. Elements of $H^0_c(X, \mathcal{F})$ are called {\it sections with compact support}. \end{definition} 
\begin{lemma} \label{lemma-proper-compact-support} Let $X$ be a proper scheme over a field $k$. Then $H^0_c(X, \mathcal{F}) = H^0(X, \mathcal{F})$. \end{lemma} 
\begin{lemma} \label{lemma-compactify-compact-support} Let $k$ be a field. Let $j : X \to \overline{X}$ be an open immersion of schemes over $k$ with $\overline{X}$ proper over $k$. For $\mathcal{F} \in \textit{Ab}(X_\etale)$ there is a canonical isomorphism (see proof) $$ H^0_c(X, \mathcal{F}) \longrightarrow H^0_c(\overline{X}, j_!\mathcal{F}) = H^0(\overline{X}, j_!\mathcal{F}) $$ where we have the equality on the right by Lemma \ref{lemma-proper-compact-support}. \end{lemma} 
\begin{lemma} \label{lemma-stalk-f-shriek-separated} Let $f : X \to Y$ be a morphism of schemes which is separated and locally of finite type. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Then there is a canonical isomorphism $$ (f_!\mathcal{F})_{\overline{y}} \longrightarrow H^0_c(X_{\overline{y}}, \mathcal{F}|_{X_{\overline{y}}}) $$ for any geometric point $\overline{y} : \Spec(k) \to Y$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-f-shriek-separated} Consider a cartesian square $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ of schemes with $f$ separated and locally of finite type. For any abelian sheaf $\mathcal{F}$ on $X_\etale$ we have $f'_!(g')^{-1}\mathcal{F} = g^{-1}f_!\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-f-shriek-composition} Let $f : X \to Y$ and $g : Y \to Z$ be composable morphisms of schemes which are separated and locally of finite type. Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Then $g_!f_!\mathcal{F} = (g \circ f)_!\mathcal{F}$ as subsheaves of $(g \circ f)_*\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-colim-f-shriek-separated} Let $f : X \to Y$ be morphism of schemes which is separated and locally of finite type. Let $X = \bigcup_{i \in I} X_i$ be an open covering such that for all $i, j \in I$ there exists a $k$ with $X_i \cup X_j \subset X_k$. Denote $f_i : X_i \to Y$ the restriction of $f$. Then $$ f_!\mathcal{F} = \colim_{i \in I} f_{i, !}(\mathcal{F}|_{X_i}) $$ functorially in $\mathcal{F} \in \textit{Ab}(X_\etale)$ where the transition maps are the ones constructed in Remark \ref{remark-covariance-f-shriek-separated}. \end{lemma} 
\begin{lemma} \label{lemma-f-shriek-separated-direct-sums} Let $f : X \to Y$ be a morphism of schemes which is separated and locally of finite type. Then functor $f_!$ commutes with direct sums. \end{lemma} 
\begin{lemma} \label{lemma-lqf-f-shriek-separated-colimits} Let $f : X \to Y$ be a morphism of schemes which is separated and locally quasi-finite. Then \begin{enumerate} \item for $\mathcal{F}$ in $\textit{Ab}(X_\etale)$ and a geometric point $\overline{y} : \Spec(k) \to Y$ we have $$ (f_!\mathcal{F})_{\overline{y}} = \bigoplus\nolimits_{f(\overline{x}) = \overline{y}} \mathcal{F}_{\overline{x}} $$ functorially in $\mathcal{F}$, and \item the functor $f_!$ is exact. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-finite-support-f-shriek-separated} Let $f : X \to Y$ be a separated and locally quasi-finite morphism of schemes. Functorially in $\mathcal{F} \in \textit{Ab}(X_\etale)$ there is a canonical isomorphism(!) $$ f_{p!}\mathcal{F} \longrightarrow f_!\mathcal{F} $$ of abelian presheaves which identifies the sheaf $f_!\mathcal{F}$ of Definition \ref{definition-f-shriek-separated} with the presheaf $f_{p!}\mathcal{F}$ constructed above. \end{lemma} 
\begin{lemma} \label{lemma-finite-support-stalk} Let $f : X \to Y$ be a morphism of schemes which is locally quasi-finite. Let $\overline{y} : \Spec(k) \to Y$ be a geometric point. Functorially in $\mathcal{F}$ in $\textit{Ab}(X_\etale)$ we have $$ (f_{p!}\mathcal{F})_{\overline{y}} = \bigoplus\nolimits_{f(\overline{x}) = \overline{y}} \mathcal{F}_{\overline{x}} $$ \end{lemma} 
\begin{lemma} \label{lemma-finite-support-etale-shriek} Let $f = j : U \to X$ be an \'etale of schemes. Denote $j_{p!}$ the construction of \'Etale Cohomology, Equation (\ref{etale-cohomology-equation-j-p-shriek}) and denote $f_{p!}$ the construction above. Functorially in $\mathcal{F} \in \textit{Ab}(X_\etale)$ there is a canonical map $$ j_{p!}\mathcal{F} \longrightarrow f_{p!}\mathcal{F} $$ of abelian presheaves which identifies the sheaf $j_!\mathcal{F} = (j_{p!}\mathcal{F})^\#$ of \'Etale Cohomology, Definition \ref{etale-cohomology-definition-extension-zero} with $(f_{p!}\mathcal{F})^\#$. \end{lemma} 
\begin{definition} \label{definition-f-shriek-lqf} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. We define the {\it direct image with compact support} to be the functor $$ f_! : \textit{Ab}(X_\etale) \longrightarrow \textit{Ab}(Y_\etale) $$ defined by the formula $f_!\mathcal{F} = (f_{p!}\mathcal{F})^\#$, i.e., $f_!\mathcal{F}$ is the sheafification of the presheaf $f_{p!}\mathcal{F}$ constructed above. \end{definition} 
\begin{lemma} \label{lemma-lqf-f-shriek-stalk} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Then \begin{enumerate} \item for $\mathcal{F}$ in $\textit{Ab}(X_\etale)$ and a geometric point $\overline{y} : \Spec(k) \to Y$ we have $$ (f_!\mathcal{F})_{\overline{y}} = \bigoplus\nolimits_{f(\overline{x}) = \overline{y}} \mathcal{F}_{\overline{x}} $$ functorially in $\mathcal{F}$, and \item the functor $f_! : \textit{Ab}(X_\etale) \to \textit{Ab}(Y_\etale)$ is exact and commutes with direct sums. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lqf-colimit-f-shriek} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Let $X = \bigcup_{i \in I} X_i$ be an open covering. Then there exists an exact complex $$ \ldots \to \bigoplus\nolimits_{i_0, i_1, i_2} f_{i_0i_1i_2, !} \mathcal{F}|_{X_{i_0i_1i_2}} \to \bigoplus\nolimits_{i_0, i_1} f_{i_0i_1, !} \mathcal{F}|_{X_{i_0i_1}} \to \bigoplus\nolimits_{i_0} f_{i_0, !} \mathcal{F}|_{X_{i_0}} \to f_!\mathcal{F} \to 0 $$ functorial in $\mathcal{F} \in \textit{Ab}(X_\etale)$, see proof for details. \end{lemma} 
\begin{lemma} \label{lemma-lqf-base-change-f-shriek} Consider a cartesian square $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ of schemes with $f$ locally quasi-finite. There is an isomorphism $g^{-1}f_!\mathcal{F} \to f'_!(g')^{-1}\mathcal{F}$ functorial for $\mathcal{F}$ in $\textit{Ab}(X_\etale)$ which is compatible with the descriptions of stalks given in Lemma \ref{lemma-lqf-f-shriek-stalk} (see proof for the precise statement). \end{lemma} 
\begin{lemma} \label{lemma-lqf-separated-shriek-composition} Let $f' : X \to Y'$ and $g : Y' \to Y$ be composable morphisms of schemes with $f'$ and $f = g \circ f'$ locally quasi-finite and $g$ separated and locally of finite type. Then there is a canonical isomorphism of functors $g_! \circ f'_! = f_!$. This isomorphism is compatible with \begin{enumerate} \item[(a)] covariance with respect to open embeddings as in Remarks \ref{remark-covariance-f-shriek-separated} and \ref{remark-covariance-lqf-f-shriek}, \item[(b)] the base change isomorphisms of Lemmas \ref{lemma-lqf-base-change-f-shriek} and \ref{lemma-base-change-f-shriek-separated}, and \item[(c)] equal to the isomorphism of Lemma \ref{lemma-f-shriek-composition} via the identifications of Lemma \ref{lemma-finite-support-f-shriek-separated} in case $f'$ is separated. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lqf-shriek-composition} Let $f : X \to Y$ and $g : Y \to Z$ be composable locally quasi-finite morphisms of schemes. Then there is a canonical isomorphism of functors $$ (g \circ f)_! \longrightarrow g_! \circ f_! $$ These isomorphisms satisfy the following properties: \begin{enumerate} \item If $f$ and $g$ are separated, then the isomorphism agrees with Lemma \ref{lemma-f-shriek-composition}. \item If $g$ is separated, then the isomorphism agrees with Lemma \ref{lemma-lqf-separated-shriek-composition}. \item For a geometric point $\overline{z} : \Spec(k) \to Z$ the diagram $$ \xymatrix{ ((g \circ f)_!\mathcal{F})_{\overline{z}} \ar[d] \ar[rr] & & \bigoplus\nolimits_{g(f(\overline{x})) = \overline{z}} \mathcal{F}_{\overline{x}} \ar@{=}[d] \\ (g_!f_!\mathcal{F})_{\overline{z}} \ar[r] & \bigoplus\nolimits_{g(\overline{y}) = \overline{z}} (f_!\mathcal{F})_{\overline{y}} \ar[r] & \bigoplus\nolimits_{g(f(\overline{x})) = \overline{z}} \mathcal{F}_{\overline{x}} } $$ is commutative where the horizontal arrows are given by Lemma \ref{lemma-lqf-f-shriek-stalk}. \item Let $h : Z \to T$ be a third locally quasi-finite morphism of schemes. Then the diagram $$ \xymatrix{ (h \circ g \circ f)_! \ar[r] \ar[d] & (h \circ g)_! \circ f_! \ar[d] \\ h_! \circ (g \circ f)_! \ar[r] & h_! \circ g_! \circ f_! } $$ commutes. \item Suppose that we have a diagram of schemes $$ \xymatrix{ X' \ar[d]_{f'} \ar[r]_c & X \ar[d]^f \\ Y' \ar[d]_{g'} \ar[r]_b & Y \ar[d]^g \\ Z' \ar[r]^a & Z } $$ with both squares cartesian and $f$ and $g$ locally quasi-finite. Then the diagram $$ \xymatrix{ a^{-1} \circ (g \circ f)_! \ar[d] \ar[rr] & & (g' \circ f')_! \circ c^{-1} \ar[d] \\ a^{-1} \circ g_! \circ f_! \ar[r] & g'_! \circ b^{-1} \circ f_! \ar[r] & g'_! \circ f'_! \circ c^{-1} } $$ commutes where the horizontal arrows are those of Lemma \ref{lemma-lqf-base-change-f-shriek}. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-f-shriek-projection} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Let $\Lambda$ be a ring. Let $\mathcal{F}$ be a sheaf of $\Lambda$-modules on $X_\etale$ and let $\mathcal{G}$ be a sheaf of $\Lambda$-modues on $Y_\etale$. There is a canonical isomorphism $$ can : f_!\mathcal{F} \otimes_\Lambda \mathcal{G} \longrightarrow f_!(\mathcal{F} \otimes_\Lambda f^{-1}\mathcal{G}) $$ of sheaves of $\Lambda$-modules on $Y_\etale$. \end{lemma} 
\begin{lemma} \label{lemma-trace-map-exists} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Let $w : X \to \mathbf{Z}$ be a weighting of $f$. For any abelian sheaf $\mathcal{F}$ on $Y$ there exists a unique trace map $\text{Tr}_{f, w, \mathcal{F}} : f_!f^{-1}\mathcal{F} \to \mathcal{F}$ having the prescribed behaviour on stalks. \end{lemma} 
\begin{lemma} \label{lemma-properties-trace-map} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Let $w : X \to \mathbf{Z}$ be a weighting of $f$. The trace maps constructed above have the following properties: \begin{enumerate} \item $\text{Tr}_{f, w, \mathcal{F}}$ is functorial in $\mathcal{F}$, \item $\text{Tr}_{f, w, \mathcal{F}}$ is compatible with arbitrary base change, \item given a ring $\Lambda$ and $K$ in $D(Y_\etale, \Lambda)$ we obtain $\text{Tr}_{f, w, K} : f_!f^{-1}K \to K$ functorial in $K$ and compatible with arbitrary base change. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-trace-composition} Let $f : X \to Y$ and $g : Y \to Z$ be locally quasi-finite morphisms. Let $w_f : X \to \mathbf{Z}$ be a weighting of $f$ and let $w_g : Y \to \mathbf{Z}$ be a weighting of $g$. For $K \in D(Z_\etale, \Lambda)$ the composition $$ (g \circ f)_!(g \circ f)^{-1}K = g_! f_! f^{-1} g^{-1}K \xrightarrow{g_! \text{Tr}_{f, w_f, g^{-1}K}} g_!g^{-1}K \xrightarrow{\text{Tr}_{g, w_g, K}} K $$ is equal to $\text{Tr}_{g \circ f, w_{g \circ f}, K}$ where $w_{g \circ f}(x) = w_f(x) w_g(f(x))$. \end{lemma} 
\begin{lemma} \label{lemma-lqf-f-upper-shriek} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. \begin{enumerate} \item The functor $f_! : \textit{Ab}(X_\etale) \to \textit{Ab}(Y_\etale)$ has a right adjoint $f^! : \textit{Ab}(Y_\etale) \to \textit{Ab}(X_\etale)$. \item We have $f^!(\overline{y}_*A) = \prod_{f(\overline{x}) = \overline{y}} \overline{x}_*A$. \item If $\Lambda$ is a ring, then the functor $f_! : \textit{Mod}(X_\etale, \Lambda) \to \textit{Mod}(Y_\etale, \Lambda)$ has a right adjoint $f^! : \textit{Mod}(Y_\etale, \Lambda) \to \textit{Mod}(X_\etale, \Lambda)$ which agrees with $f^!$ on underlying abelian sheaves. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-etale-upper-shriek} Let $j : U \to X$ be an \'etale morphism. Then $j^! = j^{-1}$. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-restriction} Let $f : X \to Y$ and $g : Y \to Z$ be separated and locally quasi-finite morphisms. There is a canonical isomorphism $(g \circ f)^! \to f^! \circ g^!$. Given a third locally quasi-finite morphism $h : Z \to T$ the diagram $$ \xymatrix{ (h \circ g \circ f)^! \ar[r] \ar[d] & f^! \circ (h \circ g)^! \ar[d] \\ (g \circ f)^! \circ h^! \ar[r] & f^! \circ g^! \circ h^! } $$ commutes. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-restriction-etale} Let $j : U \to X$ and $j' : V \to U$ be \'etale morphisms. The isomorphism $(j \circ j')^{-1} = (j')^{-1} \circ j^{-1}$ and the isomorphism $(j \circ j')^! = (j')^! \circ j^!$ of Lemma \ref{lemma-upper-shriek-restriction} agree via the isomorphism of Lemma \ref{lemma-etale-upper-shriek}. \end{lemma} 
\begin{lemma} \label{lemma-lqf-base-change-upper-shriek} Consider a cartesian square $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ of schemes with $f$ locally quasi-finite. For any abelian sheaf $\mathcal{F}$ on $Y'_\etale$ we have $(g')_*(f')^!\mathcal{F} = f^!g_*\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-lqf-shriek-derived} Let $f : X \to Y$ be a locally quasi-finite morphism of schemes. Let $\Lambda$ be a ring. The functors $f_!$ and $f^!$ of Definition \ref{definition-f-shriek-lqf} and Lemma \ref{lemma-lqf-f-upper-shriek} induce adjoint functors $f_! : D(X_\etale, \Lambda) \to D(Y_\etale, \Lambda)$ and $Rf^! : D(Y_\etale, \Lambda) \to D(X_\etale, \Lambda)$ on derived categories. \end{lemma} 
\begin{lemma} \label{lemma-mayer-vietoris-shriek} Let $X$ be a scheme. Let $X = U \cup V$ with $U$ and $V$ open. Let $\Lambda$ be a ring. Let $K \in D(X_\etale, \Lambda)$. There is a distinguished triangle $$ j_{U \cap V!}K|_{U \cap V} \to j_{U!}K|_U \oplus j_{V!}K|_V \to K \to  j_{U \cap V!}K|_{U \cap V}[1] $$ in $D(X_\etale, \Lambda)$ with obvious notation. \end{lemma} 
\begin{lemma} \label{lemma-triangle-associated-to-open} Let $X$ be a scheme. Let $Z \subset X$ be a closed subscheme and let $U \subset X$ be the complement. Denote $i : Z \to X$ and $j : U \to X$ the inclusion morphisms. Let $\Lambda$ be a ring. Let $K \in D(X_\etale, \Lambda)$. There is a distinguished triangle $$ j_!j^{-1}K \to K \to i_*i^{-1}K \to j_!j^{-1}K[1] $$ in $D(X_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-shriek-proper-and-open} Consider a commutative diagram of schemes $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ with $f$ and $f'$ proper and $g$ and $g'$ separated and locally quasi-finite. Let $\Lambda$ be a ring. Functorially in $K \in D(X'_\etale, \Lambda)$ there is a canonical map $$ g_!Rf'_*K \longrightarrow Rf_*(g'_!K) $$ in $D(Y_\etale, \Lambda)$. This map is an isomorphism if (a) $K$ is bounded below and has torsion cohomology sheaves, or (b) $\Lambda$ is a torsion ring. \end{lemma} 
\begin{lemma} \label{lemma-shriek-proper-and-open-compose} Consider a commutative diagram of schemes $$ \xymatrix{ X' \ar[r]_k \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]_l \ar[d]_{g'} & Y \ar[d]^g \\ Z' \ar[r]^m & Z } $$ with $f$, $f'$, $g$ and $g'$ proper and $k$, $l$, and $m$ separated and locally quasi-finite. Then the isomorphisms of Lemma \ref{lemma-shriek-proper-and-open} for the two squares compose to give the isomorphism for the outer rectangle (see proof for a precise statement). \end{lemma} 
\begin{lemma} \label{lemma-shriek-proper-and-open-compose-horizontal} Consider a commutative diagram of schemes $$ \xymatrix{ X'' \ar[r]_{g'} \ar[d]_{f''} & X' \ar[r]_g \ar[d]_{f'} & X \ar[d]^f \\ Y'' \ar[r]^{h'} & Y' \ar[r]^h & Y } $$ with $f$, $f'$, and $f''$ proper and $g$, $g'$, $h$, and $h'$ separated and locally quasi-finite. Then the isomorphisms of Lemma \ref{lemma-shriek-proper-and-open} for the two squares compose to give the isomorphism for the outer rectangle (see proof for a precise statement). \end{lemma} 
\begin{lemma} \label{lemma-shriek-proper-and-open-base-change} Let $b : Y_1 \to Y$ be a morphism of schemes. Consider a commutative diagram of schemes $$ \vcenter{ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } } \quad\text{and let}\quad \vcenter{ \xymatrix{ X'_1 \ar[r]_{g'_1} \ar[d]_{f'_1} & X_1 \ar[d]^{f_1} \\ Y'_1 \ar[r]^{g_1} & Y_1 } } $$ be the base change by $b$. Assume $f$ and $f'$ proper and $g$ and $g'$ separated and locally quasi-finite. For a ring $\Lambda$ and $K$ in $D(X'_\etale, \Lambda)$ there is commutative diagram $$ \xymatrix{ b^{-1}g_!Rf'_*K \ar[d] \ar[r] & g_{1, !}(b')^{-1}Rf'_*K \ar[r] & g_{1, !}Rf'_{1, *}(a')^{-1}K \ar[d] \\ b^{-1}Rf_*g'_!K \ar[r] & Rf_{1, *}a^{-1}g'_!K \ar[r] & Rf_{1, *}g'_{1, !}(a')^{-1}K } $$ in $D(Y_{1, \etale}, \Lambda)$ where $a : X_1 \to X$, $a' : X'_1 \to X'$, $b' : Y'_1 \to Y'$ are the projections, the vertical maps are the arrows of Lemma \ref{lemma-shriek-proper-and-open} and the horizontal arrows are the base change map (from \'Etale Cohomology, Section \ref{etale-cohomology-section-base-change-preliminaries}) and the base change map of Lemma \ref{lemma-base-change-f-shriek-separated}. \end{lemma} 
\begin{lemma} \label{lemma-shriek-lqf-and-proper} Consider a commutative diagram of schemes $$ \xymatrix{ X \ar[r]_f \ar[rd]_g & Y \ar[d]^h \\ & Z } $$ with $f$ and $g$ locally quasi-finite and $h$ proper. Let $\Lambda$ be a ring. Funtorially in $K \in D(X_\etale, \Lambda)$ there is a canonical map $$ g_!K \longrightarrow Rh_*(f_!K) $$ in $D(Z_\etale, \Lambda)$. This map is an isomorphism if (a) $K$ is bounded below and has torsion cohomology sheaves, or (b) $\Lambda$ is a torsion ring. \end{lemma} 
\begin{lemma} \label{lemma-shriek-well-defined} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. The functors $Rf_!$ constructed above are, up to canonical isomorphism, independent of the choice of the compactification. \end{lemma} 
\begin{lemma} \label{lemma-shriek-composition} Let $f : X \to Y$ and $g : Y \to Z$ be separated morphisms of finite type of quasi-compact and quasi-separated schemes. Then there is a canonical isomorphism $Rg_! \circ Rf_! \to R(g \circ f)_!$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-functor} Let $f : X \to Y$, $g : Y \to Z$, $h : Z \to T$ be separated morphisms of finite type of quasi-compact and quasi-separated schemes. Then the diagram $$ \xymatrix{ Rh_! \circ Rg_! \circ Rf_! \ar[r]_{\gamma_C} \ar[d]^{\gamma_A} & R(h \circ g)_! \circ Rf_! \ar[d]_{\gamma_{A + B}} \\ Rh_! \circ R(g \circ f)_! \ar[r]^{\gamma_{B + C}} & R(h \circ g \circ f)_! } $$ of isomorphisms of Lemma \ref{lemma-shriek-composition} commutes (for the meaning of the $\gamma$'s see proof). \end{lemma} 
\begin{lemma} \label{lemma-base-change-shriek} Consider a cartesian square $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ of quasi-compact and quasi-separated schemes with $f$ separated and of finite type. Then there is a canonical isomorphism $$ g^{-1} \circ Rf_! \to Rf'_! \circ (g')^{-1} $$ Moreover, these isomorphisms are compatible with the isomorphisms of Lemma \ref{lemma-shriek-composition}. \end{lemma} 
\begin{lemma} \label{lemma-derived-lower-shriek-commute-direct-sums} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a ring. \begin{enumerate} \item Let $K_i \in D^+_{tors}(X_\etale, \Lambda)$, $i \in I$ be a family of objects. Assume given $a \in \mathbf{Z}$ such that $H^n(K_i) = 0$ for $n < a$ and $i \in I$. Then $Rf_!(\bigoplus_i K_i) = \bigoplus_i Rf_!K_i$. \item If $\Lambda$ is torsion, then the functor $Rf_! : D(X_\etale, \Lambda) \to D(Y_\etale, \Lambda)$ commutes with direct sums. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-derived-lower-shriek-bounded} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a ring. The functors $Rf_!$ constructed in Section \ref{section-derived-lower-shriek-compactification} are bounded in the following sense: There exists an integer $N$ such that for $E \in D^+_{tors}(X_\etale, \Lambda)$ or $E \in D(X_\etale, \Lambda)$ if $\Lambda$ is torsion, we have \begin{enumerate} \item $H^i(Rf_!(\tau_{\leq a}E) \to H^i(Rf_!(E))$ is an isomorphism for $i \leq a$, \item $H^i(Rf_!(E)) \to H^i(Rf_!(\tau_{\geq b - N}E))$ is an isomorphism for $i \geq b$, \item if $H^i(E) = 0$ for $i \not \in [a, b]$ for some $-\infty \leq a \leq b \leq \infty$, then $H^i(Rf_!(E)) = 0$ for $i \not \in [a, b + N]$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Rf-shriek-for-quasi-finite} Let $f : X \to Y$ be a quasi-finite separated morphism of quasi-compact and quasi-separated schemes. Then the functors $Rf_!$ constructed in Section \ref{section-derived-lower-shriek-compactification} agree with the restriction of the functor $f_! : D(X_\etale, \Lambda) \to D(Y_\etale, \Lambda)$ constructed in Section \ref{section-derived-duality-locally-quasi-finite} to their common domains of definition. \end{lemma} 
\begin{lemma} \label{lemma-relative-mayer-vietoris} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $U$ and $V$ be quasi-compact opens of $X$ such that $X = U \cup V$. Denote $a : U \to Y$, $b : V \to Y$ and $c : U \cap V \to Y$ the restrictions of $f$. Let $\Lambda$ be a ring. For $K$ in $D^+_{tors}(X_\etale, \Lambda)$ or $K \in D(X_\etale, \Lambda)$ if $\Lambda$ is torsion, we have a distinguished triangle $$ Rc_!(K|_{U \cap V}) \to Ra_!(K|_U) \oplus Rb_!(K|_V) \to Rf_!K \to  Rc_!(K|_{U \cap V})[1] $$ in $D(Y_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-relative-triangle-associated-to-open} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $U$ be a quasi-compact open of $X$ with complement $Z \subset X$.  Denote $g : U \to Y$ and $h : Z \to Y$ the restrictions of $f$. Let $\Lambda$ be a ring. For $K$ in $D^+_{tors}(X_\etale, \Lambda)$ or $K \in D(X_\etale, \Lambda)$ if $\Lambda$ is torsion, we have a distinguished triangle $$ Rg_!(K|_U) \to Rf_!K \to Rh_!(K|_Z) \to Rg_!(K|_U)[1] $$ in $D(Y_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-shriek-and-thickening} Let $f' : X' \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $i : X \to X'$ be a thickening and denote $f = f' \circ i$. Let $\Lambda$ be a ring. For $K'$ in $D^+_{tors}(X'_\etale, \Lambda)$ or $K' \in D(X'_\etale, \Lambda)$ if $\Lambda$ is torsion, we have $Rf_!i^{-1}K' = Rf'_!K'$. \end{lemma} 
\begin{lemma} \label{lemma-projection-formula-Rf-lower-shriek} Let $f : X \to Y$ be a separated finite type morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion ring. Let $E \in D(X_\etale, \Lambda)$ and $K \in D(Y_\etale, \Lambda)$. Then $$ Rf_!E \otimes_\Lambda^\mathbf{L} K = Rf_!(E \otimes_\Lambda^\mathbf{L} f^{-1}K) $$ in $D(Y_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-derived} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion coefficient ring. The functor $Rf_! : D(X_\etale, \Lambda) \to D(Y_\etale, \Lambda)$ has a right adjoint $Rf^! : D(Y_\etale, \Lambda) \to D(X_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-Rf-upper-shriek-for-quasi-finite} Let $f : X \to Y$ be a separated quasi-finite morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion coefficient ring. The functor $Rf^! : D(Y_\etale, \Lambda) \to D(X_\etale, \Lambda)$ of Lemma \ref{lemma-upper-shriek-derived} is the same as the functor $Rf^!$ of Lemma \ref{lemma-lqf-shriek-derived}. \end{lemma} 
\begin{lemma} \label{lemma-Rf-upper-shriek-for-etale} Let $j : U \to X$ be a separated \'etale morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion coefficient ring. The functor $Rj^! : D(X_\etale, \Lambda) \to D(U_\etale, \Lambda)$ is equal to $j^{-1}$. \end{lemma} 
\begin{lemma} \label{lemma-twisted-inverse-image-bounded-below} Let $f : X \to Y$ be a finite type separated morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion ring. The functor $Rf^!$ sends $D^+(Y_\etale, \Lambda)$ into $D^+(X_\etale, \Lambda)$. More precisely, there exists an integer $N \geq 0$ such that if $K \in D(Y_\etale, \Lambda)$ has $H^i(K) = 0$ for $i < a$ then $H^i(Rf^!K) = 0$ for $i < a - N$. \end{lemma} 
\begin{lemma} \label{lemma-iso-on-RSheafHom} Let $f : X \to Y$ be a separated finite type morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion ring. For every $K \in D(Y_\etale, \Lambda)$ and $L \in D(X_\etale, \Lambda)$ the map (\ref{equation-sheafy-trace}) $$ Rf_*R\SheafHom_\Lambda(L, Rf^!K) \longrightarrow R\SheafHom_\Lambda(Rf_!L, K) $$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-iso-global-hom} Let $f : X \to Y$ be a separated finite type morphism of quasi-separated and quasi-compact schemes. Let $\Lambda$ be a torsion ring. For every $K \in D(Y_\etale, \Lambda)$ and $L \in D(X_\etale, \Lambda)$ the map (\ref{equation-sheafy-trace}) induces an isomorphism $$ R\Hom_X(L, Rf^!K) \longrightarrow R\Hom_Y(Rf_!L, K) $$ of global derived homs. \end{lemma} 
\begin{lemma} \label{lemma-cartesian-square-Rf-upper-shriek} Consider a cartesian square $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ of quasi-compact and quasi-separated schemes with $f$ separated and of finite type. Then we have $Rf^! \circ Rg_* = Rg'_* \circ R(f')^!$. \end{lemma} 
\begin{definition} \label{definition-cohomology-compact-support} Let $X$ be a separated scheme of finite type over a field $k$. Let $\Lambda$ be a ring. Let $K$ be an object of $D^+_{tors}(X_\etale, \Lambda)$ or of $D(X_\etale, \Lambda)$ in case $\Lambda$ is torsion. The {\it cohomology of $K$ with compact support} or the {\it compactly supported cohomology of $K$} is $$ R\Gamma_c(X, K) = R\Gamma(\Spec(k), Rf_!K) $$ where $f : X \to \Spec(k)$ is the structure morphism. We will write  $H^i_c(X, K) = H^i(R\Gamma_c(X, K))$. \end{definition} 
\begin{lemma} \label{lemma-stalk-R-f-shriek} Let $f : X \to Y$ be a finite type separated morphism of schemes with $Y$ quasi-compact and quasi-separated. Let $K$ be an object of $D^+_{tors}(X_\etale, \Lambda)$ or of $D(X_\etale, \Lambda)$ in case $\Lambda$ is torsion. Then there is a canonical isomorphism $$ (Rf_!K)_{\overline{y}} \longrightarrow R\Gamma_c(X_{\overline{y}}, K|_{X_{\overline{y}}}) $$ in $D(\Lambda)$ for any geometric point $\overline{y} : \Spec(k) \to Y$. \end{lemma} 
\begin{lemma} \label{lemma-compact-support-h0} Let $X$ be a separated scheme of finite type over a field $k$. If $\mathcal{F}$ is a torsion abelian sheaf, then the abelian group $H^0_c(X, \mathcal{F})$ defined in Definition \ref{definition-compact-support} agrees with the abelian group $H^0_c(X, \mathcal{F})$ defined in Definition \ref{definition-cohomology-compact-support}. \end{lemma} 
\begin{lemma} \label{lemma-finiteness-curves} Let $k$ be an algebraically closed field. Let $X$ be a separated scheme of finite type type over $k$ of dimension $\leq 1$. Let $\Lambda$ be a Noetherian ring. Let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules on $X$ which is torsion. Then $H^q_c(X, \mathcal{F})$ is a finite $\Lambda$-module. \end{lemma} 
\begin{lemma} \label{lemma-frobenius-linear-on-vb} Let $p$ be a prime number. Let $S$ be a scheme over $\mathbf{F}_p$. Let $\mathcal{E}$ be a finite locally free $\mathcal{O}_S$-module viewed as an $\mathcal{O}_S$-module on $S_\etale$. Let $F : \mathcal{E} \to \mathcal{E}$ be a homomorphism of abelian sheaves on $S_\etale$ such that $F(a e) = a^pF(e)$ for local sections $a$, $e$ of $\mathcal{O}_S$, $\mathcal{E}$ on $S_\etale$. Then $$ \Coker(F - 1 : \mathcal{E} \to \mathcal{E}) $$ is zero and $$ \Ker(F - 1 : \mathcal{E} \to \mathcal{E}) $$ is a constructible abelian sheaf on $S_\etale$. \end{lemma} 
\begin{lemma} \label{lemma-proper-smooth-family-curves} Let $f : X \to S$ be a proper smooth morphism of schemes with geometrically connected fibres of dimension $1$. Let $\ell$ be a prime number. Then $R^qf_*\underline{\mathbf{Z}/\ell\mathbf{Z}}$ is a constructible. \end{lemma} 
\begin{lemma} \label{lemma-proper-smooth-family-curves-modules} Let $f : X \to S$ be a proper smooth morphism of schemes with geometrically connected fibres of dimension $1$. Let $\Lambda$ be a Noetherian ring. Let $M$ be a finite $\Lambda$-module annihilated by an integer $n > 0$. Then $R^qf_*\underline{M}$ is a constructible sheaf of $\Lambda$-modules on $S$. \end{lemma} 
\begin{lemma} \label{lemma-qf-f-shriek-constructible} Let $f : X \to Y$ be a morphism of schemes which is locally quasi-finite and of finite presentation. The functor $f_! : D(X_\etale, \Lambda) \to D(Y_\etale, \Lambda)$ of Lemma \ref{lemma-lqf-shriek-derived} sends $D_c(X_\etale, \Lambda)$ into $D_c(Y_\etale, \Lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-constant-shriek-rel-dim-1} Let $S$ be a Noetherian affine scheme of finite dimension. Let $f : X \to S$ be a separated, affine, smooth morphism of relative dimension $1$. Let $\Lambda$ be a Noetherian ring which is torsion. Let $M$ be a finite $\Lambda$-module. Then $Rf_!\underline{M}$ has constructible cohomology sheaves. \end{lemma} 
\begin{lemma} \label{lemma-loc-constant-shriek-rel-dim-1} Let $Y$ be a Noetherian affine scheme of finite dimension. Let $\Lambda$ be a Noetherian ring which is torsion. Let $\mathcal{F}$ be a finite type, locally constant sheaf of $\Lambda$-modules on an open subscheme $U \subset \mathbf{A}^1_Y$. Then $Rf_!\mathcal{F}$ has constructible cohomology sheaves where $f : U \to Y$ is the structure morphism. \end{lemma} 
\begin{lemma} \label{lemma-constructible-shriek-rel-dim-1} Let $Y$ be an affine scheme. Let $\Lambda$ be a Noetherian ring. Let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules on $\mathbf{A}^1_Y$ which is torsion. Then $Rf_!\mathcal{F}$ has constructible cohomology sheaves where $f : \mathbf{A}^1_Y \to Y$ is the structure morphism. \end{lemma} 
\begin{theorem} \label{theorem-constructible-shriek} Let $f : X \to Y$ be a separated morphism of finite presentation of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a Noetherian ring. Let $K$ be an object of $D^+_{tors, c}(X_\etale, \Lambda)$ or of $D_c(X_\etale, \Lambda)$ in case $\Lambda$ is torsion. Then $Rf_!K$ has constructible cohomology sheaves, i.e., $Rf_!K$ is in $D^+_{tors, c}(Y_\etale, \Lambda)$ or in $D_c(Y_\etale, \Lambda)$ in case $\Lambda$ is torsion. \end{theorem} 
\begin{lemma} \label{lemma-finiteness-compactly-supported} Let $k$ be an algebraically closed field. Let $X$ be a finite type separated scheme over $k$. Let $\Lambda$ be a Noetherian ring. Let $K$ be an object of $D^+_{tors, c}(X_\etale, \Lambda)$ or of $D_c(X_\etale, \Lambda)$ in case $\Lambda$ is torsion. Then $H^i_c(X, K)$ is a finite $\Lambda$-module for all $i \in \mathbf{Z}$. \end{lemma} 
\begin{proposition} \label{proposition-loc-cst-torsion} Let $f : X \to S$ be a smooth proper morphism of schemes. Let $\Lambda$ be a Noetherian ring. Let $\mathcal{F}$ be a finite type, locally constant sheaf of $\Lambda$-modules on $X_\etale$ such that for every geometric point $\overline{x}$ of $X$ the stalk $\mathcal{F}_{\overline{x}}$ is annihilated by an integer $n > 0$ prime to the residue characteristic of $\overline{x}$. Then $R^if_*\mathcal{F}$ is a finite type, locally constant sheaf of $\Lambda$-modules on $S_\etale$ for all $i \in \mathbf{Z}$. \end{proposition} 
\begin{lemma} \label{lemma-describe-Rf-upper-shriek} Let $f : X \to Y$ be a separated finite type morphism of quasi-compact and quasi-separated schemes. Let $\Lambda$ be a torsion ring. Let $K \in D(Y_\etale, \Lambda)$. For $n \in \mathbf{Z}$ the cohomology sheaf $H^n(Rf^!K)$ restricted to $X_{affine, \etale}$ is the sheaf associated to the presheaf $$ U \longmapsto \Hom_Y(R(U \to Y)_!\Lambda, K[n]) $$ See discussion above for the functorial nature of $R(U \to Y)_!\Lambda$. \end{lemma} 
