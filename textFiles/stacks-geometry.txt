\begin{definition} \label{definition-versal-ring-at-x} In Situation \ref{situation-versal} let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism, where $k$ is a finite type field over $S$. A {\it versal ring to $\mathcal{X}$ at $x_0$} is a complete Noetherian local $S$-algebra $A$ with residue field $k$ such that there exists a versal formal object $(A, \xi_n, f_n)$ as in Artin's Axioms, Definition \ref{artin-definition-versal-formal-object} with $\xi_1 \cong x_0$ (a $2$-isomorphism). \end{definition} 
\begin{lemma} \label{lemma-deformation-category} In Situation \ref{situation-versal} let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism, where $k$ is a finite type field over $S$. Then $\mathcal{F}_{\mathcal{X}, k, x_0}$ is a deformation category and $T\mathcal{F}_{\mathcal{X}, k, x_0}$ and $\text{Inf}(\mathcal{F}_{\mathcal{X}, k, x_0})$ are finite dimensional $k$-vector spaces. \end{lemma} 
\begin{lemma} \label{lemma-versal-ring} In Situation \ref{situation-versal} let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism, where $k$ is a finite type field over $S$. Then a versal ring to $\mathcal{X}$ at $x_0$ exists. Given a pair $A$, $A'$ of these, then $A \cong A'[[t_1, \ldots, t_r]]$ or $A' \cong A[[t_1, \ldots, t_r]]$ as $S$-algebras for some $r$. \end{lemma} 
\begin{lemma} \label{lemma-versal-ring-field-extension} In Situation \ref{situation-versal} let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism, where $k$ is a finite type field over $S$. Let $l/k$ be a finite extension of fields and denote $x_{l, 0} : \Spec(l) \to \mathcal{X}$ the induced morphism. Given a versal ring $A$ to $\mathcal{X}$ at $x_0$ there exists a versal ring $A'$ to $\mathcal{X}$ at $x_{l, 0}$ such that there is a $S$-algebra map $A \to A'$ which induces the given field extension $l/k$ and is formally smooth in the $\mathfrak m_{A'}$-adic topology. \end{lemma} 
\begin{lemma} \label{lemma-compare-versal-ring-completion} In Situation \ref{situation-versal} let $x : U \to \mathcal{X}$ be a morphism where $U$ is a scheme locally of finite type over $S$. Let $u_0 \in U$ be a finite type point. Set $k = \kappa(u_0)$ and denote $x_0 : \Spec(k) \to \mathcal{X}$ the induced map. The following are equivalent \begin{enumerate} \item $x$ is versal at $u_0$ (Artin's Axioms, Definition \ref{artin-definition-versal}), \item $\hat x : \mathcal{F}_{U, k, u_0} \to \mathcal{F}_{\mathcal{X}, k, x_0}$ is smooth, \item the formal object associated to $x|_{\Spec(\mathcal{O}_{U, u_0}^\wedge)}$ is versal, and \item there is an open neighbourhood $U' \subset U$ of $x$ such that $x|_{U'} : U' \to \mathcal{X}$ is smooth. \end{enumerate} Moreover, in this case the completion $\mathcal{O}_{U, u_0}^\wedge$ is a versal ring to $\mathcal{X}$ at $x_0$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-smoothness} In Situation \ref{situation-versal}. Let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism such that $\Spec(k) \to S$ is of finite type with image $s$. Let $A$ be a versal ring to $\mathcal{X}$ at $x_0$. The following are equivalent \begin{enumerate} \item $x_0$ is in the smooth locus of $\mathcal{X} \to S$ (Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-where-smooth}), \item $\mathcal{O}_{S, s} \to A$ is formally smooth in the $\mathfrak m_A$-adic topology, and \item $\mathcal{F}_{\mathcal{X}, k, x_0}$ is unobstructed. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-Artin-approximation-by-smooth-morphism} In Situation \ref{situation-versal}. Let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism such that $\Spec(k) \to S$ is of finite type with image $s$. Let $A$ be a versal ring to $\mathcal{X}$ at $x_0$. If $\mathcal{O}_{S, s}$ is a G-ring, then we may find a smooth morphism $U \to \mathcal{X}$ whose source is a scheme and a point $u_0 \in U$ with residue field $k$, such that \begin{enumerate} \item $\Spec(k) \to U \to \mathcal{X}$ coincides with the given morphism $x_0$, \item there is an isomorphism $\mathcal{O}_{U, u_0}^\wedge \cong A$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-versal-ring-flat} In Situation \ref{situation-versal} let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism, where $k$ is a finite type field over $S$. Let $A$ be a versal ring to $\mathcal{X}$ at $x_0$. Then the morphism $\Spec(A) \to \mathcal{X}$ of Remark \ref{remark-upgrade} is flat. \end{lemma} 
\begin{lemma} \label{lemma-map-of-components} Let $f : U \to \mathcal{X}$ be a smooth morphism from a scheme to a locally Noetherian algebraic stack. The closure of the image of any irreducible component of $|U|$ is an irreducible component of $|\mathcal{X}|$. If $U \to \mathcal{X}$ is surjective, then all irreducible components of $|\mathcal{X}|$ are obtained in this way. \end{lemma} 
\begin{lemma} \label{lemma-multiplicities} Let $U \to X$ be a smooth morphism of locally Noetherian schemes. Let $T'$ is an irreducible component of $U$. Let $T$ be the irreducible component of $X$ obtained as the closure of the image of $T'$. Then $m_{T', U} = m_{T, X}$. \end{lemma} 
\begin{lemma} \label{lemma-multiplicity} Let $U_1 \to \mathcal{X}$ and $U_2 \to \mathcal{X}$ be two smooth morphisms from schemes to a locally Noetherian algebraic stack $\mathcal{X}$. Let $T_1'$ and $T_2'$ be irreducible components of $|U_1|$ and $|U_2|$ respectively. Assume the closures of the images of $T_1'$ and $T_2'$ are the same irreducible component $T$ of $|\mathcal{X}|$. Then $m_{T_1', U_1} = m_{T_2', U_2}$. \end{lemma} 
\begin{definition} \label{definition-multiplicity} Let $\mathcal{X}$ be a locally Noetherian algebraic stack. Let $T \subset |\mathcal{X}|$ be an irreducible component. The {\it multiplicity} of $T$ in $\mathcal{X}$ is defined as $m_{T, \mathcal{X}} = m_{T', U}$ where $f : U \to \mathcal{X}$ is a smooth morphism from a scheme and $T' \subset |U|$ is an irreducible component with $f(T') \subset T$. \end{definition} 
\begin{definition} \label{definition-formal-branches} Let $\mathcal{X}$ be an algebraic stack locally of finite type over a locally Noetherian scheme $S$. Let $x_0 : \Spec(k) \to \mathcal{X}$ is a morphism where $k$ is a field of finite type over $S$. The {\it formal branches of $\mathcal{X}$ through $x_0$} is the set of irreducible components of $\Spec(A)$ for any choice of versal ring to $\mathcal{X}$ at $x_0$ identified for different choices of $A$ by the procedure described above. \end{definition} 
\begin{lemma} \label{lemma-branches} In the situation of Definition \ref{definition-formal-branches} there is a canonical surjection from the set of formal branches of $\mathcal{X}$ through $x_0$ to the set of irreducible components of $|\mathcal{X}|$ containing $x_0$ in $|\mathcal{X}|$. \end{lemma} 
\begin{definition} \label{definition-multiplicity-formal-branches} Let $\mathcal{X}$ be an algebraic stack locally of finite type over a locally Noetherian scheme $S$. Let $x_0 : \Spec(k) \to \mathcal{X}$ is a morphism where $k$ is a field of finite type over $S$. The {\it multiplicity of a formal branch of $\mathcal{X}$ through $x_0$} is the multiplicity of the corresponding irreducible component of $\Spec(A)$ for any choice of versal ring to $\mathcal{X}$ at $x_0$ (see discussion above). \end{definition} 
\begin{lemma} \label{lemma-branches-multiplicity} Let $\mathcal{X}$ be an algebraic stack locally of finite type over a locally Noetherian scheme $S$. Let $x_0 : \Spec(k) \to \mathcal{X}$ is a morphism where $k$ is a field of finite type over $S$ with image $s \in S$. If $\mathcal{O}_{S, s}$ is a G-ring, then the map of Lemma \ref{lemma-branches} preserves multiplicities. \end{lemma} 
\begin{definition} \label{definition-relative-dimension} If $f : T \to \mathcal{X}$ is a locally of finite type morphism from an algebraic space to an algebraic stack, and if $t \in |T|$ is a point with image $x \in | \mathcal{X}|$, then we define {\it the relative dimension} of $f$ at $t$, denoted $\dim_t(T_x),$ as follows: choose a morphism $\Spec k \to \mathcal{X}$, with source the spectrum of a field, which represents $x$, and choose a point $t' \in |T \times_{\mathcal{X}} \Spec k|$ mapping to $t$ under the projection to $|T|$ (such a point $t'$ exists, by Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian}); then $$ \dim_t(T_x) = \dim_{t'}(T \times_{\mathcal{X}} \Spec k ). $$ \end{definition} 
\begin{lemma} \label{lemma-behaviour-of-dimensions-wrt-smooth-morphisms} If $f: U \to X$ is a smooth morphism of locally Noetherian algebraic spaces, and if $u \in |U|$ with image $x \in |X|$, then $$ \dim_u (U) = \dim_x(X) + \dim_{u} (U_x) $$ where $\dim_u (U_x)$ is defined via Definition \ref{definition-relative-dimension}. \end{lemma} 
\begin{lemma} \label{lemma-dimension-for-stacks} If $\mathcal{X}$ is a locally Noetherian algebraic stack and $x \in |\mathcal{X}|$. Let $U \to \mathcal{X}$ be a smooth morphism from an algebraic space to $\mathcal{X}$, let $u$ be any point of $|U|$ mapping to $x$. Then we have $$ \dim_x(\mathcal{X}) =  \dim_u(U) - \dim_{u}(U_x) $$ where the relative dimension $\dim_u(U_x)$ is defined by Definition \ref{definition-relative-dimension} and the dimension of $\mathcal{X}$ at $x$ is as in Properties of Stacks, Definition \ref{stacks-properties-definition-dimension-at-point}. \end{lemma} 
\begin{definition} \label{definition-relative-dimension-for-stacks} If $f : \mathcal{T} \to \mathcal{X}$ is a locally of finite type morphism between locally Noetherian algebraic stacks, and if $t \in |\mathcal{T}|$ is a point with image $x \in |\mathcal{X}|$, then we define the {\it relative dimension} of $f$ at $t$, denoted $\dim_t(\mathcal{T}_x),$ as follows: choose a morphism $\Spec k \to \mathcal{X}$, with source the spectrum of a field, which represents $x$, and choose a point $t' \in |\mathcal{T} \times_{\mathcal{X}} \Spec k|$ mapping to $t$ under the projection to $|\mathcal{T}|$ (such a point $t'$ exists, by Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian}; then $$ \dim_t(\mathcal{T}_x) = \dim_{t'}(\mathcal{T} \times_{\mathcal{X}} \Spec k ). $$ \end{definition} 
\begin{lemma} \label{lemma-base-change-invariance-of-relative-dimension} Suppose given a Cartesian square of morphisms of locally Noetherian stacks $$ \xymatrix{ \mathcal{T}' \ar[d]\ar[r] & \mathcal{T} \ar[d] \\ \mathcal{X}' \ar[r] & \mathcal{X} } $$ in which the vertical morphisms are locally of finite type. If $t' \in |\mathcal{T}'|$, with images $t$, $x'$, and $x$ in $|\mathcal{T}|$, $|\mathcal{X}'|$, and $|\mathcal{X}|$ respectively, then $\dim_{t'}(\mathcal{T}'_{x'}) = \dim_{t}(\mathcal{T}_x).$ \end{lemma} 
\begin{lemma} \label{lemma-behaviour-of-dimensions-wrt-smooth-morphisms-stacky} If $f: \mathcal{U} \to \mathcal{X}$ is a smooth morphism of locally Noetherian algebraic stacks, and if $u \in |\mathcal{U}|$ with image $x \in |\mathcal{X}|$, then $$ \dim_u (\mathcal{U}) = \dim_x(\mathcal{X}) + \dim_{u} (\mathcal{U}_x). $$ \end{lemma} 
\begin{lemma} \label{lemma-relative-dimension-is-semi-continuous} Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type morphism of algebraic stacks. \begin{enumerate} \item The function $t \mapsto \dim_t(\mathcal{T}_{f(t)})$ is upper semi-continuous on $|\mathcal{T}|$. \item If $f$ is smooth, then the function $t \mapsto \dim_t(\mathcal{T}_{f(t)})$ is locally constant on $|\mathcal{T}|$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-dimension-achieved-by-finite-type-point} If $X$ is a finite dimensional scheme, then there exists a closed (and hence finite type) point $x \in X$ such that $\dim_x X = \dim X$. \end{lemma} 
\begin{lemma} \label{lemma-constancy-of-dimension} If $X$ is an irreducible, Jacobson, catenary, and locally Noetherian scheme of finite dimension, then $\dim U = \dim X$ for every non-empty open subset $U$ of $X$. Equivalently, $\dim_x X$ is a constant function on $X$. \end{lemma} 
\begin{definition} \label{definition-pseudo-catenary} We say that a locally Noetherian algebraic stack $\mathcal{X}$ is {\it pseudo-catenary} if there exists a smooth and surjective morphism $U \to \mathcal{X}$ whose source is a universally catenary scheme. \end{definition} 
\begin{lemma} \label{lemma-catenary-covers} If $\mathcal{X}$ is a pseudo-catenary locally Noetherian algebraic stack, and if $\mathcal{Y} \to \mathcal{X}$ is a locally of finite type morphism, then there exists a smooth surjective morphism $V \to \mathcal{Y}$ whose source is a universally catenary scheme; thus $\mathcal{Y}$ is again pseudo-catenary. \end{lemma} 
\begin{lemma} \label{lemma-irreducible-implies-equidimensional} If $\mathcal{X}$ is a Jacobson, pseudo-catenary, and locally Noetherian  algebraic stack for which $|\mathcal{X}|$ is irreducible, then $\dim_x(\mathcal{X})$ is a constant function on $|\mathcal{X}|$. \end{lemma} 
\begin{lemma} \label{lemma-closed-immersions} If $\mathcal{Z} \hookrightarrow \mathcal{X}$ is a closed immersion of locally Noetherian algebraic stacks, and if $z \in |\mathcal{Z}|$ has image $x \in |\mathcal{X}|$, then $\dim_z (\mathcal{Z}) \leq \dim_x(\mathcal{X})$. \end{lemma} 
\begin{lemma} \label{lemma-dimension-via-components} If $\mathcal{X}$ is a locally Noetherian algebraic stack, and if $x \in |\mathcal{X}|$, then $\dim_x(\mathcal{X}) = \sup_{\mathcal{T}} \{ \dim_x(\mathcal{T}) \} $, where $\mathcal{T}$ runs over all the irreducible components of $|\mathcal{X}|$ passing through $x$ (endowed with their induced reduced structure). \end{lemma} 
\begin{lemma} \label{lemma-dimension-at-finite-type-point} If $\mathcal{X}$ is a locally Noetherian algebraic stack, and if $x \in |\mathcal{X}|$, then for any open substack $\mathcal{V}$ of $\mathcal{X}$ containing $x$, there is a finite type point $x_0 \in |\mathcal{V}|$ such that $\dim_{x_0}(\mathcal{X}) = \dim_x(\mathcal{V})$. \end{lemma} 
\begin{lemma} \label{lemma-monomorphing-a-component-in-of-the-right-dimension} Let $\mathcal{T} \hookrightarrow \mathcal{X}$ be a locally of finite type monomorphism of algebraic stacks, with $\mathcal{X}$ (and thus also $\mathcal{T}$) being Jacobson, pseudo-catenary, and locally Noetherian. Suppose further that $\mathcal{T}$ is irreducible of some (finite) dimension $d$, and that $\mathcal{X}$ is reduced and of dimension less than or equal to $d$. Then there is a non-empty open substack $\mathcal{V}$ of $\mathcal{T}$ such that the induced monomorphism $\mathcal{V} \hookrightarrow \mathcal{X}$ is an open immersion which identifies $\mathcal{V}$ with an open subset of an irreducible component of $\mathcal{X}$. \end{lemma} 
\begin{lemma} \label{lemma-dims-of-images} Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type morphism of Jacobson, pseudo-catenary, and locally Noetherian algebraic stacks, whose source is irreducible and whose target is quasi-separated, and let $\mathcal{Z} \hookrightarrow \mathcal{X}$ denote the scheme-theoretic image of $\mathcal{T}$. Then for all $t \in |T|$, we have that $\dim_t( \mathcal{T}_{f(t)}) \geq \dim \mathcal{T}  - \dim \mathcal{Z}$, and there is a non-empty (equivalently, dense) open subset of $|\mathcal{T}|$ over which equality holds. \end{lemma} 
\begin{lemma} \label{lemma-dims-of-images-two} Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type morphism of Jacobson, pseudo-catenary, and locally Noetherian algebraic stacks which is quasi-DM, whose source is irreducible and whose target is quasi-separated, and let $\mathcal{Z} \hookrightarrow \mathcal{X}$ denote the scheme-theoretic image of $\mathcal{T}$. Then $\dim \mathcal{Z} \leq \dim \mathcal{T}$, and furthermore, exactly one of the following two conditions holds: \begin{enumerate} \item for every finite type point $t \in |T|,$ we have $\dim_t(\mathcal{T}_{f(t)}) > 0,$ in which case $\dim \mathcal{Z} < \dim \mathcal{T}$; or \item   $\mathcal{T}$ and $\mathcal{Z}$ are of the same dimension. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-dimension-local-ring-pre} Let $\mathcal{X}$ be a locally Noetherian algebraic stack. Let $U \to \mathcal{X}$ be a smooth morphism and let $u \in U$. Then $$ \dim(\mathcal{O}_{U, \overline{u}}) - \dim(\mathcal{O}_{R_u, e(\overline{u})}) = 2\dim(\mathcal{O}_{U, \overline{u}}) - \dim(\mathcal{O}_{R, e(\overline{u})}) $$ Here $R = U \times_\mathcal{X} U$ with projections $s, t : R \to U$ and diagonal $e : U \to R$ and $R_u$ is the fibre of $s : R \to U$ over $u$. \end{lemma} 
\begin{lemma} \label{lemma-dimension-local-ring} Let $\mathcal{X}$ be a locally Noetherian algebraic stack. Let $x \in |\mathcal{X}|$ be a finite type point  Morphisms of Stacks, Definition \ref{stacks-morphisms-definition-finite-type-point}). Let $d \in \mathbf{Z}$. The following are equivalent \begin{enumerate} \item there exists a scheme $U$, a smooth morphism $U \to \mathcal{X}$, and a finite type point $u \in U$ mapping to $x$ such that $2\dim(\mathcal{O}_{U, \overline{u}}) - \dim(\mathcal{O}_{R, e(\overline{u})}) = d$, and \item for any scheme $U$, a smooth morphism $U \to \mathcal{X}$, and finite type point $u \in U$ mapping to $x$ we have $2\dim(\mathcal{O}_{U, \overline{u}}) - \dim(\mathcal{O}_{R, e(\overline{u})}) = d$. \end{enumerate} Here $R = U \times_\mathcal{X} U$ with projections $s, t : R \to U$ and diagonal $e : U \to R$ and $R_u$ is the fibre of $s : R \to U$ over $u$. \end{lemma} 
\begin{definition} \label{definition-dimension-local-ring} Let $\mathcal{X}$ be a locally Noetherian algebraic stack. Let $x \in |\mathcal{X}|$ be a finite type point. The {\it dimension of the local ring of $\mathcal{X}$ at $x$} is $d \in \mathbf{Z}$ if the equivalent conditions of Lemma \ref{lemma-dimension-local-ring} are satisfied. \end{definition} 
\begin{lemma} \label{lemma-dimension-formula} Suppose that $\mathcal{X}$ is an algebraic stack, locally of finite type over a locally Noetherian scheme $S$. Let $x_0 : \Spec(k) \to \mathcal{X}$ be a morphism where $k$ is a field of finite type over $S$. Represent $\mathcal{F}_{\mathcal{X}, k, x_0}$ as in Remark \ref{remark-groupoid-defo} by a cogroupoid $(A, B, s, t, c)$ of Noetherian complete local $S$-algebras with residue field $k$. Then $$ \text{the dimension of the local ring of }\mathcal{X}\text{ at }x_0 = 2\dim A - \dim B $$ \end{lemma} 
