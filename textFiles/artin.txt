\begin{lemma} \label{lemma-predeformation-category} The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ defined above is a predeformation category. \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth-on-deformation-categories} Let $S$ be a locally Noetherian scheme. Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Assume either \begin{enumerate} \item $F$ is formally smooth on objects (Criteria for Representability, Section \ref{criteria-section-formally-smooth}), \item $F$ is representable by algebraic spaces and formally smooth, or \item $F$ is representable by algebraic spaces and smooth. \end{enumerate} Then for every finite type field $k$ over $S$ and object $x_0$ of $\mathcal{X}$ over $k$ the functor (\ref{equation-functoriality}) is smooth in the sense of Formal Deformation Theory, Definition \ref{formal-defos-definition-smooth-morphism}. \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-deformation-categories} Let $S$ be a locally Noetherian scheme. Let $$ \xymatrix{ \mathcal{W} \ar[d] \ar[r] & \mathcal{Z} \ar[d] \\ \mathcal{X} \ar[r] & \mathcal{Y} } $$ be a $2$-fibre product of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Let $k$ be a finite type field over $S$ and $w_0$ an object of $\mathcal{W}$ over $k$. Let $x_0, z_0, y_0$ be the images of $w_0$ under the morphisms in the diagram. Then $$ \xymatrix{ \mathcal{F}_{\mathcal{W}, k, w_0} \ar[d] \ar[r] & \mathcal{F}_{\mathcal{Z}, k, z_0} \ar[d] \\ \mathcal{F}_{\mathcal{X}, k, x_0} \ar[r] & \mathcal{F}_{\mathcal{Y}, k, y_0} } $$ is a fibre product of predeformation categories. \end{lemma} 
\begin{lemma} \label{lemma-pushout} \begin{slogan} Algebraic stacks satisfy the (strong) Rim-Schlessinger condition \end{slogan} Let $S$ be a scheme. Let $$ \xymatrix{ X \ar[r] \ar[d] & X' \ar[d] \\ Y \ar[r] & Y' } $$ be a pushout in the category of schemes over $S$ where $X \to X'$ is a thickening and $X \to Y$ is affine, see More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}. Let $\mathcal{Z}$ be an algebraic stack over $S$. Then the functor of fibre categories $$ \mathcal{Z}_{Y'} \longrightarrow \mathcal{Z}_Y \times_{\mathcal{Z}_X} \mathcal{Z}_{X'} $$ is an equivalence of categories. \end{lemma} 
\begin{definition} \label{definition-RS} Let $S$ be a locally Noetherian scheme. Let $\mathcal{Z}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. We say $\mathcal{Z}$ satisfies {\it condition (RS)} if for every pushout $$ \xymatrix{ X \ar[r] \ar[d] & X' \ar[d] \\ Y \ar[r] & Y' = Y \amalg_X X' } $$ in the category of schemes over $S$ where \begin{enumerate} \item $X$, $X'$, $Y$, $Y'$ are spectra of local Artinian rings, \item $X$, $X'$, $Y$, $Y'$ are of finite type over $S$, and \item $X \to X'$ (and hence $Y \to Y'$) is a closed immersion \end{enumerate} the functor of fibre categories $$ \mathcal{Z}_{Y'} \longrightarrow \mathcal{Z}_Y \times_{\mathcal{Z}_X} \mathcal{Z}_{X'} $$ is an equivalence of categories. \end{definition} 
\begin{lemma} \label{lemma-algebraic-stack-RS} Let $\mathcal{X}$ be an algebraic stack over a locally Noetherian base $S$. Then $\mathcal{X}$ satisfies (RS). \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-RS} Let $S$ be a scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If $\mathcal{X}$, $\mathcal{Y}$, and $\mathcal{Z}$ satisfy (RS), then so does $\mathcal{X} \times_\mathcal{Y} \mathcal{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-deformation-category} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$ satisfying (RS). For any field $k$ of finite type over $S$ and any object $x_0$ of $\mathcal{X}$ lying over $k$ the predeformation category $p : \mathcal{F}_{\mathcal{X}, k, x_0} \to \mathcal{C}_\Lambda$ (\ref{equation-predeformation-category}) is a deformation category, see Formal Deformation Theory, Definition \ref{formal-defos-definition-deformation-category}. \end{lemma} 
\begin{lemma} \label{lemma-change-of-field} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Let $k$ be a field of finite type over $S$ and let $l/k$ be a finite extension. Let $x_0$ be an object of $\mathcal{F}$ lying over $\Spec(k)$. Denote $x_{l, 0}$ the restriction of $x_0$ to $\Spec(l)$. Then there is a canonical functor $$ (\mathcal{F}_{\mathcal{X}, k , x_0})_{l/k} \longrightarrow \mathcal{F}_{\mathcal{X}, l, x_{l, 0}} $$ of categories cofibred in groupoids over $\mathcal{C}_{\Lambda, l}$. If $\mathcal{X}$ satisfies (RS), then this functor is an equivalence. \end{lemma} 
\begin{lemma} \label{lemma-finite-dimension} Let $S$ be a locally Noetherian scheme. Assume \begin{enumerate} \item $\mathcal{X}$ is an algebraic stack, \item $U$ is a scheme locally of finite type over $S$, and \item $(\Sch/U)_{fppf} \to \mathcal{X}$ is a smooth surjective morphism. \end{enumerate} Then, for any $\mathcal{F} = \mathcal{F}_{\mathcal{X}, k, x_0}$ as in Section \ref{section-predeformation-categories} the tangent space $T\mathcal{F}$ and infinitesimal automorphism space $\text{Inf}(\mathcal{F})$ have finite dimension over $k$. \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-tangent-spaces} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Assume $\mathcal{X}$, $\mathcal{Y}$, $\mathcal{Z}$ satisfy (RS). Let $k$ be a field of finite type over $S$ and let $w_0$ be an object of $\mathcal{W} = \mathcal{X} \times_\mathcal{Y} \mathcal{Z}$ over $k$. Denote $x_0, y_0, z_0$ the objects of $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ you get from $w_0$. Then there is a $6$-term exact sequence $$ \xymatrix{ 0 \ar[r] & \text{Inf}(\mathcal{F}_{\mathcal{W}, k, w_0}) \ar[r] & \text{Inf}(\mathcal{F}_{\mathcal{X}, k, x_0}) \oplus \text{Inf}(\mathcal{F}_{\mathcal{Z}, k, z_0}) \ar[r] & \text{Inf}(\mathcal{F}_{\mathcal{Y}, k, y_0}) \ar[lld] \\  & T\mathcal{F}_{\mathcal{W}, k, w_0} \ar[r] & T\mathcal{F}_{\mathcal{X}, k, x_0} \oplus T\mathcal{F}_{\mathcal{Z}, k, z_0} \ar[r] & T\mathcal{F}_{\mathcal{Y}, k, y_0} } $$ of $k$-vector spaces. \end{lemma} 
\begin{definition} \label{definition-formal-objects} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. \begin{enumerate} \item A {\it formal object} $\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$ consists of a Noetherian complete local $S$-algebra $R$, objects $\xi_n$ of $\mathcal{X}$ lying over $\Spec(R/\mathfrak m_R^n)$, and morphisms $f_n : \xi_n \to \xi_{n + 1}$ of $\mathcal{X}$ lying over $\Spec(R/\mathfrak m^n) \to \Spec(R/\mathfrak m^{n + 1})$ such that $R/\mathfrak m$ is a field of finite type over $S$. \item A {\it morphism of formal objects} $a : \xi = (R, \xi_n, f_n) \to \eta = (T, \eta_n, g_n)$ is given by morphisms $a_n : \xi_n \to \eta_n$ such that for every $n$ the diagram $$ \xymatrix{ \xi_n \ar[r]_{f_n} \ar[d]_{a_n} & \xi_{n + 1} \ar[d]^{a_{n + 1}} \\ \eta_n \ar[r]^{g_n} & \eta_{n + 1} } $$ is commutative. Applying the functor $p$ we obtain a compatible collection of morphisms $\Spec(R/\mathfrak m_R^n) \to \Spec(T/\mathfrak m_T^n)$ and hence a morphism $a_0 : \Spec(R) \to \Spec(T)$ over $S$. We say that $a$ {\it lies over} $a_0$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-smooth-lift-formal} Let $S$ be a locally Noetherian scheme. Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Let $\eta = (R, \eta_n, g_n)$ be a formal object of $\mathcal{Y}$ and let $\xi_1$ be an object of $\mathcal{X}$ with $F(\xi_1) \cong \eta_1$. If $F$ is formally smooth on objects (see Criteria for Representability, Section \ref{criteria-section-formally-smooth}), then there exists a formal object $\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$ such that $F(\xi) \cong \eta$. \end{lemma} 
\begin{definition} \label{definition-effective} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. A formal object $\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$ is called {\it effective} if it is in the essential image of the functor (\ref{equation-approximation}). \end{definition} 
\begin{lemma} \label{lemma-effective} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be an algebraic stack over $S$. The functor (\ref{equation-approximation}) is an equivalence. \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-effective} Let $S$ be a scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If the functor (\ref{equation-approximation}) is an equivalence for  $\mathcal{X}$, $\mathcal{Y}$, and $\mathcal{Z}$, then it is  an equivalence for $\mathcal{X} \times_\mathcal{Y} \mathcal{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-approximate} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Let $x$ be an object of $\mathcal{X}$ lying over $\Spec(R)$ where $R$ is a Noetherian complete local ring with residue field $k$ of finite type over $S$. Let $s \in S$ be the image of $\Spec(k) \to S$. Assume that (a) $\mathcal{O}_{S, s}$ is a G-ring and (b) $p$ is limit preserving on objects. Then for every integer $N \geq 1$ there exist \begin{enumerate} \item a finite type $S$-algebra $A$, \item a maximal ideal $\mathfrak m_A \subset A$, \item an object $x_A$ of $\mathcal{X}$ over $\Spec(A)$, \item an $S$-isomorphism $R/\mathfrak m_R^N \cong A/\mathfrak m_A^N$, \item an isomorphism $x|_{\Spec(R/\mathfrak m_R^N)} \cong x_A|_{\Spec(A/\mathfrak m_A^N)}$ compatible with (4), and \item an isomorphism $\text{Gr}_{\mathfrak m_R}(R) \cong \text{Gr}_{\mathfrak m_A}(A)$ of graded $k$-algebras. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-limit-preserving} Let $S$ be a scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. We say $\mathcal{X}$ is {\it limit preserving} if for every affine scheme $T$ over $S$ which is a limit $T = \lim T_i$ of a directed inverse system of affine schemes $T_i$ over $S$, we have an equivalence $$ \colim \mathcal{X}_{T_i} \longrightarrow \mathcal{X}_T $$ of fibre categories. \end{definition} 
\begin{lemma} \label{lemma-fibre-product-limit-preserving} Let $S$ be a scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. \begin{enumerate} \item If $\mathcal{X} \to (\Sch/S)_{fppf}$ and $\mathcal{Z} \to (\Sch/S)_{fppf}$ are limit preserving on objects and $\mathcal{Y}$ is limit preserving, then $\mathcal{X} \times_\mathcal{Y} \mathcal{Z} \to (\Sch/S)_{fppf}$ is limit preserving on objects. \item If $\mathcal{X}$, $\mathcal{Y}$, and $\mathcal{Z}$ are limit preserving, then so is $\mathcal{X} \times_\mathcal{Y} \mathcal{Z}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-limit-preserving-algebraic-space} Let $S$ be a scheme. Let $\mathcal{X}$ be an algebraic stack over $S$. Then the following are equivalent \begin{enumerate} \item $\mathcal{X}$ is a stack in setoids and $\mathcal{X} \to (\Sch/S)_{fppf}$ is limit preserving on objects, \item $\mathcal{X}$ is a stack in setoids and limit preserving, \item $\mathcal{X}$ is representable by an algebraic space locally of finite presentation. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-diagonal} Let $S$ be a scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces and $\mathcal{X}$ is limit preserving. Then $\Delta$ is locally of finite type. \end{lemma} 
\begin{definition} \label{definition-versal-formal-object} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Let $\xi = (R, \xi_n, f_n)$ be a formal object. Set $k = R/\mathfrak m$ and $x_0 = \xi_1$. We will say that $\xi$ is {\it versal} if $\xi$ as a formal object of $\mathcal{F}_{\mathcal{X}, k, x_0}$ (Remark \ref{remark-formal-objects-match}) is versal in the sense of Formal Deformation Theory, Definition \ref{formal-defos-definition-versal}. \end{definition} 
\begin{definition} \label{definition-versal} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be fibred in groupoids over $(\Sch/S)_{fppf}$. Let $U$ be a scheme locally of finite type over $S$. Let $x$ be an object of $\mathcal{X}$ lying over $U$. Let $u_0$ be finite type point of $U$. We say $x$ is {\it versal} at $u_0$ if the morphism $\hat x$ (\ref{equation-hat-x}) is smooth, see Formal Deformation Theory, Definition \ref{formal-defos-definition-smooth-morphism}. \end{definition} 
\begin{lemma} \label{lemma-versality-matches} With notation as in Definition \ref{definition-versal}. Let $R = \mathcal{O}_{U, u_0}^\wedge$. Let $\xi$ be the formal object of $\mathcal{X}$ over $R$ associated to $x|_{\Spec(R)}$, see (\ref{equation-approximation}). Then $$ x\text{ is versal at }u_0 \Leftrightarrow \xi\text{ is versal} $$ \end{lemma} 
\begin{lemma} \label{lemma-versal-implies-smooth} Let $S$ be a locally Noetherian scheme. Let $f : U \to V$ be a morphism of schemes locally of finite type over $S$. Let $u_0 \in U$ be a finite type point. The following are equivalent \begin{enumerate} \item $f$ is smooth at $u_0$, \item $f$ viewed as an object of $(\Sch/V)_{fppf}$ over $U$ is versal at $u_0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-versal-change-of-field} Let $S$, $\mathcal{X}$, $U$, $x$, $u_0$ be as in Definition \ref{definition-versal}. Let $l$ be a field and let $u_{l, 0} : \Spec(l) \to U$ be a morphism with image $u_0$ such that $l/k = \kappa(u_0)$ is finite. Set $x_{l, 0} = x_0|_{\Spec(l)}$. If $\mathcal{X}$ satisfies (RS) and $x$ is versal at $u_0$, then $$ \mathcal{F}_{(\Sch/U)_{fppf}, l, u_{l, 0}} \longrightarrow \mathcal{F}_{\mathcal{X}, l, x_{l, 0}} $$ is smooth. \end{lemma} 
\begin{lemma} \label{lemma-base-change-versal} Let $S$, $\mathcal{X}$, $U$, $x$, $u_0$ be as in Definition \ref{definition-versal}. Assume \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\Delta$ is locally of finite type (for example if $\mathcal{X}$ is limit preserving), and \item $\mathcal{X}$ has (RS). \end{enumerate} Let $V$ be a scheme locally of finite type over $S$ and let $y$ be an object of $\mathcal{X}$ over $V$. Form the $2$-fibre product $$ \xymatrix{ \mathcal{Z} \ar[r] \ar[d] & (\Sch/U)_{fppf} \ar[d]^x \\ (\Sch/V)_{fppf} \ar[r]^y & \mathcal{X} } $$ Let $Z$ be the algebraic space representing $\mathcal{Z}$ and let $z_0 \in |Z|$ be a finite type point lying over $u_0$. If $x$ is versal at $u_0$, then the morphism $Z \to V$ is smooth at $z_0$. \end{lemma} 
\begin{lemma} \label{lemma-approximate-versal} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Let $\xi = (R, \xi_n, f_n)$ be a formal object of $\mathcal{X}$ with $\xi_1$ lying over $\Spec(k) \to S$ with image $s \in S$. Assume \begin{enumerate} \item $\xi$ is versal, \item $\xi$ is effective, \item $\mathcal{O}_{S, s}$ is a G-ring, and \item $p : \mathcal{X} \to (\Sch/S)_{fppf}$ is limit preserving on objects. \end{enumerate} Then there exist a morphism of finite type $U \to S$, a finite type point $u_0 \in U$ with residue field $k$, and an object $x$ of $\mathcal{X}$ over $U$ such that $x$ is versal at $u_0$ and such that $x|_{\Spec(\mathcal{O}_{U, u_0}/\mathfrak m_{u_0}^n)} \cong \xi_n$. \end{lemma} 
\begin{definition} \label{definition-openness-versality} Let $S$ be a locally Noetherian scheme. \begin{enumerate} \item Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. We say $\mathcal{X}$ satisfies {\it openness of versality} if given a scheme $U$ locally of finite type over $S$, an object $x$ of $\mathcal{X}$ over $U$, and a finite type point $u_0 \in U$ such that $x$ is versal at $u_0$, then there exists an open neighbourhood $u_0 \in U' \subset U$ such that $x$ is versal at every finite type point of $U'$. \item Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$. We say $f$ satisfies {\it openness of versality} if given a scheme $U$ locally of finite type over $S$, an object $y$ of $\mathcal{Y}$ over $U$, openness of versality holds for $(\Sch/U)_{fppf} \times_\mathcal{Y} \mathcal{X}$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-versal-smooth} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Let $U$ be a scheme locally of finite type over $S$. Let $x$ be an object of $\mathcal{X}$ over $U$. Assume that $x$ is versal at every finite type point of $U$ and that $\mathcal{X}$ satisfies (RS). Then $x : (\Sch/U)_{fppf} \to \mathcal{X}$ satisfies (\ref{equation-smooth}). \end{lemma} 
\begin{lemma} \label{lemma-composition-smooth} Let $S$ be a locally Noetherian scheme. Let $f : \mathcal{X} \to \mathcal{Y}$ and $g : \mathcal{Y} \to \mathcal{Z}$ be composable $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If $f$ and $g$ satisfy (\ref{equation-smooth}) so does $g \circ f$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-smooth} Let $S$ be a locally Noetherian scheme. Let $f : \mathcal{X} \to \mathcal{Y}$ and $\mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If $f$ satisfies (\ref{equation-smooth}) so does the projection $\mathcal{X} \times_\mathcal{Y} \mathcal{Z} \to \mathcal{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-smooth-smooth} Let $S$ be a locally Noetherian scheme. Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If $f$ is formally smooth on objects, then $f$ satisfies (\ref{equation-smooth}). If $f$ is representable by algebraic spaces and smooth, then $f$ satisfies (\ref{equation-smooth}). \end{lemma} 
\begin{lemma} \label{lemma-implies-smooth} Let $S$ be a locally Noetherian scheme. Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Assume \begin{enumerate} \item $f$ is representable by algebraic spaces, \item $f$ satisfies (\ref{equation-smooth}), \item $\mathcal{X} \to (\Sch/S)_{fppf}$ is limit preserving on objects, and \item $\mathcal{Y}$ is limit preserving. \end{enumerate} Then $f$ is smooth. \end{lemma} 
\begin{lemma} \label{lemma-get-smooth} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Let $k$ be a finite type field over $S$ and let $x_0$ be an object of $\mathcal{X}$ over $\Spec(k)$ with image $s \in S$. Assume \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ satisfies axioms [1], [2], [3] (see Section \ref{section-axioms}), \item every formal object of $\mathcal{X}$ is effective, \item openness of versality holds for $\mathcal{X}$, and \item $\mathcal{O}_{S, s}$ is a G-ring. \end{enumerate} Then there exist a morphism of finite type $U \to S$ and an object $x$ of $\mathcal{X}$ over $U$ such that $$ x : (\Sch/U)_{fppf} \longrightarrow \mathcal{X} $$ is smooth and such that there exists a finite type point $u_0 \in U$ whose residue field is $k$ and such that $x|_{u_0} \cong x_0$. \end{lemma} 
\begin{proposition} \label{proposition-spaces-diagonal-representable} Let $S$ be a locally Noetherian scheme. Let $F : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$ be a functor. Assume that \begin{enumerate} \item $\Delta : F \to F \times F$ is representable by algebraic spaces, \item $F$ satisfies axioms [-1], [0], [1], [2], [3], [4], [5] (see Section \ref{section-axioms-functors}), and \item $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s$ of $S$. \end{enumerate} Then $F$ is an algebraic space. \end{proposition} 
\begin{lemma} \label{lemma-monomorphism} Let $S$ be a locally Noetherian scheme. Let $a : F \to G$ be a transformation of functors $(\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Assume that \begin{enumerate} \item $a$ is injective, \item $F$ satisfies axioms [0], [1], [2], [4], and [5], \item $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s$ of $S$, \item $G$ is an algebraic space locally of finite type over $S$, \end{enumerate} Then $F$ is an algebraic space. \end{lemma} 
\begin{lemma} \label{lemma-diagonal-representable} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Assume that \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ satisfies axioms [-1], [0], [1], [2], [3] (see Section \ref{section-axioms}), \item every formal object of $\mathcal{X}$ is effective, \item $\mathcal{X}$ satisfies openness of versality, and \item $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s$ of $S$. \end{enumerate} Then $\mathcal{X}$ is an algebraic stack. \end{lemma} 
\begin{proposition} \label{proposition-second-diagonal-representable} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids. Assume that \begin{enumerate} \item $\Delta_\Delta : \mathcal{X} \to \mathcal{X} \times_{\mathcal{X} \times \mathcal{X}} \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ satisfies axioms [-1], [0], [1], [2], [3], [4], and [5] (see Section \ref{section-axioms}), \item $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s$ of $S$. \end{enumerate} Then $\mathcal{X}$ is an algebraic stack. \end{proposition} 
\begin{definition} \label{definition-RS-star} Let $S$ be a scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. We say $\mathcal{X}$ satisfies {\it condition (RS*)} if given a fibre product diagram $$ \xymatrix{ B' \ar[r] & B \\ A' = A \times_B B' \ar[u] \ar[r] & A \ar[u] } $$ of $S$-algebras, with $B' \to B$ surjective with square zero kernel, the functor of fibre categories $$ \mathcal{X}_{\Spec(A')} \longrightarrow \mathcal{X}_{\Spec(A)} \times_{\mathcal{X}_{\Spec(B)}} \mathcal{X}_{\Spec(B')} $$ is an equivalence of categories. \end{definition} 
\begin{lemma} \label{lemma-algebraic-stack-RS-star} Let $\mathcal{X}$ be an algebraic stack over a base $S$. Then $\mathcal{X}$ satisfies (RS*). \end{lemma} 
\begin{lemma} \label{lemma-fibre-product-RS-star} Let $S$ be a scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. If $\mathcal{X}$, $\mathcal{Y}$, and $\mathcal{Z}$ satisfy (RS*), then so does $\mathcal{X} \times_\mathcal{Y} \mathcal{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-single-point} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$ having (RS*). Let $x$ be an object of $\mathcal{X}$ over an affine scheme $U$ of finite type over $S$. Let $u \in U$ be a finite type point such that $x$ is not versal at $u$. Then there exists a morphism $x \to y$ of $\mathcal{X}$ lying over $U \to T$ satisfying \begin{enumerate} \item the morphism $U \to T$ is a first order thickening, \item we have a short exact sequence $$ 0 \to \kappa(u) \to \mathcal{O}_T \to \mathcal{O}_U \to 0 $$ \item there does {\bf not} exist a pair $(W, \alpha)$ consisting of an open neighbourhood $W \subset T$ of $u$ and a morphism $\beta : y|_W \to x$ such that the composition $$ x|_{U \cap W} \xrightarrow{\text{restriction of }x \to y} y|_W \xrightarrow{\beta} x $$ is the canonical morphism $x|_{U \cap W} \to x$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-generalization-versality} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ has (RS*), \item $\mathcal{X}$ is limit preserving. \end{enumerate} Let $x$ be an object of $\mathcal{X}$ over a scheme $U$ of finite type over $S$. Let $u \leadsto u_0$ be a specialization of finite type points of $U$ such that $x$ is versal at $u_0$. Then $x$ is versal at $u$. \end{lemma} 
\begin{lemma} \label{lemma-infinite-sequence-pre} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$ having (RS*). Let $x$ be an object of $\mathcal{X}$ over an affine scheme $U$ of finite type over $S$. Let $u_n \in U$, $n \geq 1$ be finite type points such that (a) there are no specializations $u_n \leadsto u_m$ for $n \not = m$, and (b) $x$ is not versal at $u_n$ for all $n$. Then there exist morphisms $$ x \to x_1 \to x_2 \to \ldots \quad\text{in }\mathcal{X}\text{ lying over }\quad U \to U_1 \to U_2 \to \ldots $$ over $S$ such that \begin{enumerate} \item for each $n$ the morphism $U \to U_n$ is a first order thickening, \item for each $n$ we have a short exact sequence $$ 0 \to \kappa(u_n) \to \mathcal{O}_{U_n} \to \mathcal{O}_{U_{n - 1}} \to 0 $$ with $U_0 = U$ for $n = 1$, \item for each $n$ there does {\bf not} exist a pair $(W, \alpha)$ consisting of an open neighbourhood $W \subset U_n$ of $u_n$ and a morphism $\alpha : x_n|_W \to x$ such that the composition $$ x|_{U \cap W} \xrightarrow{\text{restriction of }x \to x_n} x_n|_W \xrightarrow{\alpha} x $$ is the canonical morphism $x|_{U \cap W} \to x$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-SGE-implies-openness-versality} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ has (RS*), \item $\mathcal{X}$ is limit preserving, \item systems $(\xi_n)$ as in Remark \ref{remark-strong-effectiveness} where $\Ker(R_m \to R_n)$ is an ideal of square zero for all $m \geq n$ are effective. \end{enumerate} Then $\mathcal{X}$ satisfies openness of versality. \end{lemma} 
\begin{lemma} \label{lemma-functoriality} Let $S$ be a scheme. Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Let $$ \xymatrix{ B' \ar[r] & B \\ A' \ar[u] \ar[r] & A \ar[u] } $$ be a commutative diagram of $S$-algebras. Let $x$ be an object of $\mathcal{X}$ over $\Spec(A)$, let $y$ be an object of $\mathcal{Y}$ over $\Spec(B)$, and let $\phi : f(x)|_{\Spec(B)} \to y$ be a morphism of $\mathcal{Y}$ over $\Spec(B)$. Then there is a canonical functor $$ \textit{Lift}(x, A') \longrightarrow \textit{Lift}(y, B') $$ of categories of lifts induced by $f$ and $\phi$. The construction is compatible with compositions of $1$-morphisms of categories fibred in groupoids in an obvious manner. \end{lemma} 
\begin{lemma} \label{lemma-properties-lift-RS-star} Let $S$ be a scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume $\mathcal{X}$ satisfies condition (RS*). Let $A$ be an $S$-algebra and let $x$ be an object of $\mathcal{X}$ over $\Spec(A)$. \begin{enumerate} \item There exists an $A$-linear functor $\text{Inf}_x : \text{Mod}_A \to \text{Mod}_A$ such that given a deformation situation $(x, A' \to A)$ and a lift $x'$ there is an isomorphism $\text{Inf}_x(I) \to \text{Inf}(x'/x)$ where $I = \Ker(A' \to A)$. \item There exists an $A$-linear functor $T_x : \text{Mod}_A \to \text{Mod}_A$ such that \begin{enumerate} \item given $M$ in $\text{Mod}_A$ there is a bijection $T_x(M) \to \text{Lift}(x, A[M])$, \item given a deformation situation $(x, A' \to A)$ there is an action $$ T_x(I) \times \text{Lift}(x, A') \to \text{Lift}(x, A') $$ where $I = \Ker(A' \to A)$. It is simply transitive if $\text{Lift}(x, A') \not = \emptyset$. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ses-inf-and-T} Let $S$ be a scheme. Let $p : \mathcal{X} \to \mathcal{Y}$ and $q : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms of categories fibred in groupoids over $(\Sch/S)_{fppf}$. Assume $\mathcal{X}$, $\mathcal{Y}$, $\mathcal{Z}$ satisfy (RS*). Let $A$ be an $S$-algebra and let $w$ be an object of $\mathcal{W} = \mathcal{X} \times_\mathcal{Y} \mathcal{Z}$ over $A$. Denote $x, y, z$ the objects of $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ you get from $w$. For any $A$-module $M$ there is a $6$-term exact sequence $$ \xymatrix{ 0 \ar[r] & \text{Inf}_w(M) \ar[r] & \text{Inf}_x(M) \oplus \text{Inf}_z(M) \ar[r] & \text{Inf}_y(M) \ar[lld] \\  & T_w(M) \ar[r] & T_x(M) \oplus T_z(M) \ar[r] & T_y(M) } $$ of $A$-modules. \end{lemma} 
\begin{definition} \label{definition-obstruction-theory} Let $S$ be a locally Noetherian base. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. An {\it obstruction theory} is  given by the following data \begin{enumerate} \item for every $S$-algebra $A$ such that $\Spec(A) \to S$ maps into an affine open and every object $x$ of $\mathcal{X}$ over $\Spec(A)$ an $A$-linear functor $$ \mathcal{O}_x : \text{Mod}_A \to \text{Mod}_A $$ of {\it obstruction modules}, \item for $(x, A)$ as in (1), a ring map $A \to B$, $M \in \text{Mod}_A$, $N \in \text{Mod}_B$, and an $A$-linear map $M \to N$ an induced $A$-linear map $\mathcal{O}_x(M) \to \mathcal{O}_y(N)$ where $y = x|_{\Spec(B)}$, and \item for every deformation situation $(x, A' \to A)$ an {\it obstruction} element $o_x(A') \in \mathcal{O}_x(I)$ where $I = \Ker(A' \to A)$. \end{enumerate} These data are subject to the following conditions \begin{enumerate} \item[(i)] the functoriality maps turn the obstruction modules into a functor from the category of triples $(x, A, M)$ to sets, \item[(ii)] for every morphism of deformation situations $(y, B' \to B) \to (x, A' \to A)$ the element $o_x(A')$ maps to $o_y(B')$, and \item[(iii)] we have $$ \text{Lift}(x, A') \not = \emptyset \Leftrightarrow o_x(A') = 0 $$ for every deformation situation $(x, A' \to A)$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-get-openness-obstruction-theory} \begin{reference} This is \cite[Theorem 4.4]{Hall-coherent} \end{reference} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume \begin{enumerate} \item $\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is representable by algebraic spaces, \item $\mathcal{X}$ has (RS*), \item $\mathcal{X}$ is limit preserving, \item there exists an obstruction theory\footnote{Analyzing the proof the reader sees that in fact it suffices to check the functoriality (ii) of obstruction classes in Definition \ref{definition-obstruction-theory} for maps $(y, B' \to B) \to (x, A' \to A)$ with $B = A$ and $y = x$.}, \item for an object $x$ of $\mathcal{X}$ over $\Spec(A)$ and $A$-modules $M_n$, $n \geq 1$ we have \begin{enumerate} \item $T_x(\prod M_n) = \prod T_x(M_n)$, \item $\mathcal{O}_x(\prod M_n) \to \prod \mathcal{O}_x(M_n)$ is injective. \end{enumerate} \end{enumerate} Then $\mathcal{X}$ satisfies openness of versality. \end{lemma} 
\begin{lemma} \label{lemma-compute-ext-into-field} Let $A \to k$ be a ring map with $k$ a field. Let $E \in D^-(A)$. Then $\Ext^i_A(E, k) = \Hom_k(H^{-i}(E \otimes^\mathbf{L} k), k)$. \end{lemma} 
\begin{lemma} \label{lemma-construct-essential-surjection} Let $\Lambda \to A \to k$ be finite type ring maps of Noetherian rings with $k = \kappa(\mathfrak p)$ for some prime $\mathfrak p$ of $A$. Let $\xi : E \to \NL_{A/\Lambda}$ be morphism of $D^{-}(A)$ such that $H^{-1}(\xi \otimes^{\mathbf{L}} k)$ is not surjective. Then there exists a surjection $A' \to A$ of $\Lambda$-algebras such that \begin{enumerate} \item[(a)] $I = \Ker(A' \to A)$ has square zero and is isomorphic to $k$ as an $A$-module, \item[(b)] $\Omega_{A'/\Lambda} \otimes k = \Omega_{A/\Lambda} \otimes k$, and \item[(c)] $E \to \NL_{A/A'}$ is zero. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-characterize-versal} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$ satisfying (RS*). Let $U = \Spec(A)$ be an affine scheme of finite type over $S$ which maps into an affine open $\Spec(\Lambda)$. Let $x$ be an object of $\mathcal{X}$ over $U$. Let $\xi : E \to \NL_{A/\Lambda}$ be a morphism of $D^{-}(A)$. Assume \begin{enumerate} \item[(i)] for every deformation situation $(x, A' \to A)$ we have: $x$ lifts to $\Spec(A')$ if and only if $E \to \NL_{A/\Lambda} \to \NL_{A/A'}$ is zero, and \item[(ii)] there is an isomorphism of functors $T_x(-) \to \Ext^0_A(E, -)$ such that $E \to \NL_{A/\Lambda} \to \Omega^1_{A/\Lambda}$ corresponds to the canonical element (see Remark \ref{remark-canonical-element}). \end{enumerate} Let $u_0 \in U$ be a finite type point with residue field $k = \kappa(u_0)$. Consider the following statements \begin{enumerate} \item $x$ is versal at $u_0$, and \item $\xi : E \to \NL_{A/\Lambda}$ induces a surjection $H^{-1}(E \otimes_A^{\mathbf{L}} k) \to H^{-1}(\NL_{A/\Lambda} \otimes_A^{\mathbf{L}} k)$ and an injection $H^0(E \otimes_A^{\mathbf{L}} k) \to H^0(\NL_{A/\Lambda} \otimes_A^{\mathbf{L}} k)$. \end{enumerate} Then we always have (2) $\Rightarrow$ (1) and we have (1) $\Rightarrow$ (2) if $u_0$ is a closed point. \end{lemma} 
\begin{lemma} \label{lemma-openness} Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$ satisfying (RS*). Let $U = \Spec(A)$ be an affine scheme of finite type over $S$ which maps into an affine open $\Spec(\Lambda)$. Let $x$ be an object of $\mathcal{X}$ over $U$. Let $\xi : E \to \NL_{A/\Lambda}$ be a morphism of $D^{-}(A)$. Assume \begin{enumerate} \item[(i)] for every deformation situation $(x, A' \to A)$ we have: $x$ lifts to $\Spec(A')$ if and only if $E \to \NL_{A/\Lambda} \to \NL_{A/A'}$ is zero, \item[(ii)] there is an isomorphism of functors $T_x(-) \to \Ext^0_A(E, -)$ such that $E \to \NL_{A/\Lambda} \to \Omega^1_{A/\Lambda}$ corresponds to the canonical element (see Remark \ref{remark-canonical-element}), \item[(iii)] the cohomology groups of $E$ are finite $A$-modules. \end{enumerate} If $x$ is versal at a closed point $u_0 \in U$, then there exists an open neighbourhood $u_0 \in U' \subset U$ such that $x$ is versal at every finite type point of $U'$. \end{lemma} 
\begin{definition} \label{definition-naive-obstruction-theory} Let $S$ be a locally Noetherian base. Let $\mathcal{X}$ be a category fibred in groupoids over $(\Sch/S)_{fppf}$. Assume that $\mathcal{X}$ satisfies (RS*). A {\it naive obstruction theory} is  given by the following data \begin{enumerate} \item \label{item-map} for every $S$-algebra $A$ such that $\Spec(A) \to S$ maps into an affine open $\Spec(\Lambda) \subset S$ and every object $x$ of $\mathcal{X}$ over $\Spec(A)$ we are given an object $E_x \in D^-(A)$ and a map $\xi_x : E \to \NL_{A/\Lambda}$, \item \label{item-inf} given $(x, A)$ as in (\ref{item-map}) there are transformations of functors $$ \text{Inf}_x( - ) \to \Ext^{-1}_A(E_x, -) \quad\text{and}\quad T_x(-) \to \Ext^0_A(E_x, -) $$ \item \label{item-functoriality} for $(x, A)$ as in (\ref{item-map}) and a ring map $A \to B$ setting $y = x|_{\Spec(B)}$ there is a functoriality map $E_x \to E_y$ in $D(A)$. \end{enumerate} These data are subject to the following conditions \begin{enumerate} \item[(i)] in the situation of (\ref{item-functoriality}) the diagram $$ \xymatrix{ E_y \ar[r]_{\xi_y} & \NL_{B/\Lambda} \\ E_x \ar[u] \ar[r]^{\xi_x} & \NL_{A/\Lambda} \ar[u] } $$ is commutative in $D(A)$, \item[(ii)] given $(x, A)$ as in (\ref{item-map}) and $A \to B \to C$ setting $y = x|_{\Spec(B)}$ and $z = x|_{\Spec(C)}$ the composition of the functoriality maps $E_x \to E_y$ and $E_y \to E_z$ is the functoriality map $E_x \to E_z$, \item[(iii)] the maps of (\ref{item-inf}) are isomorphisms compatible with the functoriality maps and the maps of Remark \ref{remark-functoriality}, \item[(iv)] the composition $E_x \to \NL_{A/\Lambda} \to \Omega_{A/\Lambda}$ corresponds to the canonical element of $T_x(\Omega_{A/\Lambda}) = \Ext^0(E_x, \Omega_{A/\Lambda})$, see Remark \ref{remark-canonical-element}, \item[(v)] given a deformation situation $(x, A' \to A)$ with $I = \Ker(A' \to A)$ the composition $E_x \to \NL_{A/\Lambda} \to \NL_{A/A'}$ is zero in $$ \Hom_A(E_x, \NL_{A/\Lambda}) = \Ext^0_A(E_x, \NL_{A/A'}) = \Ext^1_A(E_x, I) $$ if and only if $x$ lifts to $A'$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-naive-obstruction-theory-qis} Let $S$ and $\mathcal{X}$ be as in Definition \ref{definition-naive-obstruction-theory} and let $\mathcal{X}$ be endowed with a naive obstruction theory. Let $A \to B$ and $y \to x$ be as in (\ref{item-functoriality}). Let $k$ be a $B$-algebra which is a field. Then the functoriality map $E_x \to E_y$ induces bijections $$ H^i(E_x \otimes_A^{\mathbf{L}} k) \to H^i(E_y \otimes_B^{\mathbf{L}} k) $$ for $i = 0, 1$. \end{lemma} 
\begin{lemma} \label{lemma-naive-obstruction-theory-gives-openness} Let $S$ be a locally Noetherian scheme. Let $p : \mathcal{X} \to (\Sch/S)_{fppf}^{opp}$ be a category fibred in groupoids. Assume that $\mathcal{X}$ satisfies (RS*) and that $\mathcal{X}$ has a naive obstruction theory. Then openness of versality holds for $\mathcal{X}$ provided the complexes $E_x$ of Definition \ref{definition-naive-obstruction-theory} have finitely generated cohomology groups for pairs $(A, x)$ where $A$ is of finite type over $S$. \end{lemma} 
\begin{lemma} \label{lemma-dual-obstruction} In Situation \ref{situation-dual}. Assume furthermore that \begin{enumerate} \item[(iv)] given a short exact sequence of deformation situations as in Remark \ref{remark-short-exact-sequence-thickenings} and a lift $x'_2 \in \text{Lift}(x, A_2')$ then $o_x(A_3') \in H^2(K^\bullet \otimes_A^\mathbf{L} I_3)$ equals $\partial\theta$ where $\theta \in H^1(K^\bullet \otimes_A^\mathbf{L} I_1)$ is the element corresponding to $x'_2|_{\Spec(A_1')}$ via $A_1' = A[I_1]$ and the given map $T_x(-) \to H^1(K^\bullet \otimes_A^\mathbf{L} -)$. \end{enumerate} In this case there exists an element $\xi \in H^1(K^\bullet \otimes_A^\mathbf{L} \NL_{A/\Lambda})$ such that \begin{enumerate} \item for every deformation situation $(x, A' \to A)$ we have $\xi_{A'} = o_x(A')$, and \item $\xi_{can}$ matches the canonical element of Remark \ref{remark-canonical-element} via the given transformation $T_x(-) \to H^1(K^\bullet \otimes_A^\mathbf{L} -)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-dual-openness} In Situation \ref{situation-dual} assume that (iv) of Lemma \ref{lemma-dual-obstruction} holds and that $K^\bullet$ is a perfect object of $D(A)$. In this case, if $x$ is versal at a closed point $u_0 \in U$ then there exists an open neighbourhood $u_0 \in U' \subset U$ such that $x$ is versal at every finite type point of $U'$. \end{lemma} 
\begin{lemma} \label{lemma-canonical-extension} Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$. Restricting along the inclusion functor $(\textit{Noetherian}/S)_\tau \to (\Sch/S)_\tau$ defines an equivalence of categories between \begin{enumerate} \item the category of limit preserving sheaves on $(\Sch/S)_\tau$ and \item the category of limit preserving sheaves on $(\textit{Noetherian}/S)_\tau$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-representable-limit-preserving} Let $X$ be an object of $(\textit{Noetherian}/S)_\tau$. If the functor of points $h_X : (\textit{Noetherian}/S)_\tau^{opp} \to \textit{Sets}$ is limit preserving, then $X$ is locally of finite presentation over $S$. \end{lemma} 
\begin{lemma} \label{lemma-representable} Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$. Let $F', G' : (\Sch/S)_\tau^{opp} \to \textit{Sets}$ be limit preserving and sheaves. Let $a' : F' \to G'$ be a transformation of functors. Denote $a : F \to G$ the restriction of $a' : F' \to G'$ to $(\textit{Noetherian}/S)_\tau$. The following are equivalent \begin{enumerate} \item $a'$ is representable (as a transformation of functors, see Categories, Definition \ref{categories-definition-representable-morphism}), and \item for every object $V$ of $(\textit{Noetherian}/S)_\tau$ and every map $V \to G$ the fibre product $F \times_G V : (\textit{Noetherian}/S)_\tau^{opp} \to \textit{Sets}$ is a representable functor, and \item same as in (2) but only for $V$ affine finite type over $S$ mapping into an affine open of $S$. \end{enumerate} \end{lemma} 
\begin{proposition} \label{proposition-spaces-diagonal-representable-noetherian} Let $S$ be a locally Noetherian scheme. Let $F : (\textit{Noetherian}/S)_\etale^{opp} \to \textit{Sets}$ be a functor. Assume that \begin{enumerate} \item $\Delta : F \to F \times F$ is representable (as a transformation of functors, see Categories, Definition \ref{categories-definition-representable-morphism}), \item $F$ satisfies axioms [-1], [0], [1], [2], [3], [4], [5] (see above), and \item $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s$ of $S$. \end{enumerate} Then there exists a unique algebraic space $F' : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$ whose restriction to $(\textit{Noetherian}/S)_\etale$ is $F$ (see proof for elucidation). \end{proposition} 
\begin{lemma} \label{lemma-functor} In Situation \ref{situation-contractions} the rule $F$ that sends a locally Noetherian scheme $V$ over $S$ to the set of triples $(Z, u', \hat x)$ satisfying the compatibility condition and which sends a a morphism $\varphi : V_2 \to V_1$ of locally Noetherian schemes over $S$ to the map $$ F(\varphi) : F(V_1) \longrightarrow F(V_2) $$ sending an element $(Z_1, u'_1, \hat x_1)$ of $F(V_1)$ to $(Z_2, u'_2, \hat x_2)$ in $F(V_2)$ given by \begin{enumerate} \item $Z_2 \subset V_2$ is the inverse image of $Z_1$ by $\varphi$, \item $u'_2$ is the composition of $u'_1$ and $\varphi|_{V_2 \setminus Z_2} : V_2 \setminus Z_2 \to V_1 \setminus Z_1$, \item $\hat x_2$ is the composition of $\hat x_1$ and $\varphi_{/Z_2} : V_{2, /Z_2} \to V_{1, /Z_1}$ \end{enumerate} is a contravariant functor. \end{lemma} 
\begin{lemma} \label{lemma-solution} In Situation \ref{situation-contractions} if there exists a solution $(f : X' \to X, T, a)$ then there is a functorial bijection $F(V) = \Mor_S(V, X)$ on the category of locally Noetherian schemes $V$ over $S$. \end{lemma} 
\begin{lemma} \label{lemma-functor-is-solution} In Situation \ref{situation-contractions} if there exists an algebraic space $X$ locally of finite type over $S$ and a functorial bijection $F(V) = \Mor_S(V, X)$ on the category of locally Noetherian schemes $V$ over $S$, then $X$ is a solution. \end{lemma} 
\begin{lemma} \label{lemma-closed-immersion} In Situation \ref{situation-contractions} assume given a closed subset $Z \subset S$ such that \begin{enumerate} \item the inverse image of $Z$ in $X'$ is $T'$, \item $U' \to S \setminus Z$ is a closed immersion, \item $W \to S_{/Z}$ is a closed immersion. \end{enumerate} Then there exists a solution $(f : X' \to X, T, a)$ and moreover $X \to S$ is a closed immersion. \end{lemma} 
\begin{lemma} \label{lemma-diagonal-contractions} In Situation \ref{situation-contractions} assume $X' \to S$ and $W \to S$ are separated. Then the diagonal $\Delta : F \to F \times F$ is representable by closed immersions. \end{lemma} 
\begin{lemma} \label{lemma-sheaf} In Situation \ref{situation-contractions} the functor $F$ satisfies the sheaf property for all \'etale coverings of locally Noetherian schemes over $S$. \end{lemma} 
\begin{lemma} \label{lemma-limit-preserving} In Situation \ref{situation-contractions} the functor $F$ is limit preserving: for any directed limit $V = \lim V_\lambda$ of Noetherian affine schemes over $S$ we have $F(V) = \colim F(V_\lambda)$. \end{lemma} 
\begin{lemma} \label{lemma-rs} In Situation \ref{situation-contractions} the functor $F$ satisfies the Rim-Schlessinger condition (RS). \end{lemma} 
\begin{lemma} \label{lemma-finite-dim} In Situation \ref{situation-contractions} the tangent spaces of the functor $F$ are finite dimensional. \end{lemma} 
\begin{lemma} \label{lemma-formal-object-effective} In Situation \ref{situation-contractions} assume $X' \to S$ is separated. Then every formal object for $F$ is effective. \end{lemma} 
\begin{lemma} \label{lemma-openness-smoothness} Let $S$ be a locally Noetherian scheme. Let $V$ be a scheme locally of finite type over $S$. Let $Z \subset V$ be closed. Let $W$ be a locally Noetherian formal algebraic space over $S$ such that $W_{red}$ is locally of finite type over $S$. Let $g : V_{/Z} \to W$ be an adic morphism of formal algebraic spaces over $S$. Let $v \in V$ be a closed point such that $g$ is versal at $v$ (as in Section \ref{section-axioms-functors}). Then after replacing $V$ by an open neighbourhood of $v$ the morphism $g$ is smooth (see proof). \end{lemma} 
\begin{lemma} \label{lemma-openness-versality} In Situation \ref{situation-contractions} the functor $F$ satisfies openness of versality. \end{lemma} 
\begin{theorem} \label{theorem-contractions} \begin{reference} \cite[Theorem 3.1]{ArtinII} \end{reference} Let $S$ be a locally Noetherian scheme such that $\mathcal{O}_{S, s}$ is a G-ring for all finite type points $s \in S$. Let $X'$ be an algebraic space locally of finite type over $S$. Let $T' \subset |X'|$ be a closed subset. Let $W$ be a locally Noetherian formal algebraic space over $S$ with $W_{red}$ locally of finite type over $S$. Finally, we let $$ g : X'_{/T'} \longrightarrow W $$ be a formal modification, see Algebraization of Formal Spaces, Definition \ref{restricted-definition-formal-modification}. If $X'$ and $W$ are separated\footnote{See Remark \ref{remark-separated-needed}.} over $S$, then there exists a proper morphism $f : X' \to X$ of algebraic spaces over $S$, a closed subset $T \subset |X|$, and an isomorphism $a : X_{/T} \to W$ of formal algebraic spaces such that \begin{enumerate} \item $T'$ is the inverse image of $T$ by $|f| : |X'| \to |X|$, \item $f : X' \to X$ maps $X' \setminus T'$ isomorphically to $X \setminus T$, and \item $g = a \circ f_{/T}$ where $f_{/T} : X'_{/T'} \to X_{/T}$ is the induced morphism. \end{enumerate} In other words, $(f : X' \to X, T, a)$ is a solution as defined earlier in this section. \end{theorem} 
