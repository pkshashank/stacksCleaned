\begin{lemma} \label{lemma-limits-colimits-abelian-presheaves} Let $\mathcal{C}$ be a category. \begin{enumerate} \item All limits and colimits exist in $\textit{PAb}(\mathcal{C})$. \item All limits and colimits commute with taking sections over objects of $\mathcal{C}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-abelian-abelian} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a morphism of abelian sheaves on $\mathcal{C}$. \begin{enumerate} \item The category $\textit{Ab}(\mathcal{C})$ is an abelian category. \item The kernel $\Ker(\varphi)$ of $\varphi$ is the same as the kernel of $\varphi$ as a morphism of presheaves. \item The morphism $\varphi$ is injective (Homology, Definition \ref{homology-definition-injective-surjective}) if and only if $\varphi$ is injective as a map of presheaves (Sites, Definition \ref{sites-definition-presheaves-injective-surjective}), if and only if $\varphi$ is injective as a map of sheaves (Sites, Definition \ref{sites-definition-sheaves-injective-surjective}). \item The cokernel $\Coker(\varphi)$ of $\varphi$ is the sheafification of the cokernel of $\varphi$ as a morphism of presheaves. \item The morphism $\varphi$ is surjective (Homology, Definition \ref{homology-definition-injective-surjective}) if and only if $\varphi$ is surjective as a map of sheaves (Sites, Definition \ref{sites-definition-sheaves-injective-surjective}). \item A complex of abelian sheaves $$ \mathcal{F} \to \mathcal{G} \to \mathcal{H} $$ is exact at $\mathcal{G}$ if and only if for all $U \in \Ob(\mathcal{C})$ and all $s \in \mathcal{G}(U)$ mapping to zero in $\mathcal{H}(U)$ there exists a covering $\{U_i \to U\}_{i \in I}$ in $\mathcal{C}$ such that each $s|_{U_i}$ is in the image of $\mathcal{F}(U_i) \to \mathcal{G}(U_i)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-limits-colimits-abelian-sheaves} Let $\mathcal{C}$ be a site. \begin{enumerate} \item All limits and colimits exist in $\textit{Ab}(\mathcal{C})$. \item Limits are the same as the corresponding limits of abelian presheaves over $\mathcal{C}$ (i.e., commute with taking sections over objects of $\mathcal{C}$). \item Finite direct sums are the same as the corresponding finite direct sums in the category of abelian pre-sheaves over $\mathcal{C}$. \item A colimit is the sheafification of the corresponding colimit in the category of abelian presheaves. \item Filtered colimits are exact. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-free-abelian-presheaf-on} Let $\mathcal{C}$ be a category. Let $\mathcal{G}$ be a presheaf of sets. The {\it free abelian presheaf} $\mathbf{Z}_\mathcal{G}$ on $\mathcal{G}$ is the abelian presheaf defined by the rule $$ U \longmapsto \mathbf{Z}[\mathcal{G}(U)]. $$ In the special case $\mathcal{G} = h_X$ of a representable presheaf associated to an object $X$ of $\mathcal{C}$ we use the notation $\mathbf{Z}_X = \mathbf{Z}_{h_X}$. In other words $$ \mathbf{Z}_X(U) = \mathbf{Z}[\Mor_\mathcal{C}(U, X)]. $$ \end{definition} 
\begin{lemma} \label{lemma-obvious-adjointness} Let $\mathcal{C}$ be a category. Let $\mathcal{G}$, $\mathcal{F}$ be a presheaves of sets. Let $\mathcal{A}$ be an abelian presheaf. Let $U$ be an object of $\mathcal{C}$. Then we have \begin{align*} \Mor_{\textit{PSh}(\mathcal{C})}(h_U, \mathcal{F}) & = \mathcal{F}(U), \\ \Mor_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_\mathcal{G}, \mathcal{A}) & = \Mor_{\textit{PSh}(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\ \Mor_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_U, \mathcal{A}) & = \mathcal{A}(U). \end{align*} All of these equalities are functorial. \end{lemma} 
\begin{lemma} \label{lemma-coproduct-sum-free-abelian-presheaf} Let $\mathcal{C}$ be a category. Let $I$ be a set. For each $i \in I$ let $\mathcal{G}_i$ be a presheaf of sets. Then $$ \mathbf{Z}_{\coprod_i \mathcal{G}_i} = \bigoplus\nolimits_{i \in I} \mathbf{Z}_{\mathcal{G}_i} $$ in $\textit{PAb}(\mathcal{C})$. \end{lemma} 
\begin{definition} \label{definition-free-abelian-sheaf-on} Let $\mathcal{C}$ be a site. Let $\mathcal{G}$ be a presheaf of sets. The {\it free abelian sheaf} $\mathbf{Z}_\mathcal{G}^\#$ on $\mathcal{G}$ is the abelian sheaf $\mathbf{Z}_\mathcal{G}^\#$ which is the sheafification of the free abelian presheaf on $\mathcal{G}$. In the special case $\mathcal{G} = h_X$ of a representable presheaf associated to an object $X$ of $\mathcal{C}$ we use the notation $\mathbf{Z}_X^\#$. \end{definition} 
\begin{lemma} \label{lemma-obvious-adjointness-sheaves} Let $\mathcal{C}$ be a site. Let $\mathcal{G}$, $\mathcal{F}$ be a sheaves of sets. Let $\mathcal{A}$ be an abelian sheaf. Let $U$ be an object of $\mathcal{C}$. Then we have \begin{align*} \Mor_{\Sh(\mathcal{C})}(h_U^\#, \mathcal{F}) & = \mathcal{F}(U), \\ \Mor_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_\mathcal{G}^\#, \mathcal{A}) & = \Mor_{\Sh(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\ \Mor_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_U^\#, \mathcal{A}) & = \mathcal{A}(U). \end{align*} All of these equalities are functorial. \end{lemma} 
\begin{lemma} \label{lemma-may-sheafify-before-abelianize} Let $\mathcal{C}$ be a site. Let $\mathcal{G}$ be a presheaf of sets. Then $\mathbf{Z}_\mathcal{G}^\# = (\mathbf{Z}_{\mathcal{G}^\#})^\#$. \end{lemma} 
\begin{definition} \label{definition-ringed-site} Ringed sites. \begin{enumerate} \item A {\it ringed site} is a pair $(\mathcal{C}, \mathcal{O})$ where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the {\it structure sheaf} of the ringed site. \item Let $(\mathcal{C}, \mathcal{O})$, $(\mathcal{C}', \mathcal{O}')$ be ringed sites. A {\it morphism of ringed sites} $$ (f, f^\sharp) : (\mathcal{C}, \mathcal{O}) \longrightarrow (\mathcal{C}', \mathcal{O}') $$ is given by a morphism of sites $f : \mathcal{C} \to \mathcal{C}'$ (see Sites, Definition \ref{sites-definition-morphism-sites}) together with a map of sheaves of rings $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction is the same thing as a map of sheaves of rings $f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$. \item Let $(f, f^\sharp) : (\mathcal{C}_1, \mathcal{O}_1) \to (\mathcal{C}_2, \mathcal{O}_2)$ and $(g, g^\sharp) : (\mathcal{C}_2, \mathcal{O}_2) \to (\mathcal{C}_3, \mathcal{O}_3)$ be morphisms of ringed sites. Then we define the {\it composition of morphisms of ringed sites} by the rule $$ (g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp). $$ Here we use composition of morphisms of sites defined in Sites, Definition \ref{sites-definition-composition-morphisms-sites} and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of rings $$ \mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2 \xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1 $$ \end{enumerate} \end{definition} 
\begin{definition} \label{definition-ringed-topos} Ringed topoi. \begin{enumerate} \item A {\it ringed topos} is a pair $(\Sh(\mathcal{C}), \mathcal{O})$ where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the {\it structure sheaf} of the ringed topos. \item Let $(\Sh(\mathcal{C}), \mathcal{O})$, $(\Sh(\mathcal{C}'), \mathcal{O}')$ be ringed topoi. A {\it morphism of ringed topoi} $$ (f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{C}'), \mathcal{O}') $$ is given by a morphism of topoi $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{C}')$ (see Sites, Definition \ref{sites-definition-topos}) together with a map of sheaves of rings $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction is the same thing as a map of sheaves of rings $f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$. \item Let $(f, f^\sharp) : (\Sh(\mathcal{C}_1), \mathcal{O}_1) \to (\Sh(\mathcal{C}_2), \mathcal{O}_2)$ and $(g, g^\sharp) : (\Sh(\mathcal{C}_2), \mathcal{O}_2) \to (\Sh(\mathcal{C}_3), \mathcal{O}_3)$ be morphisms of ringed topoi. Then we define the {\it composition of morphisms of ringed topoi} by the rule $$ (g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp). $$ Here we use composition of morphisms of topoi defined in Sites, Definition \ref{sites-definition-topos} and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of rings $$ \mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2 \xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1 $$ \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. There exists a factorization $$ \xymatrix{ (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[rr]_{(f, f^\sharp)} \ar[d]_{(g, g^\sharp)} & & (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D}) \ar[d]^{(e, e^\sharp)} \\ (\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'}) \ar[rr]^{(h, h^\sharp)} & & (\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'}) } $$ where \begin{enumerate} \item $g : \Sh(\mathcal{C}) \to \Sh(\mathcal{C}')$ is an equivalence of topoi induced by a special cocontinuous functor $\mathcal{C} \to \mathcal{C}'$ (see Sites, Definition \ref{sites-definition-special-cocontinuous-functor}), \item $e : \Sh(\mathcal{D}) \to \Sh(\mathcal{D}')$ is an equivalence of topoi induced by a special cocontinuous functor $\mathcal{D} \to \mathcal{D}'$ (see Sites, Definition \ref{sites-definition-special-cocontinuous-functor}), \item $\mathcal{O}_{\mathcal{C}'} = g_*\mathcal{O}_\mathcal{C}$ and $g^\sharp$ is the obvious map, \item $\mathcal{O}_{\mathcal{D}'} = e_*\mathcal{O}_\mathcal{D}$ and $e^\sharp$ is the obvious map, \item the sites $\mathcal{C}'$ and $\mathcal{D}'$ have final objects and fibre products (i.e., all finite limits), \item $h$ is a morphism of sites induced by a continuous functor $u : \mathcal{D}' \to \mathcal{C}'$ which commutes with all finite limits (i.e., it satisfies the assumptions of Sites, Proposition \ref{sites-proposition-get-morphism}), and \item given any set of sheaves $\mathcal{F}_i$ (resp.\ $\mathcal{G}_j$) on $\mathcal{C}$ (resp.\ $\mathcal{D}$) we may assume each of these is a representable sheaf on $\mathcal{C}'$ (resp.\ $\mathcal{D}'$). \end{enumerate} Moreover, if $(f, f^\sharp)$ is an equivalence of ringed topoi, then we can choose the diagram such that $\mathcal{C}' = \mathcal{D}'$, $\mathcal{O}_{\mathcal{C}'} = \mathcal{O}_{\mathcal{D}'}$ and $(h, h^\sharp)$ is the identity. \end{lemma} 
\begin{definition} \label{definition-2-morphism-ringed-topoi} Let $f, g : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be two morphisms of ringed topoi. A {\it 2-morphism from $f$ to $g$} is given by a transformation of functors $t : f_* \to g_*$ such that $$ \xymatrix{ & \mathcal{O}_\mathcal{D} \ar[ld]_{f^\sharp} \ar[rd]^{g^\sharp} \\ f_*\mathcal{O}_\mathcal{C} \ar[rr]^t & & g_*\mathcal{O}_\mathcal{C} } $$ is commutative. \end{definition} 
\begin{definition} \label{definition-presheaf-modules} Let $\mathcal{C}$ be a category, and let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$. \begin{enumerate} \item A {\it presheaf of $\mathcal{O}$-modules} is given by an abelian presheaf $\mathcal{F}$ together with a map of presheaves of sets $$ \mathcal{O} \times \mathcal{F} \longrightarrow \mathcal{F} $$ such that for every object $U$ of $\mathcal{C}$ the map $\mathcal{O}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$ defines the structure of an $\mathcal{O}(U)$-module structure on the abelian group $\mathcal{F}(U)$. \item A {\it morphism $\varphi : \mathcal{F} \to \mathcal{G}$ of presheaves of $\mathcal{O}$-modules} is a morphism of abelian presheaves $\varphi : \mathcal{F} \to \mathcal{G}$ such that the diagram $$ \xymatrix{ \mathcal{O} \times \mathcal{F} \ar[r] \ar[d]_{\text{id} \times \varphi} & \mathcal{F} \ar[d]^{\varphi} \\ \mathcal{O} \times \mathcal{G} \ar[r] & \mathcal{G} } $$ commutes. \item The set of $\mathcal{O}$-module morphisms as above is denoted $\Hom_\mathcal{O}(\mathcal{F}, \mathcal{G})$. \item The category of presheaves of $\mathcal{O}$-modules is denoted $\textit{PMod}(\mathcal{O})$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-adjointness-tensor-restrict-presheaves} With $\mathcal{C}$, $\mathcal{O}_1 \to \mathcal{O}_2$, $\mathcal{F}$ and $\mathcal{G}$ as above there exists a canonical bijection $$ \Hom_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1}) = \Hom_{\mathcal{O}_2}( \mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}, \mathcal{F} ) $$ In other words, the restriction and change of rings functors defined above are adjoint to each other. \end{lemma} 
\begin{definition} \label{definition-sheaf-modules} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. \begin{enumerate} \item A {\it sheaf of $\mathcal{O}$-modules} is a presheaf of $\mathcal{O}$-modules $\mathcal{F}$, see Definition \ref{definition-presheaf-modules}, such that the underlying presheaf of abelian groups $\mathcal{F}$ is a sheaf. \item A {\it morphism of sheaves of $\mathcal{O}$-modules} is a morphism of presheaves of $\mathcal{O}$-modules. \item Given sheaves of $\mathcal{O}$-modules $\mathcal{F}$ and $\mathcal{G}$ we denote $\Hom_\mathcal{O}(\mathcal{F}, \mathcal{G})$ the set of morphism of sheaves of $\mathcal{O}$-modules. \item The category of sheaves of $\mathcal{O}$-modules is denoted $\textit{Mod}(\mathcal{O})$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-sheafification-presheaf-modules} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$. Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules. Let $\mathcal{O}^\#$ be the sheafification of $\mathcal{O}$ as a presheaf of rings, see Sites, Section \ref{sites-section-sheaves-algebraic-structures}. Let $\mathcal{F}^\#$ be the sheafification of $\mathcal{F}$ as a presheaf of abelian groups. There exists a unique map of sheaves of sets $$ \mathcal{O}^\# \times \mathcal{F}^\# \longrightarrow \mathcal{F}^\# $$ which makes the diagram $$ \xymatrix{ \mathcal{O} \times \mathcal{F} \ar[r] \ar[d] & \mathcal{F} \ar[d] \\ \mathcal{O}^\# \times \mathcal{F}^\# \ar[r] & \mathcal{F}^\# } $$ commute and which makes $\mathcal{F}^\#$ into a sheaf of $\mathcal{O}^\#$-modules. In addition, if $\mathcal{G}$ is a sheaf of $\mathcal{O}^\#$-modules, then any morphism of presheaves of $\mathcal{O}$-modules $\mathcal{F} \to \mathcal{G}$ (into the restriction of $\mathcal{G}$ to a $\mathcal{O}$-module) factors uniquely as $\mathcal{F} \to \mathcal{F}^\# \to \mathcal{G}$ where $\mathcal{F}^\# \to \mathcal{G}$ is a morphism of $\mathcal{O}^\#$-modules. \end{lemma} 
\begin{lemma} \label{lemma-sheafification-exact} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$ The sheafification functor $$ \textit{PMod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}^\#), \quad \mathcal{F} \longmapsto \mathcal{F}^\# $$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-adjointness-tensor-restrict} With $X$, $\mathcal{O}_1$, $\mathcal{O}_2$, $\mathcal{F}$ and $\mathcal{G}$ as above there exists a canonical bijection $$ \Hom_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1}) = \Hom_{\mathcal{O}_2}( \mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G}, \mathcal{F} ) $$ In other words, the restriction and change of rings functors are adjoint to each other. \end{lemma} 
\begin{lemma} \label{lemma-epimorphism-modules} Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$ be an epimorphism of sheaves of rings. Let $\mathcal{G}_1, \mathcal{G}_2$ be $\mathcal{O}'$-modules. Then $$ \Hom_{\mathcal{O}'}(\mathcal{G}_1, \mathcal{G}_2) = \Hom_\mathcal{O}(\mathcal{G}_1, \mathcal{G}_2). $$ In other words, the restriction functor $\textit{Mod}(\mathcal{O}') \to \textit{Mod}(\mathcal{O})$ is fully faithful. \end{lemma} 
\begin{lemma} \label{lemma-pushforward-module} Let $\mathcal{C}$, $\mathcal{D}$ be sites. Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. There is a natural map of sheaves of sets $$ f_*\mathcal{O} \times f_*\mathcal{F} \longrightarrow f_*\mathcal{F} $$ which turns $f_*\mathcal{F}$ into a sheaf of $f_*\mathcal{O}$-modules. This construction is functorial in $\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-pullback-module} Let $\mathcal{C}$, $\mathcal{D}$ be sites. Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$. Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules. There is a natural map of sheaves of sets $$ f^{-1}\mathcal{O} \times f^{-1}\mathcal{G} \longrightarrow f^{-1}\mathcal{G} $$ which turns $f^{-1}\mathcal{G}$ into a sheaf of $f^{-1}\mathcal{O}$-modules. This construction is functorial in $\mathcal{G}$. \end{lemma} 
\begin{lemma} \label{lemma-adjoint-push-pull-modules} Let $\mathcal{C}$, $\mathcal{D}$ be sites. Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$. Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules. Let $\mathcal{F}$ be a sheaf of $f^{-1}\mathcal{O}$-modules. Then $$ \Mor_{\textit{Mod}(f^{-1}\mathcal{O})}(f^{-1}\mathcal{G}, \mathcal{F}) = \Mor_{\textit{Mod}(\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}). $$ Here we use Lemmas \ref{lemma-pullback-module} and \ref{lemma-pushforward-module}, and we think of $f_*\mathcal{F}$ as an $\mathcal{O}$-module by restriction via $\mathcal{O} \to f_*f^{-1}\mathcal{O}$. \end{lemma} 
\begin{lemma} \label{lemma-adjoint-pull-push-modules} Let $\mathcal{C}$, $\mathcal{D}$ be sites. Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. Let $\mathcal{G}$ be a sheaf of $f_*\mathcal{O}$-modules. Then $$ \Mor_{\textit{Mod}(\mathcal{O})}( \mathcal{O} \otimes_{f^{-1}f_*\mathcal{O}} f^{-1}\mathcal{G}, \mathcal{F}) = \Mor_{\textit{Mod}(f_*\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}). $$ Here we use Lemmas \ref{lemma-pullback-module} and \ref{lemma-pushforward-module}, and we use the canonical map $f^{-1}f_*\mathcal{O} \to \mathcal{O}$ in the definition of the tensor product. \end{lemma} 
\begin{definition} \label{definition-pushforward} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi or ringed sites. \begin{enumerate} \item Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_\mathcal{C}$-modules. We define the {\it pushforward} of $\mathcal{F}$ as the sheaf of $\mathcal{O}_\mathcal{D}$-modules which as a sheaf of abelian groups equals $f_*\mathcal{F}$ and with module structure given by the restriction via $f^\sharp : \mathcal{O}_\mathcal{D} \to f_*\mathcal{O}_\mathcal{C}$ of the module structure $$ f_*\mathcal{O}_\mathcal{C} \times f_*\mathcal{F} \longrightarrow f_*\mathcal{F} $$ from Lemma \ref{lemma-pushforward-module}. \item Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_\mathcal{D}$-modules. We define the {\it pullback} $f^*\mathcal{G}$ to be the sheaf of $\mathcal{O}_\mathcal{C}$-modules defined by the formula $$ f^*\mathcal{G} = \mathcal{O}_\mathcal{C} \otimes_{f^{-1}\mathcal{O}_\mathcal{D}} f^{-1}\mathcal{G} $$ where the ring map $f^{-1}\mathcal{O}_\mathcal{D} \to \mathcal{O}_\mathcal{C}$ is $f^\sharp$, and where the  module structure is given by Lemma \ref{lemma-pullback-module}. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-adjoint-pullback-pushforward-modules} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi or ringed sites. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_\mathcal{C}$-modules. Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_\mathcal{D}$-modules. There is a canonical bijection $$ \Hom_{\mathcal{O}_\mathcal{C}}(f^*\mathcal{G}, \mathcal{F}) = \Hom_{\mathcal{O}_\mathcal{D}}(\mathcal{G}, f_*\mathcal{F}). $$ In other words: the functor $f^*$ is the left adjoint to $f_*$. \end{lemma} 
\begin{lemma} \label{lemma-push-pull-composition-modules} $(f, f^\sharp) : (\Sh(\mathcal{C}_1), \mathcal{O}_1) \to (\Sh(\mathcal{C}_2), \mathcal{O}_2)$ and $(g, g^\sharp) : (\Sh(\mathcal{C}_2), \mathcal{O}_2) \to (\Sh(\mathcal{C}_3), \mathcal{O}_3)$ be morphisms of ringed topoi. There are canonical isomorphisms of functors $(g \circ f)_* \cong g_* \circ f_*$ and $(g \circ f)^* \cong f^* \circ g^*$. \end{lemma} 
\begin{lemma} \label{lemma-abelian} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. The category $\textit{Mod}(\mathcal{O})$ is an abelian category. The forgetful functor $\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$ is exact, hence kernels, cokernels and exactness of $\mathcal{O}$-modules, correspond to the corresponding notions for abelian sheaves. \end{lemma} 
\begin{lemma} \label{lemma-limits-colimits} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. All limits and colimits exist in $\textit{Mod}(\mathcal{O})$ and the forgetful functor $\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$ commutes with them. Moreover, filtered colimits are exact. \end{lemma} 
\begin{lemma} \label{lemma-exactness-pushforward-pullback} Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. \begin{enumerate} \item The functor $f_*$ is left exact. In fact it commutes with all limits. \item The functor $f^*$ is right exact. In fact it commutes with all colimits. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-exactness-stalks} Let $\mathcal{C}$ be a site. If $\{p_i\}_{i \in I}$ is a conservative family of points, then we may check exactness of a sequence of abelian sheaves on the stalks at the points $p_i$, $i \in I$. If $\mathcal{C}$ has enough points, then exactness of a sequence of abelian sheaves may be checked on stalks. \end{lemma} 
\begin{lemma} \label{lemma-reflect-surjections} Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. The following are equivalent: \begin{enumerate} \item $f^{-1}f_*\mathcal{F} \to \mathcal{F}$ is surjective for all $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$, and \item $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$ reflects surjections. \end{enumerate} In this case the functor $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$ is faithful. \end{lemma} 
\begin{lemma} \label{lemma-exactness} Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. Assume at least one of the following properties holds \begin{enumerate} \item $f_*$ transforms surjections of sheaves of sets into surjections, \item $f_*$ transforms surjections of abelian sheaves into surjections, \item $f_*$ commutes with coequalizers on sheaves of sets, \item $f_*$ commutes with pushouts on sheaves of sets, \end{enumerate} Then $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-morphism-ringed-sites-almost-cocontinuous} Let $f : \mathcal{D} \to \mathcal{C}$ be a morphism of sites associated to the continuous functor $u : \mathcal{C} \to \mathcal{D}$. Assume $u$ is almost cocontinuous. Then \begin{enumerate} \item $f_* : \textit{Ab}(\mathcal{D}) \to \textit{Ab}(\mathcal{C})$ is exact. \item if $f^\sharp : f^{-1}\mathcal{O}_\mathcal{C} \to \mathcal{O}_\mathcal{D}$ is given so that $f$ becomes a morphism of ringed sites, then $f_* : \textit{Mod}(\mathcal{O}_\mathcal{D}) \to \textit{Mod}(\mathcal{O}_\mathcal{C})$ is exact. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-g-shriek} With $u : \mathcal{C} \to \mathcal{D}$ satisfying (a), (b) above. For $\mathcal{F} \in \textit{PAb}(\mathcal{C})$ we define {\it $g_{p!}\mathcal{F}$} as the presheaf $$ V \longmapsto \colim_{V \to u(U)} \mathcal{F}(U) $$ with colimits over $(\mathcal{I}_V^u)^{opp}$ taken in $\textit{Ab}$. For $\mathcal{F} \in \textit{PAb}(\mathcal{C})$ we set {\it $g_!\mathcal{F} = (g_{p!}\mathcal{F})^\#$}. \end{definition} 
\begin{lemma} \label{lemma-g-shriek-adjoint} The functor $g_{p!}$ is a left adjoint to the functor $u^p$. The functor $g_!$ is a left adjoint to the functor $g^{-1}$. In other words the formulas \begin{align*} \Mor_{\textit{PAb}(\mathcal{C})}(\mathcal{F}, u^p\mathcal{G}) & = \Mor_{\textit{PAb}(\mathcal{D})}(g_{p!}\mathcal{F}, \mathcal{G}), \\ \Mor_{\textit{Ab}(\mathcal{C})}(\mathcal{F}, g^{-1}\mathcal{G}) & = \Mor_{\textit{Ab}(\mathcal{D})}(g_!\mathcal{F}, \mathcal{G}) \end{align*} hold bifunctorially in $\mathcal{F}$ and $\mathcal{G}$. \end{lemma} 
\begin{lemma} \label{lemma-exactness-lower-shriek} Let $\mathcal{C}$ and $\mathcal{D}$ be sites. Let $u : \mathcal{C} \to \mathcal{D}$ be a functor. Assume that \begin{enumerate} \item[(a)] $u$ is cocontinuous, \item[(b)] $u$ is continuous, and \item[(c)] fibre products and equalizers exist in $\mathcal{C}$ and $u$ commutes with them. \end{enumerate} In this case the functor $g_! : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-back-and-forth} Let $\mathcal{C}$ and $\mathcal{D}$ be sites. Let $u : \mathcal{C} \to \mathcal{D}$ be a functor. Assume that \begin{enumerate} \item[(a)] $u$ is cocontinuous, \item[(b)] $u$ is continuous, and \item[(c)] $u$ is fully faithful. \end{enumerate} For $g_!, g^{-1}, g_*$ as above the canonical maps $\mathcal{F} \to g^{-1}g_!\mathcal{F}$ and $g^{-1}g_*\mathcal{F} \to \mathcal{F}$ are isomorphisms for all abelian sheaves $\mathcal{F}$ on $\mathcal{C}$. \end{lemma} 
\begin{lemma} \label{lemma-have-left-adjoint} Let $\mathcal{C}$ and $\mathcal{D}$ be sites. Let $g : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be the morphism of topoi associated to a continuous and cocontinuous functor $u : \mathcal{C} \to \mathcal{D}$. \begin{enumerate} \item If $u$ has a left adjoint $w$, then $g_!$ agrees with $g_!^{\Sh}$ on underlying sheaves of sets and $g_!$ is exact. \item If in addition $w$ is cocontinuous, then $g_! = h^{-1}$ and $g^{-1} = h_*$ where $h : \Sh(\mathcal{D}) \to \Sh(\mathcal{C})$ is the morphism of topoi associated to $w$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-global} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. \begin{enumerate} \item We say $\mathcal{F}$ is a {\it free $\mathcal{O}$-module} if $\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$. \item We say $\mathcal{F}$ is {\it finite free} if $\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$ with a finite index set $I$. \item We say $\mathcal{F}$ is {\it generated by global sections} if there exists a surjection $$ \bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F} $$ from a free $\mathcal{O}$-module onto $\mathcal{F}$. \item Given $r \geq 0$ we say $\mathcal{F}$ is {\it generated by $r$ global sections} if there exists a surjection $\mathcal{O}^{\oplus r} \to \mathcal{F}$. \item We say $\mathcal{F}$ is {\it generated by finitely many global sections} if it is generated by $r$ global sections for some $r \geq 0$. \item We say $\mathcal{F}$ has a {\it global presentation} if there exists an exact sequence $$ \bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow \bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F} \longrightarrow 0 $$ of $\mathcal{O}$-modules. \item We say $\mathcal{F}$ has a {\it global finite presentation} if there exists an exact sequence $$ \bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow \bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F} \longrightarrow 0 $$ of $\mathcal{O}$-modules with $I$ and $J$ finite sets. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-global-pullback} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. Let $\mathcal{F}$ be an $\mathcal{O}_\mathcal{D}$-module. \begin{enumerate} \item If $\mathcal{F}$ is free then $f^*\mathcal{F}$ is free. \item If $\mathcal{F}$ is finite free then $f^*\mathcal{F}$ is finite free. \item If $\mathcal{F}$ is generated by global sections then $f^*\mathcal{F}$ is generated by global sections. \item Given $r \geq 0$ if $\mathcal{F}$ is generated by $r$ global sections, then $f^*\mathcal{F}$ is generated by $r$ global sections. \item If $\mathcal{F}$ is generated by finitely many global sections then $f^*\mathcal{F}$ is generated by finitely many global sections. \item If $\mathcal{F}$ has a global presentation then $f^*\mathcal{F}$ has a global presentation. \item If $\mathcal{F}$ has a finite global presentation then $f^*\mathcal{F}$ has a finite global presentation. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-localize-ringed-site} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U \in \Ob(\mathcal{C})$. \begin{enumerate} \item The ringed site $(\mathcal{C}/U, \mathcal{O}_U)$ is called the {\it localization of the ringed site $(\mathcal{C}, \mathcal{O})$ at the object $U$}. \item The morphism of ringed topoi $(j_U, j_U^\sharp) : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{C}), \mathcal{O})$ is called the {\it localization morphism}. \item The functor $j_{U*} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$ is called the {\it direct image functor}. \item For a sheaf of $\mathcal{O}$-modules $\mathcal{F}$ on $\mathcal{C}$ the sheaf $j_U^*\mathcal{F}$ is called the {\it restriction of $\mathcal{F}$ to $\mathcal{C}/U$}. We will sometimes denote it by $\mathcal{F}|_{\mathcal{C}/U}$ or even $\mathcal{F}|_U$. It is described by the simple rule $j_U^*(\mathcal{F})(X/U) = \mathcal{F}(X)$. \item The left adjoint $j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$ of restriction is called {\it extension by zero}. It exists and is exact by Lemmas \ref{lemma-extension-by-zero} and \ref{lemma-extension-by-zero-exact}. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-extension-by-zero} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U \in \Ob(\mathcal{C})$. The restriction functor $j_U^* : \textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_U)$ has a left adjoint $j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$. So $$ \Mor_{\textit{Mod}(\mathcal{O}_U)}(\mathcal{G}, j_U^*\mathcal{F}) = \Mor_{\textit{Mod}(\mathcal{O})}(j_{U!}\mathcal{G}, \mathcal{F}) $$ for $\mathcal{F} \in \Ob(\textit{Mod}(\mathcal{O}))$ and $\mathcal{G} \in \Ob(\textit{Mod}(\mathcal{O}_U))$. Moreover, the extension by zero $j_{U!}\mathcal{G}$ of $\mathcal{G}$ is the sheaf associated to the presheaf $$ V \longmapsto \bigoplus\nolimits_{\varphi \in \Mor_\mathcal{C}(V, U)} \mathcal{G}(V \xrightarrow{\varphi} U) $$ with obvious restriction mappings and an obvious $\mathcal{O}$-module structure. \end{lemma} 
\begin{lemma} \label{lemma-extension-by-zero-exact} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U \in \Ob(\mathcal{C})$. The functor $j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-j-shriek-reflects-exactness} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U \in \Ob(\mathcal{C})$. A complex of $\mathcal{O}_U$-modules $\mathcal{G}_1 \to \mathcal{G}_2 \to \mathcal{G}_3$ is exact if and only if $j_{U!}\mathcal{G}_1 \to j_{U!}\mathcal{G}_2 \to j_{U!}\mathcal{G}_3$ is exact as a sequence of $\mathcal{O}$-modules. \end{lemma} 
\begin{lemma} \label{lemma-relocalize} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $f : V \to U$ be a morphism of $\mathcal{C}$. Then there exists a commutative diagram $$ \xymatrix{ (\Sh(\mathcal{C}/V), \mathcal{O}_V) \ar[rd]_{(j_V, j_V^\sharp)} \ar[rr]_{(j, j^\sharp)} & & (\Sh(\mathcal{C}/U), \mathcal{O}_U) \ar[ld]^{(j_U, j_U^\sharp)} \\ & (\Sh(\mathcal{C}), \mathcal{O}) & } $$ of ringed topoi. Here $(j, j^\sharp)$ is the localization morphism associated to the object $V/U$ of the ringed site $(\mathcal{C}/V, \mathcal{O}_V)$. \end{lemma} 
\begin{lemma} \label{lemma-restrict-back} Let $\mathcal{C}$ be a site. Let $U \in \Ob(\mathcal{C})$. Assume that every $X$ in $\mathcal{C}$ has at most one morphism to $U$. Let $\mathcal{F}$ be an abelian sheaf on $\mathcal{C}/U$. The canonical maps $\mathcal{F} \to j_U^{-1}j_{U!}\mathcal{F}$ and $j_U^{-1}j_{U*}\mathcal{F} \to \mathcal{F}$ are isomorphisms. \end{lemma} 
\begin{lemma} \label{lemma-localize-morphism-ringed-sites} Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}) \longrightarrow (\mathcal{D}, \mathcal{O}')$ be a morphism of ringed sites where $f$ is given by the continuous functor $u : \mathcal{D} \to \mathcal{C}$. Let $V$ be an object of $\mathcal{D}$ and set $U = u(V)$. Then there is a canonical map of sheaves of rings $(f')^\sharp$ such that the diagram of Sites, Lemma \ref{sites-lemma-localize-morphism} is turned into a commutative diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C}/U), \mathcal{O}_U) \ar[rr]_{(j_U, j_U^\sharp)} \ar[d]_{(f', (f')^\sharp)} & & (\Sh(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D}/V), \mathcal{O}'_V) \ar[rr]^{(j_V, j_V^\sharp)} & & (\Sh(\mathcal{D}), \mathcal{O}'). } $$ Moreover, in this situation we have $f'_*j_U^{-1} = j_V^{-1}f_*$ and $f'_*j_U^* = j_V^*f_*$. \end{lemma} 
\begin{lemma} \label{lemma-relocalize-morphism-ringed-sites} Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}) \longrightarrow (\mathcal{D}, \mathcal{O}')$ be a morphism of ringed sites where $f$ is given by the continuous functor $u : \mathcal{D} \to \mathcal{C}$. Let $V \in \Ob(\mathcal{D})$, $U \in \Ob(\mathcal{C})$ and $c : U \to u(V)$ a morphism of $\mathcal{C}$. There exists a commutative diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C}/U), \mathcal{O}_U) \ar[rr]_{(j_U, j_U^\sharp)} \ar[d]_{(f_c, f_c^\sharp)} & & (\Sh(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D}/V), \mathcal{O}'_V) \ar[rr]^{(j_V, j_V^\sharp)} & & (\Sh(\mathcal{D}), \mathcal{O}'). } $$ The morphism $(f_c, f_c^\sharp)$ is equal to the composition of the morphism $$ (f', (f')^\sharp) : (\Sh(\mathcal{C}/u(V)), \mathcal{O}_{u(V)}) \longrightarrow (\Sh(\mathcal{D}/V), \mathcal{O}'_V) $$ of Lemma \ref{lemma-localize-morphism-ringed-sites} and the morphism $$ (j, j^\sharp) : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{C}/u(V)), \mathcal{O}_{u(V)}) $$ of Lemma \ref{lemma-relocalize}. Given any morphisms $b : V' \to V$, $a : U' \to U$ and $c' : U' \to u(V')$ such that $$ \xymatrix{ U' \ar[r]_-{c'} \ar[d]_a & u(V') \ar[d]^{u(b)} \\ U \ar[r]^-c & u(V) } $$ commutes, then the following diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C}/U'), \mathcal{O}_{U'}) \ar[rr]_{(j_{U'/U}, j_{U'/U}^\sharp)} \ar[d]_{(f_{c'}, f_{c'}^\sharp)} & & (\Sh(\mathcal{C}/U), \mathcal{O}_U) \ar[d]^{(f_c, f_c^\sharp)} \\ (\Sh(\mathcal{D}/V'), \mathcal{O}'_{V'}) \ar[rr]^{(j_{V'/V}, j_{V'/V}^\sharp)} & & (\Sh(\mathcal{D}/V), \mathcal{O}'_{V'}) } $$ commutes. \end{lemma} 
\begin{lemma} \label{lemma-localize-ringed-topos} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Let $\mathcal{F} \in \Sh(\mathcal{C})$ be a sheaf. For a sheaf $\mathcal{H}$ on $\mathcal{C}$ denote $\mathcal{H}_\mathcal{F}$ the sheaf $\mathcal{H} \times \mathcal{F}$ seen as an object of the category $\Sh(\mathcal{C})/\mathcal{F}$. The pair $(\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F})$ is a ringed topos and there is a canonical morphism of ringed topoi $$ (j_\mathcal{F}, j_\mathcal{F}^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \longrightarrow (\Sh(\mathcal{C}), \mathcal{O}) $$ which is a localization as in Section \ref{section-localize} such that \begin{enumerate} \item the functor $j_\mathcal{F}^{-1}$ is the functor $\mathcal{H} \mapsto \mathcal{H}_\mathcal{F}$, \item the functor $j_\mathcal{F}^*$ is the functor $\mathcal{H} \mapsto \mathcal{H}_\mathcal{F}$, \item the functor $j_{\mathcal{F}!}$ on sheaves of sets is the forgetful functor $\mathcal{G}/\mathcal{F} \mapsto \mathcal{G}$, \item the functor $j_{\mathcal{F}!}$ on sheaves of modules associates to the $\mathcal{O}_\mathcal{F}$-module $\varphi : \mathcal{G} \to \mathcal{F}$ the $\mathcal{O}$-module which is the sheafification of the presheaf $$ V \longmapsto \bigoplus\nolimits_{s \in \mathcal{F}(V)} \{\sigma \in \mathcal{G}(V) \mid \varphi(\sigma) = s \} $$ for $V \in \Ob(\mathcal{C})$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-localize-ringed-topos} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Let $\mathcal{F} \in \Sh(\mathcal{C})$. \begin{enumerate} \item The ringed topos $(\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F})$ is called the {\it localization of the ringed topos $(\Sh(\mathcal{C}), \mathcal{O})$ at $\mathcal{F}$}. \item The morphism of ringed topoi $(j_\mathcal{F}, j_\mathcal{F}^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \to (\Sh(\mathcal{C}), \mathcal{O})$ of Lemma \ref{lemma-localize-ringed-topos} is called the {\it localization morphism}. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-localize-compare} With $(\Sh(\mathcal{C}), \mathcal{O})$ and $\mathcal{F} \in \Sh(\mathcal{C})$ as in Lemma \ref{lemma-localize-ringed-topos}. If $\mathcal{F} = h_U^\#$ for some object $U$ of $\mathcal{C}$ then via the identification $\Sh(\mathcal{C}/U) = \Sh(\mathcal{C})/h_U^\#$ of Sites, Lemma \ref{sites-lemma-essential-image-j-shriek} we have \begin{enumerate} \item canonically $\mathcal{O}_U = \mathcal{O}_\mathcal{F}$, and \item with these identifications we have $(j_\mathcal{F}, j_\mathcal{F}^\sharp) = (j_U, j_U^\sharp)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-relocalize-ringed-topos} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. If $s : \mathcal{G} \to \mathcal{F}$ is a morphism of sheaves on $\mathcal{C}$ then there exists a natural commutative diagram of morphisms of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C})/\mathcal{G}, \mathcal{O}_\mathcal{G}) \ar[rd]_{(j_\mathcal{G}, j_\mathcal{G}^\sharp)} \ar[rr]_{(j, j^\sharp)} & & (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \ar[ld]^{(j_\mathcal{F}, j_\mathcal{F}^\sharp)} \\ & (\Sh(\mathcal{C}), \mathcal{O}) & } $$ where $(j, j^\sharp)$ is the localization morphism of the ringed topos $(\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F})$ at the object $\mathcal{G}/\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-relocalize-compare} With $(\Sh(\mathcal{C}), \mathcal{O})$, $s : \mathcal{G} \to \mathcal{F}$ as in Lemma \ref{lemma-relocalize-ringed-topos}. If there exist a morphism $f : V \to U$ of $\mathcal{C}$ such that $\mathcal{G} = h_V^\#$ and $\mathcal{F} = h_U^\#$ and $s$ is induced by $f$, then the diagrams of Lemma \ref{lemma-relocalize} and Lemma \ref{lemma-relocalize-ringed-topos} agree via the identifications $(j_\mathcal{F}, j_\mathcal{F}^\sharp) = (j_U, j_U^\sharp)$ and $(j_\mathcal{G}, j_\mathcal{G}^\sharp) = (j_V, j_V^\sharp)$ of Lemma \ref{lemma-localize-compare}. \end{lemma} 
\begin{lemma} \label{lemma-localize-morphism-ringed-topoi} Let $$ f : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{D}), \mathcal{O}') $$ be a morphism of ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$. Set $\mathcal{F} = f^{-1}\mathcal{G}$. Then there exists a commutative diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \ar[rr]_{(j_\mathcal{F}, j_\mathcal{F}^\sharp)} \ar[d]_{(f', (f')^\sharp)} & & (\Sh(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D})/\mathcal{G}, \mathcal{O}'_\mathcal{G}) \ar[rr]^{(j_\mathcal{G}, j_\mathcal{G}^\sharp)} & & (\Sh(\mathcal{D}), \mathcal{O}') } $$ We have $f'_*j_\mathcal{F}^{-1} = j_\mathcal{G}^{-1}f_*$ and $f'_*j_\mathcal{F}^* = j_\mathcal{G}^*f_*$. Moreover, the morphism $f'$ is characterized by the rule $$ (f')^{-1}(\mathcal{H} \xrightarrow{\varphi} \mathcal{G}) = (f^{-1}\mathcal{H} \xrightarrow{f^{-1}\varphi} \mathcal{F}). $$ \end{lemma} 
\begin{lemma} \label{lemma-localize-morphism-compare} Let $$ f : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{D}), \mathcal{O}') $$ be a morphism of ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$. Set $\mathcal{F} = f^{-1}\mathcal{G}$. If $f$ is given by a continuous functor $u : \mathcal{D} \to \mathcal{C}$ and $\mathcal{G} = h_V^\#$, then the commutative diagrams of Lemma \ref{lemma-localize-morphism-ringed-sites} and Lemma \ref{lemma-localize-morphism-ringed-topoi} agree via the identifications of Lemma \ref{lemma-localize-compare}. \end{lemma} 
\begin{lemma} \label{lemma-relocalize-morphism-ringed-topoi} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$ be a morphism of ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$, let $\mathcal{F}$ be a sheaf on $\mathcal{C}$, and let $s : \mathcal{F} \to f^{-1}\mathcal{G}$ a morphism of sheaves. There exists a commutative diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \ar[rr]_{(j_\mathcal{F}, j_\mathcal{F}^\sharp)} \ar[d]_{(f_c, f_c^\sharp)} & & (\Sh(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D})/\mathcal{G}, \mathcal{O}'_\mathcal{G}) \ar[rr]^{(j_\mathcal{G}, j_\mathcal{G}^\sharp)} & & (\Sh(\mathcal{D}), \mathcal{O}'). } $$ The morphism $(f_s, f_s^\sharp)$ is equal to the composition of the morphism $$ (f', (f')^\sharp) : (\Sh(\mathcal{C})/f^{-1}\mathcal{G}, \mathcal{O}_{f^{-1}\mathcal{G}}) \longrightarrow (\Sh(\mathcal{D})/{\mathcal{G}}, \mathcal{O}'_\mathcal{G}) $$ of Lemma \ref{lemma-localize-morphism-ringed-topoi} and the morphism $$ (j, j^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \to (\Sh(\mathcal{C})/f^{-1}\mathcal{G}, \mathcal{O}_{f^{-1}\mathcal{G}}) $$ of Lemma \ref{lemma-relocalize-ringed-topos}. Given any morphisms $b : \mathcal{G}' \to \mathcal{G}$, $a : \mathcal{F}' \to \mathcal{F}$, and $s' : \mathcal{F}' \to f^{-1}\mathcal{G}'$ such that $$ \xymatrix{ \mathcal{F}' \ar[r]_-{s'} \ar[d]_a & f^{-1}\mathcal{G}' \ar[d]^{f^{-1}b} \\ \mathcal{F} \ar[r]^-s & f^{-1}\mathcal{G} } $$ commutes, then the following diagram of ringed topoi $$ \xymatrix{ (\Sh(\mathcal{C})/\mathcal{F}', \mathcal{O}_{\mathcal{F}'}) \ar[rr]_{(j_{\mathcal{F}'/\mathcal{F}}, j_{\mathcal{F}'/\mathcal{F}}^\sharp)} \ar[d]_{(f_{s'}, f_{s'}^\sharp)} & & (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \ar[d]^{(f_s, f_s^\sharp)} \\ (\Sh(\mathcal{D})/\mathcal{G}', \mathcal{O}'_{\mathcal{G}'}) \ar[rr]^{(j_{\mathcal{G}'/\mathcal{G}}, j_{\mathcal{G}'/\mathcal{G}}^\sharp)} & & (\Sh(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}'}) } $$ commutes. \end{lemma} 
\begin{lemma} \label{lemma-relocalize-morphism-compare} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$, $s : \mathcal{F} \to f^{-1}\mathcal{G}$ be as in Lemma \ref{lemma-relocalize-morphism-ringed-topoi}. If $f$ is given by a continuous functor $u : \mathcal{D} \to \mathcal{C}$ and $\mathcal{G} = h_V^\#$, $\mathcal{F} = h_U^\#$ and $s$ comes from a morphism $c : U \to u(V)$, then the commutative diagrams of Lemma \ref{lemma-relocalize-morphism-ringed-sites} and Lemma \ref{lemma-relocalize-morphism-ringed-topoi} agree via the identifications of Lemma \ref{lemma-localize-compare}. \end{lemma} 
\begin{definition} \label{definition-site-local} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. We will freely use the notions defined in Definition \ref{definition-global}. \begin{enumerate} \item We say $\mathcal{F}$ is {\it locally free} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is a free $\mathcal{O}_{U_i}$-module. \item We say $\mathcal{F}$ is {\it finite locally free} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is a finite free $\mathcal{O}_{U_i}$-module. \item We say $\mathcal{F}$ is {\it locally generated by sections} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is an $\mathcal{O}_{U_i}$-module generated by global sections. \item Given $r \geq 0$ we sat $\mathcal{F}$ is {\it locally generated by $r$ sections} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is an $\mathcal{O}_{U_i}$-module generated by $r$ global sections. \item We say $\mathcal{F}$ is {\it of finite type} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is an $\mathcal{O}_{U_i}$-module generated by finitely many global sections. \item We say $\mathcal{F}$ is {\it quasi-coherent} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is an $\mathcal{O}_{U_i}$-module which has a global presentation. \item We say $\mathcal{F}$ is {\it of finite presentation} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/U_i}$ is an $\mathcal{O}_{U_i}$-module which has a finite global presentation. \item We say $\mathcal{F}$ is {\it coherent} if and only if $\mathcal{F}$ is of finite type, and for every object $U$ of $\mathcal{C}$ and any $s_1, \ldots, s_n \in \mathcal{F}(U)$ the kernel of the map $\bigoplus_{i = 1, \ldots, n} \mathcal{O}_U \to \mathcal{F}|_U$ is of finite type on $(\mathcal{C}/U, \mathcal{O}_U)$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-special-locally-free} Any of the properties (1) -- (8) of Definition \ref{definition-site-local} is intrinsic (see discussion in Section \ref{section-intrinsic}). \end{lemma} 
\begin{lemma} \label{lemma-local-final-object} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Let $\mathcal{F}$ be an $\mathcal{O}$-module. Assume that the site $\mathcal{C}$ has a final object $X$. Then \begin{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is locally free, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a locally free $\mathcal{O}_{X_i}$-module, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a free $\mathcal{O}_{X_i}$-module. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is finite locally free, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a finite locally free $\mathcal{O}_{X_i}$-module, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a finite free $\mathcal{O}_{X_i}$-module. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is locally generated by sections, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module locally generated by sections, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module globally generated by sections. \end{enumerate} \item Given $r \geq 0$, the following are equivalent \begin{enumerate} \item $\mathcal{F}$ is locally generated by $r$ sections, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module locally generated by $r$ sections, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module globally generated by $r$ sections. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is of finite type, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module of finite type, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module globally generated by finitely many sections. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is quasi-coherent, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a quasi-coherent $\mathcal{O}_{X_i}$-module, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module which has a global presentation. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is of finite presentation, \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module of finite presentation, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is an $\mathcal{O}_{X_i}$-module has a finite global presentation. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is coherent, and \item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a coherent $\mathcal{O}_{X_i}$-module. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-local-pullback} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. Let $\mathcal{F}$ be an $\mathcal{O}_\mathcal{D}$-module. \begin{enumerate} \item If $\mathcal{F}$ is locally free then $f^*\mathcal{F}$ is locally free. \item If $\mathcal{F}$ is finite locally free then $f^*\mathcal{F}$ is finite locally free. \item If $\mathcal{F}$ is locally generated by sections then $f^*\mathcal{F}$ is locally generated by sections. \item If $\mathcal{F}$ is locally generated by $r$ sections then $f^*\mathcal{F}$ is locally generated by $r$ sections. \item If $\mathcal{F}$ is of finite type then $f^*\mathcal{F}$ is of finite type. \item If $\mathcal{F}$ is quasi-coherent then $f^*\mathcal{F}$ is quasi-coherent. \item If $\mathcal{F}$ is of finite presentation then $f^*\mathcal{F}$ is of finite presentation. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-kernel-surjection-finite-onto-finite-presentation} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\theta : \mathcal{G} \to \mathcal{F}$ be a surjective $\mathcal{O}$-module map with $\mathcal{F}$ of finite presentation and $\mathcal{G}$ of finite type. Then $\Ker(\theta)$ is of finite type. \end{lemma} 
\begin{lemma} \label{lemma-chaotic-quasi-coherent} Let $\mathcal{C}$ be a category viewed as a site with the chaotic topology, see Sites, Example \ref{sites-example-indiscrete}. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$ and let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. Then $\mathcal{F}$ is quasi-coherent if and only if for all $U \to V$ in $\mathcal{C}$ the canonical map $$ \mathcal{F}(V) \otimes_{\mathcal{O}(V)} \mathcal{O}(U) \longrightarrow \mathcal{F}(U) $$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-chaotic-flat-quasi-coherent} Let $\mathcal{C}$ be a category viewed as a site with the chaotic topology, see Sites, Example \ref{sites-example-indiscrete}. Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. Assume for all $U \to V$ in $\mathcal{C}$ the restriction map $\mathcal{O}(V) \to \mathcal{O}(U)$ is a flat ring map. Then the category of quasi-coherent $\mathcal{O}$-modules is a weak Serre subcategory of $\textit{Mod}(\mathcal{O})$. \end{lemma} 
\begin{lemma} \label{lemma-i-star-equivalence} Let $i : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$ be a morphism of ringed topoi. Assume $i$ is a closed immersion of topoi and $i^\sharp : \mathcal{O}' \to i_*\mathcal{O}$ is surjective. Denote $\mathcal{I} \subset \mathcal{O}'$ the kernel of $i^\sharp$. The functor $$ i_* : \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}') $$ is exact, fully faithful, with essential image those $\mathcal{O}'$-modules $\mathcal{G}$ such that $\mathcal{I}\mathcal{G} = 0$. \end{lemma} 
\begin{lemma} \label{lemma-sheafification-tensor} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a presheaf of rings. Let $\mathcal{F}$, $\mathcal{G}$ be presheaves of $\mathcal{O}$-modules. Then $\mathcal{F}^\# \otimes_{\mathcal{O}^\#} \mathcal{G}^\#$ is equal to $(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G})^\#$. \end{lemma} 
\begin{lemma} \label{lemma-tensor-product-pullback} Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}_\mathcal{D}$-modules. Then $f^*(\mathcal{F} \otimes_{\mathcal{O}_\mathcal{D}} \mathcal{G}) = f^*\mathcal{F} \otimes_{\mathcal{O}_\mathcal{C}} f^*\mathcal{G}$ functorially in $\mathcal{F}$, $\mathcal{G}$. \end{lemma} 
\begin{lemma} \label{lemma-tensor-product-permanence} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}$-modules. \begin{enumerate} \item If $\mathcal{F}$, $\mathcal{G}$ are locally free, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$, $\mathcal{G}$ are finite locally free, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$, $\mathcal{G}$ are locally generated by sections, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$, $\mathcal{G}$ are of finite type, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$, $\mathcal{G}$ are quasi-coherent, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$, $\mathcal{G}$ are of finite presentation, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \item If $\mathcal{F}$ is of finite presentation and $\mathcal{G}$ is coherent, then $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$ is coherent. \item If $\mathcal{F}$, $\mathcal{G}$ are coherent, so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-internal-hom} If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings, $\mathcal{F}$ is a presheaf of $\mathcal{O}$-modules, and $\mathcal{G}$ is a sheaf of $\mathcal{O}$-modules, then $\SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G})$ is a sheaf of $\mathcal{O}$-modules. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-restriction} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}, \mathcal{G}$ be sheaves of $\mathcal{O}$-modules. Then formation of $\SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G})$ commutes with restriction to $U$ for $U \in \Ob(\mathcal{C})$. \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-commute-limits} Internal hom and (co)limits. Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings. \begin{enumerate} \item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor $$ \textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O}) , \quad \mathcal{G} \longmapsto \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) $$ commutes with arbitrary limits. \item For any presheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor $$ \textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})^{opp} , \quad \mathcal{F} \longmapsto \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) $$ commutes with arbitrary colimits, in a formula $$ \SheafHom_\mathcal{O}(\colim_i \mathcal{F}_i, \mathcal{G}) = \lim_i \SheafHom_\mathcal{O}(\mathcal{F}_i, \mathcal{G}). $$ \end{enumerate} Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings. \begin{enumerate} \item[(3)] For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor $$ \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}) , \quad \mathcal{G} \longmapsto \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) $$ commutes with arbitrary limits. \item[(4)] For any sheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor $$ \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O})^{opp} , \quad \mathcal{F} \longmapsto \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) $$ commutes with arbitrary colimits, in a formula $$ \SheafHom_\mathcal{O}(\colim_i \mathcal{F}_i, \mathcal{G}) = \lim_i \SheafHom_\mathcal{O}(\mathcal{F}_i, \mathcal{G}). $$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-exact} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}$-modules. \begin{enumerate} \item If $\mathcal{F}_2 \to \mathcal{F}_1 \to \mathcal{F} \to 0$ is an exact sequence of $\mathcal{O}$-modules, then $$ 0 \to \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) \to \SheafHom_\mathcal{O}(\mathcal{F}_1, \mathcal{G}) \to \SheafHom_\mathcal{O}(\mathcal{F}_2, \mathcal{G}) $$ is exact. \item If $0 \to \mathcal{G} \to \mathcal{G}_1 \to \mathcal{G}_2$ is an exact sequence of $\mathcal{O}$-modules, then $$ 0 \to \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) \to \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}_1) \to \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}_2) $$ is exact. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-internal-hom-adjoint-tensor} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. \begin{enumerate} \item Let $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ be presheaves of $\mathcal{O}$-modules. There is a canonical isomorphism $$ \SheafHom_\mathcal{O} (\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H}) \longrightarrow \SheafHom_\mathcal{O} (\mathcal{F}, \SheafHom_\mathcal{O}(\mathcal{G}, \mathcal{H})) $$ which is functorial in all three entries (sheaf Hom in all three spots). In particular, $$ \Mor_{\textit{PMod}(\mathcal{O})}( \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H}) = \Mor_{\textit{PMod}(\mathcal{O})}( \mathcal{F}, \SheafHom_\mathcal{O}(\mathcal{G}, \mathcal{H})) $$ \item Suppose that $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings, and $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ are sheaves of $\mathcal{O}$-modules. There is a canonical isomorphism $$ \SheafHom_\mathcal{O} (\mathcal{F} \otimes_\mathcal{O} \mathcal{G}, \mathcal{H}) \longrightarrow \SheafHom_\mathcal{O} (\mathcal{F}, \SheafHom_\mathcal{O}(\mathcal{G}, \mathcal{H})) $$ which is functorial in all three entries (sheaf Hom in all three spots). In particular, $$ \Mor_{\textit{Mod}(\mathcal{O})}( \mathcal{F} \otimes_\mathcal{O} \mathcal{G}, \mathcal{H}) = \Mor_{\textit{Mod}(\mathcal{O})}( \mathcal{F}, \SheafHom_\mathcal{O}(\mathcal{G}, \mathcal{H})) $$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tensor-commute-colimits} Tensor product and colimits. Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings. \begin{enumerate} \item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor $$ \textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O}) , \quad \mathcal{G} \longmapsto \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} $$ commutes with arbitrary colimits. \item Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings. For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor $$ \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}) , \quad \mathcal{G} \longmapsto \mathcal{F} \otimes_\mathcal{O} \mathcal{G} $$ commutes with arbitrary colimits. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-adjoint-hom-restrict} Let $\mathcal{C}$ be a category, resp.\ a site Let $\mathcal{O} \to \mathcal{O}'$ be a map of presheaves, resp.\ sheaves of rings. Then $$ \Hom_\mathcal{O}(\mathcal{G}, \mathcal{F}) = \Hom_{\mathcal{O}'}(\mathcal{G}, \SheafHom_\mathcal{O}(\mathcal{O}', \mathcal{F})) $$ for any $\mathcal{O}'$-module $\mathcal{G}$ and $\mathcal{O}$-module $\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-j-shriek-and-tensor} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U \in \Ob(\mathcal{C})$. For $\mathcal{G}$ in $\textit{Mod}(\mathcal{O}_U)$ and $\mathcal{F}$ in $\textit{Mod}(\mathcal{O})$ we have $j_{U!}\mathcal{G} \otimes_\mathcal{O} \mathcal{F} = j_{U!}(\mathcal{G} \otimes_{\mathcal{O}_U} \mathcal{F}|_U)$. \end{lemma} 
\begin{lemma} \label{lemma-hom-finite-presentation-colimit} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be an $\mathcal{O}$-module of finite presentation. Let $\mathcal{G} = \colim_{\lambda \in \Lambda} \mathcal{G}_\lambda$ be a filtered colimit of $\mathcal{O}$-modules. Then the canonical map $$ \colim_\lambda \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}_\lambda) \longrightarrow \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{G}) $$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-finite-presentation-quasi-compact-colimit} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{G} = \colim_{\lambda \in \Lambda} \mathcal{G}_\lambda$ be a filtered colimit of $\mathcal{O}$-modules. Let $\mathcal{F}$ be an $\mathcal{O}$-module of finite presentation. Then we have $$ \colim_\lambda \Hom_\mathcal{O}(\mathcal{F}, \mathcal{G}_\lambda) = \Hom_\mathcal{O}(\mathcal{F}, \mathcal{G}). $$ if the hypotheses of Sites, Lemma \ref{sites-lemma-directed-colimits-global-sections} part (4) are satisfied for the site $\mathcal{C}$; please see Sites, Remark \ref{sites-remark-stronger-conditions}. \end{lemma} 
\begin{definition} \label{definition-flat} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. \begin{enumerate} \item A presheaf $\mathcal{F}$ of $\mathcal{O}$-modules is called {\it flat} if the functor $$ \textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O}), \quad \mathcal{G} \mapsto \mathcal{G} \otimes_{p, \mathcal{O}} \mathcal{F} $$ is exact. \item A map $\mathcal{O} \to \mathcal{O}'$ of presheaves of rings is called {\it flat} if $\mathcal{O}'$ is flat as a presheaf of $\mathcal{O}$-modules. \item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings and $\mathcal{F}$ is a sheaf of $\mathcal{O}$-modules, then we say $\mathcal{F}$ is {\it flat} if the functor $$ \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}), \quad \mathcal{G} \mapsto \mathcal{G} \otimes_\mathcal{O} \mathcal{F} $$ is exact. \item A map $\mathcal{O} \to \mathcal{O}'$ of sheaves of rings on a site is called {\it flat} if $\mathcal{O}'$ is flat as a sheaf of $\mathcal{O}$-modules. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-flatness-presheaves} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules. If each $\mathcal{F}(U)$ is a flat $\mathcal{O}(U)$-module, then $\mathcal{F}$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-flatness-sheafification} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a presheaf of rings. Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules. If $\mathcal{F}$ is a flat $\mathcal{O}$-module, then $\mathcal{F}^\#$ is a flat $\mathcal{O}^\#$-module. \end{lemma} 
\begin{lemma} \label{lemma-flatness-sheafification-refined} Let $\mathcal{C}$ be a site. Let $\mathcal{O}$ be a presheaf of rings. Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules. Assume that every object $U$ of $\mathcal{C}$ has a covering $\{U_i \to U\}_{i \in I}$ such that $\mathcal{F}(U_i)$ is a flat $\mathcal{O}(U_i)$-module. Then $\mathcal{F}^\#$ is a flat $\mathcal{O}^\#$-module. \end{lemma} 
\begin{lemma} \label{lemma-colimits-flat} Colimits and tensor product. \begin{enumerate} \item A filtered colimit of flat presheaves of modules is flat. A direct sum of flat presheaves of modules is flat. \item A filtered colimit of flat sheaves of modules is flat. A direct sum of flat sheaves of modules is flat. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-restriction-flat} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object of $\mathcal{C}$. If $\mathcal{F}$ is a flat $\mathcal{O}$-module, then $\mathcal{F}|_U$ is a flat $\mathcal{O}_U$-module. \end{lemma} 
\begin{lemma} \label{lemma-j-shriek-flat} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. Let $U$ be an object of $\mathcal{C}$. Consider the functor $j_U : \mathcal{C}/U \to \mathcal{C}$. \begin{enumerate} \item The presheaf of $\mathcal{O}$-modules $j_{U!}\mathcal{O}_U$ (see Remark \ref{remark-localize-presheaves}) is flat. \item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings, $j_{U!}\mathcal{O}_U$ is a flat sheaf of $\mathcal{O}$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-module-quotient-flat} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. \begin{enumerate} \item Any presheaf of $\mathcal{O}$-modules is a quotient of a direct sum $\bigoplus j_{U_i!}\mathcal{O}_{U_i}$. \item Any presheaf of $\mathcal{O}$-modules is a quotient of a flat presheaf of $\mathcal{O}$-modules. \item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings, then any sheaf of $\mathcal{O}$-modules is a quotient of a direct sum $\bigoplus j_{U_i!}\mathcal{O}_{U_i}$. \item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings, then any sheaf of $\mathcal{O}$-modules is a quotient of a flat sheaf of $\mathcal{O}$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-tor-zero} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. Let $$ 0 \to \mathcal{F}'' \to \mathcal{F}' \to \mathcal{F} \to 0 $$ be a short exact sequence of presheaves of $\mathcal{O}$-modules. Let $\mathcal{G}$ be a presheaf of $\mathcal{O}$-modules. \begin{enumerate} \item If $\mathcal{F}$ is a flat presheaf of modules, then the sequence $$ 0 \to \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G} \to \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G} \to \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0 $$ is exact. \item If $\mathcal{C}$ is a site, $\mathcal{O}$, $\mathcal{F}$, $\mathcal{F}'$, $\mathcal{F}''$, and $\mathcal{G}$ are sheaves, and $\mathcal{F}$ is flat as a sheaf of modules, then the sequence $$ 0 \to \mathcal{F}'' \otimes_\mathcal{O} \mathcal{G} \to \mathcal{F}' \otimes_\mathcal{O} \mathcal{G} \to \mathcal{F} \otimes_\mathcal{O} \mathcal{G} \to 0 $$ is exact. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-ses} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. Let $$ 0 \to \mathcal{F}_2 \to \mathcal{F}_1 \to \mathcal{F}_0 \to 0 $$ be a short exact sequence of presheaves of $\mathcal{O}$-modules. \begin{enumerate} \item If $\mathcal{F}_2$ and $\mathcal{F}_0$ are flat so is $\mathcal{F}_1$. \item If $\mathcal{F}_1$ and $\mathcal{F}_0$ are flat so is $\mathcal{F}_2$. \end{enumerate} If $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings then the same result holds in $\textit{Mod}(\mathcal{O})$. \end{lemma} 
\begin{lemma} \label{lemma-flat-resolution-of-flat} Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of rings. Let $$ \ldots \to \mathcal{F}_2 \to \mathcal{F}_1 \to \mathcal{F}_0 \to \mathcal{Q} \to 0 $$ be an exact complex of presheaves of $\mathcal{O}$-modules. If $\mathcal{Q}$ and all $\mathcal{F}_i$ are flat $\mathcal{O}$-modules, then for any presheaf $\mathcal{G}$ of $\mathcal{O}$-modules the complex $$ \ldots \to \mathcal{F}_2 \otimes_{p, \mathcal{O}} \mathcal{G} \to \mathcal{F}_1 \otimes_{p, \mathcal{O}} \mathcal{G} \to \mathcal{F}_0 \otimes_{p, \mathcal{O}} \mathcal{G} \to \mathcal{Q} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0 $$ is exact also. If $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings then the same result holds $\textit{Mod}(\mathcal{O})$. \end{lemma} 
\begin{lemma} \label{lemma-tensor-flats} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. If $\mathcal{G}$ and $\mathcal{F}$ are flat $\mathcal{O}$-modules, then $\mathcal{G} \otimes_\mathcal{O} \mathcal{F}$ is a flat $\mathcal{O}$-module. \end{lemma} 
\begin{lemma} \label{lemma-flat-change-of-rings} Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a map of sheaves of rings on a site $\mathcal{C}$. If $\mathcal{G}$ is a flat $\mathcal{O}_1$-module, then $\mathcal{G} \otimes_{\mathcal{O}_1} \mathcal{O}_2$ is a flat $\mathcal{O}_2$-module. \end{lemma} 
\begin{lemma} \label{lemma-flat-eq} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be an $\mathcal{O}$-module. The following are equivalent \begin{enumerate} \item $\mathcal{F}$ is a flat $\mathcal{O}$-module. \item Let $U$ be an object of $\mathcal{C}$ and let $$ \mathcal{O}_U \xrightarrow{(f_1, \ldots, f_n)} \mathcal{O}_U^{\oplus n} \xrightarrow{(s_1, \ldots, s_n)} \mathcal{F}|_U $$ be a complex of $\mathcal{O}_U$-modules. Then there exists a covering $\{U_i \to U\}$ and for each $i$ a factorization $$ \mathcal{O}_{U_i}^{\oplus n} \xrightarrow{B_i} \mathcal{O}_{U_i}^{\oplus l_i} \xrightarrow{(t_{i1}, \ldots, t_{il_i})} \mathcal{F}|_{U_i} $$ of $(s_1, \ldots, s_n)|_{U_i}$ such that $B_i \circ (f_1, \ldots, f_n)|_{U_i} = 0$. \item Let $U$ be an object of $\mathcal{C}$ and let $$ \mathcal{O}_U^{\oplus m} \xrightarrow{A} \mathcal{O}_U^{\oplus n} \xrightarrow{(s_1, \ldots, s_n)} \mathcal{F}|_U $$ be a complex of $\mathcal{O}_U$-modules. Then there exists a covering $\{U_i \to U\}$ and for each $i$ a factorization $$ \mathcal{O}_{U_i}^{\oplus n} \xrightarrow{B_i} \mathcal{O}_{U_i}^{\oplus l_i} \xrightarrow{(t_{i1}, \ldots, t_{il_i})} \mathcal{F}|_{U_i} $$ of $(s_1, \ldots, s_n)|_{U_i}$ such that $B_i \circ A|_{U_i} = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-over-thickening} Let $\mathcal{C}$ be a site. Let $\mathcal{O}' \to \mathcal{O}$ be a surjection of sheaves of rings whose kernel $\mathcal{I}$ is an ideal of square zero. Let $\mathcal{F}'$ be an $\mathcal{O}'$-module and set $\mathcal{F} = \mathcal{F}'/\mathcal{I}\mathcal{F}'$. The following are equivalent \begin{enumerate} \item $\mathcal{F}'$ is a flat $\mathcal{O}'$-module, and \item $\mathcal{F}$ is a flat $\mathcal{O}$-module and $\mathcal{I} \otimes_\mathcal{O} \mathcal{F} \to \mathcal{F}'$ is injective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-neighbourhood-isomorphism} Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$ be a flat homomorphism of sheaves of rings. Let $\mathcal{I} \subset \mathcal{O}$ be a sheaf of ideals such that the induced map $\mathcal{O}/\mathcal{I} \to \mathcal{O}'/\mathcal{I}\mathcal{O}'$ is an isomorphism. For any $\mathcal{O}$-module $\mathcal{F}$ annihilated by $\mathcal{I}^n$ for some $n \geq 0$ the map $\text{id} \otimes 1 : \mathcal{F} \to \mathcal{F} \otimes_\mathcal{O} \mathcal{O}'$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-left-dual-module} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be a $\mathcal{O}$-module. Let $\mathcal{G}, \eta, \epsilon$ be a left dual of $\mathcal{F}$ in the monoidal category of $\mathcal{O}$-modules, see Categories, Definition \ref{categories-definition-dual}. Then \begin{enumerate} \item for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$ such that $\mathcal{F}|_{U_i}$ is a direct summand of a finite free $\mathcal{O}|_{U_i}$-module, \item the map $e : \SheafHom_\mathcal{O}(\mathcal{F}, \mathcal{O}) \to \mathcal{G}$ sending a local section $\lambda$ to $(\lambda \otimes 1)(\eta)$ is an isomorphism, \item we have $\epsilon(f, g) = e^{-1}(g)(f)$ for local sections $f$ and $g$ of $\mathcal{F}$ and $\mathcal{G}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-locally-finite-presentation} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be locally of finite presentation and flat. Then given an object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$ such that $\mathcal{F}|_{U_i}$ is a direct summand of a finite free $\mathcal{O}_{U_i}$-module. \end{lemma} 
\begin{lemma} \label{lemma-covering-gives-surjection} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\{U_i \to U\}$ be a covering of $\mathcal{C}$. Then the sequence $$ \bigoplus j_{U_i \times_U U_j!}\mathcal{O}_{U_i \times_U U_j} \to \bigoplus j_{U_i!}\mathcal{O}_{U_i} \to j_!\mathcal{O}_U \to 0 $$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-silly-quasi-compact} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be covering of $\mathcal{C}$. If $U$ is quasi-compact, then there exist a finite subset $I' \subset I$ such that the sequence $$ \bigoplus\nolimits_{i, i' \in I'} j_{U_i \times_U U_{i'}!}\mathcal{O}_{U_i \times_U U_{i'}} \to \bigoplus\nolimits_{i \in I'} j_{U_i!}\mathcal{O}_{U_i} \to j_!\mathcal{O}_U \to 0 $$ is exact. \end{lemma} 
\begin{lemma} \label{lemma-sections-over-quasi-compact} Let $\mathcal{C}$ be a site. Let $W$ be a quasi-compact object of $\mathcal{C}$. \begin{enumerate} \item The functor $\Sh(\mathcal{C}) \to \textit{Sets}$, $\mathcal{F} \mapsto \mathcal{F}(W)$ commutes with coproducts. \item Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. The functor $\textit{Mod}(\mathcal{O}) \to \textit{Ab}$, $\mathcal{F} \mapsto \mathcal{F}(W)$ commutes with direct sums. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quasi-compact-hom-from} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be a quasi-compact object of $\mathcal{C}$. Then the functor $\Hom_\mathcal{O}(j_!\mathcal{O}_U, -)$ commutes with direct sums. \end{lemma} 
\begin{lemma} \label{lemma-module-quotient-direct-sum} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}) holds. \begin{enumerate} \item Every sheaf of sets is the target of a surjective map whose source is a coproduct $\coprod h_{U_i}^\#$ with $U_i$ in $\mathcal{B}$. \item If $\mathcal{O}$ is a sheaf of rings, then every $\mathcal{O}$-module is a quotient of a direct sum $\bigoplus\nolimits j_{U_i!}\mathcal{O}_{U_i}$ with $U_i$ in $\mathcal{B}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-module-filtered-colimit-constructibles} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}) and (\ref{item-enough-qc}) hold. \begin{enumerate} \item Every sheaf of sets is a filtered colimit of sheaves of the form \begin{equation} \label{equation-towards-constructible-sets} \text{Coequalizer}\left( \xymatrix{ \coprod\nolimits_{j = 1, \ldots, m} h_{V_j}^\# \ar@<1ex>[r] \ar@<-1ex>[r] & \coprod\nolimits_{i = 1, \ldots, n} h_{U_i}^\# } \right) \end{equation} with $U_i$ and $V_j$ in $\mathcal{B}$. \item If $\mathcal{O}$ is a sheaf of rings, then every $\mathcal{O}$-module is a filtered colimit of sheaves of the form \begin{equation} \label{equation-towards-constructible} \Coker\left( \bigoplus\nolimits_{j = 1, \ldots, m} j_{V_j!}\mathcal{O}_{V_j} \longrightarrow \bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\mathcal{O}_{U_i} \right) \end{equation} with $U_i$ and $V_j$ in $\mathcal{B}$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-cokernel-map-towards-constructibles} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}) and (\ref{item-enough-qc}) hold. Let $\mathcal{O}$ be a sheaf of rings. Then a cokernel of a map between modules as in (\ref{equation-towards-constructible}) is another module as in (\ref{equation-towards-constructible}). \end{lemma} 
\begin{lemma} \label{lemma-change-presentation-towards-constructibles} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}), (\ref{item-enough-qc}), and (\ref{item-enough-qc-qs}) hold. Let $\mathcal{O}$ be a sheaf of rings. Assume given a map $$ \bigoplus\nolimits_{j = 1, \ldots, m} j_{V_j!}\mathcal{O}_{V_j} \longrightarrow \bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\mathcal{O}_{U_i} $$ with $U_i$ and $V_j$ in $\mathcal{B}$, and coverings $\{U_{ik} \to U_i\}_{k \in K_i}$ with $U_{ik} \in \mathcal{B}$. Then there exist finite subsets $K'_i \subset K_i$ and a finite set $L$ of $W_l \in \mathcal{B}$ and a commutative diagram $$ \xymatrix{ \bigoplus_{l \in L} j_{W_l!}\mathcal{O}_{W_l} \ar[d] \ar[r] & \bigoplus_{i = 1, \ldots, n} \bigoplus_{k \in K'_i} j_{U_{ik}!}\mathcal{O}_{U_{ik}} \ar[d] \\ \bigoplus_{j = 1, \ldots, m} j_{V_j!}\mathcal{O}_{V_j} \ar[r] & \bigoplus_{i = 1, \ldots, n} j_{U_i!}\mathcal{O}_{U_i} } $$ inducing an isomorphism on cokernels of the horizontal maps. \end{lemma} 
\begin{lemma} \label{lemma-extension-towards-constructibles} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}), (\ref{item-enough-qc}), and (\ref{item-enough-qc-qs}) hold. Let $\mathcal{O}$ be a sheaf of rings. Then an extension of modules as in (\ref{equation-towards-constructible}) is another module as in (\ref{equation-towards-constructible}). \end{lemma} 
\begin{lemma} \label{lemma-towards-constructible-when-serre-subcategory} In Situation \ref{situation-quasi-compact-objects} assume (\ref{item-enough}), (\ref{item-enough-qc}), and (\ref{item-enough-qc-qs}) hold. Let $\mathcal{O}$ be a sheaf of rings. Let $\mathcal{A} \subset \textit{Mod}(\mathcal{O})$ be the full subcategory of modules isomorphic to a cokernel as in (\ref{equation-towards-constructible}). If the kernel of every map of $\mathcal{O}$-modules of the form $$ \bigoplus\nolimits_{j = 1, \ldots, m} j_{V_j!}\mathcal{O}_{V_j} \longrightarrow \bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\mathcal{O}_{U_i} $$ with $U_i$ and $V_j$ in $\mathcal{B}$, is in $\mathcal{A}$, then $\mathcal{A}$ is weak Serre subcategory of $\textit{Mod}(\mathcal{O})$. \end{lemma} 
\begin{definition} \label{definition-flat-morphism} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{C}'), \mathcal{O}')$ be a morphism of ringed topoi. We say $(f, f^\sharp)$ is {\it flat} if the ring map $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$ is flat. We say a morphism of ringed sites is {\it flat} if the associated morphism of ringed topoi is flat. \end{definition} 
\begin{lemma} \label{lemma-flat-pullback-exact} Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{C}')$ be a morphism of ringed topoi. Then $$ f^{-1} : \textit{Ab}(\mathcal{C}') \longrightarrow \textit{Ab}(\mathcal{C}), \quad \mathcal{F} \longmapsto f^{-1}\mathcal{F} $$ is exact. If $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{C}'), \mathcal{O}')$ is a flat morphism of ringed topoi then $$ f^* : \textit{Mod}(\mathcal{O}') \longrightarrow \textit{Mod}(\mathcal{O}), \quad \mathcal{F} \longmapsto f^*\mathcal{F} $$ is exact. \end{lemma} 
\begin{definition} \label{definition-flat-module} Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$ be a morphism of ringed topoi. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. We say that $\mathcal{F}$ is {\it flat over $(\Sh(\mathcal{D}), \mathcal{O}')$} if $\mathcal{F}$ is flat as an $f^{-1}\mathcal{O}'$-module. \end{definition} 
\begin{lemma} \label{lemma-pullback-internal-hom} Let $f : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to (\mathcal{D}, \mathcal{O}_\mathcal{D})$ be a morphism of ringed sites. Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}_\mathcal{D}$-modules. If $\mathcal{F}$ is finitely presented and $f$ is flat, then the canonical map $$ f^*\SheafHom_{\mathcal{O}_\mathcal{D}}(\mathcal{F}, \mathcal{G}) \longrightarrow \SheafHom_{\mathcal{O}_\mathcal{C}}(f^*\mathcal{F}, f^*\mathcal{G}) $$ of Remark \ref{remark-pullback-internal-hom} is an isomorphism. \end{lemma} 
\begin{definition} \label{definition-invertible-sheaf} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. \begin{enumerate} \item A finite locally free $\mathcal{O}$-module $\mathcal{F}$ is said to have {\it rank $r$} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$ of $U$ such that $\mathcal{F}|_{U_i}$ is isomorphic to $\mathcal{O}_{U_i}^{\oplus r}$ as an $\mathcal{O}_{U_i}$-module. \item An $\mathcal{O}$-module $\mathcal{L}$ is {\it invertible} if the functor $$ \textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}),\quad \mathcal{F}  \longmapsto \mathcal{F} \otimes_\mathcal{O} \mathcal{L} $$ is an equivalence. \item The sheaf {\it $\mathcal{O}^*$} is the subsheaf of $\mathcal{O}$ defined by the rule $$ U \longmapsto \mathcal{O}^*(U) = \{f \in \mathcal{O}(U) \mid \exists g \in \mathcal{O}(U)\text{ such that }fg = 1\} $$ It is a sheaf of abelian groups with multiplication as the group law. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-invertible} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{L}$ be an $\mathcal{O}$-module. The following are equivalent: \begin{enumerate} \item $\mathcal{L}$ is invertible, and \item there exists an $\mathcal{O}$-module $\mathcal{N}$ such that $\mathcal{L} \otimes_\mathcal{O} \mathcal{N} \cong \mathcal{O}$. \end{enumerate} In this case we have \begin{enumerate} \item[(a)] $\mathcal{L}$ is a flat $\mathcal{O}$-module of finite presentation, \item[(b)] for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$ such that $\mathcal{L}|_{U_i}$ is a direct summand of a finite free module, and \item[(c)] the module $\mathcal{N}$ in (2) is isomorphic to $\SheafHom_\mathcal{O}(\mathcal{L}, \mathcal{O})$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pullback-invertible} Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. The pullback $f^*\mathcal{L}$ of an invertible $\mathcal{O}_\mathcal{D}$-module is invertible. \end{lemma} 
\begin{lemma} \label{lemma-constructions-invertible} Let $(\mathcal{C}, \mathcal{O})$ be a ringed space. \begin{enumerate} \item If $\mathcal{L}$, $\mathcal{N}$ are invertible $\mathcal{O}$-modules, then so is $\mathcal{L} \otimes_\mathcal{O} \mathcal{N}$. \item If $\mathcal{L}$ is an invertible $\mathcal{O}$-module, then so is $\SheafHom_\mathcal{O}(\mathcal{L}, \mathcal{O})$ and the evaluation map $\mathcal{L} \otimes_\mathcal{O} \SheafHom_\mathcal{O}(\mathcal{L}, \mathcal{O}) \to \mathcal{O}$ is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pic-set} Let $(\mathcal{C}, \mathcal{O})$ be a ringed space. There exists a set of invertible modules $\{\mathcal{L}_i\}_{i \in I}$ such that each invertible module on $(\mathcal{C}, \mathcal{O})$ is isomorphic to exactly one of the $\mathcal{L}_i$. \end{lemma} 
\begin{definition} \label{definition-pic} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. The {\it Picard group} $\Pic(\mathcal{O})$ of the ringed site is the abelian group whose elements are isomorphism classes of invertible $\mathcal{O}$-modules, with addition corresponding to tensor product. \end{definition} 
\begin{definition} \label{definition-derivation} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. Let $\mathcal{F}$ be an $\mathcal{O}_2$-module. A {\it $\mathcal{O}_1$-derivation} or more precisely a {\it $\varphi$-derivation} into $\mathcal{F}$ is a map $D : \mathcal{O}_2 \to \mathcal{F}$ which is additive, annihilates the image of $\mathcal{O}_1 \to \mathcal{O}_2$, and satisfies the {\it Leibniz rule} $$ D(ab) = aD(b) + D(a)b $$ for all $a, b$ local sections of $\mathcal{O}_2$ (wherever they are both defined). We denote $\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})$ the set of $\varphi$-derivations into $\mathcal{F}$. \end{definition} 
\begin{lemma} \label{lemma-universal-module} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. The functor $$ \textit{Mod}(\mathcal{O}_2) \longrightarrow \textit{Ab}, \quad \mathcal{F} \longmapsto \text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F}) $$ is representable. \end{lemma} 
\begin{definition} \label{definition-module-differentials} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. The {\it module of differentials} of the ring map $\varphi$ is the object representing the functor $\mathcal{F} \mapsto \text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})$ which exists by Lemma \ref{lemma-universal-module}. It is denoted $\Omega_{\mathcal{O}_2/\mathcal{O}_1}$, and the {\it universal $\varphi$-derivation} is denoted $\text{d} : \mathcal{O}_2 \to \Omega_{\mathcal{O}_2/\mathcal{O}_1}$. \end{definition} 
\begin{lemma} \label{lemma-differentials-sheafify} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of presheaves of rings. Then $\Omega_{\mathcal{O}_2^\#/\mathcal{O}_1^\#}$ is the sheaf associated to the presheaf $U \mapsto \Omega_{\mathcal{O}_2(U)/\mathcal{O}_1(U)}$. \end{lemma} 
\begin{lemma} \label{lemma-pullback-differentials} Let $f : \Sh(\mathcal{D}) \to \Sh(\mathcal{C})$ be a morphism of topoi. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings on $\mathcal{C}$. Then there is a canonical identification $f^{-1}\Omega_{\mathcal{O}_2/\mathcal{O}_1} = \Omega_{f^{-1}\mathcal{O}_2/f^{-1}\mathcal{O}_1}$ compatible with universal derivations. \end{lemma} 
\begin{lemma} \label{lemma-localize-differentials} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. For any object $U$ of $\mathcal{C}$ there is a canonical isomorphism $$ \Omega_{\mathcal{O}_2/\mathcal{O}_1}|_U = \Omega_{(\mathcal{O}_2|_U)/(\mathcal{O}_1|_U)} $$ compatible with universal derivations. \end{lemma} 
\begin{lemma} \label{lemma-functoriality-differentials} Let $\mathcal{C}$ be a site. Let $$ \xymatrix{ \mathcal{O}_2 \ar[r]_\varphi & \mathcal{O}_2' \\ \mathcal{O}_1 \ar[r] \ar[u] & \mathcal{O}'_1 \ar[u] } $$ be a commutative diagram of sheaves of rings on $\mathcal{C}$. The map $\mathcal{O}_2 \to \mathcal{O}'_2$ composed with the map $\text{d} : \mathcal{O}'_2 \to \Omega_{\mathcal{O}'_2/\mathcal{O}'_1}$ is a $\mathcal{O}_1$-derivation. Hence we obtain a canonical map of $\mathcal{O}_2$-modules $\Omega_{\mathcal{O}_2/\mathcal{O}_1} \to \Omega_{\mathcal{O}'_2/\mathcal{O}'_1}$. It is uniquely characterized by the property that $\text{d}(f)$ mapsto $\text{d}(\varphi(f))$ for any local section $f$ of $\mathcal{O}_2$. In this way $\Omega_{-/-}$ becomes a functor on the category of arrows of sheaves of rings. \end{lemma} 
\begin{lemma} \label{lemma-differential-seq} In Lemma \ref{lemma-functoriality-differentials} suppose that $\mathcal{O}_2 \to \mathcal{O}'_2$ is surjective with kernel $\mathcal{I} \subset \mathcal{O}_2$ and assume that $\mathcal{O}_1 = \mathcal{O}'_1$. Then there is a canonical exact sequence of $\mathcal{O}'_2$-modules $$ \mathcal{I}/\mathcal{I}^2 \longrightarrow \Omega_{\mathcal{O}_2/\mathcal{O}_1} \otimes_{\mathcal{O}_2} \mathcal{O}'_2 \longrightarrow \Omega_{\mathcal{O}'_2/\mathcal{O}_1} \longrightarrow 0 $$ The leftmost map is characterized by the rule that a local section $f$ of $\mathcal{I}$ maps to $\text{d}f \otimes 1$. \end{lemma} 
\begin{lemma} \label{lemma-double-structure-gives-derivation} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. Consider a short exact sequence $$ 0 \to \mathcal{F} \to \mathcal{A} \to \mathcal{O}_2 \to 0 $$ Here $\mathcal{A}$ is a sheaf of $\mathcal{O}_1$-algebras, $\pi : \mathcal{A} \to \mathcal{O}_2$ is a surjection of sheaves of $\mathcal{O}_1$-algebras, and $\mathcal{F} = \Ker(\pi)$ is its kernel. Assume $\mathcal{F}$ an ideal sheaf with square zero in $\mathcal{A}$. So $\mathcal{F}$ has a natural structure of an $\mathcal{O}_2$-module. A section $s : \mathcal{O}_2 \to \mathcal{A}$ of $\pi$ is a $\mathcal{O}_1$-algebra map such that $\pi \circ s = \text{id}$. Given any section $s : \mathcal{O}_2 \to \mathcal{F}$ of $\pi$ and any $\varphi$-derivation $D : \mathcal{O}_1 \to \mathcal{F}$ the map $$ s + D : \mathcal{O}_1 \to \mathcal{A} $$ is a section of $\pi$ and every section $s'$ is of the form $s + D$ for a unique $\varphi$-derivation $D$. \end{lemma} 
\begin{definition} \label{definition-sheaf-differentials} Let $X = (\Sh(\mathcal{C}), \mathcal{O})$ and $Y = (\Sh(\mathcal{C}'), \mathcal{O}')$ be ringed topoi. Let $(f, f^\sharp) : X \to Y$ be a morphism of ringed topoi. In this situation \begin{enumerate} \item for a sheaf $\mathcal{F}$ of $\mathcal{O}$-modules a {\it $Y$-derivation} $D : \mathcal{O} \to \mathcal{F}$ is just a $f^\sharp$-derivation, and \item the {\it sheaf of differentials $\Omega_{X/Y}$ of $X$ over $Y$} is the module of differentials of $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, see Definition \ref{definition-module-differentials}. \end{enumerate} Thus $\Omega_{X/Y}$ comes equipped with a {\it universal $Y$-derivation} $\text{d}_{X/Y} : \mathcal{O} \longrightarrow \Omega_{X/Y}$. We sometimes write $\Omega_{X/Y} = \Omega_f$. \end{definition} 
\begin{lemma} \label{lemma-functoriality-differentials-ringed-topoi} Let $X = (\Sh(\mathcal{C}_X), \mathcal{O}_X)$, $Y = (\Sh(\mathcal{C}_Y), \mathcal{O}_Y)$, $X' = (\Sh(\mathcal{C}_{X'}), \mathcal{O}_{X'})$, and $Y' = (\Sh(\mathcal{C}_{Y'}), \mathcal{O}_{Y'})$ be ringed topoi. Let $$ \xymatrix{ X' \ar[d] \ar[r]_f & X \ar[d] \\ Y' \ar[r] & Y } $$ be a commutative diagram of morphisms of ringed topoi. The map $f^\sharp : \mathcal{O}_X \to f_*\mathcal{O}_{X'}$ composed with the map $f_*\text{d}_{X'/Y'} : f_*\mathcal{O}_{X'} \to f_*\Omega_{X'/Y'}$ is a $Y$-derivation. Hence we obtain a canonical map of $\mathcal{O}_X$-modules $\Omega_{X/Y} \to f_*\Omega_{X'/Y'}$, and by adjointness of $f_*$ and $f^*$ a canonical $\mathcal{O}_{X'}$-module homomorphism $$ c_f : f^*\Omega_{X/Y} \longrightarrow \Omega_{X'/Y'}. $$ It is uniquely characterized by the property that $f^*\text{d}_{X/Y}(t)$ mapsto $\text{d}_{X'/Y'}(f^* t)$ for any local section $t$ of $\mathcal{O}_X$. \end{lemma} 
\begin{definition} \label{definition-differential-operators} Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. Let $k \geq 0$ be an integer. Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}_2$-modules. A {\it differential operator $D : \mathcal{F} \to \mathcal{G}$ of order $k$} is an is an $\mathcal{O}_1$-linear map such that for all local sections $g$ of $\mathcal{O}_2$ the map $s \mapsto D(gs) - gD(s)$ is a differential operator of order $k - 1$. For the base case $k = 0$ we define a differential operator of order $0$ to be an $\mathcal{O}_2$-linear map. \end{definition} 
\begin{lemma} \label{lemma-composition-differential-operators} Let $\mathcal{C}$ be a site. Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a map of sheaves of rings. Let $\mathcal{E}, \mathcal{F}, \mathcal{G}$ be sheaves of $\mathcal{O}_2$-modules. If $D : \mathcal{E} \to \mathcal{F}$ and $D' : \mathcal{F} \to \mathcal{G}$ are differential operators of order $k$ and $k'$, then $D' \circ D$ is a differential operator of order $k + k'$. \end{lemma} 
\begin{lemma} \label{lemma-module-principal-parts} Let $\mathcal{C}$ be a site. Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a map of sheaves of rings. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_2$-modules. Let $k \geq 0$. There exists a sheaf of $\mathcal{O}_2$-modules $\mathcal{P}^k_{\mathcal{O}_2/\mathcal{O}_1}(\mathcal{F})$ and a canonical isomorphism $$ \text{Diff}^k_{\mathcal{O}_2/\mathcal{O}_1}(\mathcal{F}, \mathcal{G}) = \Hom_{\mathcal{O}_2}( \mathcal{P}^k_{\mathcal{O}_2/\mathcal{O}_1}(\mathcal{F}), \mathcal{G}) $$ functorial in the $\mathcal{O}_2$-module $\mathcal{G}$. \end{lemma} 
\begin{definition} \label{definition-module-principal-parts} Let $\mathcal{C}$ be a site. Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a map of sheaves of rings. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_2$-modules. The module $\mathcal{P}^k_{\mathcal{O}_2/\mathcal{O}_1}(\mathcal{F})$ constructed in Lemma \ref{lemma-module-principal-parts} is called the {\it module of principal parts of order $k$} of $\mathcal{F}$. \end{definition} 
\begin{lemma} \label{lemma-differential-operators-sheafify} Let $\mathcal{C}$ be a site. Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of presheaves of rings. Let $\mathcal{F}$ be a presheaf of $\mathcal{O}_2$-modules. Then $\mathcal{P}^k_{\mathcal{O}_2^\#/\mathcal{O}_1^\#}(\mathcal{F}^\#)$ is the sheaf associated to the presheaf $U \mapsto P^k_{\mathcal{O}_2(U)/\mathcal{O}_1(U)}(\mathcal{F}(U))$. \end{lemma} 
\begin{lemma} \label{lemma-sequence-of-principal-parts} Let $\mathcal{C}$ be a site. Let $\mathcal{O}_1 \to \mathcal{O}_2$ be a homomorphism of sheaves of rings. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_2$-modules. There is a canonical short exact sequence $$ 0 \to \Omega_{\mathcal{O}_2/\mathcal{O}_1} \otimes_{\mathcal{O}_2} \mathcal{F} \to \mathcal{P}^1_{\mathcal{O}_2/\mathcal{O}_1}(\mathcal{F}) \to \mathcal{F} \to 0 $$ functorial in $\mathcal{F}$ called the {\it sequence of principal parts}. \end{lemma} 
\begin{definition} \label{definition-naive-cotangent-complex} Let $\mathcal{C}$ be a site. Let $\mathcal{A} \to \mathcal{B}$ be a homomorphism of sheaves of rings on $\mathcal{C}$. The {\it naive cotangent complex} $\NL_{\mathcal{B}/\mathcal{A}}$ is the chain complex (\ref{equation-naive-cotangent-complex}) $$ \NL_{\mathcal{B}/\mathcal{A}} = \left(\mathcal{I}/\mathcal{I}^2 \longrightarrow \Omega_{\mathcal{A}[\mathcal{B}]/\mathcal{A}} \otimes_{\mathcal{A}[\mathcal{B}]} \mathcal{B}\right) $$ with $\mathcal{I}/\mathcal{I}^2$ placed in degree $-1$ and $\Omega_{\mathcal{A}[\mathcal{B}]/\mathcal{A}} \otimes_{\mathcal{A}[\mathcal{B}]} \mathcal{B}$ placed in degree $0$. \end{definition} 
\begin{lemma} \label{lemma-NL-up-to-qis} In the situation above there is a canonical isomorphism $\NL(\alpha) = \NL_{\mathcal{B}/\mathcal{A}}$ in $D(\mathcal{B})$. \end{lemma} 
\begin{lemma} \label{lemma-pullback-NL} Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be morphism of topoi. Let $\mathcal{A} \to \mathcal{B}$ be a homomorphism of sheaves of rings on $\mathcal{D}$. Then $f^{-1}\NL_{\mathcal{B}/\mathcal{A}} = \NL_{f^{-1}\mathcal{B}/f^{-1}\mathcal{A}}$. \end{lemma} 
\begin{definition} \label{definition-cotangent-complex-morphism-ringed-topoi} Let $X = (\Sh(\mathcal{C}), \mathcal{O})$ and $Y = (\Sh(\mathcal{C}'), \mathcal{O}')$ be ringed topoi. Let $(f, f^\sharp) : X \to Y$ be a morphism of ringed topoi. The {\it naive cotangent complex} $\NL_f = \NL_{X/Y}$ of the given morphism of ringed topoi is $\NL_{\mathcal{O}/f^{-1}\mathcal{O}'}$. We sometimes write $\NL_{X/Y} = \NL_{\mathcal{O}/\mathcal{O}'}$. \end{definition} 
\begin{lemma} \label{lemma-stalk-exact} Let $\mathcal{C}$ be a site. Let $p$ be a point of $\mathcal{C}$. \begin{enumerate} \item We have $(\mathcal{F}^\#)_p = \mathcal{F}_p$ for any presheaf of sets on $\mathcal{C}$. \item The stalk functor $\Sh(\mathcal{C}) \to \textit{Sets}$, $\mathcal{F} \mapsto \mathcal{F}_p$ is exact (see Categories, Definition \ref{categories-definition-exact}) and commutes with arbitrary colimits. \item The stalk functor $\textit{PSh}(\mathcal{C}) \to \textit{Sets}$, $\mathcal{F} \mapsto \mathcal{F}_p$ is exact (see Categories, Definition \ref{categories-definition-exact}) and commutes with arbitrary colimits. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-stalk-exact-abelian} Let $\mathcal{C}$ be a site. Let $p$ be a point of $\mathcal{C}$. \begin{enumerate} \item The functor $\textit{Ab}(\mathcal{C}) \to \textit{Ab}$, $\mathcal{F} \mapsto \mathcal{F}_p$ is exact. \item The stalk functor $\textit{PAb}(\mathcal{C}) \to \textit{Ab}$, $\mathcal{F}  \mapsto  \mathcal{F}_p$ is exact. \item For $\mathcal{F} \in \Ob(\textit{PAb}(\mathcal{C}))$ we have $\mathcal{F}_p = \mathcal{F}^\#_p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-stalk-exact-modules} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $p$ be a point of $\mathcal{C}$. \begin{enumerate} \item The functor $\textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_p)$, $\mathcal{F} \mapsto \mathcal{F}_p$ is exact. \item The stalk functor $\textit{PMod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_p)$, $\mathcal{F} \mapsto \mathcal{F}_p$ is exact. \item For $\mathcal{F} \in \Ob(\textit{PMod}(\mathcal{O}))$ we have $\mathcal{F}_p = \mathcal{F}^\#_p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-pullback-stalk} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi or ringed sites. Let $p$ be a point of $\mathcal{C}$ or $\Sh(\mathcal{C})$ and set $q = f \circ p$. Then $$ (f^*\mathcal{F})_p = \mathcal{F}_q \otimes_{\mathcal{O}_{\mathcal{D}, q}} \mathcal{O}_{\mathcal{C}, p} $$ for any $\mathcal{O}_\mathcal{D}$-module $\mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-skyscraper-exact} Let $\mathcal{C}$ be a site. Let $p$ be a point of $\mathcal{C}$ or of its associated topos. \begin{enumerate} \item The functor $p_* : \textit{Ab} \to \textit{Ab}(\mathcal{C})$, $A \mapsto p_*A$ is exact. \item There is a functorial direct sum decomposition $$ p^{-1}p_*A = A \oplus I(A) $$ for $A \in \Ob(\textit{Ab})$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-skyscraper-modules-exact} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Let $p$ be a point of the topos $\Sh(\mathcal{C})$. \begin{enumerate} \item The functor $p_* : \textit{Mod}(\mathcal{O}_p) \to \textit{Mod}(\mathcal{O})$, $M \mapsto p_*M$ is exact. \item The canonical surjection $p^{-1}p_*M \to M$ is $\mathcal{O}_p$-linear. \item The functorial direct sum decomposition $p^{-1}p_*M = M \oplus I(M)$ of Lemma \ref{lemma-skyscraper-exact} is {\bf not} $\mathcal{O}_p$-linear in general. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-stalk-j-shriek} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $p$ be a point of $\mathcal{C}$. Let $U$ be an object of $\mathcal{C}$. For $\mathcal{G}$ in $\textit{Mod}(\mathcal{O}_U)$ we have $$ (j_{U!}\mathcal{G})_p = \bigoplus\nolimits_q \mathcal{G}_q $$ where the coproduct is over the points $q$ of $\mathcal{C}/U$ lying over $p$, see Sites, Lemma \ref{sites-lemma-points-above-point}. \end{lemma} 
\begin{lemma} \label{lemma-pullback-flat} \begin{reference} \cite[Expos\'e V, Corollary 1.7.1]{SGA4} \end{reference} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi or ringed sites. Then $f^*\mathcal{F}$ is a flat $\mathcal{O}_\mathcal{C}$-module whenever $\mathcal{F}$ is a flat $\mathcal{O}_\mathcal{D}$-module. \end{lemma} 
\begin{lemma} \label{lemma-stalk-flat} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $p$ be a point of $\mathcal{C}$. If $\mathcal{F}$ is a flat $\mathcal{O}$-module, then $\mathcal{F}_p$ is a flat $\mathcal{O}_p$-module. \end{lemma} 
\begin{lemma} \label{lemma-check-flat-stalks} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules. Let $\{p_i\}_{i \in I}$ be a conservative family of points of $\mathcal{C}$. Then $\mathcal{F}$ is flat if and only if $\mathcal{F}_{p_i}$ is a flat $\mathcal{O}_{p_i}$-module for all $i \in I$. \end{lemma} 
\begin{lemma} \label{lemma-pullback-ses} Let $f : (\Sh(\mathcal{C}'), \mathcal{O}') \to (\Sh(\mathcal{C}'), \mathcal{O})$ be a morphism of ringed topoi. Let $0 \to \mathcal{F} \to \mathcal{G} \to \mathcal{H} \to 0$ be a short exact sequence of $\mathcal{O}$-modules with $\mathcal{H}$ a flat $\mathcal{O}$-module. Then the sequence $0 \to f^*\mathcal{F} \to f^*\mathcal{G} \to f^*\mathcal{H} \to 0$ is exact as well. \end{lemma} 
\begin{lemma} \label{lemma-locally-ringed} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. The following are equivalent \begin{enumerate} \item For every object $U$ of $\mathcal{C}$ and $f \in \mathcal{O}(U)$ there exists a covering $\{U_j \to U\}$ such that for each $j$ either $f|_{U_j}$ is invertible or $(1 - f)|_{U_j}$ is invertible. \item For $U \in \Ob(\mathcal{C})$, $n \geq 1$, and $f_1, \ldots, f_n \in \mathcal{O}(U)$ which generate the unit ideal in $\mathcal{O}(U)$ there exists a covering $\{U_j \to U\}$ such that for each $j$ there exists an $i$ such that $f_i|_{U_j}$ is invertible. \item The map of sheaves of sets $$ (\mathcal{O} \times \mathcal{O}) \amalg (\mathcal{O} \times \mathcal{O}) \longrightarrow \mathcal{O} \times \mathcal{O} $$ which maps $(f, a)$ in the first component to $(f, af)$ and $(f, b)$ in the second component to $(f, b(1 - f))$ is surjective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-locally-ringed-stalk} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Consider the following conditions \begin{enumerate} \item For every object $U$ of $\mathcal{C}$ and $f \in \mathcal{O}(U)$ there exists a covering $\{U_j \to U\}$ such that for each $j$ either $f|_{U_j}$ is invertible or $(1 - f)|_{U_j}$ is invertible. \item For every point $p$ of $\mathcal{C}$ the stalk $\mathcal{O}_p$ is either the zero ring or a local ring. \end{enumerate} We always have (1) $\Rightarrow$ (2). If $\mathcal{C}$ has enough points then (1) and (2) are equivalent. \end{lemma} 
\begin{lemma} \label{lemma-ringed-stalk-not-zero} Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Consider the statements \begin{enumerate} \item (\ref{equation-one-is-never-zero}) is an isomorphism, and \item for every point $p$ of $\mathcal{C}$ the stalk $\mathcal{O}_p$ is not the zero ring. \end{enumerate} We always have (1) $\Rightarrow$ (2) and if $\mathcal{C}$ has enough points then (1) $\Leftrightarrow$ (2). \end{lemma} 
\begin{definition} \label{definition-locally-ringed} A ringed site $(\mathcal{C}, \mathcal{O})$ is said to be {\it locally ringed site} if (\ref{equation-one-is-never-zero}) is an isomorphism, and the equivalent properties of Lemma \ref{lemma-locally-ringed} are satisfied. \end{definition} 
\begin{lemma} \label{lemma-locally-ringed-intrinsic} Being a locally ringed site is an intrinsic property. More precisely, \begin{enumerate} \item if $f : \Sh(\mathcal{C}') \to \Sh(\mathcal{C})$ is a morphism of topoi and $(\mathcal{C}, \mathcal{O})$ is a locally ringed site, then $(\mathcal{C}', f^{-1}\mathcal{O})$ is a locally ringed site, and \item if $(f, f^\sharp) : (\Sh(\mathcal{C}'), \mathcal{O}') \to (\Sh(\mathcal{C}), \mathcal{O})$ is an equivalence of ringed topoi, then $(\mathcal{C}, \mathcal{O})$ is locally ringed if and only if $(\mathcal{C}', \mathcal{O}')$ is locally ringed. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-locally-ringed-topos} A ringed topos $(\Sh(\mathcal{C}), \mathcal{O})$ is said to be {\it locally ringed} if the underlying ringed site $(\mathcal{C}, \mathcal{O})$ is locally ringed. \end{definition} 
\begin{lemma} \label{lemma-invertible-is-locally-free-rank-1} Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos. Any locally free $\mathcal{O}$-module of rank $1$ is invertible. If $(\mathcal{C}, \mathcal{O})$ is locally ringed, then the converse holds as well (but in general this is not the case). \end{lemma} 
\begin{lemma} \label{lemma-locally-ringed-morphism} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. Consider the following conditions \begin{enumerate} \item The diagram of sheaves $$ \xymatrix{ f^{-1}(\mathcal{O}^*_\mathcal{D}) \ar[r]_-{f^\sharp} \ar[d] & \mathcal{O}^*_\mathcal{C} \ar[d] \\ f^{-1}(\mathcal{O}_\mathcal{D}) \ar[r]^-{f^\sharp} & \mathcal{O}_\mathcal{C} } $$ is cartesian. \item For any point $p$ of $\mathcal{C}$, setting $q = f \circ p$, the diagram $$ \xymatrix{ \mathcal{O}^*_{\mathcal{D}, q} \ar[r] \ar[d] & \mathcal{O}^*_{\mathcal{C}, p} \ar[d] \\ \mathcal{O}_{\mathcal{D}, q} \ar[r] & \mathcal{O}_{\mathcal{C}, p} } $$ of sets is cartesian. \end{enumerate} We always have (1) $\Rightarrow$ (2). If $\mathcal{C}$ has enough points then (1) and (2) are equivalent. If $(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C})$ and $(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ are locally ringed topoi then (2) is equivalent to \begin{enumerate} \item[(3)] For any point $p$ of $\mathcal{C}$, setting $q = f \circ p$, the ring map $\mathcal{O}_{\mathcal{D}, q} \to \mathcal{O}_{\mathcal{C}, p}$ is a local ring map. \end{enumerate} In fact, properties (2), or (3) for a conservative family of points implies (1). \end{lemma} 
\begin{definition} \label{definition-morphism-locally-ringed-topoi} Let $(f, f^\sharp) : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi. Assume $(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C})$ and $(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ are locally ringed topoi. We say that $(f, f^\sharp)$ is a {\it morphism of locally ringed topoi} if and only if the diagram of sheaves $$ \xymatrix{ f^{-1}(\mathcal{O}^*_\mathcal{D}) \ar[r]_-{f^\sharp} \ar[d] & \mathcal{O}^*_\mathcal{C} \ar[d] \\ f^{-1}(\mathcal{O}_\mathcal{D}) \ar[r]^-{f^\sharp} & \mathcal{O}_\mathcal{C} } $$ (see Lemma \ref{lemma-locally-ringed-morphism}) is cartesian. If $(f, f^\sharp)$ is a morphism of ringed sites, then we say that it is a {\it morphism of locally ringed sites} if the associated morphism of ringed topoi is a morphism of locally ringed topoi. \end{definition} 
\begin{lemma} \label{lemma-composition-morphisms-locally-ringed-topoi} Let $(f, f^\sharp) : (\Sh(\mathcal{C}_1), \mathcal{O}_1) \to (\Sh(\mathcal{C}_2), \mathcal{O}_2)$ and $(g, g^\sharp) : (\Sh(\mathcal{C}_2), \mathcal{O}_2) \to (\Sh(\mathcal{C}_3), \mathcal{O}_3)$ be morphisms of locally ringed topoi. Then the composition $(g, g^\sharp) \circ (f, f^\sharp)$ (see Definition \ref{definition-ringed-topos}) is also a morphism of locally ringed topoi. \end{lemma} 
\begin{lemma} \label{lemma-locally-ringed-intrinsic-morphism} Let $f : \Sh(\mathcal{C}') \to \Sh(\mathcal{C})$ be a morphism of topoi. If $\mathcal{O}$ is a sheaf of rings on $\mathcal{C}$, then $$ f^{-1}(\mathcal{O}^*) = (f^{-1}\mathcal{O})^*. $$ In particular, if $\mathcal{O}$ turns $\mathcal{C}$ into a locally ringed site, then setting $f^\sharp = \text{id}$ the morphism of ringed topoi $$ (f, f^\sharp) : (\Sh(\mathcal{C}'), f^{-1}\mathcal{O}) \to (\Sh(\mathcal{C}, \mathcal{O}) $$ is a morphism of locally ringed topoi. \end{lemma} 
\begin{lemma} \label{lemma-localize-morphism-locally-ringed-topoi} Localization of locally ringed sites and topoi. \begin{enumerate} \item Let $(\mathcal{C}, \mathcal{O})$ be a locally ringed site. Let $U$ be an object of $\mathcal{C}$. Then the localization $(\mathcal{C}/U, \mathcal{O}_U)$ is a locally ringed site, and the localization morphism $$ (j_U, j_U^\sharp) : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{C}), \mathcal{O}) $$ is a morphism of locally ringed topoi. \item Let $(\mathcal{C}, \mathcal{O})$ be a locally ringed site. Let $f : V \to U$ be a morphism of $\mathcal{C}$. Then the morphism $$ (j, j^\sharp) : (\Sh(\mathcal{C}/V), \mathcal{O}_V) \to (\Sh(\mathcal{C}/U), \mathcal{O}_U) $$ of Lemma \ref{lemma-relocalize} is a morphism of locally ringed topoi. \item Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}) \longrightarrow (\mathcal{D}, \mathcal{O}')$ be a morphism of locally ringed sites where $f$ is given by the continuous functor $u : \mathcal{D} \to \mathcal{C}$. Let $V$ be an object of $\mathcal{D}$ and let $U = u(V)$. Then the morphism $$ (f', (f')^\sharp) : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{D}/V), \mathcal{O}'_V) $$ of Lemma \ref{lemma-localize-morphism-ringed-sites} is a morphism of locally ringed sites. \item Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}) \longrightarrow (\mathcal{D}, \mathcal{O}')$ be a morphism of locally ringed sites where $f$ is given by the continuous functor $u : \mathcal{D} \to \mathcal{C}$. Let $V \in \Ob(\mathcal{D})$, $U \in \Ob(\mathcal{C})$, and $c : U \to u(V)$. Then the morphism $$ (f_c, (f_c)^\sharp) : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{D}/V), \mathcal{O}'_V) $$ of Lemma \ref{lemma-relocalize-morphism-ringed-sites} is a morphism of locally ringed topoi. \item Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a locally ringed topos. Let $\mathcal{F}$ be a sheaf on $\mathcal{C}$. Then the localization $(\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F})$ is a locally ringed topos and the localization morphism $$ (j_\mathcal{F}, j_\mathcal{F}^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \to (\Sh(\mathcal{C}), \mathcal{O}) $$ is a morphism of locally ringed topoi. \item  Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a locally ringed topos. Let $s : \mathcal{G} \to \mathcal{F}$ be a map of sheaves on $\mathcal{C}$. Then the morphism $$ (j, j^\sharp) : (\Sh(\mathcal{C})/\mathcal{G}, \mathcal{O}_\mathcal{G}) \longrightarrow (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) $$ of Lemma \ref{lemma-relocalize-ringed-topos} is a morphism of locally ringed topoi. \item Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{D}), \mathcal{O}')$ be a morphism of locally ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$. Set $\mathcal{F} = f^{-1}\mathcal{G}$. Then the morphism $$ (f', (f')^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \longrightarrow (\Sh(\mathcal{D})/\mathcal{G}, \mathcal{O}'_\mathcal{G}) $$ of Lemma \ref{lemma-localize-morphism-ringed-topoi} is a morphism of locally ringed topoi. \item  Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \longrightarrow (\Sh(\mathcal{D}), \mathcal{O}')$ be a morphism of locally ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$, let $\mathcal{F}$ be a sheaf on $\mathcal{C}$, and let $s : \mathcal{F} \to f^{-1}\mathcal{G}$ be a morphism of sheaves. Then the morphism $$ (f_s, (f_s)^\sharp) : (\Sh(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F}) \longrightarrow (\Sh(\mathcal{D})/\mathcal{G}, \mathcal{O}'_\mathcal{G}) $$ of Lemma \ref{lemma-relocalize-morphism-ringed-topoi} is a morphism of locally ringed topoi. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lower-shriek-modules} Let $u : \mathcal{C} \to \mathcal{D}$ be a continuous and cocontinuous functor between sites. Denote $g : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ the associated morphism of topoi. Let $\mathcal{O}_\mathcal{D}$ be a sheaf of rings on $\mathcal{D}$. Set $\mathcal{O}_\mathcal{C} = g^{-1}\mathcal{O}_\mathcal{D}$. Hence $g$ becomes a morphism of ringed topoi with $g^* = g^{-1}$. In this case there exists a functor $$ g_! : \textit{Mod}(\mathcal{O}_\mathcal{C}) \longrightarrow \textit{Mod}(\mathcal{O}_\mathcal{D}) $$ which is left adjoint to $g^*$. \end{lemma} 
\begin{lemma} \label{lemma-special-square-cocontinuous} Assume given a commutative diagram $$ \xymatrix{ (\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'}) \ar[r]_{(g', (g')^\sharp)} \ar[d]_{(f', (f')^\sharp)} & (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'}) \ar[r]^{(g, g^\sharp)} & (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D}) } $$ of ringed topoi. Assume \begin{enumerate} \item $f$, $f'$, $g$, and $g'$ correspond to cocontinuous functors $u$, $u'$, $v$, and $v'$ as in Sites, Lemma \ref{sites-lemma-cocontinuous-morphism-topoi}, \item $v \circ u' = u \circ v'$, \item $v$ and $v'$ are continuous as well as cocontinuous, \item for any object $V'$ of $\mathcal{D}'$ the functor ${}^{u'}_{V'}\mathcal{I} \to {}^{\ \ \ u}_{v(V')}\mathcal{I}$ given by $v$ is cofinal, and \item $g^{-1}\mathcal{O}_{\mathcal{D}} = \mathcal{O}_{\mathcal{D}'}$ and $(g')^{-1}\mathcal{O}_{\mathcal{C}} = \mathcal{O}_{\mathcal{C}'}$. \end{enumerate} Then we have $f'_* \circ (g')^* = g^* \circ f_*$ and $g'_! \circ (f')^{-1} = f^{-1} \circ g_!$ on modules. \end{lemma} 
\begin{lemma} \label{lemma-special-square-continuous} Consider a commutative diagram $$ \xymatrix{ (\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'}) \ar[r]_{(g', (g')^\sharp)} \ar[d]_{(f', (f')^\sharp)} & (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[d]^{(f, f^\sharp)} \\ (\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'}) \ar[r]^{(g, g^\sharp)} & (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D}) } $$ of ringed topoi and suppose we have functors $$ \xymatrix{ \mathcal{C}' \ar[r]_{v'} & \mathcal{C} \\ \mathcal{D}' \ar[r]^v \ar[u]^{u'} & \mathcal{D} \ar[u]_u } $$ such that (with notation as in Sites, Sections \ref{sites-section-morphism-sites} and \ref{sites-section-cocontinuous-morphism-topoi}) we have \begin{enumerate} \item $u$ and $u'$ are continuous and give rise to the morphisms $f$ and $f'$, \item $v$ and $v'$ are cocontinuous giving rise to the morphisms $g$ and $g'$, \item $u \circ v = v' \circ u'$, \item $v$ and $v'$ are continuous as well as cocontinuous, and \item $g^{-1}\mathcal{O}_{\mathcal{D}} = \mathcal{O}_{\mathcal{D}'}$ and $(g')^{-1}\mathcal{O}_{\mathcal{C}} = \mathcal{O}_{\mathcal{C}'}$. \end{enumerate} Then $f'_* \circ (g')^* = g^* \circ f_*$ and $g'_! \circ (f')^{-1} = f^{-1} \circ g_!$ on modules. \end{lemma} 
\begin{lemma} \label{lemma-constant-exact} Let $\mathcal{C}$ be a site. If $0 \to A \to B \to C \to 0$ is a short exact sequence of abelian groups, then $0 \to \underline{A} \to \underline{B} \to \underline{C} \to 0$ is an exact sequence of abelian sheaves and in fact it is even exact as a sequence of abelian presheaves. \end{lemma} 
\begin{lemma} \label{lemma-tensor-with-finitely-presented} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a ring and let $M$ and $Q$ be $\Lambda$-modules. If $Q$ is a finitely presented $\Lambda$-module, then we have $\underline{M \otimes_\Lambda Q}(U) = \underline{M}(U) \otimes_\Lambda Q$ for all $U \in \Ob(\mathcal{C})$. \end{lemma} 
\begin{lemma} \label{lemma-flat-sections} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a coherent ring. Let $M$ be a flat $\Lambda$-module. For $U \in \Ob(\mathcal{C})$ the module $\underline{M}(U)$ is a flat $\Lambda$-module. \end{lemma} 
\begin{lemma} \label{lemma-completion-flat} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring. Let $I \subset \Lambda$ be an ideal. The sheaf $\underline{\Lambda}^\wedge = \lim \underline{\Lambda/I^n}$ is a flat $\underline{\Lambda}$-algebra. Moreover we have canonical identifications $$ \underline{\Lambda}/I\underline{\Lambda} = \underline{\Lambda}/\underline{I} = \underline{\Lambda}^\wedge/I\underline{\Lambda}^\wedge = \underline{\Lambda}^\wedge/\underline{I} \cdot \underline{\Lambda}^\wedge = \underline{\Lambda}^\wedge/\underline{I}^\wedge = \underline{\Lambda/I} $$ where $\underline{I}^\wedge = \lim \underline{I/I^n}$. \end{lemma} 
\begin{lemma} \label{lemma-locally-constant-finite-type} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a ring and let $M$ be a $\Lambda$-module. Assume $\Sh(\mathcal{C})$ is not the empty topos. Then \begin{enumerate} \item $\underline{M}$ is a finite type sheaf of $\underline{\Lambda}$-modules if and only if $M$ is a finite $\Lambda$-module, and \item $\underline{M}$ is a finitely presented sheaf of $\underline{\Lambda}$-modules if and only if $M$ is a  finitely presented $\Lambda$-module. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-locally-constant} Let $\mathcal{C}$ be a site. Let $\mathcal{F}$ be a sheaf of sets, groups, abelian groups, rings, modules over a fixed ring $\Lambda$, etc. \begin{enumerate} \item We say $\mathcal{F}$ is a {\it constant sheaf} of sets, groups, abelian groups, rings, modules over a fixed ring $\Lambda$, etc if it is isomorphic as a sheaf of sets, groups, abelian groups, rings, modules over a fixed ring $\Lambda$, etc to a constant sheaf $\underline{E}$ as in Section \ref{section-constant}. \item We say $\mathcal{F}$ is {\it locally constant} if for every object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$ such that $\mathcal{F}|_{U_i}$ is a constant sheaf. \item If $\mathcal{F}$ is a sheaf of sets or groups, then we say $\mathcal{F}$ is {\it finite locally constant} if the constant values are finite sets or finite groups. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-pullback-locally-constant} Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi. If $\mathcal{G}$ is a locally constant sheaf of sets, groups, abelian groups, rings, modules over a fixed ring $\Lambda$, etc on $\mathcal{D}$, the same is true for $f^{-1}\mathcal{G}$ on $\mathcal{C}$. \end{lemma} 
\begin{lemma} \label{lemma-morphism-locally-constant} Let $\mathcal{C}$ be a site with a final object $X$. \begin{enumerate} \item Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map of locally constant sheaves of sets on $\mathcal{C}$. If $\mathcal{F}$ is finite locally constant, there exists a covering $\{U_i \to X\}$ such that $\varphi|_{U_i}$ is the map of constant sheaves associated to a map of sets. \item Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map of locally constant sheaves of abelian groups on $\mathcal{C}$. If $\mathcal{F}$ is finite locally constant, there exists a covering $\{U_i \to X\}$ such that $\varphi|_{U_i}$ is the map of constant abelian sheaves associated to a map of abelian groups. \item Let $\Lambda$ be a ring. Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map of locally constant sheaves of $\Lambda$-modules on $\mathcal{C}$. If $\mathcal{F}$ is of finite type, then there exists a covering $\{U_i \to X\}$ such that $\varphi|_{U_i}$ is the map of constant sheaves of $\Lambda$-modules associated to a map of $\Lambda$-modules. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-locally-constant} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a ring. Let $M$, $N$ be $\Lambda$-modules. Let $\mathcal{F}, \mathcal{G}$ be a locally constant sheaves of $\Lambda$-modules. \begin{enumerate} \item If $M$ is of finite presentation, then $$ \underline{\Hom_\Lambda(M, N)} = \SheafHom_{\underline{\Lambda}}(\underline{M}, \underline{N}) $$ \item If $M$ and $N$ are both of finite presentation, then $$ \underline{\text{Isom}_\Lambda(M, N)} = \mathit{Isom}_{\underline{\Lambda}}(\underline{M}, \underline{N}) $$ \item If $\mathcal{F}$ is of finite presentation, then $\SheafHom_{\underline{\Lambda}}(\mathcal{F}, \mathcal{G})$ is a locally constant sheaf of $\Lambda$-modules. \item If $\mathcal{F}$ and $\mathcal{G}$ are both of finite presentation, then $\mathit{Isom}_{\underline{\Lambda}}(\mathcal{F}, \mathcal{G})$ is a locally constant sheaf of sets. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-kernel-finite-locally-constant} Let $\mathcal{C}$ be a site. \begin{enumerate} \item The category of finite locally constant sheaves of sets is closed under finite limits and colimits inside $\Sh(\mathcal{C})$. \item The category of finite locally constant abelian sheaves is a weak Serre subcategory of $\textit{Ab}(\mathcal{C})$. \item Let $\Lambda$ be a Noetherian ring. The category of finite type, locally constant sheaves of $\Lambda$-modules on $\mathcal{C}$ is a weak Serre subcategory of $\textit{Mod}(\mathcal{C}, \Lambda)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tensor-product-locally-constant} Let $\mathcal{C}$ be a site. Let $\Lambda$ be a ring. The tensor product of two locally constant sheaves of $\Lambda$-modules on $\mathcal{C}$ is a locally constant sheaf of $\Lambda$-modules. \end{lemma} 
\begin{lemma} \label{lemma-simple-invert} In the situation above the map to the sheafification $$ \mathcal{O} \longrightarrow (\mathcal{S}^{-1}\mathcal{O})^\# $$ is a homomorphism of sheaves of rings with the following universal property: for any homomorphism of sheaves of rings $\mathcal{O} \to \mathcal{A}$ such that each local section of $\mathcal{S}$ maps to an invertible section of $\mathcal{A}$ there exists a unique factorization $(\mathcal{S}^{-1}\mathcal{O})^\# \to \mathcal{A}$. \end{lemma} 
\begin{lemma} \label{lemma-simple-invert-module} In the situation above the map to the sheafification $$ \mathcal{F} \longrightarrow (\mathcal{S}^{-1}\mathcal{F})^\# $$ has the following universal property: for any homomorphism of $\mathcal{O}$-modules $\mathcal{F} \to \mathcal{G}$ such that each local section of $\mathcal{S}$ acts invertibly on $\mathcal{G}$ there exists a unique factorization $(\mathcal{S}^{-1}\mathcal{F})^\# \to \mathcal{G}$. Moreover we have $$ (\mathcal{S}^{-1}\mathcal{F})^\# = (\mathcal{S}^{-1}\mathcal{O})^\# \otimes_\mathcal{O} \mathcal{F} $$ as sheaves of $(\mathcal{S}^{-1}\mathcal{O})^\#$-modules. \end{lemma} 
