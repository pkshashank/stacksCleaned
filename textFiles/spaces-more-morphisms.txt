\begin{definition} \label{definition-radicial} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. We say $f$ is {\it radicial} if for any morphism $\Spec(K) \to Y$ where $K$ is a field the reduction $(\Spec(K) \times_Y X)_{red}$ is either empty or representable by the spectrum of a purely inseparable field extension of $K$. \end{definition} 
\begin{lemma} \label{lemma-radicial-implies-universally-injective} A radicial morphism of algebraic spaces is universally injective. \end{lemma} 
\begin{lemma} \label{lemma-when-universally-injective-radicial} Let $S$ be a scheme. Let $f : X \to Y$ be a universally injective morphism of algebraic spaces over $S$. \begin{enumerate} \item If $f$ is decent then $f$ is radicial. \item If $f$ is quasi-separated then $f$ is radicial. \item If $f$ is locally separated then $f$ is radicial. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-universally-injective} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $f$ is locally of finite type, \item for every \'etale morphism $V \to Y$ the map $|X \times_Y V| \to |V|$ is injective. \end{enumerate} Then $f$ is universally injective. \end{lemma} 
\begin{lemma}[David Rydh] \label{lemma-flat-case} A flat monomorphism of algebraic spaces is representable by schemes. \end{lemma} 
\begin{lemma} \label{lemma-ui-case} Let $S$ be a scheme. Let $f : X \to Y$ be a quasi-compact monomorphism of algebraic spaces such that for every $T \to Y$ the map $$ \mathcal{O}_T \to f_{T,*}\mathcal{O}_{X \times_Y T} $$ is injective. Then $f$ is an isomorphism (and hence representable by schemes). \end{lemma} 
\begin{lemma} \label{lemma-flat-surjective-monomorphism} A quasi-compact flat surjective monomorphism of algebraic spaces is an isomorphism. \end{lemma} 
\begin{definition} \label{definition-conormal-sheaf} Let $i : Z \to X$ be an immersion. The {\it conormal sheaf $\mathcal{C}_{Z/X}$ of $Z$ in $X$} or the {\it conormal sheaf of $i$} is the quasi-coherent $\mathcal{O}_Z$-module $\mathcal{I}/\mathcal{I}^2$ described above. \end{definition} 
\begin{lemma} \label{lemma-etale-conormal} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion. Let $\varphi : U \to X$ be an \'etale morphism where $U$ is a scheme. Set $Z_U = U \times_X Z$ which is a locally closed subscheme of $U$. Then $$ \mathcal{C}_{Z/X}|_{Z_U} = \mathcal{C}_{Z_U/U} $$ canonically and functorially in $U$. \end{lemma} 
\begin{lemma} \label{lemma-conormal-functorial} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[d]_f & X \ar[d]^g \\ Z' \ar[r]^{i'} & X' } $$ be a commutative diagram of algebraic spaces over $S$. Assume $i$, $i'$ immersions. There is a canonical map of $\mathcal{O}_Z$-modules $$ f^*\mathcal{C}_{Z'/X'} \longrightarrow \mathcal{C}_{Z/X} $$ \end{lemma} 
\begin{lemma} \label{lemma-conormal-functorial-more} Let $S$ be a scheme. The conormal sheaf of Definition \ref{definition-conormal-sheaf}, and its functoriality of Lemma \ref{lemma-conormal-functorial} satisfy the following properties: \begin{enumerate} \item If $Z \to X$ is an immersion of schemes over $S$, then the conormal sheaf agrees with the one from Morphisms, Definition \ref{morphisms-definition-conormal-sheaf}. \item If in Lemma \ref{lemma-conormal-functorial} all the spaces are schemes, then the map $f^*\mathcal{C}_{Z'/X'} \to \mathcal{C}_{Z/X}$ is the same as the one constructed in Morphisms, Lemma \ref{morphisms-lemma-conormal-functorial}. \item Given a commutative diagram $$ \xymatrix{ Z \ar[r]_i \ar[d]_f & X \ar[d]^g \\ Z' \ar[r]^{i'} \ar[d]_{f'} & X' \ar[d]^{g'} \\ Z'' \ar[r]^{i''} & X'' } $$ then the map $(f' \circ f)^*\mathcal{C}_{Z''/X''} \to \mathcal{C}_{Z/X}$ is the same as the composition of $f^*\mathcal{C}_{Z'/X'} \to \mathcal{C}_{Z/X}$ with the pullback by $f$ of $(f')^*\mathcal{C}_{Z''/X''} \to \mathcal{C}_{Z'/X'}$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-conormal-functorial-flat} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[d]_f & X \ar[d]^g \\ Z' \ar[r]^{i'} & X' } $$ be a fibre product diagram of algebraic spaces over $S$. Assume $i$, $i'$ immersions. Then the canonical map $f^*\mathcal{C}_{Z'/X'} \to \mathcal{C}_{Z/X}$ of Lemma \ref{lemma-conormal-functorial} is surjective. If $g$ is flat, then it is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-transitivity-conormal} Let $S$ be a scheme. Let $Z \to Y \to X$ be immersions of algebraic spaces. Then there is a canonical exact sequence $$ i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ where the maps come from Lemma \ref{lemma-conormal-functorial} and $i : Z \to Y$ is the first morphism. \end{lemma} 
\begin{definition} \label{definition-conormal-algebra} Let $i : Z \to X$ be an immersion. The {\it conormal algebra $\mathcal{C}_{Z/X, *}$ of $Z$ in $X$} or the {\it conormal algebra of $i$} is the quasi-coherent sheaf of graded $\mathcal{O}_Z$-algebras $\bigoplus_{n \geq 0} \mathcal{I}^n/\mathcal{I}^{n + 1}$ described above. \end{definition} 
\begin{lemma} \label{lemma-etale-conormal-algebra} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. Let $\varphi : U \to X$ be an \'etale morphism where $U$ is a scheme. Set $Z_U = U \times_X Z$ which is a locally closed subscheme of $U$. Then $$ \mathcal{C}_{Z/X, *}|_{Z_U} = \mathcal{C}_{Z_U/U, *} $$ canonically and functorially in $U$. \end{lemma} 
\begin{lemma} \label{lemma-conormal-algebra-functorial} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[d]_f & X \ar[d]^g \\ Z' \ar[r]^{i'} & X' } $$ be a commutative diagram of algebraic spaces over $S$. Assume $i$, $i'$ immersions. There is a canonical map of graded $\mathcal{O}_Z$-algebras $$ f^*\mathcal{C}_{Z'/X', *} \longrightarrow \mathcal{C}_{Z/X, *} $$ \end{lemma} 
\begin{lemma} \label{lemma-conormal-algebra-functorial-flat} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[d]_f & X \ar[d]^g \\ Z' \ar[r]^{i'} & X' } $$ be a cartesian square of algebraic spaces over $S$ with $i$, $i'$ immersions. Then the canonical map $f^*\mathcal{C}_{Z'/X', *} \to \mathcal{C}_{Z/X, *}$ of Lemma \ref{lemma-conormal-algebra-functorial} is surjective. If $g$ is flat, then it is an isomorphism. \end{lemma} 
\begin{definition} \label{definition-normal-cone} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. The {\it normal cone $C_ZX$} of $Z$ in $X$ is $$ C_ZX = \underline{\Spec}_Z(\mathcal{C}_{Z/X, *}) $$ see Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-relative-spec}. The {\it normal bundle} of $Z$ in $X$ is the vector bundle $$ N_ZX = \underline{\Spec}_Z(\text{Sym}(\mathcal{C}_{Z/X})) $$ \end{definition} 
\begin{lemma} \label{lemma-match-modules-differentials} Let $f : X \to Y$ be a morphism of schemes. Let $f_{small} : X_\etale \to Y_\etale$ be the associated morphism of small \'etale sites, see Descent, Remark \ref{descent-remark-change-topologies-ringed}. Then there is a canonical isomorphism $$ (\Omega_{X/Y})^a = \Omega_{X_\etale/Y_\etale} $$ compatible with universal derivations. Here the first module is the sheaf on $X_\etale$ associated to the quasi-coherent $\mathcal{O}_X$-module $\Omega_{X/Y}$, see Morphisms, Definition \ref{morphisms-definition-sheaf-differentials}, and the second module is the one from Modules on Sites, Definition \ref{sites-modules-definition-module-differentials}. \end{lemma} 
\begin{definition} \label{definition-sheaf-differentials} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The {\it sheaf of differentials $\Omega_{X/Y}$ of $X$ over $Y$} is sheaf of differentials (Modules on Sites, Definition \ref{sites-modules-definition-sheaf-differentials}) for the morphism of ringed topoi $$ (f_{small}, f^\sharp) : (X_\etale, \mathcal{O}_X) \to (Y_\etale, \mathcal{O}_Y) $$ of Properties of Spaces, Lemma \ref{spaces-properties-lemma-morphism-ringed-topoi}. The {\it universal $Y$-derivation} will be denoted $\text{d}_{X/Y} : \mathcal{O}_X \to \Omega_{X/Y}$. \end{definition} 
\begin{lemma} \label{lemma-localize-differentials} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Consider any commutative diagram $$ \xymatrix{ U \ar[d]_a \ar[r]_\psi & V \ar[d]^b \\ X \ar[r]^f & Y } $$ where the vertical arrows are \'etale morphisms of algebraic spaces. Then $$ \Omega_{X/Y}|_{U_\etale} = \Omega_{U/V} $$ In particular, if $U$, $V$ are schemes, then this is equal to the usual sheaf of differentials of the morphism of schemes $U \to V$. \end{lemma} 
\begin{lemma} \label{lemma-module-differentials-quasi-coherent} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Then $\Omega_{X/Y}$ is a quasi-coherent $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-functoriality-differentials} Let $S$ be a scheme. Let $$ \xymatrix{ X' \ar[d] \ar[r]_f & X \ar[d] \\ Y' \ar[r] & Y } $$ be a commutative diagram of algebraic spaces. The map $f^\sharp : \mathcal{O}_X \to f_*\mathcal{O}_{X'}$ composed with the map $f_*\text{d}_{X'/Y'} : f_*\mathcal{O}_{X'} \to f_*\Omega_{X'/Y'}$ is a $Y$-derivation. Hence we obtain a canonical map of $\mathcal{O}_X$-modules $\Omega_{X/Y} \to f_*\Omega_{X'/Y'}$, and by adjointness of $f_*$ and $f^*$ a canonical $\mathcal{O}_{X'}$-module homomorphism $$ c_f : f^*\Omega_{X/Y} \longrightarrow \Omega_{X'/Y'}. $$ It is uniquely characterized by the property that $f^*\text{d}_{X/Y}(t)$ mapsto $\text{d}_{X'/Y'}(f^* t)$ for any local section $t$ of $\mathcal{O}_X$. \end{lemma} 
\begin{lemma} \label{lemma-check-functoriality-differentials} Let $S$ be a scheme. Let $$ \xymatrix{ X'' \ar[d] \ar[r]_g & X' \ar[d] \ar[r]_f & X \ar[d] \\ Y'' \ar[r] & Y' \ar[r] & Y } $$ be a commutative diagram of algebraic spaces over $S$. Then we have $$ c_{f \circ g} = c_g \circ g^* c_f $$ as maps $(f \circ g)^*\Omega_{X/Y} \to \Omega_{X''/Y''}$. \end{lemma} 
\begin{lemma} \label{lemma-triangle-differentials} Let $S$ be a scheme. Let $f : X \to Y$, $g : Y \to B$ be morphisms of algebraic spaces over $S$. Then there is a canonical exact sequence $$ f^*\Omega_{Y/B} \to \Omega_{X/B} \to \Omega_{X/Y} \to 0 $$ where the maps come from applications of Lemma \ref{lemma-functoriality-differentials}. \end{lemma} 
\begin{lemma} \label{lemma-immersion-differentials} Let $S$ be a scheme. If $X \to Y$ is an immersion of algebraic spaces over $S$ then $\Omega_{X/S}$ is zero. \end{lemma} 
\begin{lemma} \label{lemma-differentials-relative-immersion} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $i : Z \to X$ be an immersion of algebraic spaces over $B$. There is a canonical exact sequence $$ \mathcal{C}_{Z/X} \to i^*\Omega_{X/B} \to \Omega_{Z/B} \to 0 $$ where the first arrow is induced by $\text{d}_{X/B}$ and the second arrow comes from Lemma \ref{lemma-functoriality-differentials}. \end{lemma} 
\begin{lemma} \label{lemma-differentials-relative-immersion-section} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $i : Z \to X$ be an immersion of algebraic spaces over $B$, and assume $i$ (\'etale locally) has a left inverse. Then the canonical sequence $$ 0 \to \mathcal{C}_{Z/X} \to i^*\Omega_{X/B} \to \Omega_{Z/B} \to 0 $$ of Lemma \ref{lemma-differentials-relative-immersion} is (\'etale locally) split exact. \end{lemma} 
\begin{lemma} \label{lemma-base-change-differentials} Let $S$ be a scheme. Let $X \to Y$ be a morphism of algebraic spaces over $S$. Let $g : Y' \to Y$ be a morphism of algebraic spaces over $S$. Let $X' = X_{Y'}$ be the base change of $X$. Denote $g' : X' \to X$ the projection. Then the map $$ (g')^*\Omega_{X/Y} \to \Omega_{X'/Y'} $$ of Lemma \ref{lemma-functoriality-differentials} is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-differential-product} Let $S$ be a scheme. Let $f : X \to B$ and $g : Y \to B$ be morphisms of algebraic spaces over $S$ with the same target. Let $p : X \times_B Y \to X$ and $q : X \times_B Y \to Y$ be the projection morphisms. The maps from Lemma \ref{lemma-functoriality-differentials} $$ p^*\Omega_{X/B} \oplus q^*\Omega_{Y/B} \longrightarrow \Omega_{X \times_B Y/B} $$ give an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-finite-type-differentials} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. If $f$ is locally of finite type, then $\Omega_{X/Y}$ is a finite type $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-finite-presentation-differentials} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. If $f$ is locally of finite presentation, then $\Omega_{X/Y}$ is an $\mathcal{O}_X$-module of finite presentation. \end{lemma} 
\begin{lemma} \label{lemma-smooth-omega-finite-locally-free} Let $S$ be a scheme. Let $f : X \to Y$ be a smooth morphism of algebraic spaces over $S$. Then the module of differentials $\Omega_{X/Y}$ is finite locally free. \end{lemma} 
\begin{theorem} \label{theorem-topological-invariance} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ is integral, universally injective and surjective. The functor $$ V \longmapsto V_X = X \times_Y V $$ defines an equivalence of categories $Y_{spaces, \etale} \to X_{spaces, \etale}$. \end{theorem} 
\begin{lemma} \label{lemma-topological-invariance} With assumption and notation as in Theorem \ref{theorem-topological-invariance} the equivalence of categories $Y_{spaces, \etale} \to X_{spaces, \etale}$ restricts to equivalences of categories $Y_\etale \to X_\etale$ and $Y_{affine, \etale} \to X_{affine, \etale}$. \end{lemma} 
\begin{definition} \label{definition-thickening} Thickenings. Let $S$ be a scheme. \begin{enumerate} \item We say an algebraic space $X'$ is a {\it thickening} of an algebraic space $X$ if $X$ is a closed subspace of $X'$ and the associated topological spaces are equal. \item We say $X'$ is a {\it first order thickening} of $X$ if $X$ is a closed subspace of $X'$ and the quasi-coherent sheaf of ideals $\mathcal{I} \subset \mathcal{O}_{X'}$ defining $X$ has square zero. \item Given two thickenings $X \subset X'$ and $Y \subset Y'$ a {\it morphism of thickenings} is a morphism $f' : X' \to Y'$ such that $f(X) \subset Y$, i.e., such that $f'|_X$ factors through the closed subspace $Y$. In this situation we set $f = f'|_X : X \to Y$ and we say that $(f, f') : (X \subset X') \to (Y \subset Y')$ is a morphism of thickenings. \item Let $B$ be an algebraic space. We similarly define {\it thickenings over $B$}, and {\it morphisms of thickenings over $B$}. This means that the spaces $X, X', Y, Y'$ above are algebraic spaces endowed with a structure morphism to $B$, and that the morphisms $X \to X'$, $Y \to Y'$ and $f' : X' \to Y'$ are morphisms over $B$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-first-order-thickening-maps} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $X \subset X'$ and $Y \subset Y'$ be thickenings of algebraic spaces over $B$. Let $f : X \to Y$ be a morphism of algebraic spaces over $B$. Given any map of $\mathcal{O}_B$-algebras $$ \alpha : f_{spaces, \etale}^{-1}\mathcal{O}_{Y'} \to \mathcal{O}_{X'} $$ such that $$ \xymatrix{ f_{spaces, \etale}^{-1}\mathcal{O}_Y \ar[r]_-{f^\sharp} \ar[r] & \mathcal{O}_X \\ f_{spaces, \etale}^{-1}\mathcal{O}_{Y'} \ar[r]^-\alpha \ar[u]^{i_Y^\sharp} & \mathcal{O}_{X'} \ar[u]_{i_X^\sharp} } $$ commutes, there exists a unique morphism of $(f, f')$ of thickenings over $B$ such that $\alpha = (f')^\sharp$. \end{lemma} 
\begin{lemma} \label{lemma-open-subspace-thickening} Let $S$ be a scheme. Let $X \subset X'$ be a thickening of algebraic spaces over $S$. For any open subspace $U \subset X$ there exists a unique open subspace $U' \subset X'$ such that $U = X \times_{X'} U'$. \end{lemma} 
\begin{lemma} \label{lemma-first-order-thickening-surjective} Let $S$ be a scheme. Let $X \subset X'$ be a thickening of algebraic spaces over $S$. Let $U$ be an affine object of $X_{spaces, \etale}$. Then $$ \Gamma(U, \mathcal{O}_{X'}) \to \Gamma(U, \mathcal{O}_X) $$ is surjective where we think of $\mathcal{O}_{X'}$ as a sheaf on $X_{spaces, \etale}$ via (\ref{equation-fundamental-equivalence}). \end{lemma} 
\begin{lemma} \label{lemma-thickening-scheme} Let $S$ be a scheme. Let $X \subset X'$ be a thickening of algebraic spaces over $S$. If $X$ is (representable by) a scheme, then so is $X'$. \end{lemma} 
\begin{lemma} \label{lemma-thickening-equivalence} Let $S$ be a scheme. Let $X \subset X'$ be a thickening of algebraic spaces over $S$. The functor $$ V' \longmapsto V = X \times_{X'} V' $$ defines an equivalence of categories $X'_\etale \to X_\etale$. \end{lemma} 
\begin{lemma} \label{lemma-first-order-thickening} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Consider a short exact sequence $$ 0 \to \mathcal{I} \to \mathcal{A} \to \mathcal{O}_X \to 0 $$ of sheaves on $X_\etale$ where $\mathcal{A}$ is a sheaf of $f^{-1}\mathcal{O}_B$-algebras, $\mathcal{A} \to \mathcal{O}_X$ is a surjection of sheaves of $f^{-1}\mathcal{O}_B$-algebras, and $\mathcal{I}$ is its kernel. If \begin{enumerate} \item $\mathcal{I}$ is an ideal of square zero in $\mathcal{A}$, and \item $\mathcal{I}$ is quasi-coherent as an $\mathcal{O}_X$-module \end{enumerate} then there exists a first order thickening $X \subset X'$ over $B$ and an isomorphism $\mathcal{O}_{X'} \to \mathcal{A}$ of $f^{-1}\mathcal{O}_B$-algebras compatible with the surjections to $\mathcal{O}_X$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-thickening} Let $S$ be a scheme. Let $Y \subset Y'$ be a thickening of algebraic spaces over $S$. Let $X' \to Y'$ be a morphism and set $X = Y \times_{Y'} X'$. Then $(X \subset X') \to (Y \subset Y')$ is a morphism of thickenings. If $Y \subset Y'$ is a first (resp.\ finite order) thickening, then $X \subset X'$ is a first (resp.\ finite order) thickening. \end{lemma} 
\begin{lemma} \label{lemma-composition-thickening} Let $S$ be a scheme. If $X \subset X'$ and $X' \subset X''$ are thickenings of algebraic spaces over $S$, then so is $X \subset X''$. \end{lemma} 
\begin{lemma} \label{lemma-descending-property-thickening} The property of being a thickening is fpqc local. Similarly for first order thickenings. \end{lemma} 
\begin{lemma} \label{lemma-thicken-property-morphisms} Let $S$ be a scheme. Let $(f, f') : (X \subset X') \to (Y \subset Y')$ be a morphism of thickenings of algebraic spaces over $S$. Then \begin{enumerate} \item $f$ is an affine morphism if and only if $f'$ is an affine morphism, \item $f$ is a surjective morphism if and only if $f'$ is a surjective morphism, \item $f$ is quasi-compact if and only if $f'$ quasi-compact, \item $f$ is universally closed if and only if $f'$ is universally closed, \item $f$ is integral if and only if $f'$ is integral, \item $f$ is (quasi-)separated if and only if $f'$ is (quasi-)separated, \item $f$ is universally injective if and only if $f'$ is universally injective, \item $f$ is universally open if and only if $f'$ is universally open, \item $f$ is representable if and only if $f'$ is representable, and \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-thicken-property-morphisms-cartesian} Let $S$ be a scheme. Let $(f, f') : (X \subset X') \to (Y \subset Y')$ be a morphism of thickenings of algebraic spaces over $S$ such that $X = Y \times_{Y'} X'$. If $X \subset X'$ is a finite order thickening, then \begin{enumerate} \item $f$ is a closed immersion if and only if $f'$ is a closed immersion, \item $f$ is locally of finite type if and only if $f'$ is locally of finite type, \item $f$ is locally quasi-finite if and only if $f'$ is locally quasi-finite, \item $f$ is locally of finite type of relative dimension $d$ if and only if $f'$ is locally of finite type of relative dimension $d$, \item $\Omega_{X/Y} = 0$ if and only if $\Omega_{X'/Y'} = 0$, \item $f$ is unramified if and only if $f'$ is unramified, \item $f$ is proper if and only if $f'$ is proper, \item $f$ is a finite morphism if and only if $f'$ is an finite morphism, \item $f$ is a monomorphism if and only if $f'$ is a monomorphism, \item $f$ is an immersion if and only if $f'$ is an immersion, and \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-properties-that-extend-over-thickenings} Let $S$ be a scheme. Let $(f, f') : (X \subset X') \to (Y \to Y')$ be a morphism of thickenings of algebraic spaces over $S$. Assume $f$ and $f'$ are locally of finite type and $X = Y \times_{Y'} X'$. Then \begin{enumerate} \item $f$ is locally quasi-finite if and only if $f'$ is locally quasi-finite, \item $f$ is finite if and only if $f'$ is finite, \item $f$ is a closed immersion if and only if $f'$ is a closed immersion, \item $\Omega_{X/Y} = 0$ if and only if $\Omega_{X'/Y'} = 0$, \item $f$ is unramified if and only if $f'$ is unramified, \item $f$ is a monomorphism if and only if $f'$ is a monomorphism, \item $f$ is an immersion if and only if $f'$ is an immersion, \item $f$ is proper if and only if $f'$ is proper, and \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-picard-group-first-order-thickening} Let $S$ be a scheme. Let $X \subset X'$ be a first order thickening of algebraic spaces over $S$ with ideal sheaf $\mathcal{I}$. Then there is a canonical exact sequence $$ \xymatrix{ 0 \ar[r] & H^0(X, \mathcal{I}) \ar[r] & H^0(X', \mathcal{O}_{X'}^*) \ar[r] & H^0(X, \mathcal{O}^*_X) \ar `r[d] `d[l] `l[llld] `d[dll] [dll] \\ & H^1(X, \mathcal{I}) \ar[r] & \Pic(X') \ar[r] & \Pic(X) \ar `r[d] `d[l] `l[llld] `d[dll] [dll] \\ & H^2(X, \mathcal{I}) \ar[r] & \ldots \ar[r] & \ldots } $$ of abelian groups. \end{lemma} 
\begin{definition} \label{definition-first-order-infinitesimal-neighbourhood} Let $i : Z \to X$ be an immersion of algebraic spaces. The {\it first order infinitesimal neighbourhood} of $Z$ in $X$ is the first order thickening $Z \subset Z'$ over $X$ described above. \end{definition} 
\begin{lemma} \label{lemma-first-order-infinitesimal-neighbourhood} Let $i : Z \to X$ be an immersion of algebraic spaces. The first order infinitesimal neighbourhood $Z'$ of $Z$ in $X$ has the following universal property: Given any commutative diagram $$ \xymatrix{ Z \ar[d]_i & T \ar[l]^a \ar[d] \\ X & T' \ar[l]_b } $$ where $T \subset T'$ is a first order thickening over $X$, there exists a unique morphism $(a', a) : (T \subset T') \to (Z \subset Z')$ of thickenings over $X$. \end{lemma} 
\begin{lemma} \label{lemma-infinitesimal-neighbourhood-conormal} Let $i : Z \to X$ be an immersion of algebraic spaces. Let $Z \subset Z'$ be the first order infinitesimal neighbourhood of $Z$ in $X$. Then the diagram $$ \xymatrix{ Z \ar[r] \ar[d] & Z' \ar[d] \\ Z \ar[r] & X } $$ induces a map of conormal sheaves $\mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Z'}$ by Lemma \ref{lemma-conormal-functorial}. This map is an isomorphism. \end{lemma} 
\begin{definition} \label{definition-formally-smooth-etale-unramified} Let $S$ be a scheme. Let $a : F \to G$ be a transformation of functors $F, G : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Consider commutative solid diagrams of the form $$ \xymatrix{ F \ar[d]_a & T \ar[d]^i \ar[l] \\ G & T' \ar[l] \ar@{-->}[lu] } $$ where $T$ and $T'$ are affine schemes and $i$ is a closed immersion defined by an ideal of square zero. \begin{enumerate} \item We say $a$ is {\it formally smooth} if given any solid diagram as above there exists a dotted arrow making the diagram commute\footnote{This is just one possible definition that one can make here. Another slightly weaker condition would be to require that the dotted arrow exists fppf locally on $T'$. This weaker notion has in some sense better formal properties.}. \item We say $a$ is {\it formally \'etale} if given any solid diagram as above there exists exactly one dotted arrow making the diagram commute. \item We say $a$ is {\it formally unramified} if given any solid diagram as above there exists at most one dotted arrow making the diagram commute. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-formally-etale-is-combination} Let $S$ be a scheme. Let $a : F \to G$ be a transformation of functors $F, G : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Then $a$ is formally \'etale if and only if $a$ is both formally smooth and formally unramified. \end{lemma} 
\begin{lemma} \label{lemma-composition-formally-smooth-etale-unramified} Composition. \begin{enumerate} \item A composition of formally smooth transformations of functors is formally smooth. \item A composition of formally \'etale transformations of functors is formally \'etale. \item A composition of formally unramified transformations of functors is formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-base-change-formally-smooth-etale-unramified} Let $S$ be a scheme contained in $\Sch_{fppf}$. Let $F, G, H : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Let $a : F \to G$, $b : H \to G$ be transformations of functors. Consider the fibre product diagram $$ \xymatrix{ H \times_{b, G, a} F \ar[r]_-{b'} \ar[d]_{a'} & F \ar[d]^a \\ H \ar[r]^b & G } $$ \begin{enumerate} \item If $a$ is formally smooth, then the base change $a'$ is formally smooth. \item If $a$ is formally \'etale, then the base change $a'$ is formally \'etale. \item If $a$ is formally unramified, then the base change $a'$ is formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-representable-property-formally-property} Let $S$ be a scheme. Let $F, G : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Let $a : F \to G$ be a representable transformation of functors. \begin{enumerate} \item If $a$ is smooth then $a$ is formally smooth. \item If $a$ is \'etale, then $a$ is formally \'etale. \item If $a$ is unramified, then $a$ is formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-etale-on-top} Let $S$ be a scheme contained in $\Sch_{fppf}$. Let $F, G, H : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Let $a : F \to G$, $b : G \to H$ be transformations of functors. Assume that $a$ is representable, surjective, and \'etale. \begin{enumerate} \item If $b$ is formally smooth, then $b \circ a$ is formally smooth. \item If $b$ is formally \'etale, then $b \circ a$ is formally \'etale. \item If $b$ is formally unramified, then $b \circ a$ is formally unramified. \end{enumerate} Conversely, consider a solid commutative diagram $$ \xymatrix{ G \ar[d]_b & T \ar[d]^i \ar[l] \\ H & T' \ar[l] \ar@{-->}[lu] } $$ with $T'$ an affine scheme over $S$ and $i : T \to T'$ a closed immersion defined by an ideal of square zero. \begin{enumerate} \item[(4)] If $b \circ a$ is formally smooth, then for every $t \in T$ there exists an \'etale morphism of affines $U' \to T'$ and a morphism $U' \to G$ such that $$ \xymatrix{ G \ar[d]_b & T \ar[l] & T \times_{T'} U' \ar[d] \ar[l]\\ H & T' \ar[l] & U' \ar[llu] \ar[l] } $$ commutes and $t$ is in the image of $U' \to T'$. \item[(5)] If $b \circ a$ is formally unramified, then there exists at most one dotted arrow in the diagram above, i.e., $b$ is formally unramified. \item[(6)] If $b \circ a$ is formally \'etale, then there exists exactly one dotted arrow in the diagram above, i.e., $b$ is formally \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-formally-permanence} Let $S$ be a scheme. Let $F, G, H : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$. Let $a : F \to G$, $b : G \to H$ be transformations of functors. Assume $b$ is formally unramified. \begin{enumerate} \item If $b \circ a$ is formally unramified then $a$ is formally unramified. \item If $b \circ a$ is formally \'etale then $a$ is formally \'etale. \item If $b \circ a$ is formally smooth then $a$ is formally smooth. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-formally-unramified} Let $S$ be a scheme. A morphism $f : X \to Y$ of algebraic spaces over $S$ is said to be {\it formally unramified} if it is formally unramified as a transformation of functors as in Definition \ref{definition-formally-smooth-etale-unramified}. \end{definition} 
\begin{lemma} \label{lemma-formally-unramified} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is formally unramified, \item for every diagram $$ \xymatrix{ U \ar[d] \ar[r]_\psi & V \ar[d] \\ X \ar[r]^f & Y } $$ where $U$ and $V$ are schemes and the vertical arrows are \'etale the morphism of schemes $\psi$ is formally unramified (as in More on Morphisms, Definition \ref{more-morphisms-definition-formally-unramified}), and \item for one such diagram with surjective vertical arrows the morphism $\psi$ is formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-formally-unramified-not-affine} Let $S$ be a scheme. If $f : X \to Y$ is a formally unramified morphism of algebraic spaces over $S$, then given any solid commutative diagram $$ \xymatrix{ X \ar[d]_f & T \ar[d]^i \ar[l] \\ Y & T' \ar[l] \ar@{-->}[lu] } $$ where $T \subset T'$ is a first order thickening of algebraic spaces over $S$ there exists at most one dotted arrow making the diagram commute. In other words, in Definition \ref{definition-formally-unramified} the condition that $T$ be an affine scheme may be dropped. \end{lemma} 
\begin{lemma} \label{lemma-composition-formally-unramified} A composition of formally unramified morphisms is formally unramified. \end{lemma} 
\begin{lemma} \label{lemma-base-change-formally-unramified} A base change of a formally unramified morphism is formally unramified. \end{lemma} 
\begin{lemma} \label{lemma-characterize-formally-unramified} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is formally unramified, and \item $\Omega_{X/Y} = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-unramified-formally-unramified} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item The morphism $f$ is unramified, \item the morphism $f$ is locally of finite type and $\Omega_{X/Y} = 0$, and \item the morphism $f$ is locally of finite type and formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-universally-injective-unramified} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is unramified and a monomorphism, \item $f$ is unramified and universally injective, \item $f$ is locally of finite type and a monomorphism, \item $f$ is universally injective, locally of finite type, and formally unramified. \end{enumerate} Moreover, in this case $f$ is also representable, separated, and locally quasi-finite. \end{lemma} 
\begin{lemma} \label{lemma-characterize-closed-immersion} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is a closed immersion, \item $f$ is universally closed, unramified, and a monomorphism, \item $f$ is universally closed, unramified, and universally injective, \item $f$ is universally closed, locally of finite type, and a monomorphism, \item $f$ is universally closed, universally injective, locally of finite type, and formally unramified. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-universal-first-order-thickening} Let $S$ be a scheme. Let $h : Z \to X$ be a morphism of algebraic spaces over $S$. Let $Z \subset Z'$ be a first order thickening over $X$. The following are equivalent \begin{enumerate} \item $Z \subset Z'$ is a universal first order thickening, \item for any diagram (\ref{equation-universal-first-order-thickening}) with $T'$ a scheme a unique dotted arrow exists making the diagram commute, and \item for any diagram (\ref{equation-universal-first-order-thickening}) with $T'$ an affine scheme a unique dotted arrow exists making the diagram commute. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-over-formally-etale} Let $S$ be a scheme. Let $Z \to Y \to X$ be morphisms of algebraic spaces over $S$. If $Z \subset Z'$ is a universal first order thickening of $Z$ over $Y$ and $Y \to X$ is formally \'etale, then $Z \subset Z'$ is a universal first order thickening of $Z$ over $X$. \end{lemma} 
\begin{lemma} \label{lemma-etale-morphism-of-universal-thickenings} Let $S$ be a scheme. Let $Z \to Y \to X$ be morphisms of algebraic spaces over $S$. Assume $Z \to Y$ is \'etale. \begin{enumerate} \item If $Y \subset Y'$ is a universal first order thickening of $Y$ over $X$, then the unique \'etale morphism $Z' \to Y'$ such that $Z = Y \times_{Y'} Z'$ (see Theorem \ref{theorem-topological-invariance}) is a universal first order thickening of $Z$ over $X$. \item If $Z \to Y$ is surjective and $(Z \subset Z') \to (Y \subset Y')$ is an \'etale morphism of first order thickenings over $X$ and $Z'$ is a universal first order thickening of $Z$ over $X$, then $Y'$ is a universal first order thickening of $Y$ over $X$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening} Let $S$ be a scheme. Let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over $S$. There exists a universal first order thickening $Z \subset Z'$ of $Z$ over $X$. \end{lemma} 
\begin{definition} \label{definition-universal-thickening} Let $S$ be a scheme. Let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over $S$. \begin{enumerate} \item The {\it universal first order thickening} of $Z$ over $X$ is the thickening $Z \subset Z'$ constructed in Lemma \ref{lemma-universal-thickening}. \item The {\it conormal sheaf of $Z$ over $X$} is the conormal sheaf of $Z$ in its universal first order thickening $Z'$ over $X$. \end{enumerate} We often denote the conormal sheaf $\mathcal{C}_{Z/X}$ in this situation. \end{definition} 
\begin{lemma} \label{lemma-immersion-universal-thickening} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. Then \begin{enumerate} \item $i$ is formally unramified, \item the universal first order thickening of $Z$ over $X$ is the first order infinitesimal neighbourhood of $Z$ in $X$ of Definition \ref{definition-first-order-infinitesimal-neighbourhood}, \item the conormal sheaf of $i$ in the sense of Definition \ref{definition-conormal-sheaf} agrees with the conormal sheaf of $i$ in the sense of Definition \ref{definition-universal-thickening}. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-unramified} Let $S$ be a scheme. Let $Z \to X$ be a formally unramified morphism of algebraic spaces over $S$. Then the universal first order thickening $Z'$ is formally unramified over $X$. \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-functorial} Let $S$ be a scheme Consider a commutative diagram of algebraic spaces over $S$ $$ \xymatrix{ Z \ar[r]_h \ar[d]_f & X \ar[d]^g \\ W \ar[r]^{h'} & Y } $$ with $h$ and $h'$ formally unramified. Let $Z \subset Z'$ be the universal first order thickening of $Z$ over $X$. Let $W \subset W'$ be the universal first order thickening of $W$ over $Y$. There exists a canonical morphism $(f, f') : (Z, Z') \to (W, W')$ of thickenings over $Y$ which fits into the following commutative diagram $$ \xymatrix{ & & & Z' \ar[ld] \ar[d]^{f'} \\ Z \ar[rr] \ar[d]_f \ar[rrru] & & X \ar[d] & W' \ar[ld] \\ W \ar[rrru]|!{[rr];[rruu]}\hole \ar[rr] & & Y } $$ In particular the morphism $(f, f')$ of thickenings induces a morphism of conormal sheaves $f^*\mathcal{C}_{W/Y} \to \mathcal{C}_{Z/X}$. \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-fibre-product} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_h \ar[d]_f & X \ar[d]^g \\ W \ar[r]^{h'} & Y } $$ be a fibre product diagram of algebraic spaces over $S$ with $h'$ formally unramified. Then $h$ is formally unramified and if $W \subset W'$ is the universal first order thickening of $W$ over $Y$, then $Z = X \times_Y W \subset X \times_Y W'$ is the universal first order thickening of $Z$ over $X$. In particular the canonical map $f^*\mathcal{C}_{W/Y} \to \mathcal{C}_{Z/X}$ of Lemma \ref{lemma-universal-thickening-functorial} is surjective. \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-fibre-product-flat} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_h \ar[d]_f & X \ar[d]^g \\ W \ar[r]^{h'} & Y } $$ be a fibre product diagram of algebraic spaces over $S$ with $h'$ formally unramified and $g$ flat. In this case the corresponding map $Z' \to W'$ of universal first order thickenings is flat, and $f^*\mathcal{C}_{W/Y} \to \mathcal{C}_{Z/X}$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-universal-thickening-localize} Taking the universal first order thickenings commutes with \'etale localization. More precisely, let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over a base scheme $S$. Let $$ \xymatrix{ V \ar[d] \ar[r] & U \ar[d] \\ Z \ar[r] & X } $$ be a commutative diagram with \'etale vertical arrows. Let $Z'$ be the universal first order thickening of $Z$ over $X$. Then $V \to U$ is formally unramified and the universal first order thickening $V'$ of $V$ over $U$ is \'etale over $Z'$. In particular, $\mathcal{C}_{Z/X}|_V = \mathcal{C}_{V/U}$. \end{lemma} 
\begin{lemma} \label{lemma-differentials-universally-unramified} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over $B$. Let $Z \subset Z'$ be the universal first order thickening of $Z$ over $X$ with structure morphism $h' : Z' \to X$. The canonical map $$ \text{d}h' : (h')^*\Omega_{X/B} \to \Omega_{Z'/B} $$ induces an isomorphism $h^*\Omega_{X/B} \to \Omega_{Z'/B} \otimes \mathcal{O}_Z$. \end{lemma} 
\begin{lemma} \label{lemma-universally-unramified-differentials-sequence} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over $B$. There is a canonical exact sequence $$ \mathcal{C}_{Z/X} \to h^*\Omega_{X/B} \to \Omega_{Z/B} \to 0. $$ The first arrow is induced by $\text{d}_{Z'/B}$ where $Z'$ is the universal first order neighbourhood of $Z$ over $X$. \end{lemma} 
\begin{lemma} \label{lemma-two-unramified-morphisms} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[rd]_j & X \ar[d] \\ & Y } $$ be a commutative diagram of algebraic spaces over $S$ where $i$ and $j$ are formally unramified. Then there is a canonical exact sequence $$ \mathcal{C}_{Z/Y} \to \mathcal{C}_{Z/X} \to i^*\Omega_{X/Y} \to 0 $$ where the first arrow comes from Lemma \ref{lemma-universal-thickening-functorial} and the second from Lemma \ref{lemma-universally-unramified-differentials-sequence}. \end{lemma} 
\begin{lemma} \label{lemma-transitivity-conormal-unramified} Let $S$ be a scheme. Let $Z \to Y \to X$ be formally unramified morphisms of algebraic spaces over $S$. \begin{enumerate} \item If $Z \subset Z'$ is the universal first order thickening of $Z$ over $X$ and $Y \subset Y'$ is the universal first order thickening of $Y$ over $X$, then there is a morphism $Z' \to Y'$ and $Y \times_{Y'} Z'$ is the universal first order thickening of $Z$ over $Y$. \item There is a canonical exact sequence $$ i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ where the maps come from Lemma \ref{lemma-universal-thickening-functorial} and $i : Z \to Y$ is the first morphism. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-formally-etale} Let $S$ be a scheme. A morphism $f : X \to Y$ of algebraic spaces over $S$ is said to be {\it formally \'etale} if it is formally \'etale as a transformation of functors as in Definition \ref{definition-formally-smooth-etale-unramified}. \end{definition} 
\begin{lemma} \label{lemma-formally-etale} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is formally \'etale, \item for every diagram $$ \xymatrix{ U \ar[d] \ar[r]_\psi & V \ar[d] \\ X \ar[r]^f & Y } $$ where $U$ and $V$ are schemes and the vertical arrows are \'etale the morphism of schemes $\psi$ is formally \'etale (as in More on Morphisms, Definition \ref{more-morphisms-definition-formally-etale}), and \item for one such diagram with surjective vertical arrows the morphism $\psi$ is formally \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-formally-etale-not-affine} Let $S$ be a scheme. Let $f : X \to Y$ be a formally \'etale morphism of algebraic spaces over $S$. Then given any solid commutative diagram $$ \xymatrix{ X \ar[d]_f & T \ar[d]^i \ar[l]_a \\ Y & T' \ar[l] \ar@{-->}[lu] } $$ where $T \subset T'$ is a first order thickening of algebraic spaces over $Y$ there exists exactly one dotted arrow making the diagram commute. In other words, in Definition \ref{definition-formally-etale} the condition that $T$ be affine may be dropped. \end{lemma} 
\begin{lemma} \label{lemma-composition-formally-etale} A composition of formally \'etale morphisms is formally \'etale. \end{lemma} 
\begin{lemma} \label{lemma-base-change-formally-etale} A base change of a formally \'etale morphism is formally \'etale. \end{lemma} 
\begin{lemma} \label{lemma-characterize-formally-etale} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ The following are equivalent: \begin{enumerate} \item $f$ is formally \'etale, \item $f$ is formally unramified and the universal first order thickening of $X$ over $Y$ is equal to $X$, \item $f$ is formally unramified and $\mathcal{C}_{X/Y} = 0$, and \item $\Omega_{X/Y} = 0$ and $\mathcal{C}_{X/Y} = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-unramified-flat-formally-etale} An unramified flat morphism is formally \'etale. \end{lemma} 
\begin{lemma} \label{lemma-etale-formally-etale} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item The morphism $f$ is \'etale, and \item the morphism $f$ is locally of finite presentation and formally \'etale. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-difference-derivation} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $X \subset X'$ and $Y \subset Y'$ be two first order thickenings of algebraic spaces over $B$. Let $(a, a'), (b, b') : (X \subset X') \to (Y \subset Y')$ be two morphisms of thickenings over $B$. Assume that \begin{enumerate} \item $a = b$, and \item the two maps $a^*\mathcal{C}_{Y/Y'} \to \mathcal{C}_{X/X'}$ (Lemma \ref{lemma-conormal-functorial}) are equal. \end{enumerate} Then the map $(a')^\sharp - (b')^\sharp$ factors as $$ \mathcal{O}_{Y'} \to \mathcal{O}_Y \xrightarrow{D} a_*\mathcal{C}_{X/X'} \to a_*\mathcal{O}_{X'} $$ where $D$ is an $\mathcal{O}_B$-derivation. \end{lemma} 
\begin{lemma} \label{lemma-action-by-derivations} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $(a, a') : (X \subset X') \to (Y \subset Y')$ be a morphism of first order thickenings over $B$. Let $$ \theta : a^*\Omega_{Y/B} \to \mathcal{C}_{X/X'} $$ be an $\mathcal{O}_X$-linear map. Then there exists a unique morphism of pairs $(b, b') : (X \subset X') \to (Y \subset Y')$ such that (1) and (2) of Lemma \ref{lemma-difference-derivation} hold and the derivation $D$ and $\theta$ are related by Equation (\ref{equation-D}). \end{lemma} 
\begin{lemma} \label{lemma-sheaf} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $X \subset X'$ and $Y \subset Y'$ be first order thickenings over $B$. Assume given a morphism $a : X \to Y$ and a map $A : a^*\mathcal{C}_{Y/Y'} \to \mathcal{C}_{X/X'}$ of $\mathcal{O}_X$-modules. For an object $U'$ of $(X')_{spaces, \etale}$ with $U = X \times_{X'} U'$ consider morphisms $a' : U' \to Y'$ such that \begin{enumerate} \item $a'$ is a morphism over $B$, \item $a'|_U = a|_U$, and \item the induced map $a^*\mathcal{C}_{Y/Y'}|_U \to \mathcal{C}_{X/X'}|_U$ is the restriction of $A$ to $U$. \end{enumerate} Then the rule \begin{equation} \label{equation-sheaf} U' \mapsto \{a' : U' \to Y'\text{ such that (1), (2), (3) hold.}\} \end{equation} defines a sheaf of sets on $(X')_{spaces, \etale}$. \end{lemma} 
\begin{lemma} \label{lemma-action-sheaf} Same notation and assumptions as in Lemma \ref{lemma-sheaf}. We identify sheaves on $X$ and $X'$ via (\ref{equation-equivalence-etale-spaces}). There is an action of the sheaf $$ \SheafHom_{\mathcal{O}_X}(a^*\Omega_{Y/B}, \mathcal{C}_{X/X'}) $$ on the sheaf (\ref{equation-sheaf}). Moreover, the action is simply transitive for any object $U'$ of $(X')_{spaces, \etale}$ over which the sheaf (\ref{equation-sheaf}) has a section. \end{lemma} 
\begin{lemma} \label{lemma-action-by-derivations-etale-localization} Let $S$ be a scheme. Consider a commutative diagram of first order thickenings $$ \vcenter{ \xymatrix{ (T_2 \subset T_2') \ar[d]_{(h, h')} \ar[rr]_{(a_2, a_2')} & & (X_2 \subset X_2') \ar[d]^{(f, f')} \\ (T_1 \subset T_1') \ar[rr]^{(a_1, a_1')} & & (X_1 \subset X_1') } } \quad \begin{matrix} \text{and a commutative} \\ \text{diagram} \end{matrix} \quad \vcenter{ \xymatrix{ X_2' \ar[r] \ar[d] & B_2 \ar[d] \\ X_1' \ar[r] & B_1 } } $$ of algebraic spaces over $S$ with $X_2 \to X_1$ and $B_2 \to B_1$ \'etale. For any $\mathcal{O}_{T_1}$-linear map $\theta_1 : a_1^*\Omega_{X_1/B_1} \to \mathcal{C}_{T_1/T'_1}$ let $\theta_2$ be the composition $$ \xymatrix{ a_2^*\Omega_{X_2/B_2} \ar@{=}[r] & h^*a_1^*\Omega_{X_1/B_1} \ar[r]^-{h^*\theta_1} & h^*\mathcal{C}_{T_1/T'_1} \ar[r] & \mathcal{C}_{T_2/T'_2} } $$ (equality sign is explained in the proof). Then the diagram $$ \xymatrix{ T_2' \ar[rr]_{\theta_2 \cdot a_2'} \ar[d] & & X'_2 \ar[d] \\ T_1' \ar[rr]^{\theta_1 \cdot a_1'} & & X'_1 } $$ commutes where the actions $\theta_2 \cdot a_2'$ and $\theta_1 \cdot a_1'$ are as in Remark \ref{remark-action-by-derivations}. \end{lemma} 
\begin{lemma} \label{lemma-deform} Let $S$ be a scheme. Let $(f, f') : (X \subset X') \to (Y \subset Y')$ be a morphism of first order thickenings of algebraic spaces over $S$. Assume that $f$ is flat. Then the following are equivalent \begin{enumerate} \item $f'$ is flat and $X = Y \times_{Y'} X'$, and \item the canonical map $f^*\mathcal{C}_{Y/Y'} \to \mathcal{C}_{X/X'}$ is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flatness-morphism-thickenings} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ (X \subset X') \ar[rr]_{(f, f')} \ar[rd] & & (Y \subset Y') \ar[ld] \\ & (B \subset B') } $$ of thickenings of algebraic spaces over $S$. Assume \begin{enumerate} \item $X'$ is flat over $B'$, \item $f$ is flat, \item $B \subset B'$ is a finite order thickening, and \item $X = B \times_{B'} X'$ and $Y = B \times_{B'} Y'$. \end{enumerate} Then $f'$ is flat and $Y'$ is flat over $B'$ at all points in the image of $f'$. \end{lemma} 
\begin{lemma} \label{lemma-deform-property} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ (X \subset X') \ar[rr]_{(f, f')} \ar[rd] & & (Y \subset Y') \ar[ld] \\ & (B \subset B') } $$ of thickenings of algebraic spaces over $S$. Assume $B \subset B'$ is a finite order thickening, $X'$ flat over $B'$, $X = B \times_{B'} X'$, and $Y = B \times_{B'} Y'$. Then \begin{enumerate} \item $f$ is representable if and only if $f'$ is representable, \label{item-representable} \item $f$ is flat if and only if $f'$ is flat, \label{item-flat} \item $f$ is an isomorphism if and only if $f'$ is an isomorphism, \label{item-isomorphism} \item $f$ is an open immersion if and only if $f'$ is an open immersion, \label{item-open-immersion} \item $f$ is quasi-compact if and only if $f'$ is quasi-compact, \label{item-quasi-compact} \item $f$ is universally closed if and only if $f'$ is universally closed, \label{item-universally-closed} \item $f$ is (quasi-)separated if and only if $f'$ is (quasi-)separated, \label{item-separated} \item $f$ is a monomorphism if and only if $f'$ is a monomorphism, \label{item-monomorphism} \item $f$ is surjective if and only if $f'$ is surjective, \label{item-surjective} \item $f$ is universally injective if and only if $f'$ is universally injective, \label{item-universally-injective} \item $f$ is affine if and only if $f'$ is affine, \label{item-affine} \item \label{item-finite-type} $f$ is locally of finite type if and only if $f'$ is locally of finite type, \item $f$ is locally quasi-finite if and only if $f'$ is locally quasi-finite, \label{item-quasi-finite} \item \label{item-finite-presentation} $f$ is locally of finite presentation if and only if $f'$ is locally of finite presentation, \item \label{item-relative-dimension-d} $f$ is locally of finite type of relative dimension $d$ if and only if $f'$ is locally of finite type of relative dimension $d$, \item $f$ is universally open if and only if $f'$ is universally open, \label{item-universally-open} \item $f$ is syntomic if and only if $f'$ is syntomic, \label{item-syntomic} \item $f$ is smooth if and only if $f'$ is smooth, \label{item-smooth} \item $f$ is unramified if and only if $f'$ is unramified, \label{item-unramified} \item $f$ is \'etale if and only if $f'$ is \'etale, \label{item-etale} \item $f$ is proper if and only if $f'$ is proper, \label{item-proper} \item $f$ is integral if and only if $f'$ is integral, \label{item-integral} \item $f$ is finite if and only if $f'$ is finite, \label{item-finite} \item \label{item-finite-locally-free} $f$ is finite locally free (of rank $d$) if and only if $f'$ is finite locally free (of rank $d$), and \item add more here. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flatness-morphism-thickenings-fp-over-ft} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ (X \subset X') \ar[rr]_{(f, f')} \ar[rd] & & (Y \subset Y') \ar[ld] \\ & (B \subset B') } $$ of thickenings of algebraic spaces over $S$. Assume \begin{enumerate} \item $Y' \to B'$ is locally of finite type, \item $X' \to B'$ is flat and locally of finite presentation, \item $f$ is flat, and \item $X = B \times_{B'} X'$ and $Y = B \times_{B'} Y'$. \end{enumerate} Then $f'$ is flat and for all $y' \in |Y'|$ in the image of $|f'|$ the morphism $Y' \to B'$ is flat at $y'$. \end{lemma} 
\begin{lemma} \label{lemma-deform-property-fp-over-ft} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ (X \subset X') \ar[rr]_{(f, f')} \ar[rd] & & (Y \subset Y') \ar[ld] \\ & (B \subset B') } $$ of thickenings of algebraic spaces over $S$. Assume $Y' \to B'$ locally of finite type, $X' \to B'$ flat and locally of finite presentation, $X = B \times_{B'} X'$, and $Y = B \times_{B'} Y'$. Then \begin{enumerate} \item $f$ is representable if and only if $f'$ is representable, \label{item-representable-fp-over-ft} \item $f$ is flat if and only if $f'$ is flat, \label{item-flat-fp-over-ft} \item $f$ is an isomorphism if and only if $f'$ is an isomorphism, \label{item-isomorphism-fp-over-ft} \item $f$ is an open immersion if and only if $f'$ is an open immersion, \label{item-open-immersion-fp-over-ft} \item $f$ is quasi-compact if and only if $f'$ is quasi-compact, \label{item-quasi-compact-fp-over-ft} \item $f$ is universally closed if and only if $f'$ is universally closed, \label{item-universally-closed-fp-over-ft} \item $f$ is (quasi-)separated if and only if $f'$ is (quasi-)separated, \label{item-separated-fp-over-ft} \item $f$ is a monomorphism if and only if $f'$ is a monomorphism, \label{item-monomorphism-fp-over-ft} \item $f$ is surjective if and only if $f'$ is surjective, \label{item-surjective-fp-over-ft} \item $f$ is universally injective if and only if $f'$ is universally injective, \label{item-universally-injective-fp-over-ft} \item $f$ is affine if and only if $f'$ is affine, \label{item-affine-fp-over-ft} \item $f$ is locally quasi-finite if and only if $f'$ is locally quasi-finite, \label{item-quasi-finite-fp-over-ft} \item \label{item-relative-dimension-d-fp-over-ft} $f$ is locally of finite type of relative dimension $d$ if and only if $f'$ is locally of finite type of relative dimension $d$, \item $f$ is universally open if and only if $f'$ is universally open, \label{item-universally-open-fp-over-ft} \item $f$ is syntomic if and only if $f'$ is syntomic, \label{item-syntomic-fp-over-ft} \item $f$ is smooth if and only if $f'$ is smooth, \label{item-smooth-fp-over-ft} \item $f$ is unramified if and only if $f'$ is unramified, \label{item-unramified-fp-over-ft} \item $f$ is \'etale if and only if $f'$ is \'etale, \label{item-etale-fp-over-ft} \item $f$ is proper if and only if $f'$ is proper, \label{item-proper-fp-over-ft} \item $f$ is finite if and only if $f'$ is finite, \label{item-finite-fp-over-ft} \item \label{item-finite-locally-free-fp-over-ft} $f$ is finite locally free (of rank $d$) if and only if $f'$ is finite locally free (of rank $d$), and \item add more here. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-formally-smooth} Let $S$ be a scheme. A morphism $f : X \to Y$ of algebraic spaces over $S$ is said to be {\it formally smooth} if it is formally smooth as a transformation of functors as in Definition \ref{definition-formally-smooth-etale-unramified}. \end{definition} 
\begin{lemma} \label{lemma-composition-formally-smooth} A composition of formally smooth morphisms is formally smooth. \end{lemma} 
\begin{lemma} \label{lemma-base-change-formally-smooth} A base change of a formally smooth morphism is formally smooth. \end{lemma} 
\begin{lemma} \label{lemma-formally-etale-unramified-smooth} Let $f : X \to S$ be a morphism of schemes. Then $f$ is formally \'etale if and only if $f$ is formally smooth and formally unramified. \end{lemma} 
\begin{lemma} \label{lemma-helper-formally-smooth} Let $S$ be a scheme. Let $$ \xymatrix{ U \ar[d] \ar[r]_\psi & V \ar[d] \\ X \ar[r]^f & Y } $$ be a commutative diagram of morphisms of algebraic spaces over $S$. If the vertical arrows are \'etale and $f$ is formally smooth, then $\psi$ is formally smooth. \end{lemma} 
\begin{lemma}[Infinitesimal lifting criterion] \label{lemma-smooth-formally-smooth} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item The morphism $f$ is smooth. \item The morphism $f$ is locally of finite presentation, and formally smooth. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-smooth-strong-lift} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ X \ar[d] & T \ar[l] \ar[d] \\ Y & T' \ar[l] } $$ of algebraic spaces over $S$ where $X \to Y$ is smooth and $T \to T'$ is a thickening. Then there exists an \'etale covering $\{T'_i \to T'\}$ such that we can find the dotted arrow in $$ \xymatrix{ X \ar[d] & T \ar[l] \ar[d] & T \times_{T'} T'_i \ar[l] \ar[d] \\ Y & T' \ar[l] & T'_i \ar[l] \ar@{..>}[llu] } $$ making the diagram commute (for all $i$). \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth-sheaf-differentials} Let $S$ be a scheme. Let $f : X \to Y$ be a formally smooth morphism of algebraic spaces over $S$. Then $\Omega_{X/Y}$ is locally projective on $X$. \end{lemma} 
\begin{lemma} \label{lemma-h1-is-zero} Let $T$ be an affine scheme. Let $\mathcal{F}$, $\mathcal{G}$ be quasi-coherent $\mathcal{O}_T$-modules on $T_\etale$. Consider the internal hom sheaf $\mathcal{H} = \SheafHom_{\mathcal{O}_T}(\mathcal{F}, \mathcal{G})$ on $T_\etale$. If $\mathcal{F}$ is locally projective, then $H^1(T_\etale, \mathcal{H}) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-formally-smooth} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is formally smooth, \item for every diagram $$ \xymatrix{ U \ar[d] \ar[r]_\psi & V \ar[d] \\ X \ar[r]^f & Y } $$ where $U$ and $V$ are schemes and the vertical arrows are \'etale the morphism of schemes $\psi$ is formally smooth (as in More on Morphisms, Definition \ref{more-morphisms-definition-formally-unramified}), and \item for one such diagram with surjective vertical arrows the morphism $\psi$ is formally smooth. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-descending-property-formally-smooth} The property $\mathcal{P}(f) =$``$f$ is formally smooth'' is fpqc local on the base. \end{lemma} 
\begin{lemma} \label{lemma-triangle-differentials-formally-smooth} Let $S$ be a scheme. Let $f : X \to Y$, $g : Y \to Z$ be morphisms of algebraic spaces over $S$. Assume $f$ is formally smooth. Then $$ 0 \to f^*\Omega_{Y/Z} \to \Omega_{X/Z} \to \Omega_{X/Y} \to 0 $$ Lemma \ref{lemma-triangle-differentials} is short exact. \end{lemma} 
\begin{lemma} \label{lemma-differentials-formally-unramified-formally-smooth} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $h : Z \to X$ be a formally unramified morphism of algebraic spaces over $B$. Assume that $Z$ is formally smooth over $B$. Then the canonical exact sequence $$ 0 \to \mathcal{C}_{Z/X} \to h^*\Omega_{X/B} \to \Omega_{Z/B} \to 0 $$ of Lemma \ref{lemma-universally-unramified-differentials-sequence} is short exact. \end{lemma} 
\begin{lemma} \label{lemma-two-unramified-morphisms-formally-smooth} Let $S$ be a scheme. Let $$ \xymatrix{ Z \ar[r]_i \ar[rd]_j & X \ar[d]^f \\ & Y } $$ be a commutative diagram of algebraic spaces over $S$ where $i$ and $j$ are formally unramified and $f$ is formally smooth. Then the canonical exact sequence $$ 0 \to \mathcal{C}_{Z/Y} \to \mathcal{C}_{Z/X} \to i^*\Omega_{X/Y} \to 0 $$ of Lemma \ref{lemma-two-unramified-morphisms} is exact and locally split. \end{lemma} 
\begin{lemma} \label{lemma-lifting-along-artinian-at-point} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $x \in |X|$. Assume that $Y$ is locally Noetherian and $f$ locally of finite type. The following are equivalent: \begin{enumerate} \item $f$ is smooth at $x$, \item for every solid commutative diagram $$ \xymatrix{ X \ar[d]_f & \Spec(B) \ar[d]^i \ar[l]^-\alpha \\ Y & \Spec(B') \ar[l]_-{\beta} \ar@{-->}[lu] } $$ where $B' \to B$ is a surjection of local rings with $\Ker(B' \to B)$ of square zero, and $\alpha$ mapping the closed point of $\Spec(B)$ to $x$ there exists a dotted arrow making the diagram commute, and \item same as in (2) but with $B' \to B$ ranging over small extensions (see Algebra, Definition \ref{algebra-definition-small-extension}). \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-lifting-along-artinian} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $Y$ is locally Noetherian and $f$ locally of finite type. The following are equivalent: \begin{enumerate} \item $f$ is smooth, \item for every solid commutative diagram $$ \xymatrix{ X \ar[d]_f & \Spec(B) \ar[d]^i \ar[l]^-\alpha \\ Y & \Spec(B') \ar[l]_-{\beta} \ar@{-->}[lu] } $$ where $B' \to B$ is a small extension of Artinian local rings and $\beta$ of finite type (!) there exists a dotted arrow making the diagram commute. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-check-smoothness-on-infinitesimal-nbhds} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ is locally of finite type and $Y$ locally Noetherian. Let $Z \subset Y$ be a closed subspace with $n$th infinitesimal neighbourhood $Z_n \subset Y$. Set $X_n = Z_n \times_Y X$. \begin{enumerate} \item If $X_n \to Z_n$ is smooth for all $n$, then $f$ is smooth at every point of $f^{-1}(Z)$. \item If $X_n \to Z_n$ is \'etale for all $n$, then $f$ is \'etale at every point of $f^{-1}(Z)$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-netherlander} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The {\it naive cotangent complex of $f$} is the complex defined in Modules on Sites, Definition \ref{sites-modules-definition-cotangent-complex-morphism-ringed-topoi} for the morphism of ringed topoi $f_{small}$ between the small \'etale sites of $X$ and $Y$, see Properties of Spaces, Lemma \ref{spaces-properties-lemma-morphism-ringed-topoi}. Notation: $\NL_f$ or $\NL_{X/Y}$. \end{definition} 
\begin{lemma} \label{lemma-NL-etale-localization} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ U \ar[d]_p \ar[r]_g & V \ar[d]^q \\ X \ar[r]^f & Y } $$ of algebraic spaces over $S$ with $p$ and $q$ \'etale. Then there is a canonical identification $\NL_{X/Y}|_{U_\etale} = \NL_{U/V}$ in $D(\mathcal{O}_U)$. \end{lemma} 
\begin{lemma} \label{lemma-NL-compare-spaces-schemes} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $X$ and $Y$ representable by schemes $X_0$ and $Y_0$. Then there is a canonical identification $\NL_{X/Y} = \epsilon^*\NL_{X_0/Y_0}$ in $D(\mathcal{O}_X)$ where $\epsilon$ is as in Derived Categories of Spaces, Section \ref{spaces-perfect-section-derived-quasi-coherent-etale} and $\NL_{X_0/Y_0}$ is as in More on Morphisms, Definition \ref{more-morphisms-definition-netherlander}. \end{lemma} 
\begin{lemma} \label{lemma-netherlander-quasi-coherent} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The cohomology sheaves of the complex $\NL_{X/Y}$ are quasi-coherent, zero outside degrees $-1$, $0$ and equal to $\Omega_{X/Y}$ in degree $0$. \end{lemma} 
\begin{lemma} \label{lemma-netherlander-fp} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. If $f$ is locally of finite presentation, then $\NL_{X/Y}$ is \'etale locally on $X$ quasi-isomorphic to a complex $$ \ldots \to 0 \to \mathcal{F}^{-1} \to \mathcal{F}^0 \to 0 \to \ldots $$ of quasi-coherent $\mathcal{O}_X$-modules with $\mathcal{F}^0$ of finite presentation and $\mathcal{F}^{-1}$ of finite type. \end{lemma} 
\begin{lemma} \label{lemma-NL-formally-smooth} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent \begin{enumerate} \item $f$ is formally smooth, \item $H^{-1}(\NL_{X/Y}) = 0$ and $H^0(\NL_{X/Y}) = \Omega_{X/Y}$ is locally projective. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-NL-formally-etale} Let $f : X \to Y$ be a morphism of schemes. The following are equivalent \begin{enumerate} \item $f$ is formally \'etale, \item $H^{-1}(\NL_{X/Y}) = H^0(\NL_{X/Y}) = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-NL-smooth} Let $f : X \to Y$ be a morphism of schemes. The following are equivalent \begin{enumerate} \item $f$ is smooth, and \item $f$ is locally of finite presentation, $H^{-1}(\NL_{X/Y}) = 0$, and $H^0(\NL_{X/Y}) = \Omega_{X/Y}$ is finite locally free. \end{enumerate} \end{lemma} 
\begin{theorem} \label{theorem-openness-flatness} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$. Assume $f$ is locally of finite presentation and that $\mathcal{F}$ is an $\mathcal{O}_X$-module which is locally of finite presentation. Then $$ \{x \in |X| : \mathcal{F}\text{ is flat over }Y\text{ at }x\} $$ is open in $|X|$. \end{theorem} 
\begin{lemma} \label{lemma-flat-locus-base-change} Let $S$ be a scheme. Let $$ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ be a cartesian diagram of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Assume $g$ is flat, $f$ is locally of finite presentation, and $\mathcal{F}$ is locally of finite presentation. Then $$ \{x' \in |X'| : (g')^*\mathcal{F}\text{ is flat over }Y'\text{ at }x'\} $$ is the inverse image of the open subset of Theorem \ref{theorem-openness-flatness} under the continuous map $|g'| : |X'| \to |X|$. \end{lemma} 
\begin{lemma} \label{lemma-flat-on-fibres-at-point} In the situation above the following are equivalent \begin{enumerate} \item Pick a geometric point $\overline{x}$ of $X$ lying over $x$. Set $\overline{y} = f \circ \overline{x}$ and $\overline{z} = g \circ \overline{x}$. Then the module $\mathcal{F}_{\overline{x}}/ \mathfrak m_{\overline{z}}\mathcal{F}_{\overline{x}}$ is flat over $\mathcal{O}_{Y, \overline{y}}/ \mathfrak m_{\overline{z}}\mathcal{O}_{Y, \overline{y}}$. \item Pick a morphism $x : \Spec(K) \to X$ in the equivalence class of $x$. Set $z = g \circ x$, $X_z = \Spec(K) \times_{z, Z} X$, $Y_z = \Spec(K) \times_{z, Z} Y$, and $\mathcal{F}_z$ the pullback of $\mathcal{F}$ to $X_z$. Then $\mathcal{F}_z$ is flat at $x$ over $Y_z$ (as defined in Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-flat-module}). \item Pick a commutative diagram $$ \xymatrix{ & & & U \ar[llld]_a \ar[rr] \ar[dr] & & V \ar[llld]_>>>>>>>b \ar[dl] \\ X \ar[rr]_f \ar[dr]_g & & Y \ar[dl]^h &  & W \ar[llld]_c \\ & Z } $$ where $U, V, W$ are schemes, and $a, b, c$ are \'etale, and a point $u \in U$ mapping to $x$. Let $w \in W$ be the image of $u$. Let $\mathcal{F}_w$ be the pullback of $\mathcal{F}$ to the fibre $U_w$ of $U \to W$ at $w$. Then $\mathcal{F}_w$ is flat over $V_w$ at $u$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-module-flat-on-fibre} Let $S$ be a scheme. Let $X \to Y \to Z$ be morphisms of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Let $x \in |X|$ be a point and denote $z \in |Z|$ its image. \begin{enumerate} \item We say {\it the restriction of $\mathcal{F}$ to its fibre over $z$ is flat at $x$ over the fibre of $Y$ over $z$} if the equivalent conditions of Lemma \ref{lemma-flat-on-fibres-at-point} are satisfied. \item We say {\it the fibre of $X$ over $z$ is flat at $x$ over the fibre of $Y$ over $z$} if the equivalent conditions of Lemma \ref{lemma-flat-on-fibres-at-point} hold with $\mathcal{F} = \mathcal{O}_X$. \item We say {\it the fibre of $X$ over $z$ is flat over the fibre of $Y$ over $z$} if for all $x \in |X|$ lying over $z$ the fibre of $X$ over $z$ is flat at $x$ over the fibre of $Y$ over $z$ \end{enumerate} \end{definition} 
\begin{theorem} \label{theorem-criterion-flatness-fibre} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be morphisms of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Assume \begin{enumerate} \item $X$ is locally of finite presentation over $Z$, \item $\mathcal{F}$ an $\mathcal{O}_X$-module of finite presentation, and \item $Y$ is locally of finite type over $Z$. \end{enumerate} Let $x \in |X|$ and let $y \in |Y|$ and $z \in |Z|$ be the images of $x$. If $\mathcal{F}_{\overline{x}} \not = 0$, then the following are equivalent: \begin{enumerate} \item $\mathcal{F}$ is flat over $Z$ at $x$ and the restriction of $\mathcal{F}$ to its fibre over $z$ is flat at $x$ over the fibre of $Y$ over $z$, and \item $Y$ is flat over $Z$ at $y$ and $\mathcal{F}$ is flat over $Y$ at $x$. \end{enumerate} Moreover, the set of points $x$ where (1) and (2) hold is open in $\text{Supp}(\mathcal{F})$. \end{theorem} 
\begin{lemma} \label{lemma-morphism-between-flat} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $X$ is locally of finite presentation over $Z$, \item $X$ is flat over $Z$, \item for every $z \in |Z|$ the fibre of $X$ over $z$ is flat over the fibre of $Y$ over $z$, and \item $Y$ is locally of finite type over $Z$. \end{enumerate} Then $f$ is flat. If $f$ is also surjective, then $Y$ is flat over $Z$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-criterion-flatness-fibre} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be morphisms of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Assume \begin{enumerate} \item $X$ is locally of finite presentation over $Z$, \item $\mathcal{F}$ an $\mathcal{O}_X$-module of finite presentation, \item $\mathcal{F}$ is flat over $Z$, and \item $Y$ is locally of finite type over $Z$. \end{enumerate} Then the set $$ A = \{x \in |X| : \mathcal{F} \text{ flat at }x \text{ over }Y\}. $$ is open in $|X|$ and its formation commutes with arbitrary base change: If $Z' \to Z$ is a morphism of algebraic spaces, and $A'$ is the set of points of $X' = X \times_Z Z'$ where $\mathcal{F}' = \mathcal{F} \times_Z Z'$ is flat over $Y' = Y \times_Z Z'$, then $A'$ is the inverse image of $A$ under the continuous map $|X'| \to |X|$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-flatness-fibres} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $X$ is locally of finite presentation over $Z$, \item $X$ is flat over $Z$, and \item $Y$ is locally of finite type over $Z$. \end{enumerate} Then the set $$ \{x \in |X| : X\text{ flat at }x \text{ over }Y\}. $$ is open in $|X|$ and its formation commutes with arbitrary base change $Z' \to Z$. \end{lemma} 
\begin{lemma} \label{lemma-flat-and-free-at-point-fibre} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is locally of finite presentation. Let $\mathcal{F}$ be a finitely presented $\mathcal{O}_X$-module. Let $x \in |X|$ with image $y \in |Y|$. If $\mathcal{F}$ is flat at $x$ over $Y$, then the following are equivalent \begin{enumerate} \item $(\mathcal{F}_{\overline{y}})_{\overline{x}}$ is a flat $\mathcal{O}_{X_{\overline{y}}, \overline{x}}$-module, \item $(\mathcal{F}_{\overline{y}})_{\overline{x}}$ is a free $\mathcal{O}_{X_{\overline{y}}, \overline{x}}$-module, \item $\mathcal{F}_{\overline{y}}$ is finite free in an \'etale neighbourhood of $\overline{x}$ in $X_{\overline{y}}$, and \item $\mathcal{F}$ is finite free in an \'etale neighbourhood of $x$ in $X$. \end{enumerate} Here $\overline{x}$ is a geometric point of $X$ lying over $x$ and $\overline{y} = f \circ \overline{x}$. \end{lemma} 
\begin{lemma} \label{lemma-finite-free-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is locally of finite presentation. Let $\mathcal{F}$ be a finitely presented $\mathcal{O}_X$-module flat over $Y$. Then the set $$ \{x \in |X| : \mathcal{F}\text{ free in an \'etale neighbourhood of }x\} $$ is open in $|X|$ and its formation commutes with arbitrary base change $Y' \to Y$. \end{lemma} 
\begin{theorem} \label{theorem-criterion-flatness-fibre-Noetherian} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be morphisms of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Assume \begin{enumerate} \item $X$, $Y$, $Z$ locally Noetherian, and \item $\mathcal{F}$ a coherent $\mathcal{O}_X$-module. \end{enumerate} Let $x \in |X|$ and let $y \in |Y|$ and $z \in |Z|$ be the images of $x$. If $\mathcal{F}_{\overline{x}} \not = 0$, then the following are equivalent: \begin{enumerate} \item $\mathcal{F}$ is flat over $Z$ at $x$ and the restriction of $\mathcal{F}$ to its fibre over $z$ is flat at $x$ over the fibre of $Y$ over $z$, and \item $Y$ is flat over $Z$ at $y$ and $\mathcal{F}$ is flat over $Y$ at $x$. \end{enumerate} \end{theorem} 
\begin{lemma} \label{lemma-morphism-between-flat-Noetherian} Let $S$ be a scheme. Let $f : X \to Y$ and $Y \to Z$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $X$, $Y$, $Z$ locally Noetherian, \item $X$ is flat over $Z$, \item for every $z \in |Z|$ the fibre of $X$ over $z$ is flat over the fibre of $Y$ over $z$. \end{enumerate} Then $f$ is flat. If $f$ is also surjective, then $Y$ is flat over $Z$. \end{lemma} 
\begin{lemma} \label{lemma-flatness-over-Noetherian-ring} Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Let $X$ be an algebraic space locally of finite presentation over $S = \Spec(A)$. For $n \geq 1$ set $S_n = \Spec(A/I^n)$ and $X_n = S_n \times_S X$. Let $\mathcal{F}$ be coherent $\mathcal{O}_X$-module. If for every $n \geq 1$ the pullback $\mathcal{F}_n$ of $\mathcal{F}$ to $X$ is flat over $S_n$, then the (open) locus where $\mathcal{F}$ is flat over $X$ contains the inverse image of $V(I)$ under $X \to S$. \end{lemma} 
\begin{lemma} \label{lemma-integral-closure-smooth-pullback} Let $S$ be a scheme. Let $f : Y \to X$ be a smooth morphism of algebraic spaces over $S$. Let $\mathcal{A}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-algebras. The integral closure of $\mathcal{O}_Y$ in $f^*\mathcal{A}$ is equal to $f^*\mathcal{A}'$ where $\mathcal{A}' \subset \mathcal{A}$ is the integral closure of $\mathcal{O}_X$ in $\mathcal{A}$. \end{lemma} 
\begin{lemma}[Normalization commutes with smooth base change] \label{lemma-normalization-smooth-localization} Let $S$ be a scheme. Let $$ \xymatrix{ Y_2 \ar[r] \ar[d] & Y_1 \ar[d]^f \\ X_2 \ar[r]^\varphi & X_1 } $$ be a fibre square of algebraic spaces over $S$. Assume $f$ is quasi-compact and quasi-separated and $\varphi$ is smooth. Let $Y_i \to X_i' \to X_i$ be the normalization of $X_i$ in $Y_i$. Then $X_2' \cong X_2 \times_{X_1} X_1'$. \end{lemma} 
\begin{lemma} \label{lemma-CM-local-ring-fibre} The property of morphisms of germs of schemes \begin{align*} & \mathcal{P}((X, x) \to (S, s)) = \\ & \text{the local ring } \mathcal{O}_{X_s, x} \text{ of the fibre is Noetherian and Cohen-Macaulay} \end{align*} is \'etale local on the source-and-target (Descent, Definition \ref{descent-definition-local-source-target-at-point}). \end{lemma} 
\begin{definition} \label{definition-CM} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian (Divisors on Spaces, Definition \ref{spaces-divisors-definition-locally-Noetherian-fibre}). \begin{enumerate} \item Let $x \in |X|$, and $y = f(x)$. We say that $f$ is {\it Cohen-Macaulay at $x$} if $f$ is flat at $x$ and the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target-at-point} hold for the property $\mathcal{P}$ described in Lemma \ref{lemma-CM-local-ring-fibre}. \item We say $f$ is a {\it Cohen-Macaulay morphism} if $f$ is Cohen-Macaulay at every point of $X$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-CM} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian. The following are equivalent \begin{enumerate} \item $f$ is Cohen-Macaulay, \item $f$ is flat and for some surjective \'etale morphism $V \to Y$ where $V$ is a scheme, the fibres of $X_V \to V$ are Cohen-Macaulay algebraic spaces, and \item $f$ is flat and for any \'etale morphism $V \to Y$ where $V$ is a scheme, the fibres of $X_V \to V$ are Cohen-Macaulay algebraic spaces. \end{enumerate} Given $x \in |X|$ with image $y \in |Y|$ the following are equivalent \begin{enumerate} \item[(a)] $f$ is Cohen-Macaulay at $x$, and \item[(b)] $\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{X, \overline{x}}$ is flat and $\mathcal{O}_{X, \overline{x}}/ \mathfrak m_{\overline{y}}\mathcal{O}_{X, \overline{x}}$ is Cohen-Macaulay. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-composition-CM} Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$. Assume that the fibres of $f$, $g$, and $g \circ f$ are locally Noetherian. Let $x \in |X|$ with images $y \in |Y|$ and $z \in |Z|$. \begin{enumerate} \item If $f$ is Cohen-Macaulay at $x$ and $g$ is Cohen-Macaulay at $f(x)$, then $g \circ f$ is Cohen-Macaulay at $x$. \item If $f$ and $g$ are Cohen-Macaulay, then $g \circ f$ is Cohen-Macaulay. \item If $g \circ f$ is Cohen-Macaulay at $x$ and $f$ is flat at $x$, then $f$ is Cohen-Macaulay at $x$ and $g$ is Cohen-Macaulay at $f(x)$. \item If $f \circ g$ is Cohen-Macaulay and $f$ is flat, then $f$ is Cohen-Macaulay and $g$ is Cohen-Macaulay at every point in the image of $f$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-morphism-from-CM} Let $S$ be a scheme. Let $f : X \to Y$ be a flat morphism of locally Noetherian algebraic spaces over $S$. If $X$ is Cohen-Macaulay, then $f$ is Cohen-Macaulay and $\mathcal{O}_{Y, f(\overline{x})}$ is Cohen-Macaulay for all $x \in |X|$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-CM} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian. Let $Y' \to Y$ be locally of finite type. Let $f' : X' \to Y'$ be the base change of $f$. Let $x' \in |X'|$ be a point with image $x \in |X|$. \begin{enumerate} \item If $f$ is Cohen-Macaulay at $x$, then $f' : X' \to Y'$ is Cohen-Macaulay at $x'$. \item If $f$ is flat at $x$ and $f'$ is Cohen-Macaulay at $x'$, then $f$ is Cohen-Macaulay at $x$. \item If $Y' \to Y$ is flat at $f'(x')$ and $f'$ is Cohen-Macaulay at $x'$, then $f$ is Cohen-Macaulay at $x$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-presentation-CM-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. Let $$ W = \{x \in |X| : f\text{ is Cohen-Macaulay at }x\} $$ Then $W$ is open in $|X|$ and the formation of $W$ commutes with arbitrary base change of $f$: For any morphism $g : Y' \to Y$, consider the base change $f' : X' \to Y'$ of $f$ and the projection $g' : X' \to X$. Then the corresponding set $W'$ for the morphism $f'$ is equal to $W' = (g')^{-1}(W)$. \end{lemma} 
\begin{lemma} \label{lemma-lfp-CM-relative-dimension} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume that $f$ is locally of finite presentation and Cohen-Macaulay. Then there exist open and closed subschemes $X_d \subset X$ such that $X = \coprod_{d \geq 0} X_d$ and $f|_{X_d} : X_d \to Y$ has relative dimension $d$. \end{lemma} 
\begin{lemma} \label{lemma-gorenstein-local-ring-fibre} The property of morphisms of germs of schemes \begin{align*} & \mathcal{P}((X, x) \to (S, s)) = \\ & \text{the local ring } \mathcal{O}_{X_s, x} \text{ of the fibre is Noetherian and Gorenstein} \end{align*} is \'etale local on the source-and-target (Descent, Definition \ref{descent-definition-local-source-target-at-point}). \end{lemma} 
\begin{definition} \label{definition-gorenstein} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian (Divisors on Spaces, Definition \ref{spaces-divisors-definition-locally-Noetherian-fibre}). \begin{enumerate} \item Let $x \in |X|$, and $y = f(x)$. We say that $f$ is {\it Gorenstein at $x$} if $f$ is flat at $x$ and the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target-at-point} hold for the property $\mathcal{P}$ described in Lemma \ref{lemma-gorenstein-local-ring-fibre}. \item We say $f$ is a {\it Gorenstein morphism} if $f$ is Gorenstein at every point of $X$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-gorenstein} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian. The following are equivalent \begin{enumerate} \item $f$ is Gorenstein, \item $f$ is flat and for some surjective \'etale morphism $V \to Y$ where $V$ is a scheme, the fibres of $X_V \to V$ are Gorenstein algebraic spaces, and \item $f$ is flat and for any \'etale morphism $V \to Y$ where $V$ is a scheme, the fibres of $X_V \to V$ are Gorenstein algebraic spaces. \end{enumerate} Given $x \in |X|$ with image $y \in |Y|$ the following are equivalent \begin{enumerate} \item[(a)] $f$ is Gorenstein at $x$, and \item[(b)] $\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{X, \overline{x}}$ is flat and $\mathcal{O}_{X, \overline{x}}/ \mathfrak m_{\overline{y}}\mathcal{O}_{X, \overline{x}}$ is Gorenstein. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-composition-gorenstein} Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$. Assume that the fibres of $f$, $g$, and $g \circ f$ are locally Noetherian. Let $x \in |X|$ with images $y \in |Y|$ and $z \in |Z|$. \begin{enumerate} \item If $f$ is Gorenstein at $x$ and $g$ is Gorenstein at $f(x)$, then $g \circ f$ is Gorenstein at $x$. \item If $f$ and $g$ are Gorenstein, then $g \circ f$ is Gorenstein. \item If $g \circ f$ is Gorenstein at $x$ and $f$ is flat at $x$, then $f$ is Gorenstein at $x$ and $g$ is Gorenstein at $f(x)$. \item If $f \circ g$ is Gorenstein and $f$ is flat, then $f$ is Gorenstein and $g$ is Gorenstein at every point in the image of $f$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-morphism-from-gorenstein} Let $S$ be a scheme. Let $f : X \to Y$ be a flat morphism of locally Noetherian algebraic spaces over $S$. If $X$ is Gorenstein, then $f$ is Gorenstein and $\mathcal{O}_{Y, f(\overline{x})}$ is Gorenstein for all $x \in |X|$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-gorenstein} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume the fibres of $f$ are locally Noetherian. Let $Y' \to Y$ be locally of finite type. Let $f' : X' \to Y'$ be the base change of $f$. Let $x' \in |X'|$ be a point with image $x \in |X|$. \begin{enumerate} \item If $f$ is Gorenstein at $x$, then $f' : X' \to Y'$ is Gorenstein at $x'$. \item If $f$ is flat at $x$ and $f'$ is Gorenstein at $x'$, then $f$ is Gorenstein at $x$. \item If $Y' \to Y$ is flat at $f'(x')$ and $f'$ is Gorenstein at $x'$, then $f$ is Gorenstein at $x$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-presentation-gorenstein-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. Let $$ W = \{x \in |X| : f\text{ is Gorenstein at }x\} $$ Then $W$ is open in $|X|$ and the formation of $W$ commutes with arbitrary base change of $f$: For any morphism $g : Y' \to Y$, consider the base change $f' : X' \to Y'$ of $f$ and the projection $g' : X' \to X$. Then the corresponding set $W'$ for the morphism $f'$ is equal to $W' = (g')^{-1}(W)$. \end{lemma} 
\begin{lemma} \label{lemma-slice} Let $S$ be a scheme. Consider a cartesian diagram $$ \xymatrix{ X \ar[d] & F \ar[l]^p \ar[d] \\ Y & \Spec(k) \ar[l] } $$ where $X \to Y$ is a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation, and where $k$ is a field over $S$. Let $f_1, \ldots, f_r \in \Gamma(X, \mathcal{O}_X)$ and $z \in |F|$ such that $f_1, \ldots, f_r$ map to a regular sequence in the local ring $\mathcal{O}_{F, \overline{z}}$. Then, after replacing $X$ by an open subspace containing $p(z)$, the morphism $$ V(f_1, \ldots, f_r) \longrightarrow Y $$ is flat and locally of finite presentation. \end{lemma} 
\begin{lemma} \label{lemma-geometrically-reduced-fibre} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $y \in |Y|$. The following are equivalent \begin{enumerate} \item for some morphism $\Spec(k) \to Y$ in the equivalence class of $y$ the algebraic space $X_k$ is geometrically reduced over $k$, \item for every morphism $\Spec(k) \to Y$ in the equivalence class of $y$ the algebraic space $X_k$ is geometrically reduced over $k$, \item for every morphism $\Spec(k) \to Y$ in the equivalence class of $y$ the algebraic space $X_k$ is reduced. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-geometrically-reduced-fibre} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $y \in |Y|$. We say {\it the fibre of $f : X \to Y$ at $y$ is geometrically reduced} if the equivalent conditions of Lemma \ref{lemma-geometrically-reduced-fibre} hold. \end{definition} 
\begin{lemma} \label{lemma-base-change-fibres-geometrically-reduced} Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y' \to Y$ be morphisms of algebraic spaces over $S$. Denote $f' : X' \to Y'$ the base change of $f$ by $g$. Then \begin{align*} \{y' \in |Y'| : \text{the fibre of }f' : X' \to Y'\text{ at }y' \text{ is geometrically reduced}\} \\ = g^{-1}(\{y \in |Y| : \text{the fibre of }f : X \to Y\text{ at }y \text{ is geometrically reduced}\}). \end{align*} \end{lemma} 
\begin{lemma} \label{lemma-geometrically-reduced-constructible} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is quasi-compact and locally of finite presentation. Then the set $$ E = \{y \in |Y| : \text{the fibre of }f : X \to Y\text{ at }y \text{ is geometrically reduced}\} $$ is \'etale locally constructible. \end{lemma} 
\begin{lemma} \label{lemma-proper-flat-over-dvr-reduced-fibre} Let $X$ be an algebraic space over a discrete valuation ring $R$ whose structure morphism $X \to \Spec(R)$ is proper and flat. If the special fibre is reduced, then both $X$ and the generic fibre $X_\eta$ are reduced. \end{lemma} 
\begin{lemma} \label{lemma-geometrically-reduced-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. If $f$ is flat, proper, and of finite presentation, then the set $$ E = \{y \in |Y| : \text{the fibre of }f : X \to Y\text{ at }y \text{ is geometrically reduced}\} $$ is open in $|Y|$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-fibres-nr-geometrically-connected-components} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $$ n_{X/Y} : |Y| \to \{0, 1, 2, 3, \ldots, \infty\} $$ be the function which associates to $y \in Y$ the number of connected components of $X_k$ where $\Spec(k) \to Y$ is in the equivalence class of $y$ with $k$ algebraically closed. This is well defined and if $g : Y' \to Y$ is a morphism then $$ n_{X'/Y'} = n_{X/Y} \circ g $$ where $X' \to Y'$ is the base change of $f$. \end{lemma} 
\begin{lemma} \label{lemma-dimension-fibre} Let $S$ be a scheme. Let $f : X \to Y$ be a finite type morphism of algebraic spaces over $S$. Let $y \in |Y|$. The following quantities are the same \begin{enumerate} \item $d = -\infty$ if $y$ is not in the image of $|f|$ and otherwise the minimal integer $d$ such that $f$ has relative dimension $\leq d$ at every $x \in |X|$ mapping to $y$, \item the dimension of the algebraic space $X_k = \Spec(k) \times_Y X$ for any morphism $\Spec(k) \to Y$ in the equivalence class defining $y$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-base-change-dimension-fibres} Let $S$ be a scheme. Let $f : X \to Y$ be a finite type morphism of algebraic spaces over $S$. Let $$ n_{X/Y} : |Y| \to \{-\infty, 0, 1, 2, 3, \ldots\} $$ be the function which associates to $y \in |Y|$ the integer discussed in Lemma \ref{lemma-dimension-fibre}. If $g : Y' \to Y$ is a morphism then $$ n_{X'/Y'} = n_{X/Y} \circ |g| $$ where $X' \to Y'$ is the base change of $f$. \end{lemma} 
\begin{lemma} \label{lemma-dimension-fibres-flat} Let $S$ be a scheme. Let $f : X \to Y$ be a flat morphism of finite presentation of algebraic spaces over $S$. Let $n_{X/Y}$ be the function on $Y$ giving the dimension of fibres of $f$ introduced in Lemma \ref{lemma-base-change-dimension-fibres}. Then $n_{X/Y}$ is lower semi-continuous. \end{lemma} 
\begin{lemma} \label{lemma-dimension-fibres-proper} Let $S$ be a scheme. Let $f : X \to Y$ be a proper morphism of algebraic spaces over $S$. Let $n_{X/Y}$ be the function on $Y$ giving the dimension of fibres of $f$ introduced in Lemma \ref{lemma-base-change-dimension-fibres}. Then $n_{X/Y}$ is upper semi-continuous. \end{lemma} 
\begin{lemma} \label{lemma-dimension-fibres-proper-flat} Let $S$ be a scheme. Let $f : X \to Y$ be a proper, flat, finitely presented morphism of algebraic spaces over $S$. Let $n_{X/Y}$ be the function on $Y$ giving the dimension of fibres of $f$ introduced in Lemma \ref{lemma-base-change-dimension-fibres}. Then $n_{X/Y}$ is locally constant. \end{lemma} 
\begin{lemma} \label{lemma-construct-glueing} Let $S$ be a scheme. Let $f : X \to Y$ be an integral morphism of algebraic spaces over $S$. Let $y \in |Y|$ be a point which can be represented by a closed immersion $y : \Spec(k) \to Y$. Then there exists a factorization $X \to X' \to Y$ of $f$ such that \begin{enumerate} \item $X' \to Y$ is integral, \item $X \to X'$ is an isomorphism over $X' \setminus X'_y$, \item $X'_y$ has a unique point $x'$ with $\kappa(x') = k$. \end{enumerate} Moreover, if $f$ is finite and $Y$ is locally Noetherian, then $X' \to Y$ is finite. \end{lemma} 
\begin{lemma} \label{lemma-universally-catenary-dimension-function} Let $S$ be a scheme. Let $B$ be an algebraic space over $S$. Let $\delta : |B| \to \mathbf{Z}$ be a function. Assume $B$ is decent, locally Noetherian, and universally catenary and $\delta$ is a dimension function. If $X$ is a decent algebraic space over $B$ whose structure morphism $f : X \to B$ is locally of finite type we define $\delta_X : |X| \to \mathbf{Z}$ by the rule $$ \delta_X(x) = \delta(f(x)) + \text{transcendence degreeof }x/f(x) $$ (Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-dimension-fibre}). Then $\delta_X$ is a dimension function. \end{lemma} 
\begin{lemma} \label{lemma-etale-splits-off-quasi-finite-part} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $y \in |Y|$. Let $x_1, \ldots, x_n \in |X|$ mapping to $y$. Assume that \begin{enumerate} \item $f$ is locally of finite type, \item $f$ is separated, \item $f$ is quasi-finite at $x_1, \ldots, x_n$, and \item $f$ is quasi-compact or $Y$ is decent. \end{enumerate} Then there exists an \'etale morphism $(U, u) \to (Y, y)$ of pointed algebraic spaces and a decomposition $$ U \times_Y X = W \amalg V $$ into open and closed subspaces such that the morphism $V \to U$ is finite, every point of the fibre of $|V| \to |U|$ over $u$ maps to an $x_i$, and the fibre of $|W| \to |U|$ over $u$ contains no point mapping to an $x_i$. \end{lemma} 
\begin{lemma} \label{lemma-etale-splits-off-just-one-quasi-finite-part} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $x \in |X|$ with image $y \in |Y|$. Assume that \begin{enumerate} \item $f$ is locally of finite type, \item $f$ is separated, and \item $f$ is quasi-finite at $x$. \end{enumerate} Then there exists an \'etale morphism $(U, u) \to (Y, y)$ of pointed algebraic spaces and a decomposition $$ U \times_Y X = W \amalg V $$ into open and closed subspaces such that the morphism $V \to U$ is finite and there exists a point $v \in |V|$ which maps to $x$ in $|X|$ and $u$ in $|U|$. \end{lemma} 
\begin{lemma} \label{lemma-finite-type-separated} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is of finite type and separated. Let $Y'$ be the normalization of $Y$ in $X$. Picture: $$ \xymatrix{ X \ar[rd]_f \ar[rr]_{f'} & & Y' \ar[ld]^\nu \\ & Y & } $$ Then there exists an open subspace $U' \subset Y'$ such that \begin{enumerate} \item $(f')^{-1}(U') \to U'$ is an isomorphism, and \item $(f')^{-1}(U') \subset X$ is the set of points at which $f$ is quasi-finite. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-quasi-finite-separated-quasi-affine} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ is quasi-finite and separated. Let $Y'$ be the normalization of $Y$ in $X$. Picture: $$ \xymatrix{ X \ar[rd]_f \ar[rr]_{f'} & & Y' \ar[ld]^\nu \\ & Y & } $$ Then $f'$ is a quasi-compact open immersion and $\nu$ is integral. In particular $f$ is quasi-affine. \end{lemma} 
\begin{lemma}[Zariski's Main Theorem] \label{lemma-quasi-finite-separated-pass-through-finite} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ is quasi-finite and separated and assume that $Y$ is quasi-compact and quasi-separated. Then there exists a factorization $$ \xymatrix{ X \ar[rd]_f \ar[rr]_j & & T \ar[ld]^\pi \\ & Y & } $$ where $j$ is a quasi-compact open immersion and $\pi$ is finite. \end{lemma} 
\begin{lemma} \label{lemma-quasi-finite-separated-pass-through-finite-addendum} With notation and hypotheses as in Lemma \ref{lemma-quasi-finite-separated-pass-through-finite}. Assume moreover that $f$ is locally of finite presentation. Then we can choose the factorization such that $T$ is finite and of finite presentation over $Y$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-finite} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is finite, \item $f$ is proper and locally quasi-finite, \item $f$ is proper and $|X_k|$ is a discrete space for every morphism $\Spec(k) \to Y$ where $k$ is a field, \item $f$ is universally closed, separated, locally of finite type and $|X_k|$ is a discrete space for every morphism $\Spec(k) \to Y$ where $k$ is a field. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-proper-finite-fibre-finite-in-neighbourhood} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $y \in |Y|$. Assume \begin{enumerate} \item $f$ is proper, and \item $f$ is quasi-finite at all $x \in |X|$ lying over $y$ (Decent Spaces, Lemma \ref{decent-spaces-lemma-conditions-on-fibre-and-qf}). \end{enumerate} Then there exists an open neighbourhood $V \subset Y$ of $y$ such that $f|_{f^{-1}(V)} : f^{-1}(V) \to V$ is finite. \end{lemma} 
\begin{lemma} \label{lemma-flat-proper-family-cannot-collapse-fibre} \begin{slogan} Collapsing a fibre of a proper family forces nearby ones to collapse too. \end{slogan} Let $S$ be a scheme. Let $$ \xymatrix{ X \ar[rr]_h \ar[rd]_f & & Y \ar[ld]^g \\ & B } $$ be a commutative diagram of morphism of algebraic spaces over $S$. Let $b \in B$ and let $\Spec(k) \to B$ be a morphism in the equivalence class of $b$. Assume \begin{enumerate} \item $X \to B$ is a proper morphism, \item $Y \to B$ is separated and locally of finite type, \item one of the following is true \begin{enumerate} \item the image of $|X_k| \to |Y_k|$ is finite, \item the image of $|f|^{-1}(\{b\})$ in $|Y|$ is finite and $B$ is decent. \end{enumerate} \end{enumerate} Then there is an open subspace $B' \subset B$ containing $b$ such that $X_{B'} \to Y_{B'}$ factors through a closed subspace $Z \subset Y_{B'}$ finite over $B'$. \end{lemma} 
\begin{lemma} \label{lemma-stein-universally-closed} Let $S$ be a scheme. Let $f : X \to Y$ be a universally closed and quasi-separated morphism of algebraic spaces over $S$. There exists a factorization $$ \xymatrix{ X \ar[rr]_{f'} \ar[rd]_f & & Y' \ar[dl]^\pi \\ & Y & } $$ with the following properties: \begin{enumerate} \item the morphism $f'$ is universally closed, quasi-compact, quasi-separated, and surjective, \item the morphism $\pi : Y' \to Y$ is integral, \item we have $f'_*\mathcal{O}_X = \mathcal{O}_{Y'}$, \item we have $Y' = \underline{\Spec}_Y(f_*\mathcal{O}_X)$, and \item $Y'$ is the normalization of $Y$ in $X$ as defined in Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-normalization-X-in-Y}. \end{enumerate} Formation of the factorization $f = \pi \circ f'$ commutes with flat base change. \end{lemma} 
\begin{lemma} \label{lemma-stein-universally-closed-residue-fields} In Lemma \ref{lemma-stein-universally-closed} assume in addition that $f$ is locally of finite type and $Y$ affine. Then for $y \in Y$ the fibre $\pi^{-1}(\{y\}) = \{y_1, \ldots, y_n\}$ is finite and the field extensions $\kappa(y_i)/\kappa(y)$ are finite. \end{lemma} 
\begin{lemma} \label{lemma-characterize-geometrically-connected-fibres} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $\overline{y}$ be a geometric point of $Y$. Then $X_{\overline{y}}$ is connected, if and only if for every \'etale neighbourhood $(V, \overline{v}) \to (Y, \overline{y})$ where $V$ is a scheme the base change $X_V \to V$ has connected fibre $X_v$. \end{lemma} 
\begin{theorem}[Stein factorization; Noetherian case] \label{theorem-stein-factorization-Noetherian} Let $S$ be a scheme. Let $f : X \to Y$ be a proper morphism of algebraic spaces over $S$ with $Y$ locally Noetherian. There exists a factorization $$ \xymatrix{ X \ar[rr]_{f'} \ar[rd]_f & & Y' \ar[dl]^\pi \\ & Y & } $$ with the following properties: \begin{enumerate} \item the morphism $f'$ is proper with connected geometric fibres, \item the morphism $\pi : Y' \to Y$ is finite, \item we have $f'_*\mathcal{O}_X = \mathcal{O}_{Y'}$, \item we have $Y' = \underline{\Spec}_Y(f_*\mathcal{O}_X)$, and \item $Y'$ is the normalization of $Y$ in $X$, see Morphisms, Definition \ref{morphisms-definition-normalization-X-in-Y}. \end{enumerate} \end{theorem} 
\begin{theorem}[Stein factorization; general case] \label{theorem-stein-factorization-general} Let $S$ be a scheme. Let $f : X \to Y$ be a proper morphism of algebraic spaces over $S$. There exists a factorization $$ \xymatrix{ X \ar[rr]_{f'} \ar[rd]_f & & Y' \ar[dl]^\pi \\ & Y & } $$ with the following properties: \begin{enumerate} \item the morphism $f'$ is proper with connected geometric fibres, \item the morphism $\pi : Y' \to Y$ is integral, \item we have $f'_*\mathcal{O}_X = \mathcal{O}_{Y'}$, \item we have $Y' = \underline{\Spec}_Y(f_*\mathcal{O}_X)$, and \item $Y'$ is the normalization of $Y$ in $X$ (Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-normalization-X-in-Y}). \end{enumerate} \end{theorem} 
\begin{lemma} \label{lemma-geometrically-connected-fibres-towards-normal} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $f$ is proper, \item $Y$ is integral (Spaces over Fields, Definition \ref{spaces-over-fields-definition-integral-algebraic-space}) with generic point $\xi$, \item $Y$ is normal, \item $X$ is reduced, \item every generic point of an irreducible component of $|X|$ maps to $\xi$, \item we have $H^0(X_\xi, \mathcal{O}) = \kappa(\xi)$. \end{enumerate} Then $f_*\mathcal{O}_X = \mathcal{O}_Y$ and $f$ has geometrically connected fibres. \end{lemma} 
\begin{lemma} \label{lemma-proper-flat-nr-geom-conn-comps-lower-semicontinuous} Let $S$ be a scheme. Let $X \to Y$ be a morphism of algebraic spaces over $S$. If $f$ is proper, flat, and of finite presentation, then the function $n_{X/Y} : |Y| \to \mathbf{Z}$ counting the number of geometric connected components of fibres of $f$ (Lemma \ref{lemma-base-change-fibres-nr-geometrically-connected-components}) is lower semi-continuous. \end{lemma} 
\begin{lemma} \label{lemma-proper-flat-geom-red} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume \begin{enumerate} \item $f$ is proper, flat, and of finite presentation, and \item the geometric fibres of $f$ are reduced. \end{enumerate} Then the function $n_{X/S} : |Y| \to \mathbf{Z}$ counting the numbers of geometric connected components of fibres of $f$ (Lemma \ref{lemma-base-change-fibres-nr-geometrically-connected-components}) is locally constant. \end{lemma} 
\begin{lemma} \label{lemma-stein-factorization-etale} Let $S$ be a scheme. Let $f : X \to Y$ be a proper morphism of algebraic spaces over $S$. Let $X \to Y' \to Y$ be the Stein factorization of $f$ (Theorem \ref{theorem-stein-factorization-general}). If $f$ is of finite presentation, flat, with geometrically reduced fibres (Definition \ref{definition-geometrically-reduced-fibre}), then $Y' \to Y$ is finite \'etale. \end{lemma} 
\begin{lemma} \label{lemma-split-off-proper-part-henselian} Let $(A, I)$ be a henselian pair. Let $X$ be an algebraic space separated and of finite type over $A$. Set $X_0 = X \times_{\Spec(A)} \Spec(A/I)$. Let $Y \subset X_0$ be an open and closed subspace such that $Y \to \Spec(A/I)$ is proper. Then there exists an open and closed subspace $W \subset X$ which is proper over $A$ with $W \times_{\Spec(A)} \Spec(A/I) = Y$. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-type-finitely-presented-over-dense-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Let $V \subset Y$ be an open subspace. Assume \begin{enumerate} \item $f$ is locally of finite presentation, \item $\mathcal{F}$ is of finite type and flat over $Y$, \item $V \to Y$ is quasi-compact and scheme theoretically dense, \item $\mathcal{F}|_{f^{-1}V}$ is of finite presentation. \end{enumerate} Then $\mathcal{F}$ is of finite presentation. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-type-finitely-presented-over-dense-open-X} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $V \subset Y$ be an open subspace. Assume \begin{enumerate} \item $f$ is locally of finite type and flat, \item $V \to Y$ is quasi-compact and scheme theoretically dense, \item $f|_{f^{-1}V} : f^{-1}V \to V$ is locally of finite presentation. \end{enumerate} Then $f$ is of locally of finite presentation. \end{lemma} 
\begin{lemma} \label{lemma-flat-fp-dimension-over-dense-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite type. Let $V \subset Y$ be an open subspace such that $|V| \subset |Y|$ is dense and such that $X_V \to V$ has relative dimension $\leq d$. If also either \begin{enumerate} \item $f$ is locally of finite presentation, or \item $V \to Y$ is quasi-compact, \end{enumerate} then $f : X \to Y$ has relative dimension $\leq d$. \end{lemma} 
\begin{lemma} \label{lemma-proper-flat-finite-over-dense-open} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and proper. Let $V \to Y$ be an open subspace with $|V| \subset |Y|$ dense such that $X_V \to V$ is finite. If also either $f$ is locally of finite presentation or $V \to Y$ is quasi-compact, then $f$ is finite. \end{lemma} 
\begin{lemma} \label{lemma-zariski} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $V \subset Y$ be an open subspace. If \begin{enumerate} \item $f$ is separated, locally of finite type, and flat, \item $f^{-1}(V) \to V$ is an isomorphism, and \item $V \to Y$ is quasi-compact and scheme theoretically dense, \end{enumerate} then $f$ is an open immersion. \end{lemma} 
\begin{lemma} \label{lemma-push-ideal} Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$. Let $\varphi : W \to X$ be a quasi-compact separated \'etale morphism. Let $U \subset X$ be a quasi-compact open subspace. Let $\mathcal{I} \subset \mathcal{O}_W$ be a finite type quasi-coherent sheaf of ideals such that $V(\mathcal{I}) \cap \varphi^{-1}(U) = \emptyset$. Then there exists a finite type quasi-coherent sheaf of ideals $\mathcal{J} \subset \mathcal{O}_X$ such that \begin{enumerate} \item $V(\mathcal{J}) \cap U = \emptyset$, and \item $\varphi^{-1}(\mathcal{J})\mathcal{O}_W = \mathcal{I} \mathcal{I}'$ for some finite type quasi-coherent ideal $\mathcal{I}' \subset \mathcal{O}_W$. \end{enumerate} \end{lemma} 
\begin{theorem} \label{theorem-flatten-module} Let $S$ be a scheme. Let $B$ be a quasi-compact and quasi-separated algebraic space over $S$. Let $X$ be an algebraic space over $B$. Let $\mathcal{F}$ be a quasi-coherent module on $X$. Let $U \subset B$ be a quasi-compact open subspace. Assume \begin{enumerate} \item $X$ is quasi-compact, \item $X$ is locally of finite presentation over $B$, \item $\mathcal{F}$ is a module of finite type, \item $\mathcal{F}_U$ is of finite presentation, and \item $\mathcal{F}_U$ is flat over $U$. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ such that the strict transform $\mathcal{F}'$ of $\mathcal{F}$ is an $\mathcal{O}_{X \times_B B'}$-module of finite presentation and flat over $B'$. \end{theorem} 
\begin{lemma} \label{lemma-flat-after-blowing-up} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Let $U \subset B$ be an open subspace. Assume \begin{enumerate} \item $B$ is quasi-compact and quasi-separated, \item $U$ is quasi-compact, \item $f : X \to B$ is of finite type and quasi-separated, and \item $f^{-1}(U) \to U$ is flat and locally of finite presentation. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ such that the strict transform $X'$ of $X$ is flat and of finite presentation over $B'$. \end{lemma} 
\begin{lemma} \label{lemma-finite-after-blowing-up} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Let $U \subset B$ be an open subspace. Assume \begin{enumerate} \item $B$ is quasi-compact and quasi-separated, \item $U$ is quasi-compact, \item $f : X \to B$ is proper, and \item $f^{-1}(U) \to U$ is finite locally free. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ such that the strict transform $X'$ of $X$ is finite locally free over $B'$. \end{lemma} 
\begin{lemma} \label{lemma-isomorphism-after-blowing-up} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Let $U \subset B$ be an open subspace. Assume \begin{enumerate} \item $B$ is quasi-compact and quasi-separated, \item $U$ is quasi-compact, \item $f : X \to B$ is proper, and \item $f^{-1}(U) \to U$ is an isomorphism. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ such that the strict transform $X'$ of $X$ maps isomorphically to $B'$. \end{lemma} 
\begin{lemma} \label{lemma-zariski-after-blowup} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Let $U \subset B$ be an open subspace. Assume \begin{enumerate} \item $B$ quasi-compact and quasi-separated, \item $U$ is quasi-compact, \item $f$ is of finite type \item $f^{-1}(U) \to U$ is an isomorphism. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ such that $U$ is scheme theoretically dense in $B'$ and such that the strict transform $X'$ of $X$ maps isomorphically to an open subspace of $B'$. \end{lemma} 
\begin{lemma} \label{lemma-dominate-modification-by-blowup} Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces over $S$. Let $U \subset B$ be an open subspace. Assume \begin{enumerate} \item $B$ is quasi-compact and quasi-separated, \item $U$ is quasi-compact, \item $f : X \to B$ is proper, \item $f^{-1}(U) \to U$ us an isomorphism. \end{enumerate} Then there exists a $U$-admissible blowup $B' \to B$ which dominates $X$, i.e., such that there exists a factorization $B' \to X \to B$ of the blowup morphism. \end{lemma} 
\begin{lemma} \label{lemma-get-section-after-blowup} Let $S$ be a scheme. Let $X$, $Y$ be algebraic spaces over $S$. Let $U \subset W \subset Y$ be open subspaces. Let $f : X \to W$ and let $s : U \to X$ be morphisms such that $f \circ s = \text{id}_U$. Assume \begin{enumerate} \item $f$ is proper, \item $Y$ is quasi-compact and quasi-separated, and \item $U$ and $W$ are quasi-compact. \end{enumerate} Then there exists a $U$-admissible blowup $b : Y' \to Y$ and a morphism $s' : b^{-1}(W) \to X$ extending $s$ with $f \circ s' = b|_{b^{-1}(W)}$. \end{lemma} 
\begin{lemma} \label{lemma-find-common-blowups} Let $S$ be a scheme. Let $Y$ be a quasi-compact and quasi-separated algebraic space over $S$. Let $U \to X_1$ and $U \to X_2$ be open immersions of algebraic spaces over $Y$ and assume $U$, $X_1$, $X_2$ of finite type and separated over $Y$. Then there exists a commutative diagram $$ \xymatrix{ X_1' \ar[d] \ar[r] & X & X_2' \ar[l] \ar[d] \\ X_1 & U \ar[l] \ar[lu] \ar[u] \ar[ru] \ar[r] & X_2 } $$ of algebraic spaces over $Y$ where $X_i' \to X_i$ is a $U$-admissible blowup, $X_i' \to X$ is an open immersion, and $X$ is separated and finite type over $Y$. \end{lemma} 
\begin{lemma} \label{lemma-blowup-to-find-embedding} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $U \subset X$ be an open subspace. Assume \begin{enumerate} \item $U$ is quasi-compact, \item $Y$ is quasi-compact and quasi-separated, \item there exists an immersion $U \to \mathbf{P}^n_Y$ over $Y$, \item $f$ is of finite type and separated. \end{enumerate} Then there exists a commutative diagram $$ \xymatrix{ & U \ar[ld] \ar[d] \ar[rd] \ar[rrd] \\ X \ar[rd] & X' \ar[l] \ar[d] \ar[r] & Z' \ar[ld] \ar[r] & Z \ar[ld] \\ & Y & \mathbf{P}^n_Y \ar[l] } $$ where the arrows with source $U$ are open immersions, $X' \to X$ is a $U$-admissible blowup, $X' \to Z'$ is an open immersion, $Z' \to Y$ is a proper and representable morphism of algebraic spaces. More precisely, $Z' \to Z$ is a $U$-admissible blowup and $Z \to \mathbf{P}^n_Y$ is a closed immersion. \end{lemma} 
\begin{lemma} \label{lemma-chow-noetherian} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ separated, of finite type, and $Y$ Noetherian. Then there exists a dense open subspace $U \subset X$ and a commutative diagram $$ \xymatrix{ & U \ar[ld] \ar[d] \ar[rd] \ar[rrd] \\ X \ar[rd] & X' \ar[l] \ar[d] \ar[r] & Z' \ar[ld] \ar[r] & Z \ar[ld] \\ & Y & \mathbf{P}^n_Y \ar[l] } $$ where the arrows with source $U$ are open immersions, $X' \to X$ is a $U$-admissible blowup, $X' \to Z'$ is an open immersion, $Z' \to Y$ is a proper and representable morphism of algebraic spaces. More precisely, $Z' \to Z$ is a $U$-admissible blowup and $Z \to \mathbf{P}^n_Y$ is a closed immersion. \end{lemma} 
\begin{lemma}[Chow's lemma] \label{lemma-chow-noetherian-separated} \begin{reference} \cite[IV Theorem 3.1]{Kn} \end{reference} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ separated of finite type, and $Y$ separated and Noetherian. Then there exists a commutative diagram $$ \xymatrix{ X \ar[rd] & X' \ar[l] \ar[d] \ar[r] & \mathbf{P}^n_Y \ar[ld] \\ & Y } $$ where $X' \to X$ is a $U$-admissible blowup for some dense open $U \subset X$ and the morphism $X' \to \mathbf{P}^n_Y$ is an immersion. \end{lemma} 
\begin{lemma} \label{lemma-chow-finite-type} Let $S$ be a  scheme. Let $Y$ be a quasi-compact and quasi-separated algebraic space over $S$. Let $f : X \to Y$ be a separated morphism of finite type. Then there exists a commutative diagram $$ \xymatrix{ X \ar[rd] & X' \ar[l] \ar[d] \ar[r] & \overline{X}' \ar[ld] \\ & Y } $$ where $X' \to X$ is proper surjective, $X' \to \overline{X}'$ is an open immersion, and $\overline{X}' \to Y$ is proper and representable morphism of algebraic spaces. \end{lemma} 
\begin{lemma} \label{lemma-chow-finite-type-separated} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume $f$ separated of finite type, and $Y$ separated and quasi-compact. Then there exists a commutative diagram $$ \xymatrix{ X \ar[rd] & X' \ar[l] \ar[d] \ar[r] & \mathbf{P}^n_Y \ar[ld] \\ & Y } $$ where $X' \to X$ is proper surjective morphism and the morphism $X' \to \mathbf{P}^n_Y$ is an immersion. \end{lemma} 
\begin{lemma} \label{lemma-inverse-systems-abelian} Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$ and let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of ideals. \begin{enumerate} \item The category $\textit{Coh}(X, \mathcal{I})$ is abelian. \item Exactness in $\textit{Coh}(X, \mathcal{I})$ can be checked \'etale locally. \item For any flat morphism $f : X' \to X$ of Noetherian algebraic spaces the functor $f^* : \textit{Coh}(X, \mathcal{I}) \to \textit{Coh}(X', f^{-1}\mathcal{I}\mathcal{O}_{X'})$ is exact. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-inverse-systems-surjective} Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$ and let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of ideals. A map $(\mathcal{F}_n) \to (\mathcal{G}_n)$ is surjective in $\textit{Coh}(X, \mathcal{I})$ if and only if $\mathcal{F}_1 \to \mathcal{G}_1$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-exact} The functor (\ref{equation-completion-functor}) is exact. \end{lemma} 
\begin{lemma} \label{lemma-completion-internal-hom} Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$ and let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of ideals. Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules. Set $\mathcal{H} = \SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$. Then $$ \lim H^0(X, \mathcal{H}/\mathcal{I}^n\mathcal{H}) = \Mor_{\textit{Coh}(X, \mathcal{I})} (\mathcal{F}^\wedge, \mathcal{G}^\wedge). $$ \end{lemma} 
\begin{lemma} \label{lemma-fully-faithful} In Situation \ref{situation-existence}. Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules. Assume that the intersection of the supports of $\mathcal{F}$ and $\mathcal{G}$ is proper over $\Spec(A)$. Then the map $$ \Mor_{\textit{Coh}(\mathcal{O}_X)}(\mathcal{F}, \mathcal{G}) \longrightarrow \Mor_{\textit{Coh}(X, \mathcal{I})} (\mathcal{F}^\wedge, \mathcal{G}^\wedge) $$ coming from (\ref{equation-completion-functor}) is a bijection. In particular, (\ref{equation-completion-functor-proper-over-A}) is fully faithful. \end{lemma} 
\begin{lemma} \label{lemma-existence-easy} Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$ and let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of ideals. Let $\mathcal{G}$ be a coherent $\mathcal{O}_X$-module, $(\mathcal{F}_n)$ an object of $\textit{Coh}(X, \mathcal{I})$, and $\alpha : (\mathcal{F}_n) \to \mathcal{G}^\wedge$ a map whose kernel and cokernel are annihilated by a power of $\mathcal{I}$. Then there exists a unique (up to unique isomorphism) triple $(\mathcal{F}, a, \beta)$ where \begin{enumerate} \item $\mathcal{F}$ is a coherent $\mathcal{O}_X$-module, \item $a : \mathcal{F} \to \mathcal{G}$ is an $\mathcal{O}_X$-module map whose kernel and cokernel are annihilated by a power of $\mathcal{I}$, \item $\beta : (\mathcal{F}_n) \to \mathcal{F}^\wedge$ is an isomorphism, and \item $\alpha = a^\wedge \circ \beta$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-existence-tricky} In Situation \ref{situation-existence}. Let $\mathcal{K} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of ideals. Let $X_e \subset X$ be the closed subspace cut out by $\mathcal{K}^e$. Let $\mathcal{I}_e = \mathcal{I}\mathcal{O}_{X_e}$. Let $(\mathcal{F}_n)$ be an object of $\textit{Coh}_{\text{support proper over } A}(X, \mathcal{I})$. Assume \begin{enumerate} \item the functor $\textit{Coh}_{\text{support proper over } A}(\mathcal{O}_{X_e}) \to \textit{Coh}_{\text{support proper over } A}(X_e, \mathcal{I}_e)$ is an equivalence for all $e \geq 1$, and \item there exists an object $\mathcal{H}$ of $\textit{Coh}_{\text{support proper over } A}(\mathcal{O}_X)$ and a map $\alpha : (\mathcal{F}_n) \to \mathcal{H}^\wedge$ whose kernel and cokernel are annihilated by a power of $\mathcal{K}$. \end{enumerate} Then $(\mathcal{F}_n)$ is in the essential image of (\ref{equation-completion-functor-proper-over-A}). \end{lemma} 
\begin{lemma} \label{lemma-inverse-systems-push-pull} Let $S$ be a scheme. Let $f : X \to Y$ be a representable proper morphism of Noetherian algebraic spaces over $S$. Let $\mathcal{J}, \mathcal{K} \subset \mathcal{O}_Y$ be quasi-coherent sheaves of ideals. Assume $f$ is an isomorphism over $V = Y \setminus V(\mathcal{K})$. Set $\mathcal{I} = f^{-1}\mathcal{J} \mathcal{O}_X$. Let $(\mathcal{G}_n)$ be an object of $\textit{Coh}(Y, \mathcal{J})$, let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module, and let $\beta : (f^*\mathcal{G}_n)  \to \mathcal{F}^\wedge$ be an isomorphism in $\textit{Coh}(X, \mathcal{I})$. Then there exists a map $$ \alpha : (\mathcal{G}_n) \longrightarrow (f_*\mathcal{F})^\wedge $$ in $\textit{Coh}(Y, \mathcal{J})$ whose kernel and cokernel are annihilated by a power of $\mathcal{K}$. \end{lemma} 
\begin{theorem}[Grothendieck's existence theorem] \label{theorem-grothendieck-existence} In Situation \ref{situation-existence} the functor (\ref{equation-completion-functor-proper-over-A}) is an equivalence. \end{theorem} 
\begin{lemma} \label{lemma-algebraize-formal-closed-subscheme} Let $A$ be a Noetherian ring complete with respect to an ideal $I$. Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$. Let $X \to S$ be a morphism of algebraic spaces that is separated and of finite type. For $n \geq 1$ we set $X_n = X \times_S S_n$. Suppose given a commutative diagram $$ \xymatrix{ Z_1 \ar[r] \ar[d] & Z_2 \ar[r] \ar[d] & Z_3 \ar[r] \ar[d] & \ldots \\ X_1 \ar[r]^{i_1} & X_2 \ar[r]^{i_2} & X_3 \ar[r] & \ldots } $$ of algebraic spaces with cartesian squares. Assume that \begin{enumerate} \item $Z_1 \to X_1$ is a closed immersion, and \item $Z_1 \to S_1$ is proper. \end{enumerate} Then there exists a closed immersion of algebraic spaces $Z \to X$ such that $Z_n = Z \times_S S_n$ for all $n \geq 1$. Moreover, $Z$ is proper over $S$. \end{lemma} 
\begin{lemma} \label{lemma-algebraize-formal-algebraic-space-finite-over-proper} Let $A$ be a Noetherian ring complete with respect to an ideal $I$. Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$. Let $X \to S$ be a morphism of algebraic spaces that is separated and of finite type. For $n \geq 1$ we set $X_n = X \times_S S_n$. Suppose given a commutative diagram $$ \xymatrix{ Y_1 \ar[r] \ar[d] & Y_2 \ar[r] \ar[d] & Y_3 \ar[r] \ar[d] & \ldots \\ X_1 \ar[r]^{i_1} & X_2 \ar[r]^{i_2} & X_3 \ar[r] & \ldots } $$ of algebraic spaces with cartesian squares. Assume that \begin{enumerate} \item $Y_1 \to X_1$ is a finite morphism, and \item $Y_1 \to S_1$ is proper. \end{enumerate} Then there exists a finite morphism of algebraic spaces $Y \to X$ such that $Y_n = Y \times_S S_n$ for all $n \geq 1$. Moreover, $Y$ is proper over $S$. \end{lemma} 
\begin{lemma} \label{lemma-algebraize-morphism} Let $A$ be a Noetherian ring complete with respect to an ideal $I$. Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$. Let $X$, $Y$ be algebraic spaces over $S$. For $n \geq 1$ we set $X_n = X \times_S S_n$ and $Y_n = Y \times_S S_n$. Suppose given a compatible system of commutative diagrams $$ \xymatrix{ & & X_{n + 1} \ar[rd] \ar[rr]_{g_{n + 1}} & & Y_{n + 1} \ar[ld] \\ X_n \ar[rru] \ar[rd] \ar[rr]_{g_n} & & Y_n \ar[rru] \ar[ld] & S_{n + 1} \\ & S_n \ar[rru] } $$ Assume that \begin{enumerate} \item $X \to S$ is proper, and \item $Y \to S$ is separated of finite type. \end{enumerate} Then there exists a unique morphism of algebraic spaces $g : X \to Y$ over $S$ such that $g_n$ is the base change of $g$ to $S_n$. \end{lemma} 
\begin{lemma} \label{lemma-formal-algebraic-space-proper-reldim-1} Let $(A, \mathfrak m, \kappa)$ be a complete local Noetherian ring. Set $S = \Spec(A)$ and $S_n = \Spec(A/\mathfrak m^n)$. Consider a commutative diagram $$ \xymatrix{ X_1 \ar[r]_{i_1} \ar[d] & X_2 \ar[r]_{i_2} \ar[d] & X_3 \ar[r] \ar[d] & \ldots \\ S_1 \ar[r] & S_2 \ar[r] & S_3 \ar[r] & \ldots } $$ of algebraic spaces with cartesian squares. If $\dim(X_1) \leq 1$, then there exists a projective morphism of schemes $X \to S$ and isomorphisms $X_n \cong X \times_S S_n$ compatible with $i_n$. \end{lemma} 
\begin{lemma} \label{lemma-projective-over-complete} Let $(A, \mathfrak m, \kappa)$ be a complete Noetherian local ring. Let $X$ be an algebraic space over $\Spec(A)$. If $X \to \Spec(A)$ is proper and $\dim(X_\kappa) \leq 1$, then $X$ is a scheme projective over $A$. \end{lemma} 
\begin{lemma} \label{lemma-representable-etale-local-target} Let $\mathcal{P}$ be a property of morphisms of schemes which is \'etale local on the target. Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism of algebraic spaces over $S$. Consider commutative diagrams $$ \xymatrix{ X \times_Y V \ar[d] \ar[r] & V \ar[d] \\ X \ar[r]^f & Y } $$ where $V$ is a scheme and $V \to Y$ is \'etale. The following are equivalent \begin{enumerate} \item for any diagram as above the projection $X \times_Y V \to V$ has property $\mathcal{P}$, and \item for some diagram as above with $V \to Y$ surjective the projection $X \times_Y V \to V$ has property $\mathcal{P}$. \end{enumerate} If $X$ and $Y$ are representable, then this is also equivalent to $f$ (as a morphism of schemes) having property $\mathcal{P}$. \end{lemma} 
\begin{definition} \label{definition-regular-immersion} Let $S$ be a scheme. Let $i : X \to Y$ be a morphism of algebraic spaces over $S$. \begin{enumerate} \item We say $i$ is a {\it Koszul-regular immersion} if $i$ is representable and the equivalent conditions of Lemma \ref{lemma-representable-etale-local-target} hold with $\mathcal{P}(f) =$``$f$ is a Koszul-regular immersion''. \item We say $i$ is an {\it $H_1$-regular immersion} if $i$ is representable and the equivalent conditions of Lemma \ref{lemma-representable-etale-local-target} hold with $\mathcal{P}(f) =$``$f$ is an $H_1$-regular immersion''. \item We say $i$ is a {\it quasi-regular immersion} if $i$ is representable and the equivalent conditions of Lemma \ref{lemma-representable-etale-local-target} hold with $\mathcal{P}(f) =$``$f$ is a quasi-regular immersion''. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-regular-quasi-regular-immersion} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. We have the following implications: $i$ is Koszul-regular $\Rightarrow$ $i$ is $H_1$-regular $\Rightarrow$ $i$ is quasi-regular. \end{lemma} 
\begin{lemma} \label{lemma-regular-immersion-noetherian} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. Assume $X$ is locally Noetherian. Then $i$ is Koszul-regular $\Leftrightarrow$ $i$ is $H_1$-regular $\Leftrightarrow$ $i$ is quasi-regular. \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-regular-immersion} \begin{slogan} Regular immersions are stable under flat base change. \end{slogan} Let $S$ be a scheme. Let $i : Z \to X$ be a Koszul-regular, $H_1$-regular, or quasi-regular immersion of algebraic spaces over $S$. Let $X' \to X$ be a flat morphism of algebraic spaces over $S$. Then the base change $i' : Z \times_X X' \to X'$ is a Koszul-regular, $H_1$-regular, or quasi-regular immersion. \end{lemma} 
\begin{lemma} \label{lemma-quasi-regular-immersion} Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic spaces over $S$. Then $i$ is a quasi-regular immersion if and only if the following conditions are satisfied \begin{enumerate} \item $i$ is locally of finite presentation, \item the conormal sheaf $\mathcal{C}_{Z/X}$ is finite locally free, and \item the map (\ref{equation-conormal-algebra-quotient}) is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-transitivity-conormal-quasi-regular} Let $S$ be a scheme. Let $Z \to Y \to X$ be immersions of algebraic spaces over $S$. Assume that $Z \to Y$ is $H_1$-regular. Then the canonical sequence of Lemma \ref{lemma-transitivity-conormal} $$ 0 \to i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ is exact and (\'etale) locally split. \end{lemma} 
\begin{lemma} \label{lemma-composition-regular-immersion} Let $S$ be a scheme. Let $i : Z \to Y$ and $j : Y \to X$ be immersions of algebraic spaces over $S$. \begin{enumerate} \item If $i$ and $j$ are Koszul-regular immersions, so is $j \circ i$. \item If $i$ and $j$ are $H_1$-regular immersions, so is $j \circ i$. \item If $i$ is an $H_1$-regular immersion and $j$ is a quasi-regular immersion, then $j \circ i$ is a quasi-regular immersion. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-permanence-regular-immersion} Let $S$ be a scheme. Let $i : Z \to Y$ and $j : Y \to X$ be immersions of algebraic spaces over $S$. Assume that the sequence $$ 0 \to i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ of Lemma \ref{lemma-transitivity-conormal} is exact and locally split. \begin{enumerate} \item If $j \circ i$ is a quasi-regular immersion, so is $i$. \item If $j \circ i$ is a $H_1$-regular immersion, so is $i$. \item If both $j$ and $j \circ i$ are Koszul-regular immersions, so is $i$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-extra-permanence-regular-immersion-noetherian} Let $S$ be a scheme. Let $i : Z \to Y$ and $j : Y \to X$ be immersions of algebraic spaces over $S$. Assume $X$ is locally Noetherian. The following are equivalent \begin{enumerate} \item $i$ and $j$ are Koszul regular immersions, \item $i$ and $j \circ i$ are Koszul regular immersions, \item $j \circ i$ is a Koszul regular immersion and the conormal sequence $$ 0 \to i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ is exact and locally split. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-qcoh-relative-pseudo-coherence-characterize} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is locally of finite type. Let $m \in \mathbf{Z}$. Let $E \in D_\QCoh(\mathcal{O}_X)$. With notation as explained in Remark \ref{remark-match-relative-pseudo-coherence} the following are equivalent: \begin{enumerate} \item for every commutative diagram $$ \xymatrix{ U \ar[d] \ar[r] & V \ar[d] \\ X \ar[r] & Y } $$ where $U$, $V$ are schemes and the vertical arrows are \'etale, the complex $E|_U$ is $m$-pseudo-coherent relative to $V$, \item for some commutative diagram as in (1) with $U \to X$ surjective, the complex $E|_U$ is $m$-pseudo-coherent relative to $V$, \item for every commutative diagram as in (1) with $U$ and $V$ affine the complex $R\Gamma(U, E)$ of $\mathcal{O}_X(U)$-modules is $m$-pseudo-coherent relative to $\mathcal{O}_Y(V)$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-relative-pseudo-coherence} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is locally of finite type. Let $E$ be an object of $D_\QCoh(\mathcal{O}_X)$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module. Fix $m \in \mathbf{Z}$. \begin{enumerate} \item We say $E$ is {\it $m$-pseudo-coherent relative to $Y$} if the equivalent conditions of Lemma \ref{lemma-qcoh-relative-pseudo-coherence-characterize} are satisfied. \item We say $E$ is {\it pseudo-coherent relative to $Y$} if $E$ is $m$-pseudo-coherent relative to $Y$ for all $m \in \mathbf{Z}$. \item We say $\mathcal{F}$ is {\it $m$-pseudo-coherent relative to $Y$} if $\mathcal{F}$ viewed as an object of $D_\QCoh(\mathcal{O}_X)$ is $m$-pseudo-coherent relative to $Y$. \item We say $\mathcal{F}$ is {\it pseudo-coherent relative to $Y$} if $\mathcal{F}$ viewed as an object of $D_\QCoh(\mathcal{O}_X)$ is pseudo-coherent relative to $Y$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-relative-pseudo-coherent-is-moot} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $E$ in $D_\QCoh(\mathcal{O}_X)$. If $f$ is flat and locally of finite presentation, then the following are equivalent \begin{enumerate} \item $E$ is pseudo-coherent relative to $Y$, and \item $E$ is pseudo-coherent on $X$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-pseudo-coherent} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. \begin{enumerate} \item We say $f$ is {\it pseudo-coherent} if the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target} hold with $\mathcal{P} =$``pseudo-coherent''. \item Let $x \in |X|$. We say $f$ is {\it pseudo-coherent at $x$} if there exists an open neighbourhood $X' \subset X$ of $x$ such that $f|_{X'} : X' \to Y$ is pseudo-coherent. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-flat-base-change-pseudo-coherent} A flat base change of a pseudo-coherent morphism is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-composition-pseudo-coherent} A composition of pseudo-coherent morphisms is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-finite-presentation} A pseudo-coherent morphism is locally of finite presentation. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-presentation-pseudo-coherent} A flat morphism which is locally of finite presentation is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-permanence-pseudo-coherent} Let $f : X \to Y$ be a morphism of algebraic spaces pseudo-coherent over a base algebraic space $B$. Then $f$ is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-Noetherian-pseudo-coherent} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. If $Y$ is locally Noetherian, then $f$ is pseudo-coherent if and only if $f$ is locally of finite type. \end{lemma} 
\begin{definition} \label{definition-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. \begin{enumerate} \item We say $f$ is {\it perfect} if the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target} hold with $\mathcal{P} =$``perfect''. \item Let $x \in |X|$. We say $f$ is {\it perfect at $x$} if there exists an open neighbourhood $X' \subset X$ of $x$ such that $f|_{X'} : X' \to Y$ is perfect. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-flat-base-change-perfect} A flat base change of a perfect morphism is perfect. \end{lemma} 
\begin{lemma} \label{lemma-composition-perfect} A composition of perfect morphisms is perfect. \end{lemma} 
\begin{lemma} \label{lemma-flat-finite-presentation-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent \begin{enumerate} \item $f$ is flat and perfect, and \item $f$ is flat and locally of finite presentation. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-perfect-proper-perfect-direct-image} Let $S$ be a scheme. Let $Y$ be a Noetherian algebraic space over $S$. Let $f : X \to Y$ be a perfect proper morphism of algebraic spaces. Let $E \in D(\mathcal{O}_X)$ be perfect. Then $Rf_*E$ is a perfect object of $D(\mathcal{O}_Y)$. \end{lemma} 
\begin{definition} \label{definition-lci} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. \begin{enumerate} \item We say $f$ is a {\it Koszul morphism}, or that $f$ is a {\it local complete intersection morphism} if the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target} hold with $\mathcal{P}(f) =$``$f$ is a local complete intersection morphism''. \item Let $x \in |X|$. We say $f$ is {\it Koszul at $x$} if there exists an open neighbourhood $X' \subset X$ of $x$ such that $f|_{X'} : X' \to Y$ is a local complete intersection morphism. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-lci} Let $S$ be a scheme. Let $f : X \to Y$ be a local complete intersection morphism of algebraic spaces over $S$. Let $P$ be an algebraic space smooth over $Y$. Let $U \to X$ be an \'etale morphism of algebraic spaces and let $i : U \to P$ an immersion of algebraic spaces over $Y$. Picture: $$ \xymatrix{ X \ar[rd] & U \ar[l] \ar[d] \ar[r]_i & P \ar[ld] \\ & Y } $$ Then $i$ is a Koszul-regular immersion of algebraic spaces. \end{lemma} 
\begin{lemma} \label{lemma-lci-properties} Let $S$ be a scheme. Let $f : X \to Y$ be a local complete intersection morphism of algebraic spaces over $S$. Then \begin{enumerate} \item $f$ is locally of finite presentation, \item $f$ is pseudo-coherent, and \item $f$ is perfect. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-flat-base-change-lci} A flat base change of a local complete intersection morphism is a local complete intersection morphism. \end{lemma} 
\begin{lemma} \label{lemma-composition-lci} A composition of local complete intersection morphisms is a local complete intersection morphism. \end{lemma} 
\begin{lemma} \label{lemma-flat-lci} \begin{slogan} Syntomic equals flat plus lci (for algebraic spaces). \end{slogan} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent \begin{enumerate} \item $f$ is flat and a local complete intersection morphism, and \item $f$ is syntomic. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-regular-immersion-lci} Let $S$ be a scheme. A Koszul-regular immersion of algebraic spaces over $S$ is a local complete intersection morphism. \end{lemma} 
\begin{lemma} \label{lemma-lci-permanence} Let $S$ be a scheme. Let $$ \xymatrix{ X \ar[rr]_f \ar[rd] & & Y \ar[ld] \\ & Z } $$ be a commutative diagram of morphisms of algebraic spaces over $S$. Assume $Y \to Z$ is smooth and $X \to Z$ is a local complete intersection morphism. Then $f : X \to Y$ is a local complete intersection morphism. \end{lemma} 
\begin{lemma} \label{lemma-descending-property-lci} The property $\mathcal{P}(f) =$``$f$ is a local complete intersection morphism'' is fpqc local on the base. \end{lemma} 
\begin{lemma} \label{lemma-lci-syntomic-local-source} The property $\mathcal{P}(f) =$``$f$ is a local complete intersection morphism'' is syntomic local on the source. \end{lemma} 
\begin{lemma} \label{lemma-base-change-lci-fibres} Let $S$ be a scheme. Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces over $S$. Assume that both $p$ and $q$ are flat and locally of finite presentation. Then there exists an open subspace $U(f) \subset X$ such that $|U(f)| \subset |X|$ is the set of points where $f$ is Koszul. Moreover, for any morphism of algebraic spaces $Z' \to Z$, if $f' : X' \to Y'$ is the base change of $f$ by $Z' \to Z$, then $U(f')$ is the inverse image of $U(f)$ under the projection $X' \to X$. \end{lemma} 
\begin{lemma} \label{lemma-unramified-lci} Let $S$ be a scheme. Let $f : X \to Y$ be a local complete intersection morphism of algebraic spaces over $S$. Then $f$ is unramified if and only if $f$ is formally unramified and in this case the conormal sheaf $\mathcal{C}_{X/Y}$ is finite locally free on $X$. \end{lemma} 
\begin{lemma} \label{lemma-transitivity-conormal-lci} Let $S$ be a scheme. Let $Z \to Y \to X$ be formally unramified morphisms of algebraic spaces over $S$. Assume that $Z \to Y$ is a local complete intersection morphism. The exact sequence $$ 0 \to i^*\mathcal{C}_{Y/X} \to \mathcal{C}_{Z/X} \to \mathcal{C}_{Z/Y} \to 0 $$ of Lemma \ref{lemma-transitivity-conormal} is short exact. \end{lemma} 
\begin{lemma} \label{lemma-where-unramified} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that $p$ is locally of finite type and closed. Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified. \end{lemma} 
\begin{lemma} \label{lemma-where-unramified-universally-injective} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is locally of finite type, \item $p$ is closed, and \item $p_2 : X \times_Y X \to Z$ is closed. \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified and universally injective. \end{lemma} 
\begin{lemma} \label{lemma-where-closed-immersion} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is locally of finite type, \item $p$ is universally closed, and \item $q : Y \to Z$ is separated. \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a closed immersion. \end{lemma} 
\begin{lemma} \label{lemma-where-flat} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is locally of finite presentation, \item $p$ is flat, \item $p$ is closed, and \item $q$ is locally of finite type. \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-where-surjective-flat} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is locally of finite presentation, \item $p$ is flat, \item $p$ is closed, \item $q$ is locally of finite type, and \item $q$ is closed. \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is surjective and flat. \end{lemma} 
\begin{lemma} \label{lemma-where-isomorphism} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is locally of finite presentation, \item $p$ is flat, \item $p$ is universally closed, \item $q$ is locally of finite type, \item $q$ is closed, and \item $q$ is separated. \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-where-lci} Consider a commutative diagram $$ \xymatrix{ X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\ & Z } $$ of algebraic spaces. Assume that \begin{enumerate} \item $p$ is flat and locally of finite presentation, \item $p$ is closed, and \item $q$ is flat and locally of finite presentation, \end{enumerate} Then there exists an open subspace $W \subset Z$ such that a morphism $Z' \to Z$ factors through $W$ if and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a local complete intersection morphism. \end{lemma} 
\begin{lemma} \label{lemma-case-of-tor-independence} Let $S$ be a scheme. Consider a commutative diagram of algebraic spaces $$ \xymatrix{ Z' \ar[d] \ar[r] & Y' \ar[d] \\ X' \ar[r] & B' } $$ over $S$. Let $B \to B'$ be a morphism. Denote by $X$ and $Y$ the base changes of $X'$ and $Y'$ to $B$. Assume $Y' \to B'$ and $Z' \to X'$ are flat. Then $X \times_B Y$ and $Z'$ are Tor independent over $X' \times_{B'} Y'$. \end{lemma} 
\begin{lemma}[Derived Chow's lemma] \label{lemma-derived-chow} Let $A$ be a ring. Let $X$ be a separated algebraic space of finite presentation over $A$. Let $x \in |X|$. Then there exist an $n \geq 0$, a closed subspace $Z \subset X \times_A \mathbf{P}^n_A$, a point $z \in |Z|$, an open $V \subset \mathbf{P}^n_A$, and an object $E$ in $D(\mathcal{O}_{X \times_A \mathbf{P}^n_A})$ such that \begin{enumerate} \item $Z \to X \times_A \mathbf{P}^n_A$ is of finite presentation, \item $c : Z \to \mathbf{P}^n_A$ is a closed immersion over $V$, set $W = c^{-1}(V)$, \item the restriction of $b : Z \to X$ to $W$ is \'etale, $z \in W$, and $b(z) = x$, \item $E|_{X \times_A V} \cong (b, c)_*\mathcal{O}_Z|_{X \times_A V}$, \item $E$ is pseudo-coherent and supported on $Z$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-compute-Fourier-Mukai-for-derived-chow} Let $X/A$, $x \in |X|$, and $n, Z, z, V, E$ be as in Lemma \ref{lemma-derived-chow}. For any $K \in D_\QCoh(\mathcal{O}_X)$ we have $$ Rq_*(Lp^*K \otimes^\mathbf{L} E)|_V = R(W \to V)_*K|_W $$ where $p : X \times_A \mathbf{P}^n_A \to X$ and $q : X \times_A \mathbf{P}^n_A \to \mathbf{P}^n_A$ are the projections and where the morphism $W \to V$ is the finitely presented closed immersion $c|_W : W \to V$. \end{lemma} 
\begin{lemma} \label{lemma-characterize-pseudo-coherent} Let $A$ be a ring. Let $X$ be an algebraic space separated and of finite presentation over $A$. Let $K \in D_\QCoh(\mathcal{O}_X)$. If $R\Gamma(X, E \otimes^\mathbf{L} K)$ is pseudo-coherent in $D(A)$ for every pseudo-coherent $E$ in $D(\mathcal{O}_X)$, then $K$ is pseudo-coherent relative to $A$ (Definition \ref{definition-relative-pseudo-coherence}). \end{lemma} 
\begin{lemma} \label{lemma-characterize-pseudo-coh-improved} Let $A$ be a ring. Let $X$ be an algebraic space separated and of finite presentation over $A$. Let $K \in D_\QCoh(\mathcal{O}_X)$. If  $R \Gamma (X, E \otimes ^{\mathbf{L}} K)$ is pseudo-coherent in $D(A)$ for every perfect  $E \in D(\mathcal{O}_X)$, then $K$ is pseudo-coherent relative to $A$. \end{lemma} 
\begin{definition} \label{definition-relatively-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. An object $E$ of $D(\mathcal{O}_X)$ is {\it perfect relative to $Y$} or {\it $Y$-perfect} if $E$ is pseudo-coherent (Cohomology on Sites, Definition \ref{sites-cohomology-definition-pseudo-coherent}) and $E$ locally has finite tor dimension as an object of $D(f^{-1}\mathcal{O}_Y)$ (Cohomology on Sites, Definition \ref{sites-cohomology-definition-tor-amplitude}). \end{definition} 
\begin{lemma} \label{lemma-affine-locally-rel-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. Let $E \in D_\QCoh(\mathcal{O}_X)$. The following are equivalent: \begin{enumerate} \item $E$ is $Y$-perfect, \item for every commutative diagram $$ \xymatrix{ U \ar[d] \ar[r]_g & V \ar[d] \\ X \ar[r]^f & Y } $$ where $U$, $V$ are schemes and the vertical arrows are \'etale, the complex $E|_U$ is $V$-perfect in the sense of Derived Categories of Schemes, Definition \ref{perfect-definition-relatively-perfect}, \item for some commutative diagram as in (2) with $U \to X$ surjective, the complex $E|_U$ is $V$-perfect in the sense of Derived Categories of Schemes, Definition \ref{perfect-definition-relatively-perfect}, \item for every commutative diagram as in (2) with $U$ and $V$ affine the complex $R\Gamma(U, E)$ is $\mathcal{O}_Y(V)$-perfect. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-triangulated} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. The full subcategory of $D(\mathcal{O}_X)$ consisting of $Y$-perfect objects is a saturated\footnote{Derived Categories, Definition \ref{derived-definition-saturated}.} triangulated subcategory. \end{lemma} 
\begin{lemma} \label{lemma-perfect-relatively-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. A perfect object of $D(\mathcal{O}_X)$ is $Y$-perfect. If $K, M \in D(\mathcal{O}_X)$, then $K \otimes_{\mathcal{O}_X}^\mathbf{L} M$ is $Y$-perfect if $K$ is perfect and $M$ is $Y$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-base-change-relatively-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. Let $g : Y' \to Y$ be a morphism of algebraic spaces over $S$. Set $X' = Y' \times_Y X$ and denote $g' : X' \to X$ the projection. If $K \in D(\mathcal{O}_X)$ is $Y$-perfect, then $L(g')^*K$ is $Y'$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-relative-descend-homomorphisms} In Situation \ref{situation-relative-descent}. Let $K_0$ and $L_0$ be objects of $D(\mathcal{O}_{X_0})$. Set $K_i = Lf_{i0}^*K_0$ and $L_i = Lf_{i0}^*L_0$ for $i \geq 0$ and set $K = Lf_0^*K_0$ and $L = Lf_0^*L_0$. Then the map $$ \colim_{i \geq 0} \Hom_{D(\mathcal{O}_{X_i})}(K_i, L_i) \longrightarrow \Hom_{D(\mathcal{O}_X)}(K, L) $$ is an isomorphism if $K_0$ is pseudo-coherent and $L_0 \in D_\QCoh(\mathcal{O}_{X_0})$ has (locally) finite tor dimension as an object of $D((X_0 \to Y_0)^{-1}\mathcal{O}_{Y_0})$ \end{lemma} 
\begin{lemma} \label{lemma-descend-relatively-perfect} In Situation \ref{situation-relative-descent} the category of $Y$-perfect objects of $D(\mathcal{O}_X)$ is the colimit of the categories of $Y_i$-perfect objects of $D(\mathcal{O}_{X_i})$. \end{lemma} 
\begin{lemma} \label{lemma-derived-pushforward-rel-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat, proper, and of finite presentation. Let $E \in D(\mathcal{O}_X)$ be $Y$-perfect. Then $Rf_*E$ is a perfect object of $D(\mathcal{O}_Y)$ and its formation commutes with arbitrary base change. \end{lemma} 
\begin{lemma} \label{lemma-compute-ext-rel-perfect} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Let $E, K \in D(\mathcal{O}_X)$. Assume \begin{enumerate} \item $Y$ is quasi-compact and quasi-separated, \item $f$ is proper, flat, and of finite presentation, \item $E$ is $Y$-perfect, \item $K$ is pseudo-coherent. \end{enumerate} Then there exists a pseudo-coherent $L \in D(\mathcal{O}_Y)$ such that $$ Rf_*R\SheafHom(K, E) = R\SheafHom(L, \mathcal{O}_Y) $$ and the same is true after arbitrary base change: given $$ \vcenter{ \xymatrix{ X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } } \quad\quad \begin{matrix} \text{cartesian, then we have } \\ Rf'_*R\SheafHom(L(g')^*K, L(g')^*E) \\ = R\SheafHom(Lg^*L, \mathcal{O}_{Y'}) \end{matrix} $$ \end{lemma} 
\begin{lemma} \label{lemma-bounded-on-fibres} Let $S$ be a scheme. Let $X$ be an algebraic space over $S$ such that the structure morphism $f : X \to S$ is flat and locally of finite presentation. Let $E$ be a pseudo-coherent object of $D(\mathcal{O}_X)$. The following are equivalent \begin{enumerate} \item $E$ is $S$-perfect, and \item $E$ is locally bounded below and for every point $s \in S$ the object $L(X_s \to X)^*E$ of $D(\mathcal{O}_{X_s})$ is locally bounded below. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-characterize-relatively-perfect} Let $A$ be a ring. Let $X$ be an algebraic space separated, of finite presentation, and flat over $A$. Let $K \in D_\QCoh(\mathcal{O}_X)$. If  $R \Gamma (X, E \otimes^\mathbf{L} K)$ is perfect in $D(A)$ for every perfect $E \in D(\mathcal{O}_X)$, then $K$ is $\Spec(A)$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-diagonal-picard-flat-proper} Let $S$ be a scheme. Let $f : X \to Y$ be a flat, proper morphism of finite presentation of algebraic spaces over $S$. Let $\mathcal{E}$ be a finite locally free $\mathcal{O}_X$-module. For a morphism $g : Y' \to Y$ consider the base change diagram $$ \xymatrix{ X' \ar[d]_{f'} \ar[r]_{g'} & X \ar[d]^f \\ Y' \ar[r]^g & Y } $$ Assume $\mathcal{O}_{Y'} \to f'_*\mathcal{O}_{X'}$ is an isomorphism for all $g : Y' \to Y$. Then there exists an immersion $j : Z \to Y$ of finite presentation such that a morphism $g : Y' \to Y$ factors through $Z$ if and only if there exists a finite locally free $\mathcal{O}_{Y'}$-module $\mathcal{N}$ with $(f')^*\mathcal{N} \cong (g')^*\mathcal{L}$. \end{lemma} 
\begin{lemma} \label{lemma-pseudo-coherent-descends-fpqc} Let $S$ be a scheme. Let $\{f_i : X_i \to X\}$ be an fpqc covering of algebraic spaces over $S$. Let $E \in D_\QCoh(\mathcal{O}_X)$. Let $m \in \mathbf{Z}$. Then $E$ is $m$-pseudo-coherent if and only if each $Lf_i^*E$ is $m$-pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-tor-amplitude-descends-fppf} Let $S$ be a scheme. Let $\{g_i : Y_i \to Y\}$ be an fpqc covering of algebraic spaces over $S$. Let $f : X \to Y$ be a morphism of algebraic spaces and set $X_i = Y_i \times_Y X$ with projections $f_i : X_i \to Y_i$ and $g'_i : X_i \to X$. Let $E \in D_\QCoh(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$. Then the following are equivalent \begin{enumerate} \item $E$ has tor amplitude in $[a, b]$ as an object of $D(f^{-1}\mathcal{O}_Y)$, and \item $L(g'_i)^*E$ has tor amplitude in $[a, b]$ as a object of $D(f_i^{-1}\mathcal{O}_{Y_i})$ for all $i$. \end{enumerate} Also true if ``tor amplitude in $[a, b]$'' is replaced by ``locally finite tor dimension''. \end{lemma} 
\begin{lemma} \label{lemma-thickening-pseudo-coherent} Let $S$ be a scheme. Let $i : X \to X'$ be a finite order thickening of algebraic spaces. Let $K' \in D(\mathcal{O}_{X'})$ be an object such that $K = Li^*K'$ is pseudo-coherent. Then $K'$ is pseudo-coherent. \end{lemma} 
\begin{lemma} \label{lemma-thickening-relatively-perfect} Let $S$ be a scheme. Consider a cartesian diagram $$ \xymatrix{ X \ar[r]_i \ar[d]_f & X' \ar[d]^{f'} \\ Y \ar[r]^j & Y' } $$ of algebraic spaces over $S$. Assume $X' \to Y'$ is flat and locally of finite presentation and $Y \to Y'$ is a finite order thickening. Let $E' \in D(\mathcal{O}_{X'})$. If $E = Li^*(E')$ is $Y$-perfect, then $E'$ is $Y'$-perfect. \end{lemma} 
\begin{lemma} \label{lemma-henselian-relatively-perfect} Let $(R, I)$ be a pair consisting of a ring and an ideal $I$ contained in the Jacobson radical. Set $S = \Spec(R)$ and $S_0 = \Spec(R/I)$. Let $X$ be an algebraic space over $R$ whose structure morphism $f : X \to S$ is proper, flat, and of finite presentation. Denote $X_0 = S_0 \times_S X$. Let $E \in D(\mathcal{O}_X)$ be pseudo-coherent. If the derived restriction $E_0$ of $E$ to $X_0$ is $S_0$-perfect, then $E$ is $S$-perfect. \end{lemma} 
\begin{definition} \label{definition-nodal-family} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. We say $f$ is {\it at-worst-nodal of relative dimension $1$} if the equivalent conditions of Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-local-source-target} hold with $\mathcal{P} =$``at-worst-nodal of relative dimension $1$''. \end{definition} 
\begin{lemma} \label{lemma-base-change-nodal} The property of being at-worst-nodal of relative dimension $1$ is preserved under base change. \end{lemma} 
\begin{lemma} \label{lemma-nodal-local} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. The following are equivalent: \begin{enumerate} \item $f$ is at-worst-nodal of relative dimension $1$, \item for every scheme $Z$ and any morphism $Z \to Y$ the morphism $Z \times_Y X \to Z$ is at-worst-nodal of relative dimension $1$, \item for every affine scheme $Z$ and any morphism $Z \to Y$ the morphism $Z \times_Y X \to Z$ is at-worst-nodal of relative dimension $1$, \item there exists a scheme $V$ and a surjective \'etale morphism $V \to Y$ such that $V \times_Y X \to V$ is at-worst-nodal of relative dimension $1$, \item there exists a scheme $U$ and a surjective \'etale morphism $\varphi : U \to X$ such that the composition $f \circ \varphi$ is at-worst-nodal of relative dimension $1$, \item for every commutative diagram $$ \xymatrix{ U \ar[d] \ar[r] & V \ar[d] \\ X \ar[r] & Y } $$ where $U$, $V$ are schemes and the vertical arrows are \'etale the top horizontal arrow is at-worst-nodal of relative dimension $1$, \item there exists a commutative diagram $$ \xymatrix{ U \ar[d] \ar[r] & V \ar[d] \\ X \ar[r] & Y } $$ where $U$, $V$ are schemes, the vertical arrows are \'etale, and $U \to X$ is surjective such that the top horizontal arrow is at-worst-nodal of relative dimension $1$, and \item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$, and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that each morphism $X_{ij} \to Y_i$ is at-worst-nodal of relative dimension $1$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-locus-where-nodal} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over $S$ which is flat and locally of finite presentation. Then there is a maximal open subspace $X' \subset X$ such that $f|_{X'} : X' \to Y$ is at-worst-nodal of relative dimension $1$. Moreover, formation of $X'$ commutes with arbitrary base change. \end{lemma} 
\begin{lemma} \label{lemma-surjection-in-Noetherian-case} In Situation \ref{situation-descend-resolution-property}, assume $X$ is Noetherian. Then for any coherent $\mathcal{O}_X$-module $\mathcal{F}$ there exist $r \geq 0$, integers $n_1, \ldots, n_r \geq 0$, and a surjection $$ \bigoplus\nolimits_{i = 1, \ldots, r} \pi_*(\mathcal{I}^{n_i}) \longrightarrow \mathcal{F} $$ of $\mathcal{O}_X$-modules. \end{lemma} 
\begin{lemma} \label{lemma-resolution-property-in-Noetherian-case} In Situation \ref{situation-descend-resolution-property}, assume $X$ is Noetherian. Then $X$ has the resolution property if and only if $\pi_*\mathcal{I}$ is the quotient of a finite locally free $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-resolution-property-one-sheaf} In Situation \ref{situation-descend-resolution-property}, the algebraic space $X$ has the resolution property if and only if $\pi_*\mathcal{I}$ is the quotient of a finite locally free $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-resolution-property-descends} Let $S$ be a scheme. Let $X = \lim X_i$ be a limit of a direct system of quasi-compact and quasi-separated algebraic spaces over $S$ with affine transition morphisms. Then $X$ has the resolution property if and only if $X_i$ has the resolution properties for some $i$. \end{lemma} 
\begin{lemma} \label{lemma-resolution-property-affine-diagonal} Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated algebraic space with the resolution property. Then $X$ has affine diagonal over $\mathbf{Z}$ (as in Properties of Spaces, Definition \ref{spaces-properties-definition-separated}). \end{lemma} 
\begin{lemma} \label{lemma-blow-up-resolution-property} Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$. Assume that $|X|$ has finitely many irreducible components. There exists a dense quasi-compact open $U \subset X$ and a $U$-admissible blowing up $X' \to X$ such that the algebraic space $X'$ has the resolution property. \end{lemma} 
\begin{lemma} \label{lemma-blow-up-resolution-property-filtered} Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$. There exists a $t \geq 0$ and closed subspaces $$ X \supset Z_0 \supset Z_1 \supset \ldots \supset Z_t = \emptyset $$ such that $Z_i \to X$ is of finite presentation, $Z_0 \subset X$ is a thickening, and for each $i = 0, \ldots t - 1$ there exists a $(Z_i \setminus Z_{i - 1})$-admissible blowing up $Z'_i \to Z_i$ such that $Z'_i$ has the resolution property. \end{lemma} 
