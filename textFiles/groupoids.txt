\begin{definition} \label{definition-equivalence-relation} Let $S$ be a scheme. Let $U$ be a scheme over $S$. \begin{enumerate} \item A {\it pre-relation} on $U$ over $S$ is any morphism of schemes $j : R \to U \times_S U$. In this case we set $t = \text{pr}_0 \circ j$ and $s = \text{pr}_1 \circ j$, so that $j = (t, s)$. \item A {\it relation} on $U$ over $S$ is a monomorphism of schemes $j : R \to U \times_S U$. \item A {\it pre-equivalence relation} is a pre-relation $j : R \to U \times_S U$ such that the image of $j : R(T) \to U(T) \times U(T)$ is an equivalence relation for all $T/S$. \item We say a morphism $R \to U \times_S U$ of schemes is an {\it equivalence relation on $U$ over $S$} if and only if for every scheme $T$ over $S$ the $T$-valued points of $R$ define an equivalence relation on the set of $T$-valued points of $U$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-restrict-relation} Let $S$ be a scheme. Let $U$ be a scheme over $S$. Let $j : R \to U \times_S U$ be a pre-relation. Let $g : U' \to U$ be a morphism of schemes. Finally, set $$ R' = (U' \times_S U')\times_{U \times_S U} R \xrightarrow{j'} U' \times_S U' $$ Then $j'$ is a pre-relation on $U'$ over $S$. If $j$ is a relation, then $j'$ is a relation. If $j$ is a pre-equivalence relation, then $j'$ is a pre-equivalence relation. If $j$ is an equivalence relation, then $j'$ is an equivalence relation. \end{lemma} 
\begin{definition} \label{definition-restrict-relation} Let $S$ be a scheme. Let $U$ be a scheme over $S$. Let $j : R \to U \times_S U$ be a pre-relation. Let $g : U' \to U$ be a morphism of schemes. The pre-relation $j' : R' \to U' \times_S U'$ is called the {\it restriction}, or {\it pullback} of the pre-relation $j$ to $U'$. In this situation we sometimes write $R' = R|_{U'}$. \end{definition} 
\begin{lemma} \label{lemma-pre-equivalence-equivalence-relation-points} Let $j : R \to U \times_S U$ be a pre-relation. Consider the relation on points of the scheme $U$ defined by the rule $$ x \sim y \Leftrightarrow \exists\ r \in R : t(r) = x, s(r) = y. $$ If $j$ is a pre-equivalence relation then this is an equivalence relation. \end{lemma} 
\begin{lemma} \label{lemma-etale-equivalence-relation} Let $j : R \to U \times_S U$ be a pre-relation. Assume \begin{enumerate} \item $s, t$ are unramified, \item for any algebraically closed field $k$ over $S$ the map $R(k) \to U(k) \times U(k)$ is an equivalence relation, \item there are morphisms $e : U \to R$, $i : R \to R$, $c : R \times_{s, U, t} R \to R$ such that $$ \xymatrix{ U \ar[r]_e \ar[d]_\Delta & R \ar[d]_j & R \ar[d]^j \ar[r]_i & R \ar[d]^j & R \times_{s, U, t} R \ar[d]^{j \times j} \ar[r]_c & R \ar[d]^j \\ U \times_S U \ar[r] & U \times_S U & U \times_S U \ar[r]^{flip} & U \times_S U & U \times_S U \times_S U \ar[r]^{\text{pr}_{02}} & U \times_S U } $$ are commutative. \end{enumerate} Then $j$ is an equivalence relation. \end{lemma} 
\begin{definition} \label{definition-group-scheme} Let $S$ be a scheme. \begin{enumerate} \item A {\it group scheme over $S$} is a pair $(G, m)$, where $G$ is a scheme over $S$ and $m : G \times_S G \to G$ is a morphism of schemes over $S$ with the following property: For every scheme $T$ over $S$ the pair $(G(T), m)$ is a group. \item A {\it morphism $\psi : (G, m) \to (G', m')$ of group schemes over $S$} is a morphism $\psi : G \to G'$ of schemes over $S$ such that for every $T/S$ the induced map $\psi : G(T) \to G'(T)$ is a homomorphism of groups. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-base-change-group-scheme} Let $(G, m)$ be a group scheme over $S$. Let $S' \to S$ be a morphism of schemes. The pullback $(G_{S'}, m_{S'})$ is a group scheme over $S'$. \end{lemma} 
\begin{definition} \label{definition-closed-subgroup-scheme} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. \begin{enumerate} \item A {\it closed subgroup scheme} of $G$ is a closed subscheme $H \subset G$ such that $m|_{H \times_S H}$ factors through $H$ and induces a group scheme structure on $H$ over $S$. \item An {\it open subgroup scheme} of $G$ is an open subscheme $G' \subset G$ such that $m|_{G' \times_S G'}$ factors through $G'$ and induces a group scheme structure on $G'$ over $S$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-closed-subgroup-scheme} Let $S$ be a scheme. Let $(G, m, e, i)$ be a group scheme over $S$. \begin{enumerate} \item A closed subscheme $H \subset G$ is a closed subgroup scheme if and only if $e : S \to G$, $m|_{H \times_S H} : H \times_S H \to G$, and $i|_H : H \to G$ factor through $H$. \item An open subscheme $H \subset G$ is an open subgroup scheme if and only if $e : S \to G$, $m|_{H \times_S H} : H \times_S H \to G$, and $i|_H : H \to G$ factor through $H$. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-smooth-group-scheme} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. \begin{enumerate} \item We say $G$ is a {\it smooth group scheme} if the structure morphism $G \to S$ is smooth. \item We say $G$ is a {\it flat group scheme} if the structure morphism $G \to S$ is flat. \item We say $G$ is a {\it separated group scheme} if the structure morphism $G \to S$ is separated. \end{enumerate} Add more as needed. \end{definition} 
\begin{lemma} \label{lemma-group-scheme-separated} Let $S$ be a scheme. Let $G$ be a group scheme over $S$. Then $G \to S$ is separated (resp.\ quasi-separated) if and only if the identity morphism $e : S \to G$ is a closed immersion (resp.\ quasi-compact). \end{lemma} 
\begin{lemma} \label{lemma-flat-action-on-group-scheme} Let $S$ be a scheme. Let $G$ be a group scheme over $S$. Let $T$ be a scheme over $S$ and let $\psi : T \to G$ be a morphism over $S$. If $T$ is flat over $S$, then the morphism $$ T \times_S G \longrightarrow G, \quad (t, g) \longmapsto m(\psi(t), g) $$ is flat. In particular, if $G$ is flat over $S$, then $m : G \times_S G \to G$ is flat. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-module-differentials} \begin{reference} \cite[Proposition 3.15]{BookAV} \end{reference} Let $(G, m, e, i)$ be a group scheme over the scheme $S$. Denote $f : G \to S$ the structure morphism. Then there exist canonical isomorphisms $$ \Omega_{G/S} \cong f^*\mathcal{C}_{S/G} \cong f^*e^*\Omega_{G/S} $$ where $\mathcal{C}_{S/G}$ denotes the conormal sheaf of the immersion $e$. In particular, if $S$ is the spectrum of a field, then $\Omega_{G/S}$ is a free $\mathcal{O}_G$-module. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-addition-tangent-vectors} Let $S$ be a scheme. Let $G$ be a group scheme over $S$. Let $s \in S$. Then the composition $$ T_{G/S, e(s)} \oplus T_{G/S, e(s)} = T_{G \times_S G/S, (e(s), e(s))} \rightarrow T_{G/S, e(s)} $$ is addition of tangent vectors. Here the $=$ comes from Varieties, Lemma \ref{varieties-lemma-tangent-space-product} and the right arrow is induced from $m : G \times_S G \to G$ via Varieties, Lemma \ref{varieties-lemma-map-tangent-spaces}. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-over-field-open-multiplication} If $(G, m)$ is a group scheme over a field $k$, then the multiplication map $m : G \times_k G \to G$ is open. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-over-field-translate-open} If $(G, m)$ is a group scheme over a field $k$. Let $U \subset G$ open and $T \to G$ a morphism of schemes. Then the image of the composition $T \times_k U \to G \times_k G \to G$ is open. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-over-field-separated} Let $G$ be a group scheme over a field. Then $G$ is a separated scheme. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-field-geometrically-irreducible} Let $G$ be a group scheme over a field $k$. Then \begin{enumerate} \item every local ring $\mathcal{O}_{G, g}$ of $G$ has a unique minimal prime ideal, \item there is exactly one irreducible component $Z$ of $G$ passing through $e$, and \item $Z$ is geometrically irreducible over $k$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-reduced-subgroup-scheme-perfect} Let $G$ be a group scheme over a perfect field $k$. Then the reduction $G_{red}$ of $G$ is a closed subgroup scheme of $G$. \end{lemma} 
\begin{lemma} \label{lemma-open-subgroup-closed-over-field} Let $k$ be a field. Let $\psi : G' \to G$ be a morphism of group schemes over $k$. If $\psi(G')$ is open in $G$, then $\psi(G')$ is closed in $G$. \end{lemma} 
\begin{lemma} \label{lemma-immersion-group-schemes-closed-over-field} Let $i : G' \to G$ be an immersion of group schemes over a field $k$. Then $i$ is a closed immersion, i.e., $i(G')$ is a closed subgroup scheme of $G$. \end{lemma} 
\begin{lemma} \label{lemma-irreducible-group-scheme-over-field-qc} Let $G$ be a group scheme over a field $k$. If $G$ is irreducible, then $G$ is quasi-compact. \end{lemma} 
\begin{lemma} \label{lemma-connected-group-scheme-over-field-irreducible} Let $G$ be a group scheme over a field $k$. If $G$ is connected, then $G$ is irreducible. \end{lemma} 
\begin{proposition} \label{proposition-connected-component} Let $G$ be a group scheme over a field $k$. There exists a canonical closed subgroup scheme $G^0 \subset G$ with the following properties \begin{enumerate} \item $G^0 \to G$ is a flat closed immersion, \item $G^0 \subset G$ is the connected component of the identity, \item $G^0$ is geometrically irreducible, and \item $G^0$ is quasi-compact. \end{enumerate} \end{proposition} 
\begin{lemma} \label{lemma-profinite-product-over-field} Let $k$ be a field. Let $T = \Spec(A)$ where $A$ is a directed colimit of algebras which are finite products of copies of $k$. For any scheme $X$ over $k$ we have $|T \times_k X| = |T| \times |X|$ as topological spaces. \end{lemma} 
\begin{lemma} \label{lemma-compact-set-in-affine} Let $k$ be an algebraically closed field. Let $G$ be a group scheme over $k$. Assume that $G$ is Jacobson and that all closed points are $k$-rational. Let $T = \Spec(A)$ where $A$ is a directed colimit of algebras which are finite products of copies of $k$. For any morphism $f : T \to G$ there exists an affine open $U \subset G$ containing $f(T)$. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-field-countable-affine} Let $G$ be a group scheme over a field. There exists an open and closed subscheme $G' \subset G$ which is a countable union of affines. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-finite-type-field} Let $k$ be a field. Let $G$ be a locally algebraic group scheme over $k$. Then $G$ is equidimensional and $\dim(G) = \dim_g(G)$ for all $g \in G$. For any closed point $g \in G$ we have $\dim(G) = \dim(\mathcal{O}_{G, g})$. \end{lemma} 
\begin{lemma} \label{lemma-group-scheme-characteristic-zero-smooth} Let $k$ be a field of characteristic $0$. Let $G$ be a locally algebraic group scheme over $k$. Then the structure morphism $G \to \Spec(k)$ is smooth, i.e., $G$ is a smooth group scheme. \end{lemma} 
\begin{lemma} \label{lemma-reduced-group-scheme-prefect-field-characteristic-p-smooth} Let $k$ be a perfect field of characteristic $p > 0$ (see Lemma \ref{lemma-group-scheme-characteristic-zero-smooth} for the characteristic zero case). Let $G$ be a locally algebraic group scheme over $k$. If $G$ is reduced then the structure morphism $G \to \Spec(k)$ is smooth, i.e., $G$ is a smooth group scheme. \end{lemma} 
\begin{lemma} \label{lemma-points-in-affine} Let $k$ be an algebraically closed field. Let $G$ be a locally algebraic group scheme over $k$. Let $g_1, \ldots, g_n \in G(k)$ be $k$-rational points. Then there exists an affine open $U \subset G$ containing $g_1, \ldots, g_n$. \end{lemma} 
\begin{lemma} \label{lemma-algebraic-quasi-projective} Let $k$ be a field. Let $G$ be an algebraic group scheme over $k$. Then $G$ is quasi-projective over $k$. \end{lemma} 
\begin{lemma} \label{lemma-algebraic-center} Let $k$ be a field. Let $G$ be a locally algebraic group scheme over $k$. Then the center of $G$ is a closed subgroup scheme of $G$. \end{lemma} 
\begin{definition} \label{definition-abelian-variety} Let $k$ be a field. An {\it abelian variety} is a group scheme over $k$ which is also a proper, geometrically integral variety over $k$\footnote{For equivalent definitions see Remark \ref{remark-16-equivalent}.}. \end{definition} 
\begin{lemma} \label{lemma-abelian-variety-projective} Let $k$ be a field. Let $A$ be an abelian variety over $k$. Then $A$ is projective. \end{lemma} 
\begin{lemma} \label{lemma-abelian-variety-change-field} Let $k$ be a field. Let $A$ be an abelian variety over $k$. For any field extension $K/k$ the base change $A_K$ is an abelian variety over $K$. \end{lemma} 
\begin{lemma} \label{lemma-abelian-variety-smooth} Let $k$ be a field. Let $A$ be an abelian variety over $k$. Then $A$ is smooth over $k$. \end{lemma} 
\begin{lemma} \label{lemma-abelian-variety-abelian} An abelian variety is an abelian group scheme, i.e., the group law is commutative. \end{lemma} 
\begin{lemma} \label{lemma-apply-cube} Let $k$ be a field. Let $A$ be an abelian variety over $k$. Let $\mathcal{L}$ be an invertible $\mathcal{O}_A$-module. Then there is an isomorphism $$ m_{1, 2, 3}^*\mathcal{L} \otimes m_1^*\mathcal{L} \otimes m_2^*\mathcal{L} \otimes m_3^*\mathcal{L} \cong m_{1, 2}^*\mathcal{L} \otimes m_{1, 3}^*\mathcal{L} \otimes m_{2, 3}^*\mathcal{L} $$ of invertible modules on $A \times_k A \times_k A$ where $m_{i_1, \ldots, i_t} : A \times_k A \times_k A \to A$ is the morphism $(x_1, x_2, x_3) \mapsto \sum x_{i_j}$. \end{lemma} 
\begin{lemma} \label{lemma-pullbacks-by-n} Let $k$ be a field. Let $A$ be an abelian variety over $k$. Let $\mathcal{L}$ be an invertible $\mathcal{O}_A$-module. Then $$ [n]^*\mathcal{L} \cong \mathcal{L}^{\otimes n(n + 1)/2} \otimes ([-1]^*\mathcal{L})^{\otimes n(n - 1)/2} $$ where $[n] : A \to A$ sends $x$ to $x + x + \ldots + x$ with $n$ summands and where $[-1] : A \to A$ is the inverse of $A$. \end{lemma} 
\begin{lemma} \label{lemma-degree-multiplication-by-d} Let $k$ be a field. Let $A$ be an abelian variety over $k$. Let $[d] : A \to A$ be the multiplication by $d$. Then $[d]$ is finite locally free of degree $d^{2\dim(A)}$. \end{lemma} 
\begin{lemma} \label{lemma-abelian-variety-multiplication-by-d-etale} \begin{slogan} Multiplication by an integer on an abelian variety is an etale morphism if and only if the integer is invertible in the base field. \end{slogan} Let $k$ be a field. Let $A$ be a nonzero abelian variety over $k$. Then $[d] : A \to A$ is \'etale if and only if $d$ is invertible in $k$. \end{lemma} 
\begin{lemma} \label{lemma-abelian-variety-multiplication-by-p} Let $k$ be a field of characteristic $p > 0$. Let $A$ be an abelian variety of dimension $g$ over $k$. The fibre of $[p] : A \to A$ over $0$ has at most $p^g$ distinct points. \end{lemma} 
\begin{proposition} \label{proposition-review-abelian-varieties} \begin{reference} Wonderfully explained in \cite{AVar}. \end{reference} Let $A$ be an abelian variety over a field $k$. Then \begin{enumerate} \item $A$ is projective over $k$, \item $A$ is a commutative group scheme, \item the morphism $[n] : A \to A$ is surjective for all $n \geq 1$, \item if $k$ is algebraically closed, then $A(k)$ is a divisible abelian group, \item $A[n] = \Ker([n] : A \to A)$ is a finite group scheme of degree $n^{2\dim A}$ over $k$, \item $A[n]$ is \'etale over $k$ if and only if $n \in k^*$, \item if $n \in k^*$ and $k$ is algebraically closed, then $A(k)[n] \cong (\mathbf{Z}/n\mathbf{Z})^{\oplus 2\dim(A)}$, \item if $k$ is algebraically closed of characteristic $p > 0$, then there exists an integer $0 \leq f \leq \dim(A)$ such that $A(k)[p^m] \cong (\mathbf{Z}/p^m\mathbf{Z})^{\oplus f}$ for all $m \geq 1$. \end{enumerate} \end{proposition} 
\begin{definition} \label{definition-action-group-scheme} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. \begin{enumerate} \item An {\it action of $G$ on the scheme $X/S$} is a morphism $a : G \times_S X \to X$ over $S$ such that for every $T/S$ the map $a : G(T) \times X(T) \to X(T)$ defines the structure of a $G(T)$-set on $X(T)$. \item Suppose that $X$, $Y$ are schemes over $S$ each endowed with an action of $G$. An {\it equivariant} or more precisely a {\it $G$-equivariant} morphism $\psi : X \to Y$ is a morphism of schemes over $S$ such that for every $T/S$ the map $\psi : X(T) \to Y(T)$ is a morphism of $G(T)$-sets. \end{enumerate} \end{definition} 
\begin{definition} \label{definition-free-action} Let $S$, $G \to S$, and $X \to S$ as in Definition \ref{definition-action-group-scheme}. Let $a : G \times_S X \to X$ be an action of $G$ on $X/S$. We say the action is {\it free} if for every scheme $T$ over $S$ the action $a : G(T) \times X(T) \to X(T)$ is a free action of the group $G(T)$ on the set $X(T)$. \end{definition} 
\begin{lemma} \label{lemma-free-action} Situation as in Definition \ref{definition-free-action}, The action $a$ is free if and only if $$ G \times_S X \to X \times_S X, \quad (g, x) \mapsto (a(g, x), x) $$ is a monomorphism. \end{lemma} 
\begin{definition} \label{definition-pseudo-torsor} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. Let $X$ be a scheme over $S$, and let $a : G \times_S X \to X$ be an action of $G$ on $X$. \begin{enumerate} \item We say $X$ is a {\it pseudo $G$-torsor} or that $X$ is {\it formally principally homogeneous under $G$} if the induced morphism of schemes $G \times_S X \to X \times_S X$, $(g, x) \mapsto (a(g, x), x)$ is an isomorphism of schemes over $S$. \item A pseudo $G$-torsor $X$ is called {\it trivial} if there exists an $G$-equivariant isomorphism $G \to X$ over $S$ where $G$ acts on $G$ by left multiplication. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-characterize-trivial-pseudo-torsors} In the situation of Definition \ref{definition-pseudo-torsor}. \begin{enumerate} \item The scheme $X$ is a pseudo $G$-torsor if and only if for every scheme $T$ over $S$ the set $X(T)$ is either empty or the action of the group $G(T)$ on $X(T)$ is simply transitive. \item A pseudo $G$-torsor $X$ is trivial if and only if the morphism $X \to S$ has a section. \end{enumerate} \end{lemma} 
\begin{definition} \label{definition-principal-homogeneous-space} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. Let $X$ be a pseudo $G$-torsor over $S$. \begin{enumerate} \item We say $X$ is a {\it principal homogeneous space} or a {\it $G$-torsor} if there exists a fpqc covering\footnote{This means that the default type of torsor is a pseudo torsor which is trivial on an fpqc covering. This is the definition in \cite[Expos\'e IV, 6.5]{SGA3}. It is a little bit inconvenient for us as we most often work in the fppf topology.} $\{S_i \to S\}_{i \in I}$ such that each $X_{S_i} \to S_i$ has a section (i.e., is a trivial pseudo $G_{S_i}$-torsor). \item Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$. We say $X$ is a {\it $G$-torsor in the $\tau$ topology}, or a {\it $\tau$ $G$-torsor}, or simply a {\it $\tau$ torsor} if there exists a $\tau$ covering $\{S_i \to S\}_{i \in I}$ such that each $X_{S_i} \to S_i$ has a section. \item If $X$ is a $G$-torsor, then we say that it is {\it quasi-isotrivial} if it is a torsor for the \'etale topology. \item If $X$ is a $G$-torsor, then we say that it is {\it locally trivial} if it is a torsor for the Zariski topology. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-torsor} Let $S$ be a scheme. Let $(G, m)$ be a group scheme over $S$. Let $X$ be a scheme over $S$, and let $a : G \times_S X \to X$ be an action of $G$ on $X$. Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$. Then $X$ is a $G$-torsor in the $\tau$-topology if and only if $\underline{X}$ is a $\underline{G}$-torsor on $(\Sch/S)_\tau$. \end{lemma} 
\begin{definition} \label{definition-equivariant-module} Let $S$ be a scheme, let $(G, m)$ be a group scheme over $S$, and let $a : G \times_S X \to X$ be an action of the group scheme $G$ on $X/S$. A {\it $G$-equivariant quasi-coherent $\mathcal{O}_X$-module}, or simply an {\it equivariant quasi-coherent $\mathcal{O}_X$-module}, is a pair $(\mathcal{F}, \alpha)$, where $\mathcal{F}$ is a quasi-coherent $\mathcal{O}_X$-module, and $\alpha$ is a $\mathcal{O}_{G \times_S X}$-module map $$ \alpha : a^*\mathcal{F} \longrightarrow \text{pr}_1^*\mathcal{F} $$ where $\text{pr}_1 : G \times_S X \to X$ is the projection such that \begin{enumerate} \item the diagram $$ \xymatrix{ (1_G \times a)^*\text{pr}_1^*\mathcal{F} \ar[r]_-{\text{pr}_{12}^*\alpha} & \text{pr}_2^*\mathcal{F} \\ (1_G \times a)^*a^*\mathcal{F} \ar[u]^{(1_G \times a)^*\alpha} \ar@{=}[r] & (m \times 1_X)^*a^*\mathcal{F} \ar[u]_{(m \times 1_X)^*\alpha} } $$ is a commutative in the category of $\mathcal{O}_{G \times_S G \times_S X}$-modules, and \item the pullback $$ (e \times 1_X)^*\alpha : \mathcal{F} \longrightarrow \mathcal{F} $$ is the identity map. \end{enumerate} For explanation compare with the relevant diagrams of Equation (\ref{equation-action}). \end{definition} 
\begin{lemma} \label{lemma-pullback-equivariant} Let $S$ be a scheme. Let $G$ be a group scheme over $S$. Let $f : Y \to X$ be a $G$-equivariant morphism between $S$-schemes endowed with $G$-actions. Then pullback $f^*$ given by $(\mathcal{F}, \alpha) \mapsto (f^*\mathcal{F}, (1_G \times f)^*\alpha)$ defines a functor from the category of $G$-equivariant quasi-coherent $\mathcal{O}_X$-modules  to the category of $G$-equivariant quasi-coherent $\mathcal{O}_Y$-modules. \end{lemma} 
\begin{lemma} \label{lemma-complete-reducibility-Gm} Let $a : \mathbf{G}_m \times X \to X$ be an action on an affine scheme. Then $X$ is the spectrum of a $\mathbf{Z}$-graded ring and the action is as in Example \ref{example-Gm-on-affine}. \end{lemma} 
\begin{lemma} \label{lemma-Gm-equivariant-module} Let $A$ be a graded ring. Let $X = \Spec(A)$ with action $a : \mathbf{G}_m \times X \to X$ as in Example \ref{example-Gm-on-affine}. Let $\mathcal{F}$ be a $\mathbf{G}_m$-equivariant quasi-coherent $\mathcal{O}_X$-module. Then $M = \Gamma(X, \mathcal{F})$ has a canonical grading such that it is a graded $A$-module and such that the isomorphism $\widetilde{M} \to \mathcal{F}$ (Schemes, Lemma \ref{schemes-lemma-quasi-coherent-affine}) is an isomorphism of $\mathbf{G}_m$-equivariant modules where the $\mathbf{G}_m$-equivariant structure on $\widetilde{M}$ is the one from Example \ref{example-Gm-on-affine}. \end{lemma} 
\begin{definition} \label{definition-groupoid} Let $S$ be a scheme. \begin{enumerate} \item A {\it groupoid scheme over $S$}, or simply a {\it groupoid over $S$} is a quintuple $(U, R, s, t, c)$ where $U$ and $R$ are schemes over $S$, and $s, t : R \to U$ and $c : R \times_{s, U, t} R \to R$ are morphisms of schemes over $S$ with the following property: For any scheme $T$ over $S$ the quintuple $$ (U(T), R(T), s, t, c) $$ is a groupoid category in the sense described above. \item A {\it morphism $f : (U, R, s, t, c) \to (U', R', s', t', c')$ of groupoid schemes over $S$} is given by morphisms of schemes $f : U \to U'$ and $f : R \to R'$ with the following property:  For any scheme $T$ over $S$ the maps $f$ define a functor from the groupoid category $(U(T), R(T), s, t, c)$ to the groupoid category $(U'(T), R'(T), s', t', c')$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-groupoid-pre-equivalence} Given a groupoid scheme $(U, R, s, t, c)$ over $S$ the morphism $j : R \to U \times_S U$ is a pre-equivalence relation. \end{lemma} 
\begin{lemma} \label{lemma-equivalence-groupoid} Given an equivalence relation $j : R \to U \times_S U$ over $S$ there is a unique way to extend it to a groupoid $(U, R, s, t, c)$ over $S$. \end{lemma} 
\begin{lemma} \label{lemma-diagram} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. In the commutative diagram $$ \xymatrix{ & U & \\ R \ar[d]_s \ar[ru]^t & R \times_{s, U, t} R \ar[l]^-{\text{pr}_0} \ar[d]^{\text{pr}_1} \ar[r]_-c & R \ar[d]^s \ar[lu]_t \\ U & R \ar[l]_t \ar[r]^s & U } $$ the two lower squares are fibre product squares. Moreover, the triangle on top (which is really a square) is also cartesian. \end{lemma} 
\begin{lemma} \label{lemma-diagram-pull} Let $S$ be a scheme. Let $(U, R, s, t, c, e, i)$ be a groupoid over $S$. The diagram \begin{equation} \label{equation-pull} \xymatrix{ R \times_{t, U, t} R \ar@<1ex>[r]^-{\text{pr}_1} \ar@<-1ex>[r]_-{\text{pr}_0} \ar[d]_{(\text{pr}_0, c \circ (i, 1))} & R \ar[r]^t \ar[d]^{\text{id}_R} & U \ar[d]^{\text{id}_U} \\ R \times_{s, U, t} R \ar@<1ex>[r]^-c \ar@<-1ex>[r]_-{\text{pr}_0} \ar[d]_{\text{pr}_1} & R \ar[r]^t \ar[d]^s & U \\ R \ar@<1ex>[r]^s \ar@<-1ex>[r]_t & U } \end{equation} is commutative. The two top rows are isomorphic via the vertical maps given. The two lower left squares are cartesian. \end{lemma} 
\begin{lemma} \label{lemma-base-change-groupoid} Let $(U, R, s, t, c)$ be a groupoid over a scheme $S$. Let $S' \to S$ be a morphism. Then the base changes $U' = S' \times_S U$, $R' = S' \times_S R$ endowed with the base changes $s'$, $t'$, $c'$ of the morphisms $s, t, c$ form a groupoid scheme $(U', R', s', t', c')$ over $S'$ and the projections determine a morphism $(U', R', s', t', c') \to (U, R, s, t, c)$ of groupoid schemes over $S$. \end{lemma} 
\begin{definition} \label{definition-groupoid-module} Let $S$ be a scheme, let $(U, R, s, t, c)$ be a groupoid scheme over $S$. A {\it quasi-coherent module on $(U, R, s, t, c)$} is a pair $(\mathcal{F}, \alpha)$, where $\mathcal{F}$ is a quasi-coherent $\mathcal{O}_U$-module, and $\alpha$ is a $\mathcal{O}_R$-module map $$ \alpha : t^*\mathcal{F} \longrightarrow s^*\mathcal{F} $$ such that \begin{enumerate} \item the diagram $$ \xymatrix{ & \text{pr}_1^*t^*\mathcal{F} \ar[r]_-{\text{pr}_1^*\alpha} & \text{pr}_1^*s^*\mathcal{F} \ar@{=}[rd] & \\ \text{pr}_0^*s^*\mathcal{F} \ar@{=}[ru] & & & c^*s^*\mathcal{F} \\ & \text{pr}_0^*t^*\mathcal{F} \ar[lu]^{\text{pr}_0^*\alpha} \ar@{=}[r] & c^*t^*\mathcal{F} \ar[ru]_{c^*\alpha} } $$ is a commutative in the category of $\mathcal{O}_{R \times_{s, U, t} R}$-modules, and \item the pullback $$ e^*\alpha : \mathcal{F} \longrightarrow \mathcal{F} $$ is the identity map. \end{enumerate} Compare with the commutative diagrams of Lemma \ref{lemma-diagram}. \end{definition} 
\begin{lemma} \label{lemma-isomorphism} Let $S$ be a scheme, let $(U, R, s, t, c)$ be a groupoid scheme over $S$. If $(\mathcal{F}, \alpha)$ is a quasi-coherent module on $(U, R, s, t, c)$ then $\alpha$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-pullback} Let $S$ be a scheme. Consider a morphism $f : (U, R, s, t, c) \to (U', R', s', t', c')$ of groupoid schemes over $S$. Then pullback $f^*$ given by $$ (\mathcal{F}, \alpha) \mapsto (f^*\mathcal{F}, f^*\alpha) $$ defines a functor from the category of quasi-coherent sheaves on $(U', R', s', t', c')$ to the category of quasi-coherent sheaves on $(U, R, s, t, c)$. \end{lemma} 
\begin{lemma} \label{lemma-pushforward} Let $S$ be a scheme. Consider a morphism $f : (U, R, s, t, c) \to (U', R', s', t', c')$ of groupoid schemes over $S$. Assume that \begin{enumerate} \item $f : U \to U'$ is quasi-compact and quasi-separated, \item the square $$ \xymatrix{ R \ar[d]_t \ar[r]_f & R' \ar[d]^{t'} \\ U \ar[r]^f & U' } $$ is cartesian, and \item $s'$ and $t'$ are flat. \end{enumerate} Then pushforward $f_*$ given by $$ (\mathcal{F}, \alpha) \mapsto (f_*\mathcal{F}, f_*\alpha) $$ defines a functor from the category of quasi-coherent sheaves on $(U, R, s, t, c)$ to the category of quasi-coherent sheaves on $(U', R', s', t', c')$ which is right adjoint to pullback as defined in Lemma \ref{lemma-pullback}. \end{lemma} 
\begin{lemma} \label{lemma-colimits} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. The category of quasi-coherent modules on $(U, R, s, t, c)$ has colimits. \end{lemma} 
\begin{lemma} \label{lemma-abelian} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. If $s$, $t$ are flat, then the category of quasi-coherent modules on $(U, R, s, t, c)$ is abelian. \end{lemma} 
\begin{lemma} \label{lemma-construct-quasi-coherent} Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $s, t$ are flat, quasi-compact, and quasi-separated. For any quasi-coherent module $\mathcal{G}$ on $U$, there exists a canonical isomorphism $\alpha : t^*s_*t^*\mathcal{G} \to s^*s_*t^*\mathcal{G}$ which turns $(s_*t^*\mathcal{G}, \alpha)$ into a quasi-coherent module on $(U, R, s, t, c)$. This construction defines a functor $$ \QCoh(\mathcal{O}_U) \longrightarrow \QCoh(U, R, s, t, c) $$ which is a right adjoint to the forgetful functor $(\mathcal{F}, \beta) \mapsto \mathcal{F}$. \end{lemma} 
\begin{lemma} \label{lemma-push-pull} Let $f : Y \to X$ be a morphism of schemes. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module, let $\mathcal{G}$ be a quasi-coherent $\mathcal{O}_Y$-module, and let $\varphi : \mathcal{G} \to f^*\mathcal{F}$ be a module map. Assume \begin{enumerate} \item $\varphi$ is injective, \item $f$ is quasi-compact, quasi-separated, flat, and surjective, \item $X$, $Y$ are locally Noetherian, and \item $\mathcal{G}$ is a coherent $\mathcal{O}_Y$-module. \end{enumerate} Then $\mathcal{F} \cap f_*\mathcal{G}$ defined as the pullback $$ \xymatrix{ \mathcal{F} \ar[r] & f_*f^*\mathcal{F} \\ \mathcal{F} \cap f_*\mathcal{G} \ar[u] \ar[r] & f_*\mathcal{G} \ar[u] } $$ is a coherent $\mathcal{O}_X$-module. \end{lemma} 
\begin{lemma} \label{lemma-colimit-coherent} Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume that \begin{enumerate} \item $U$, $R$ are Noetherian, \item $s, t$ are flat, quasi-compact, and quasi-separated. \end{enumerate} Then every quasi-coherent module $(\mathcal{F}, \beta)$ on $(U, R, s, t, c)$ is a filtered colimit of coherent modules. \end{lemma} 
\begin{lemma} \label{lemma-colimit-finite-type} Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume that \begin{enumerate} \item $U$, $R$ are affine, \item there exist $e_i \in \mathcal{O}_R(R)$ such that every element $g \in \mathcal{O}_R(R)$ can be uniquely written as $\sum s^*(f_i)e_i$ for some $f_i \in \mathcal{O}_U(U)$. \end{enumerate} Then every quasi-coherent module $(\mathcal{F}, \alpha)$ on $(U, R, s, t, c)$ is a filtered colimit of finite type quasi-coherent modules. \end{lemma} 
\begin{lemma} \label{lemma-set-of-iso-classes} Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $\kappa$ be a cardinal. There exists a set $T$ and a family $(\mathcal{F}_t, \alpha_t)_{t \in T}$ of $\kappa$-generated quasi-coherent modules on $(U, R, s, t, c)$ such that every $\kappa$-generated quasi-coherent module on $(U, R, s, t, c)$ is isomorphic to one of the $(\mathcal{F}_t, \alpha_t)$. \end{lemma} 
\begin{lemma} \label{lemma-colimit-kappa} Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume that $s, t$ are flat. There exists a cardinal $\kappa$ such that every quasi-coherent module $(\mathcal{F}, \alpha)$ on $(U, R, s, t, c)$ is the directed colimit of its $\kappa$-generated quasi-coherent submodules. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-from-action} Let $S$ be a scheme. Let $Y$ be a scheme over $S$. Let $(G, m)$ be a group scheme over $Y$ with identity $e_G$ and inverse $i_G$. Let $X/Y$ be a scheme over $Y$ and let $a : G \times_Y X \to X$ be an action of $G$ on $X/Y$. Then we get a groupoid scheme $(U, R, s, t, c, e, i)$ over $S$ in the following manner: \begin{enumerate} \item We set $U = X$, and $R = G \times_Y X$. \item We set $s : R \to U$ equal to $(g, x) \mapsto x$. \item We set $t : R \to U$ equal to $(g, x) \mapsto a(g, x)$. \item We set $c : R \times_{s, U, t} R \to R$ equal to $((g, x), (g', x')) \mapsto (m(g, g'), x')$. \item We set $e : U \to R$ equal to $x \mapsto (e_G(x), x)$. \item We set $i : R \to R$ equal to $(g, x) \mapsto (i_G(g), a(g, x))$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-action-groupoid-modules} Let $S$ be a scheme. Let $Y$ be a scheme over $S$. Let $(G, m)$ be a group scheme over $Y$. Let $X$ be a scheme over $Y$ and let $a : G \times_Y X \to X$ be an action of $G$ on $X$ over $Y$. Let $(U, R, s, t, c)$ be the groupoid scheme constructed in Lemma \ref{lemma-groupoid-from-action}. The rule $(\mathcal{F}, \alpha) \mapsto (\mathcal{F}, \alpha)$ defines an equivalence of categories between $G$-equivariant $\mathcal{O}_X$-modules and the category of quasi-coherent modules on $(U, R, s, t, c)$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-stabilizer} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. The scheme $G$ defined by the cartesian square $$ \xymatrix{ G \ar[r] \ar[d] & R \ar[d]^{j = (t, s)} \\ U \ar[r]^-{\Delta} & U \times_S U } $$ is a group scheme over $U$ with composition law $m$ induced by the composition law $c$. \end{lemma} 
\begin{definition} \label{definition-stabilizer-groupoid} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. The group scheme $j^{-1}(\Delta_{U/S})\to U$ is called the {\it stabilizer of the groupoid scheme $(U, R, s, t, c)$}. \end{definition} 
\begin{lemma} \label{lemma-groupoid-action-stabilizer} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$, and let $G/U$ be its stabilizer. Denote $R_t/U$ the scheme $R$ seen as a scheme over $U$ via the morphism $t : R \to U$. There is a canonical left action $$ a : G \times_U R_t \longrightarrow R_t $$ induced by the composition law $c$. \end{lemma} 
\begin{lemma} \label{lemma-groupoid-action-stabilizer-pseudo-torsor} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $G$ be the stabilizer group scheme of $R$. Let $$ G_0 = G \times_{U, \text{pr}_0} (U \times_S U) = G \times_S U $$ as a group scheme over $U \times_S U$. The action of $G$ on $R$ of Lemma \ref{lemma-groupoid-action-stabilizer} induces an action of $G_0$ on $R$ over $U \times_S U$ which turns $R$ into a pseudo $G_0$-torsor over $U \times_S U$. \end{lemma} 
\begin{lemma} \label{lemma-fibres-j} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $p \in U \times_S U$ be a point. Denote $R_p$ the scheme theoretic fibre of $j = (t, s) : R \to U \times_S U$. If $R_p \not = \emptyset$, then the action $$ G_{0, \kappa(p)} \times_{\kappa(p)} R_p \longrightarrow R_p $$ (see Lemma \ref{lemma-groupoid-action-stabilizer-pseudo-torsor}) which turns $R_p$ into a $G_{\kappa(p)}$-torsor over $\kappa(p)$. \end{lemma} 
\begin{lemma} \label{lemma-restrict-groupoid} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ be a morphism of schemes. Consider the following diagram $$ \xymatrix{ R' \ar[d] \ar[r] \ar@/_3pc/[dd]_{t'} \ar@/^1pc/[rr]^{s'}& R \times_{s, U} U' \ar[r] \ar[d] & U' \ar[d]^g \\ U' \times_{U, t} R \ar[d] \ar[r] & R \ar[r]^s \ar[d]_t & U \\ U' \ar[r]^g & U } $$ where all the squares are fibre product squares. Then there is a canonical composition law $c' : R' \times_{s', U', t'} R' \to R'$ such that $(U', R', s', t', c')$ is a groupoid scheme over $S$ and such that $U' \to U$, $R' \to R$ defines a morphism $(U', R', s', t', c') \to (U, R, s, t, c)$ of groupoid schemes over $S$. Moreover, for any scheme $T$ over $S$ the functor of groupoids $$ (U'(T), R'(T), s', t', c') \to (U(T), R(T), s, t, c) $$ is the restriction (see above) of $(U(T), R(T), s, t, c)$ via the map $U'(T) \to U(T)$. \end{lemma} 
\begin{definition} \label{definition-restrict-groupoid} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ be a morphism of schemes. The morphism of groupoids $(U', R', s', t', c') \to (U, R, s, t, c)$ constructed in Lemma \ref{lemma-restrict-groupoid} is called the {\it restriction of $(U, R, s, t, c)$ to $U'$}. We sometime use the notation $R' = R|_{U'}$ in this case. \end{definition} 
\begin{lemma} \label{lemma-restrict-groupoid-relation} The notions of restricting groupoids and (pre-)equivalence relations defined in Definitions \ref{definition-restrict-groupoid} and \ref{definition-restrict-relation} agree via the constructions of Lemmas \ref{lemma-groupoid-pre-equivalence} and \ref{lemma-equivalence-groupoid}. \end{lemma} 
\begin{lemma} \label{lemma-restrict-stabilizer} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ be a morphism of schemes. Let $(U', R', s', t', c')$ be the restriction of $(U, R, s, t, c)$ via $g$. Let $G$ be the stabilizer of $(U, R, s, t, c)$ and let $G'$ be the stabilizer of $(U', R', s', t', c')$. Then $G'$ is the base change of $G$ by $g$, i.e., there is a canonical identification $G' = U' \times_{g, U} G$. \end{lemma} 
\begin{definition} \label{definition-invariant-open} Let $(U, R, s, t, c)$ be a groupoid scheme over the base scheme $S$. \begin{enumerate} \item A subset $W \subset U$ is {\it set-theoretically $R$-invariant} if $t(s^{-1}(W)) \subset W$. \item An open $W \subset U$ is {\it $R$-invariant} if $t(s^{-1}(W)) \subset W$. \item A closed subscheme $Z \subset U$ is called {\it $R$-invariant} if $t^{-1}(Z) = s^{-1}(Z)$. Here we use the scheme theoretic inverse image, see Schemes, Definition \ref{schemes-definition-inverse-image-closed-subscheme}. \item A monomorphism of schemes $T \to U$ is {\it $R$-invariant} if $T \times_{U, t} R = R \times_{s, U} T$ as schemes over $R$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-constructing-invariant-opens} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. \begin{enumerate} \item For any subset $W \subset U$ the subset $t(s^{-1}(W))$ is set-theoretically $R$-invariant. \item If $s$ and $t$ are open, then for every open $W \subset U$ the open $t(s^{-1}(W))$ is an $R$-invariant open subscheme. \item If $s$ and $t$ are open and quasi-compact, then $U$ has an open covering consisting of $R$-invariant quasi-compact open subschemes. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-first-observation} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $s$ and $t$ quasi-compact and flat and $U$ quasi-separated. Let $W \subset U$ be quasi-compact open. Then $t(s^{-1}(W))$ is an intersection of a nonempty family of quasi-compact open subsets of $U$. \end{lemma} 
\begin{lemma} \label{lemma-second-observation} Assumptions and notation as in Lemma \ref{lemma-first-observation}. There exists an $R$-invariant open $V \subset U$ and a quasi-compact open $W'$ such that $W \subset V \subset W' \subset U$. \end{lemma} 
\begin{definition} \label{definition-quotient-sheaf} Let $\tau$, $S$, and the pre-relation $j : R \to U \times_S U$ be as above. In this setting the {\it quotient sheaf $U/R$} associated to $j$ is the sheafification of the presheaf (\ref{equation-quotient-presheaf}) in the $\tau$-topology. If $j : R \to U \times_S U$ comes from the action of a group scheme $G/S$ on $U$ as in Lemma \ref{lemma-groupoid-from-action} then we sometimes denote the quotient sheaf $U/G$. \end{definition} 
\begin{definition} \label{definition-representable-quotient} In the situation of Definition \ref{definition-quotient-sheaf}. We say that the pre-relation $j$ has a {\it representable quotient} if the sheaf $U/R$ is representable. We will say a groupoid $(U, R, s, t, c)$ has a {\it representable quotient} if the quotient $U/R$ with $j = (t, s)$ is representable. \end{definition} 
\begin{lemma} \label{lemma-criterion-quotient-representable} In the situation of Definition \ref{definition-quotient-sheaf}. Assume there is a scheme $M$, and a morphism $U \to M$ such that \begin{enumerate} \item the morphism $U \to M$ equalizes $s, t$, \item the morphism $U \to M$ induces a surjection of sheaves $h_U \to h_M$ in the $\tau$-topology, and \item the induced map $(t, s) : R \to U \times_M U$ induces a surjection of sheaves $h_R \to h_{U \times_M U}$ in the $\tau$-topology. \end{enumerate} In this case $M$ represents the quotient sheaf $U/R$. \end{lemma} 
\begin{lemma} \label{lemma-quotient-pre-equivalence} Let $\tau \in \{Zariski, \etale, fppf, smooth, syntomic\}$. Let $S$ be a scheme. Let $j : R \to U \times_S U$ be a pre-equivalence relation over $S$. Assume $U, R, S$ are objects of a $\tau$-site $\Sch_\tau$. For $T \in \Ob((\Sch/S)_\tau)$ and $a, b \in U(T)$ the following are equivalent: \begin{enumerate} \item $a$ and $b$ map to the same element of $(U/R)(T)$, and \item there exists a $\tau$-covering $\{f_i : T_i \to T\}$ of $T$ and morphisms $r_i : T_i \to R$ such that $a \circ f_i = s \circ r_i$ and $b \circ f_i = t \circ r_i$. \end{enumerate} In other words, in this case the map of $\tau$-sheaves $$ h_R \longrightarrow h_U \times_{U/R} h_U $$ is surjective. \end{lemma} 
\begin{lemma} \label{lemma-quotient-pre-equivalence-relation-restrict} Let $\tau \in \{Zariski, \etale, fppf, smooth, syntomic\}$. Let $S$ be a scheme. Let $j : R \to U \times_S U$ be a pre-equivalence relation over $S$ and $g : U' \to U$ a morphism of schemes over $S$. Let $j' : R' \to U' \times_S U'$ be the restriction of $j$ to $U'$. Assume  $U, U', R, S$ are objects of a $\tau$-site $\Sch_\tau$. The map of quotient sheaves $$ U'/R' \longrightarrow U/R $$ is injective. If $g$ defines a surjection $h_{U'} \to h_U$ of sheaves in the $\tau$-topology (for example if $\{g : U' \to U\}$ is a $\tau$-covering), then $U'/R' \to U/R$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-quotient-groupoid-restrict} Let $\tau \in \{Zariski, \etale, fppf, smooth, syntomic\}$. Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Let $g : U' \to U$ a morphism of schemes over $S$. Let $(U', R', s', t', c')$ be the restriction of $(U, R, s, t, c)$ to $U'$. Assume  $U, U', R, S$ are objects of a $\tau$-site $\Sch_\tau$. The map of quotient sheaves $$ U'/R' \longrightarrow U/R $$ is injective. If the composition $$ \xymatrix{ U' \times_{g, U, t} R \ar[r]_-{\text{pr}_1} \ar@/^3ex/[rr]^h & R \ar[r]_s & U } $$ defines a surjection of sheaves in the $\tau$-topology  then the map is bijective. This holds for example if $\{h : U' \times_{g, U, t} R \to U\}$ is a $\tau$-covering, or if $U' \to U$ defines a surjection of sheaves in the $\tau$-topology, or if $\{g : U' \to U\}$ is a covering in the $\tau$-topology. \end{lemma} 
\begin{lemma} \label{lemma-criterion-fibre-product} Let $S$ be a scheme. Let $f : (U, R, j) \to (U', R', j')$ be a morphism between equivalence relations over $S$. Assume that $$ \xymatrix{ R \ar[d]_s \ar[r]_f & R' \ar[d]^{s'} \\ U \ar[r]^f & U' } $$ is cartesian. For any $\tau \in  \{Zariski, \etale, fppf, smooth, syntomic\}$ the diagram $$ \xymatrix{ U \ar[d] \ar[r] & U/R \ar[d]^f \\ U' \ar[r] & U'/R' } $$ is a fibre product square of $\tau$-sheaves. \end{lemma} 
\begin{definition} \label{definition-cartesian-morphism} Let $S$ be a scheme. Let $f : (U', R', s', t', c') \to (U, R, s, t, c)$ be a morphism of groupoid schemes over $S$. We say $f$ is {\it cartesian}, or that {\it $(U', R', s', t', c')$ is cartesian over $(U, R, s, t, c)$}, if the diagram $$ \xymatrix{ R' \ar[r]_f \ar[d]_{s'} & R \ar[d]^s \\ U' \ar[r]^f & U } $$ is a fibre square in the category of schemes. A {\it morphism of groupoid schemes cartesian over $(U, R, s, t, c)$} is a morphism of groupoid schemes compatible with the structure morphisms towards $(U, R, s, t, c)$. \end{definition} 
\begin{lemma} \label{lemma-characterize-cartesian-schemes} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. The category of groupoid schemes cartesian over $(U, R, s, t, c)$ is equivalent to the category of pairs $(V, \varphi)$ where $V$ is a scheme over $U$ and $$ \varphi : V \times_{U, t} R \longrightarrow R \times_{s, U} V $$ is an isomorphism over $R$ such that $e^*\varphi = \text{id}_V$ and such that $$ c^*\varphi = \text{pr}_1^*\varphi \circ \text{pr}_0^*\varphi $$ as morphisms of schemes over $R \times_{s, U, t} R$. \end{lemma} 
\begin{lemma} \label{lemma-cartesian-equivalent-descent-datum} Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of schemes over $S$. The construction of Lemma \ref{lemma-characterize-cartesian-schemes} determines an equivalence $$ \begin{matrix} \text{category of groupoid schemes} \\ \text{cartesian over } (X, X \times_Y X, \ldots) \end{matrix} \longrightarrow \begin{matrix} \text{ category of descent data} \\ \text{ relative to } X/Y \end{matrix} $$ \end{lemma} 
\begin{lemma} \label{lemma-diagram-diagonal} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Let $G \to U$ be the stabilizer group scheme. The commutative diagram $$ \xymatrix{ R \ar[d]^{\Delta_{R/U \times_S U}} \ar[rrr]_{f \mapsto (f, s(f))} & & & R \times_{s, U} U \ar[d] \ar[r] & U \ar[d] \\ R \times_{(U \times_S U)} R \ar[rrr]^{(f, g) \mapsto (f, f^{-1} \circ g)} & & & R \times_{s, U} G \ar[r] & G } $$ the two left horizontal arrows are isomorphisms and the right square is a fibre product square. \end{lemma} 
\begin{lemma} \label{lemma-diagonal} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid over $S$. Let $G \to U$ be the stabilizer group scheme. \begin{enumerate} \item The following are equivalent \begin{enumerate} \item $j : R \to U \times_S U$ is separated, \item $G \to U$ is separated, and \item $e : U \to G$ is a closed immersion. \end{enumerate} \item The following are equivalent \begin{enumerate} \item $j : R \to U \times_S U$ is quasi-separated, \item $G \to U$ is quasi-separated, and \item $e : U \to G$ is quasi-compact. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-determinant-trick} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(A)$ and $R = \Spec(B)$ are affine and $s, t : R \to U$ finite locally free. Let $C$ be as in (\ref{equation-invariants}). Let $f \in A$. Then $\text{Norm}_{s^\sharp}(t^\sharp(f)) \in C$. \end{lemma} 
\begin{lemma} \label{lemma-finite-locally-free-disjoint-free} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $s, t : R \to U$ finite locally free. Then $$ U = \coprod\nolimits_{r \geq 1} U_r $$ is a disjoint union of $R$-invariant opens such that the restriction $R_r$ of $R$ to $U_r$ has the property that $s, t : R_r \to U_r$ are finite locally free of rank $r$. \end{lemma} 
\begin{lemma} \label{lemma-integral-over-invariants} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(A)$ and $R = \Spec(B)$ are affine and $s, t : R \to U$ finite locally free. Let $C \subset A$ be as in (\ref{equation-invariants}). Then $A$ is integral over $C$. \end{lemma} 
\begin{lemma} \label{lemma-invariants-base-change} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(A)$ and $R = \Spec(B)$ are affine and $s, t : R \to U$ finite locally free. Let $C \subset A$ be as in (\ref{equation-invariants}). Let $C \to C'$ be a ring map, and set $U' = \Spec(A \otimes_C C')$, $R' = \Spec(B \otimes_C C')$. Then \begin{enumerate} \item The maps $s, t, c$ induce maps $s', t', c'$ such that $(U', R', s', t', c')$ is a groupoid scheme. Let $C^1 \subset A'$ be the $R'$-invariant functions on $U'$. \item The canonical map $\varphi : C' \to C^1$ satisfies \begin{enumerate} \item for every $f \in C^1$ there exists an $n > 0$ and a polynomial $P \in C'[x]$ whose image in $C^1[x]$ is $(x - f)^n$, and \item for every $f \in \Ker(\varphi)$ there exists an $n > 0$ such that $f^n = 0$. \end{enumerate} \item If $C \to C'$ is flat then $\varphi$ is an isomorphism. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-points} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $U = \Spec(A)$ and $R = \Spec(B)$ are affine and $s, t : R \to U$ finite locally free. Let $C \subset A$ be as in (\ref{equation-invariants}). Then $U \to M = \Spec(C)$ has the following properties: \begin{enumerate} \item the map on points $|U| \to |M|$ is surjective and $u_0, u_1 \in |U|$ map to the same point if and only if there exists a $r \in |R|$ with $t(r) = u_0$ and $s(r) = u_1$, in a formula $$ |M| = |U|/|R| $$ \item for any algebraically closed field $k$ we have $$ M(k) = U(k)/R(k) $$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-etale} Let $S$ be a scheme. Let $f : (U', R', s', t') \to (U, R, s, t, c)$ be a morphism of groupoid schemes over $S$. \begin{enumerate} \item $U$, $R$, $U'$, $R'$ are affine, \item $s, t, s', t'$ are finite locally free, \item the diagrams $$ \xymatrix{ R' \ar[d]_{s'} \ar[r]_f & R \ar[d]^s \\ U' \ar[r]^f & U } \quad \quad \xymatrix{ R' \ar[d]_{t'} \ar[r]_f & R \ar[d]^t \\ U' \ar[r]^f & U } \quad \quad \xymatrix{ G' \ar[d] \ar[r]_f & G \ar[d] \\ U' \ar[r]^f & U } $$ are cartesian where $G$ and $G'$ are the stabilizer group schemes, and \item $f : U' \to U$ is \'etale. \end{enumerate} Then the map $C \to C'$ from the $R$-invariant functions on $U$ to the $R'$-invariant functions on $U'$ is \'etale and $U' = \Spec(C') \times_{\Spec(C)} U$. \end{lemma} 
\begin{lemma} \label{lemma-basis} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume \begin{enumerate} \item $U = \Spec(A)$, and $R = \Spec(B)$ are affine, and \item there exist elements $x_i \in A$, $i \in I$ such that $B = \bigoplus_{i \in I} s^\sharp(A)t^\sharp(x_i)$. \end{enumerate} Then $A = \bigoplus_{i\in I} Cx_i$, and $B \cong A \otimes_C A$ where $C \subset A$ is the $R$-invariant functions on $U$ as in (\ref{equation-invariants}). \end{lemma} 
\begin{proposition} \label{proposition-finite-flat-equivalence} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume \begin{enumerate} \item $U = \Spec(A)$, and $R = \Spec(B)$ are affine, \item $s, t : R \to U$ finite locally free, and \item $j = (t, s)$ is an equivalence. \end{enumerate} In this case, let $C \subset A$ be as in (\ref{equation-invariants}). Then $U \to M = \Spec(C)$ is finite locally free and $R = U \times_M U$. Moreover, $M$ represents the quotient sheaf $U/R$ in the fppf topology (see Definition \ref{definition-quotient-sheaf}). \end{proposition} 
\begin{lemma} \label{lemma-find-invariant-affine} Let $S$ be a scheme. Let $(U, R, s, t, c)$ be a groupoid scheme over $S$. Assume $s$, $t$ are finite locally free. Let $u \in U$ be a point such that $t(s^{-1}(\{u\}))$ is contained in an affine open of $U$. Then there exists an $R$-invariant affine open neighbourhood of $u$ in $U$. \end{lemma} 
\begin{lemma} \label{lemma-descend-along-finite} Let $X \to Y$ be a surjective finite locally free morphism. Let $V$ be a scheme over $X$ such that for all $(y, v_1, \ldots, v_d)$ where $y \in Y$ and $v_1, \ldots, v_d \in V_y$ there exists an affine open $U \subset V$ with $v_1, \ldots, v_d \in U$. Then any descent datum on $V/X/Y$ is effective. \end{lemma} 
\begin{lemma} \label{lemma-descend-along-finite-quasi-projective} Let $X \to Y$ be a surjective finite locally free morphism. Let $V$ be a scheme over $X$ such that one of the following holds \begin{enumerate} \item $V \to X$ is projective, \item $V \to X$ is quasi-projective, \item there exists an ample invertible sheaf on $V$, \item there exists an $X$-ample invertible sheaf on $V$, \item there exists an $X$-very ample invertible sheaf on $V$. \end{enumerate} Then any descent datum on $V/X/Y$ is effective. \end{lemma} 
