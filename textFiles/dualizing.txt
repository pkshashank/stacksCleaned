\begin{definition} \label{definition-essential} Let $\mathcal{A}$ be an abelian category. \begin{enumerate} \item An injection $A \subset B$ of $\mathcal{A}$ is {\it essential}, or we say that $B$ is an {\it essential extension of} $A$, if every nonzero subobject $B' \subset B$ has nonzero intersection with $A$. \item A surjection $f : A \to B$ of $\mathcal{A}$ is {\it essential} if for every proper subobject $A' \subset A$ we have $f(A') \not = B$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-essential} Let $\mathcal{A}$ be an abelian category. \begin{enumerate} \item If $A \subset B$ and $B \subset C$ are essential extensions, then $A \subset C$ is an essential extension. \item If $A \subset B$ is an essential extension and $C \subset B$ is a subobject, then $A \cap C \subset C$ is an essential extension. \item If $A \to B$ and $B \to C$ are essential surjections, then $A \to C$ is an essential surjection. \item Given an essential surjection $f : A \to B$ and a surjection $A \to C$ with kernel $K$, the morphism $C \to B/f(K)$ is an essential surjection. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-union-essential-extensions} Let $R$ be a ring. Let $M$ be an $R$-module. Let $E = \colim E_i$ be a filtered colimit of $R$-modules. Suppose given a compatible system of essential injections $M \to E_i$ of $R$-modules. Then $M \to E$ is an essential injection. \end{lemma} 
\begin{lemma} \label{lemma-essential-extension} Let $R$ be a ring. Let $M \subset N$ be $R$-modules. The following are equivalent \begin{enumerate} \item $M \subset N$ is an essential extension, \item for all $x \in N$ nonzero there exists an $f \in R$ such that $fx \in M$ and $fx \not = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-product-injectives} Let $R$ be a ring. Any product of injective $R$-modules is injective. \end{lemma} 
\begin{lemma} \label{lemma-injective-flat} Let $R \to S$ be a flat ring map. If $E$ is an injective $S$-module, then $E$ is injective as an $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-injective-epimorphism} Let $R \to S$ be an epimorphism of rings. Let $E$ be an $S$-module. If $E$ is injective as an $R$-module, then $E$ is an injective $S$-module. \end{lemma} 
\begin{lemma} \label{lemma-hom-injective} Let $R \to S$ be a ring map. If $E$ is an injective $R$-module, then $\Hom_R(S, E)$ is an injective $S$-module. \end{lemma} 
\begin{lemma} \label{lemma-essential-extensions-in-injective} Let $R$ be a ring. Let $I$ be an injective $R$-module. Let $E \subset I$ be a submodule. The following are equivalent \begin{enumerate} \item $E$ is injective, and \item for all $E \subset E' \subset I$ with $E \subset E'$ essential we have $E = E'$. \end{enumerate} In particular, an $R$-module is injective if and only if every essential extension is trivial. \end{lemma} 
\begin{lemma} \label{lemma-sum-injective-modules} Let $R$ be a Noetherian ring. A direct sum of injective modules is injective. \end{lemma} 
\begin{lemma} \label{lemma-localization-injective-modules} Let $R$ be a Noetherian ring. Let $S \subset R$ be a multiplicative subset. If $E$ is an injective $R$-module, then $S^{-1}E$ is an injective $S^{-1}R$-module. \end{lemma} 
\begin{lemma} \label{lemma-injective-module-divide} Let $R$ be a Noetherian ring. Let $I$ be an injective $R$-module. \begin{enumerate} \item Let $f \in R$. Then $E = \bigcup I[f^n] = I[f^\infty]$ is an injective submodule of $I$. \item Let $J \subset R$ be an ideal. Then the $J$-power torsion submodule $I[J^\infty]$ is an injective submodule of $I$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-injective-dimension-over-polynomial-ring} Let $A$ be a Noetherian ring. Let $E$ be an injective $A$-module. Then $E \otimes_A A[x]$ has injective-amplitude $[0, 1]$ as an object of $D(A[x])$. In particular, $E \otimes_A A[x]$ has finite injective dimension as an $A[x]$-module. \end{lemma} 
\begin{definition} \label{definition-projective-cover} Let $R$ be a ring. A surjection $P \to M$ of $R$-modules is said to be a {\it projective cover}, or sometimes a {\it projective envelope}, if $P$ is a projective $R$-module and $P \to M$ is an essential surjection. \end{definition} 
\begin{lemma} \label{lemma-projective-cover-unique} Let $R$ be a ring and let $M$ be an $R$-module. If a projective cover of $M$ exists, then it is unique up to isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-projective-covers-local} Let $(R, \mathfrak m, \kappa)$ be a local ring. Any finite $R$-module has a projective cover. \end{lemma} 
\begin{definition} \label{definition-injective-hull} Let $R$ be a ring. A injection $M \to I$ of $R$-modules is said to be an {\it injective hull} if $I$ is a injective $R$-module and $M \to I$ is an essential injection. \end{definition} 
\begin{lemma} \label{lemma-injective-hull} Let $R$ be a ring. Any $R$-module has an injective hull. \end{lemma} 
\begin{lemma} \label{lemma-injective-hull-unique} Let $R$ be a ring. Let $M$, $N$ be $R$-modules and let $M \to E$ and $N \to E'$ be injective hulls. Then \begin{enumerate} \item for any $R$-module map $\varphi : M \to N$ there exists an $R$-module map $\psi : E \to E'$ such that $$ \xymatrix{ M \ar[r] \ar[d]_\varphi & E \ar[d]^\psi \\ N \ar[r] & E' } $$ commutes, \item if $\varphi$ is injective, then $\psi$ is injective, \item if $\varphi$ is an essential injection, then $\psi$ is an isomorphism, \item if $\varphi$ is an isomorphism, then $\psi$ is an isomorphism, \item if $M \to I$ is an embedding of $M$ into an injective $R$-module, then there is an isomorphism $I \cong E \oplus I'$ compatible with the embeddings of $M$, \end{enumerate} In particular, the injective hull $E$ of $M$ is unique up to isomorphism. \end{lemma} 
\begin{definition} \label{definition-indecomposable} An object $X$ of an additive category is called {\it indecomposable} if it is nonzero and if $X = Y \oplus Z$, then either $Y = 0$ or $Z = 0$. \end{definition} 
\begin{lemma} \label{lemma-indecomposable-injective} Let $R$ be a ring. Let $E$ be an indecomposable injective $R$-module. Then \begin{enumerate} \item $E$ is the injective hull of any nonzero submodule of $E$, \item the intersection of any two nonzero submodules of $E$ is nonzero, \item $\text{End}_R(E, E)$ is a noncommutative local ring with maximal ideal those $\varphi : E \to E$ whose kernel is nonzero, and \item the set of zerodivisors on $E$ is a prime ideal $\mathfrak p$ of $R$ and $E$ is an injective $R_\mathfrak p$-module. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-injective-hull-indecomposable} Let $\mathfrak p \subset R$ be a prime of a ring $R$. Let $E$ be the injective hull of $R/\mathfrak p$. Then \begin{enumerate} \item $E$ is indecomposable, \item $E$ is the injective hull of $\kappa(\mathfrak p)$, \item $E$ is the injective hull of $\kappa(\mathfrak p)$ over the ring $R_\mathfrak p$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-indecomposable-injective-noetherian} Let $R$ be a Noetherian ring. Let $E$ be an indecomposable injective $R$-module. Then there exists a prime ideal $\mathfrak p$ of $R$ such that $E$ is the injective hull of $\kappa(\mathfrak p)$. \end{lemma} 
\begin{proposition}[Structure of injective modules over Noetherian rings] \label{proposition-structure-injectives-noetherian} Let $R$ be a Noetherian ring. Every injective module is a direct sum of indecomposable injective modules. Every indecomposable injective module is the injective hull of the residue field at a prime. \end{proposition} 
\begin{lemma} \label{lemma-finite} Let $(R, \mathfrak m, \kappa)$ be an artinian local ring. Let $E$ be an injective hull of $\kappa$. For every finite $R$-module $M$ we have $$ \text{length}_R(M) = \text{length}_R(\Hom_R(M, E)) $$ In particular, the injective hull $E$ of $\kappa$ is a finite $R$-module. \end{lemma} 
\begin{lemma} \label{lemma-evaluate} Let $(R, \mathfrak m, \kappa)$ be an artinian local ring. Let $E$ be an injective hull of $\kappa$. For any finite $R$-module $M$ the evaluation map $$ M \longrightarrow \Hom_R(\Hom_R(M, E), E) $$ is an isomorphism. In particular $R = \Hom_R(E, E)$. \end{lemma} 
\begin{lemma} \label{lemma-duality} Let $(R, \mathfrak m, \kappa)$ be an artinian local ring. Let $E$ be an injective hull of $\kappa$. The functor $D(-) = \Hom_R(-, E)$ induces an exact anti-equivalence $\text{Mod}^{fg}_R \to \text{Mod}^{fg}_R$ and $D \circ D \cong \text{id}$. \end{lemma} 
\begin{lemma} \label{lemma-duality-torsion-cotorsion} Assumptions and notation as in Lemma \ref{lemma-duality}. Let $I \subset R$ be an ideal and $M$ a finite $R$-module. Then $$ D(M[I]) = D(M)/ID(M) \quad\text{and}\quad D(M/IM) = D(M)[I] $$ \end{lemma} 
\begin{lemma} \label{lemma-quotient} Let $R \to S$ be a surjective map of local rings with kernel $I$. Let $E$ be the injective hull of the residue field of $R$ over $R$. Then $E[I]$ is the injective hull of the residue field of $S$ over $S$. \end{lemma} 
\begin{lemma} \label{lemma-torsion-submodule-sum-injective-hulls} Let $(R, \mathfrak m, \kappa)$ be a local ring. Let $E$ be the injective hull of $\kappa$. Let $M$ be a $\mathfrak m$-power torsion $R$-module with $n = \dim_\kappa(M[\mathfrak m]) < \infty$. Then $M$ is isomorphic to a submodule of $E^{\oplus n}$. \end{lemma} 
\begin{lemma} \label{lemma-union-artinian} Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $E$ be an injective hull of $\kappa$ over $R$. Let $E_n$ be an injective hull of $\kappa$ over $R/\mathfrak m^n$. Then $E = \bigcup E_n$ and $E_n = E[\mathfrak m^n]$. \end{lemma} 
\begin{lemma} \label{lemma-compare} Let $R \to S$ be a flat local homomorphism of local Noetherian rings such that $R/\mathfrak m_R \cong S/\mathfrak m_R S$. Then the injective hull of the residue field of $R$ is the injective hull of the residue field of $S$. \end{lemma} 
\begin{lemma} \label{lemma-endos} Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $E$ be an injective hull of $\kappa$ over $R$. Then $\Hom_R(E, E)$ is canonically isomorphic to the completion of $R$. \end{lemma} 
\begin{lemma} \label{lemma-injective-hull-has-dcc} Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $E$ be an injective hull of $\kappa$ over $R$. Then $E$ satisfies the descending chain condition. \end{lemma} 
\begin{lemma} \label{lemma-describe-categories} Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $E$ be an injective hull of $\kappa$. \begin{enumerate} \item For an $R$-module $M$ the following are equivalent: \begin{enumerate} \item $M$ satisfies the ascending chain condition, \item $M$ is a finite $R$-module, and \item there exist $n, m$ and an exact sequence $R^{\oplus m} \to R^{\oplus n} \to M \to 0$. \end{enumerate} \item For an $R$-module $M$ the following are equivalent: \begin{enumerate} \item $M$ satisfies the descending chain condition, \item $M$ is $\mathfrak m$-power torsion and $\dim_\kappa(M[\mathfrak m]) < \infty$, and \item there exist $n, m$ and an exact sequence $0 \to M \to E^{\oplus n} \to E^{\oplus m}$. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{proposition}[Matlis duality] \label{proposition-matlis} Let $(R, \mathfrak m, \kappa)$ be a complete local Noetherian ring. Let $E$ be an injective hull of $\kappa$ over $R$. The functor $D(-) = \Hom_R(-, E)$ induces an anti-equivalence $$ \left\{ \begin{matrix} R\text{-modules with the} \\ \text{descending chain condition} \end{matrix} \right\} \longleftrightarrow \left\{ \begin{matrix} R\text{-modules with the} \\ \text{ascending chain condition} \end{matrix} \right\} $$ and we have $D \circ D = \text{id}$ on either side of the equivalence. \end{proposition} 
\begin{lemma} \label{lemma-adjoint} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. The functor $R\Gamma_I$ is right adjoint to the functor $D(I^\infty\text{-torsion}) \to D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-ext} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. For any object $K$ of $D(A)$ we have $$ R\Gamma_I(K) = \text{hocolim}\ R\Hom_A(A/I^n, K) $$ in $D(A)$ and $$ R^q\Gamma_I(K) = \colim_n \Ext_A^q(A/I^n, K) $$ as modules for all $q \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-bad-local-cohomology-vanishes} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $K^\bullet$ be a complex of $A$-modules such that $f : K^\bullet \to K^\bullet$ is an isomorphism for some $f \in I$, i.e., $K^\bullet$ is a complex of $A_f$-modules. Then $R\Gamma_I(K^\bullet) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-not-equal} Let $A$ be a ring and let $I$ be a finitely generated ideal. Let $M$ and $N$ be $I$-power torsion modules. \begin{enumerate} \item $\Hom_{D(A)}(M, N) = \Hom_{D({I^\infty\text{-torsion}})}(M, N)$, \item $\Ext^1_{D(A)}(M, N) = \Ext^1_{D({I^\infty\text{-torsion}})}(M, N)$, \item $\Ext^2_{D({I^\infty\text{-torsion}})}(M, N) \to \Ext^2_{D(A)}(M, N)$ is not surjective in general, \item (\ref{equation-compare-torsion}) is not an equivalence in general. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-adjoint} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. There exists a right adjoint $R\Gamma_Z$ (\ref{equation-local-cohomology}) to the inclusion functor $D_{I^\infty\text{-torsion}}(A) \to D(A)$. In fact, if $I$ is generated by $f_1, \ldots, f_r \in A$, then we have $$ R\Gamma_Z(K) = (A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to \prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to \ldots \to A_{f_1\ldots f_r}) \otimes_A^\mathbf{L} K $$ functorially in $K \in D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-and-restriction} Let $A \to B$ be a ring homomorphism and let $I \subset A$ be a finitely generated ideal. Set $J = IB$. Set $Z = V(I)$ and $Y = V(J)$. Then $$ R\Gamma_Z(M_A) = R\Gamma_Y(M)_A $$ functorially in $M \in D(B)$. Here $(-)_A$ denotes the restriction functors $D(B) \to D(A)$ and $D_{J^\infty\text{-torsion}}(B) \to D_{I^\infty\text{-torsion}}(A)$. \end{lemma} 
\begin{lemma} \label{lemma-torsion-change-rings} Let $A \to B$ be a ring homomorphism and let $I \subset A$ be a finitely generated ideal. Set $J = IB$. Let $Z = V(I)$ and $Y = V(J)$. Then $$ R\Gamma_Z(K) \otimes_A^\mathbf{L} B = R\Gamma_Y(K \otimes_A^\mathbf{L} B) $$ functorially in $K \in D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-vanishes} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $K^\bullet$ be a complex of $A$-modules such that $f : K^\bullet \to K^\bullet$ is an isomorphism for some $f \in I$, i.e., $K^\bullet$ is a complex of $A_f$-modules. Then $R\Gamma_Z(K^\bullet) = 0$. \end{lemma} 
\begin{lemma} \label{lemma-torsion-tensor-product} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. For $K, L \in D(A)$ we have $$ R\Gamma_Z(K \otimes_A^\mathbf{L} L) = K \otimes_A^\mathbf{L} R\Gamma_Z(L) = R\Gamma_Z(K) \otimes_A^\mathbf{L} L = R\Gamma_Z(K) \otimes_A^\mathbf{L} R\Gamma_Z(L) $$ If $K$ or $L$ is in $D_{I^\infty\text{-torsion}}(A)$ then so is $K \otimes_A^\mathbf{L} L$. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-ss} Let $A$ be a ring and let $I, J \subset A$ be finitely generated ideals. Set $Z = V(I)$ and $Y = V(J)$. Then $Z \cap Y = V(I + J)$ and $R\Gamma_Y \circ R\Gamma_Z = R\Gamma_{Y \cap Z}$ as functors $D(A) \to D_{(I + J)^\infty\text{-torsion}}(A)$. For $K \in D^+(A)$ there is a spectral sequence $$ E_2^{p, q} = H^p_Y(H^q_Z(K)) \Rightarrow H^{p + q}_{Y \cap Z}(K) $$ as in Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}. \end{lemma} 
\begin{lemma} \label{lemma-torsion-flat-change-rings} Let $A \to B$ be a flat ring map and let $I \subset A$ be a finitely generated ideal such that $A/I = B/IB$. Then base change and restriction induce quasi-inverse equivalences $D_{I^\infty\text{-torsion}}(A) = D_{(IB)^\infty\text{-torsion}}(B)$. \end{lemma} 
\begin{lemma} \label{lemma-neighbourhood-extensions} Let $A \to B$ be a flat ring map and let $I \subset A$ be a finitely generated ideal such that $A/I \to B/IB$ is an isomorphism. For $K \in D_{I^\infty\text{-torsion}}(A)$ and $L \in D(A)$ the map $$ R\Hom_A(K, L) \longrightarrow R\Hom_B(K \otimes_A B, L \otimes_A B) $$ is a quasi-isomorphism. In particular, if $M$, $N$ are $A$-modules and $M$ is $I$-power torsion, then the canonical map $$ \Ext^i_A(M, N) \longrightarrow \Ext^i_B(M \otimes_A B, N \otimes_A B) $$ is an isomorphism for all $i$.  \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-noetherian} Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. \begin{enumerate} \item the adjunction $R\Gamma_I(K) \to K$ is an isomorphism for $K \in D_{I^\infty\text{-torsion}}(A)$, \item the functor (\ref{equation-compare-torsion}) $D(I^\infty\text{-torsion}) \to D_{I^\infty\text{-torsion}}(A)$ is an equivalence, \item the transformation of functors (\ref{equation-compare-torsion-functors}) is an isomorphism, in other words $R\Gamma_I(K) = R\Gamma_Z(K)$ for $K \in D(A)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-compute-local-cohomology-noetherian} Let $A$ be a Noetherian ring and let $I = (f_1, \ldots, f_r)$ be an ideal of $A$. Set $Z = V(I) \subset \Spec(A)$. There are canonical isomorphisms $$ R\Gamma_I(A) \to (A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to \prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to \ldots \to A_{f_1\ldots f_r}) \to R\Gamma_Z(A) $$ in $D(A)$. If $M$ is an $A$-module, then we have similarly $$ R\Gamma_I(M) \cong (M \to \prod\nolimits_{i_0} M_{f_{i_0}} \to \prod\nolimits_{i_0 < i_1} M_{f_{i_0}f_{i_1}} \to \ldots \to M_{f_1\ldots f_r}) \cong R\Gamma_Z(M) $$ in $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-change-rings} If $A \to B$ is a homomorphism of Noetherian rings and $I \subset A$ is an ideal, then in $D(B)$ we have $$ R\Gamma_I(A) \otimes_A^\mathbf{L} B = R\Gamma_Z(A) \otimes_A^\mathbf{L} B = R\Gamma_Y(B) = R\Gamma_{IB}(B) $$ where $Y = V(IB) \subset \Spec(B)$. \end{lemma} 
\begin{lemma} \label{lemma-depth} Let $A$ be a Noetherian ring, let $I \subset A$ be an ideal, and let $M$ be a finite $A$-module such that $IM \not = M$. Then the following integers are equal: \begin{enumerate} \item $\text{depth}_I(M)$, \item the smallest integer $i$ such that $\Ext_A^i(A/I, M)$ is nonzero, and \item the smallest integer $i$ such that $H^i_I(M)$ is nonzero. \end{enumerate} Moreover, we have $\Ext^i_A(N, M) = 0$ for $i < \text{depth}_I(M)$ for any finite $A$-module $N$ annihilated by a power of $I$. \end{lemma} 
\begin{lemma} \label{lemma-depth-in-ses} Let $A$ be a Noetherian ring. Let $0 \to N' \to N \to N'' \to 0$ be a short exact sequence of finite $A$-modules. Let $I \subset A$ be an ideal. \begin{enumerate} \item $\text{depth}_I(N) \geq \min\{\text{depth}_I(N'), \text{depth}_I(N'')\}$ \item $\text{depth}_I(N'') \geq \min\{\text{depth}_I(N), \text{depth}_I(N') - 1\}$ \item $\text{depth}_I(N') \geq \min\{\text{depth}_I(N), \text{depth}_I(N'') + 1\}$ \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-depth-drops-by-one} Let $A$ be a Noetherian ring, let $I \subset A$ be an ideal, and let $M$ a finite $A$-module with $IM \not = M$. \begin{enumerate} \item If $x \in I$ is a nonzerodivisor on $M$, then $\text{depth}_I(M/xM) = \text{depth}_I(M) - 1$. \item Any $M$-regular sequence $x_1, \ldots, x_r$ in $I$ can be extended to an $M$-regular sequence in $I$ of length $\text{depth}_I(M)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-depth-CM} Let $R$ be a Noetherian local ring. If $M$ is a finite Cohen-Macaulay $R$-module and $I \subset R$ a nontrivial ideal. Then $$ \text{depth}_I(M) = \dim(\text{Supp}(M)) - \dim(\text{Supp}(M/IM)). $$ \end{lemma} 
\begin{lemma} \label{lemma-depth-flat-CM} Let $R \to S$ be a flat local ring homomorphism of Noetherian local rings. Denote $\mathfrak m \subset R$ the maximal ideal. Let $I \subset S$ be an ideal. If $S/\mathfrak mS$ is Cohen-Macaulay, then $$ \text{depth}_I(S) \geq \dim(S/\mathfrak mS) - \dim(S/\mathfrak mS + I) $$ \end{lemma} 
\begin{lemma} \label{lemma-divide-by-torsion} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. Let $M$ be an $A$-module. Let $Z = V(I)$. Then $H^0_I(M) = H^0_Z(M)$. Let $N$ be the common value and set $M' = M/N$. Then \begin{enumerate} \item $H^0_I(M') = 0$ and $H^p_I(M) = H^p_I(M')$ and $H^p_I(N) = 0$ for all $p > 0$, \item $H^0_Z(M') = 0$ and $H^p_Z(M) = H^p_Z(M')$ and $H^p_Z(N) = 0$ for all $p > 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-complete-and-local} \begin{slogan} Results of this nature are sometimes referred to as Greenlees-May duality. \end{slogan} Let $A$ be a ring and let $I$ be a finitely generated ideal. Let $R\Gamma_Z$ be as in Lemma \ref{lemma-local-cohomology-adjoint}. Let ${\ }^\wedge$ denote derived completion as in More on Algebra, Lemma \ref{more-algebra-lemma-derived-completion}. For an object $K$ in $D(A)$ we have $$ R\Gamma_Z(K^\wedge) = R\Gamma_Z(K) \quad\text{and}\quad (R\Gamma_Z(K))^\wedge = K^\wedge $$ in $D(A)$. \end{lemma} 
\begin{proposition} \label{proposition-torsion-complete} \begin{reference} This is a special case of \cite[Theorem 1.1]{Porta-Liran-Yekutieli}. \end{reference} Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal. The functors $R\Gamma_Z$ and ${\ }^\wedge$ define quasi-inverse equivalences of categories $$ D_{I^\infty\text{-torsion}}(A) \leftrightarrow D_{comp}(A, I) $$ \end{proposition} 
\begin{lemma} \label{lemma-compare-RHom} With notation as in Lemma \ref{lemma-complete-and-local}. For objects $K, L$ in $D(A)$ there is a canonical isomorphism $$ R\Hom_A(K^\wedge, L^\wedge) \longrightarrow R\Hom_A(R\Gamma_Z(K), R\Gamma_Z(L)) $$ in $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-completion-local} Let $I$ and $J$ be ideals in a Noetherian ring $A$. Let $M$ be a finite $A$-module. Set $Z =V(J)$. Consider the derived $I$-adic completion $R\Gamma_Z(M)^\wedge$ of local cohomology. Then \begin{enumerate} \item we have $R\Gamma_Z(M)^\wedge = R\lim R\Gamma_Z(M/I^nM)$, and \item there are short exact sequences $$ 0 \to R^1\lim H^{i - 1}_Z(M/I^nM) \to H^i(R\Gamma_Z(M)^\wedge) \to \lim H^i_Z(M/I^nM) \to 0 $$ \end{enumerate} In particular $R\Gamma_Z(M)^\wedge$ has vanishing cohomology in negative degrees. \end{lemma} 
\begin{lemma} \label{lemma-completion-local-H0} With notation and hypotheses as in Lemma \ref{lemma-completion-local} assume $A$ is $I$-adically complete. Then $$ H^0(R\Gamma_Z(M)^\wedge) = \colim H^0_{V(J')}(M) $$ where the filtered colimit is over $J' \subset J$ such that $V(J') \cap V(I) = V(J) \cap V(I)$. \end{lemma} 
\begin{lemma} \label{lemma-right-adjoint} Let $A \to B$ be a ring homomorphism. The functor $R\Hom(B, -)$ constructed above is right adjoint to the restriction functor $D(B) \to D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-composition-right-adjoints} Let $A \to B \to C$ be ring maps. Then $R\Hom(C, -) \circ R\Hom(B, -) : D(A) \to D(C)$ is the functor $R\Hom(C, -) : D(A) \to D(C)$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-ext} Let $\varphi : A \to B$ be a ring homomorphism. For $K$ in $D(A)$ we have $$ \varphi_*R\Hom(B, K) = R\Hom_A(B, K) $$ where $\varphi_* : D(B) \to D(A)$ is restriction. In particular $R^q\Hom(B, K) = \Ext_A^q(B, K)$. \end{lemma} 
\begin{lemma} \label{lemma-exact-support-coherent} With notation as above, assume $A \to B$ is a finite ring map of Noetherian rings. Then $R\Hom(B, -)$ maps $D^+_{\textit{Coh}}(A)$ into $D^+_{\textit{Coh}}(B)$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-dga} In Situation \ref{situation-resolution} the functor $R\Hom(A, -)$ is equal to the composition of $R\Hom(E, -) : D(R) \to D(E, \text{d})$ and the equivalence $- \otimes^\mathbf{L}_E A : D(E, \text{d}) \to D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-is-tensor} In Situation \ref{situation-resolution} assume that \begin{enumerate} \item $E$ viewed as an object of $D(R)$ is compact, and \item $N = \Hom^\bullet_R(E^\bullet, R)$ computes $R\Hom(E, R)$. \end{enumerate} Then $R\Hom(E, -) : D(R) \to D(E)$ is isomorphic to $K \mapsto K \otimes_R^\mathbf{L} N$. \end{lemma} 
\begin{lemma} \label{lemma-RHom-is-tensor-special} In Situation \ref{situation-resolution} assume $A$ is a perfect $R$-module. Then $$ R\Hom(A, -) : D(R) \to D(A) $$ is given by $K \mapsto K \otimes_R^\mathbf{L} M$ where $M = R\Hom(A, R) \in D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-compute-for-effective-Cartier-algebraic} Let $R \to A$ be a surjective ring map whose kernel $I$ is an invertible $R$-module. The functor $R\Hom(A, -) : D(R) \to D(A)$ is isomorphic to $K \mapsto K \otimes_R^\mathbf{L} N[-1]$ where $N$ is inverse of the invertible $A$-module $I \otimes_R A$. \end{lemma} 
\begin{lemma} \label{lemma-check-base-change-is-iso} In the situation above, the map (\ref{equation-base-change}) is an isomorphism if and only if the map $$ R\Hom_R(A, K) \otimes_R^\mathbf{L} R' \longrightarrow R\Hom_R(A, K \otimes_R^\mathbf{L} R') $$ of More on Algebra, Lemma \ref{more-algebra-lemma-internal-hom-diagonal-better} is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-flat-bc-surjection} Let $R \to A$ and $R \to R'$ be ring maps and $A' = A \otimes_R R'$. Assume \begin{enumerate} \item $A$ is pseudo-coherent as an $R$-module, \item $R'$ has finite tor dimension as an $R$-module (for example $R \to R'$ is flat), \item $A$ and $R'$ are tor independent over $R$. \end{enumerate} Then (\ref{equation-base-change}) is an isomorphism for $K \in D^+(R)$. \end{lemma} 
\begin{lemma} \label{lemma-bc-surjection} Let $R \to A$ and $R \to R'$ be ring maps and $A' = A \otimes_R R'$. Assume \begin{enumerate} \item $A$ is perfect as an $R$-module, \item $A$ and $R'$ are tor independent over $R$. \end{enumerate} Then (\ref{equation-base-change}) is an isomorphism for all $K \in D(R)$. \end{lemma} 
\begin{definition} \label{definition-dualizing} Let $A$ be a Noetherian ring. A {\it dualizing complex} is a complex of $A$-modules $\omega_A^\bullet$ such that \begin{enumerate} \item $\omega_A^\bullet$ has finite injective dimension, \item $H^i(\omega_A^\bullet)$ is a finite $A$-module for all $i$, and \item $A \to R\Hom_A(\omega_A^\bullet, \omega_A^\bullet)$ is a quasi-isomorphism. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-finite-ext-into-bounded-injective} Let $A$ be a Noetherian ring. Let $K, L \in D_{\textit{Coh}}(A)$ and assume $L$ has finite injective dimension. Then $R\Hom_A(K, L)$ is in $D_{\textit{Coh}}(A)$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing} Let $A$ be a Noetherian ring. If $\omega_A^\bullet$ is a dualizing complex, then the functor $$ D : K \longmapsto R\Hom_A(K, \omega_A^\bullet) $$ is an anti-equivalence $D_{\textit{Coh}}(A) \to D_{\textit{Coh}}(A)$ which exchanges $D^+_{\textit{Coh}}(A)$ and $D^-_{\textit{Coh}}(A)$ and induces an anti-equivalence $D^b_{\textit{Coh}}(A) \to D^b_{\textit{Coh}}(A)$. Moreover $D \circ D$ is isomorphic to the identity functor. \end{lemma} 
\begin{lemma} \label{lemma-equivalence-comes-from-invertible} Let $A$ be a Noetherian ring. Let $F : D^b_{\textit{Coh}}(A) \to D^b_{\textit{Coh}}(A)$ be an $A$-linear equivalence of categories. Then $F(A)$ is an invertible object of $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-unique} Let $A$ be a Noetherian ring. If $\omega_A^\bullet$ and $(\omega'_A)^\bullet$ are dualizing complexes, then $(\omega'_A)^\bullet$ is quasi-isomorphic to $\omega_A^\bullet \otimes_A^\mathbf{L} L$ for some invertible object $L$ of $D(A)$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-localize} Let $A$ be a Noetherian ring. Let $B = S^{-1}A$ be a localization. If $\omega_A^\bullet$ is a dualizing complex, then $\omega_A^\bullet \otimes_A B$ is a dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-glue} Let $A$ be a Noetherian ring. Let $f_1, \ldots, f_n \in A$ generate the unit ideal. If $\omega_A^\bullet$ is a complex of $A$-modules such that $(\omega_A^\bullet)_{f_i}$ is a dualizing complex for $A_{f_i}$ for all $i$, then $\omega_A^\bullet$ is a dualizing complex for $A$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-finite} Let $A \to B$ be a finite ring map of Noetherian rings. Let $\omega_A^\bullet$ be a dualizing complex. Then $R\Hom(B, \omega_A^\bullet)$ is a dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-quotient} Let $A \to B$ be a surjective homomorphism of Noetherian rings. Let $\omega_A^\bullet$ be a dualizing complex. Then $R\Hom(B, \omega_A^\bullet)$ is a dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-polynomial-ring} Let $A$ be a Noetherian ring. If $\omega_A^\bullet$ is a dualizing complex, then $\omega_A^\bullet \otimes_A A[x]$ is a dualizing complex for $A[x]$. \end{lemma} 
\begin{proposition} \label{proposition-dualizing-essentially-finite-type} Let $A$ be a Noetherian ring which has a dualizing complex. Then any $A$-algebra essentially of finite type over $A$ has a dualizing complex. \end{proposition} 
\begin{lemma} \label{lemma-find-function} Let $A$ be a Noetherian ring. Let $\omega_A^\bullet$ be a dualizing complex. Let $\mathfrak m \subset A$ be a maximal ideal and set $\kappa = A/\mathfrak m$. Then $R\Hom_A(\kappa, \omega_A^\bullet) \cong \kappa[n]$ for some $n \in \mathbf{Z}$. \end{lemma} 
\begin{lemma} \label{lemma-normalized-finite} Let $(A, \mathfrak m, \kappa) \to (B, \mathfrak m', \kappa')$ be a finite local map of Noetherian local rings. Let $\omega_A^\bullet$ be a normalized dualizing complex. Then $\omega_B^\bullet = R\Hom(B, \omega_A^\bullet)$ is a normalized dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-normalized-quotient} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $A \to B$ be surjective. Then $\omega_B^\bullet = R\Hom_A(B, \omega_A^\bullet)$ is a normalized dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-equivalence-finite-length} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $F$ be an $A$-linear self-equivalence of the category of finite length $A$-modules. Then $F$ is isomorphic to the identity functor. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-finite-length} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $E$ be an injective hull of $\kappa$. Then there exists a functorial isomorphism $$ R\Hom_A(N, \omega_A^\bullet) = \Hom_A(N, E)[0] $$ for $N$ running through the finite length $A$-modules. \end{lemma} 
\begin{lemma} \label{lemma-sitting-in-degrees} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $M$ be a finite $A$-module and let $d = \dim(\text{Supp}(M))$. Then \begin{enumerate} \item if $\Ext^i_A(M, \omega_A^\bullet)$ is nonzero, then $i \in \{-d, \ldots, 0\}$, \item the dimension of the support of $\Ext^i_A(M, \omega_A^\bullet)$ is at most $-i$, \item $\text{depth}(M)$ is the smallest integer $\delta \geq 0$ such that $\Ext^{-\delta}_A(M, \omega_A^\bullet) \not = 0$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-local-CM} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $M$ be a finite $A$-module. The following are equivalent \begin{enumerate} \item $M$ is Cohen-Macaulay, \item $\Ext^i_A(M, \omega_A^\bullet)$ is nonzero for at most one $i$, \item $\Ext^{-i}_A(M, \omega_A^\bullet)$ is zero for $i \not = \dim(\text{Supp}(M))$. \end{enumerate} Denote $CM_d$ the category of finite Cohen-Macaulay $A$-modules of depth $d$. Then $M \mapsto \Ext^{-d}_A(M, \omega_A^\bullet)$ defines an anti-auto-equivalence of $CM_d$. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-artinian} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. If $\dim(A) = 0$, then $\omega_A^\bullet \cong E[0]$ where $E$ is an injective hull of the residue field. \end{lemma} 
\begin{lemma} \label{lemma-divide-by-finite-length-ideal} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex. Let $I \subset \mathfrak m$ be an ideal of finite length. Set $B = A/I$. Then there is a distinguished triangle $$ \omega_B^\bullet \to \omega_A^\bullet \to \Hom_A(I, E)[0] \to \omega_B^\bullet[1] $$ in $D(A)$ where $E$ is an injective hull of $\kappa$ and $\omega_B^\bullet$ is a normalized dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-divide-by-nonzerodivisor} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $f \in \mathfrak m$ be a nonzerodivisor. Set $B = A/(f)$. Then there is a distinguished triangle $$ \omega_B^\bullet \to \omega_A^\bullet \to \omega_A^\bullet \to \omega_B^\bullet[1] $$ in $D(A)$ where $\omega_B^\bullet$ is a normalized dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-nonvanishing-generically-local} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $\mathfrak p$ be a minimal prime of $A$ with $\dim(A/\mathfrak p) = e$. Then $H^i(\omega_A^\bullet)_\mathfrak p$ is nonzero if and only if $i = -e$. \end{lemma} 
\begin{lemma} \label{lemma-nonvanishing-generically} Let $A$ be a Noetherian ring. Let $\mathfrak p$ be a minimal prime of $A$. Then $H^i(\omega_A^\bullet)_\mathfrak p$ is nonzero for exactly one $i$. \end{lemma} 
\begin{lemma} \label{lemma-quotient-function} Let $A$ be a Noetherian ring and let $\omega_A^\bullet$ be a dualizing complex. Let $A \to B$ be a surjective ring map and let $\omega_B^\bullet = R\Hom(B, \omega_A^\bullet)$ be the dualizing complex for $B$ of Lemma \ref{lemma-dualizing-quotient}. Then we have $$ \delta_{\omega_B^\bullet} = \delta_{\omega_A^\bullet}|_{\Spec(B)} $$ \end{lemma} 
\begin{lemma} \label{lemma-dimension-function} Let $A$ be a Noetherian ring and let $\omega_A^\bullet$ be a dualizing complex. The function $\delta = \delta_{\omega_A^\bullet}$ defined above is a dimension function (Topology, Definition \ref{topology-definition-dimension-function}). \end{lemma} 
\begin{lemma} \label{lemma-universally-catenary} Let $A$ be a Noetherian ring which has a dualizing complex. Then $A$ is universally catenary of finite dimension. \end{lemma} 
\begin{lemma} \label{lemma-depth-dualizing-module} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Let $d = \dim(A)$ and $\omega_A = H^{-d}(\omega_A^\bullet)$. Then \begin{enumerate} \item the support of $\omega_A$ is the union of the irreducible components of $\Spec(A)$ of dimension $d$, \item $\omega_A$ satisfies $(S_2)$, see Algebra, Definition \ref{algebra-definition-conditions}. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-local-cohomology-of-dualizing} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $\omega_A^\bullet$ be a normalized dualizing complex. Let $Z = V(\mathfrak m) \subset \Spec(A)$. Then $E = R^0\Gamma_Z(\omega_A^\bullet)$ is an injective hull of $\kappa$ and $R\Gamma_Z(\omega_A^\bullet) = E[0]$. \end{lemma} 
\begin{theorem} \label{theorem-local-duality} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $\omega_A^\bullet$ be a normalized dualizing complex. Let $E$ be an injective hull of the residue field. Let $Z = V(\mathfrak m) \subset \Spec(A)$. Denote ${}^\wedge$ derived completion with respect to $\mathfrak m$. Then $$ R\Hom_A(K, \omega_A^\bullet)^\wedge \cong R\Hom_A(R\Gamma_Z(K), E[0]) $$ for $K$ in $D(A)$. \end{theorem} 
\begin{lemma} \label{lemma-special-case-local-duality} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $\omega_A^\bullet$ be a normalized dualizing complex. Let $E$ be an injective hull of the residue field. Let $K \in D_{\textit{Coh}}(A)$. Then $$ \Ext^{-i}_A(K, \omega_A^\bullet)^\wedge = \Hom_A(H^i_{\mathfrak m}(K), E) $$ where ${}^\wedge$ denotes $\mathfrak m$-adic completion. \end{lemma} 
\begin{lemma} \label{lemma-depth-in-terms-dualizing-complex} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$. Then $\text{depth}(A)$ is equal to the smallest integer $\delta \geq 0$ such that $H^{-\delta}(\omega_A^\bullet) \not = 0$. \end{lemma} 
\begin{lemma} \label{lemma-apply-CM} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring with normalized dualizing complex $\omega_A^\bullet$ and dualizing module $\omega_A = H^{-\dim(A)}(\omega_A^\bullet)$. The following are equivalent \begin{enumerate} \item $A$ is Cohen-Macaulay, \item $\omega_A^\bullet$ is concentrated in a single degree, and \item $\omega_A^\bullet = \omega_A[\dim(A)]$. \end{enumerate} In this case $\omega_A$ is a maximal Cohen-Macaulay module. \end{lemma} 
\begin{lemma} \label{lemma-has-dualizing-module-CM} Let $A$ be a Noetherian ring. If there exists a finite $A$-module $\omega_A$ such that $\omega_A[0]$ is a dualizing complex, then $A$ is Cohen-Macaulay. \end{lemma} 
\begin{lemma} \label{lemma-CM-open} Let $A$ be a Noetherian ring with dualizing complex $\omega_A^\bullet$. Let $M$ be a finite $A$-module. Then $$ U = \{\mathfrak p \in \Spec(A) \mid M_\mathfrak p\text{ is Cohen-Macaulay}\} $$ is an open subset of $\Spec(A)$ whose intersection with $\text{Supp}(M)$ is dense. \end{lemma} 
\begin{lemma} \label{lemma-CM} Let $A$ be a Noetherian ring. If $A$ has a dualizing complex $\omega_A^\bullet$, then $\{\mathfrak p \in \Spec(A) \mid A_\mathfrak p\text{ is Cohen-Macaulay}\}$ is a dense open subset of $\Spec(A)$. \end{lemma} 
\begin{definition} \label{definition-gorenstein} Gorenstein rings. \begin{enumerate} \item Let $A$ be a Noetherian local ring. We say $A$ is {\it Gorenstein} if $A[0]$ is a dualizing complex for $A$. \item Let $A$ be a Noetherian ring. We say $A$ is {\it Gorenstein} if $A_\mathfrak p$ is Gorenstein for every prime $\mathfrak p$ of $A$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-gorenstein-CM} A Gorenstein ring is Cohen-Macaulay. \end{lemma} 
\begin{lemma} \label{lemma-regular-gorenstein} A regular local ring is Gorenstein. A regular ring is Gorenstein. \end{lemma} 
\begin{lemma} \label{lemma-gorenstein} Let $A$ be a Noetherian ring. \begin{enumerate} \item If $A$ has a dualizing complex $\omega_A^\bullet$, then \begin{enumerate} \item $A$ is Gorenstein $\Leftrightarrow$ $\omega_A^\bullet$ is an invertible object of $D(A)$, \item $A_\mathfrak p$ is Gorenstein $\Leftrightarrow$ $(\omega_A^\bullet)_\mathfrak p$ is an invertible object of $D(A_\mathfrak p)$, \item $\{\mathfrak p \in \Spec(A) \mid A_\mathfrak p\text{ is Gorenstein}\}$ is an open subset. \end{enumerate} \item If $A$ is Gorenstein, then $A$ has a dualizing complex if and only if $A[0]$ is a dualizing complex. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-gorenstein-ext} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Then $A$ is Gorenstein if and only if $\Ext^i_A(\kappa, A)$ is zero for $i \gg 0$. \end{lemma} 
\begin{lemma} \label{lemma-gorenstein-divide-by-nonzerodivisor} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. Let $f \in \mathfrak m$ be a nonzerodivisor. Set $B = A/(f)$. Then $A$ is Gorenstein if and only if $B$ is Gorenstein. \end{lemma} 
\begin{lemma} \label{lemma-gorenstein-lci} If $A \to B$ is a local complete intersection homomorphism of rings and $A$ is a Noetherian Gorenstein ring, then $B$ is a Gorenstein ring. \end{lemma} 
\begin{lemma} \label{lemma-flat-under-gorenstein} Let $A \to B$ be a flat local homomorphism of Noetherian local rings. The following are equivalent \begin{enumerate} \item $B$ is Gorenstein, and \item $A$ and $B/\mathfrak m_A B$ are Gorenstein. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-tor-injective-hull} Let $(A, \mathfrak m, \kappa)$ be a Noetherian local Gorenstein ring of dimension $d$. Let $E$ be the injective hull of $\kappa$. Then $\text{Tor}_i^A(E, \kappa)$ is zero for $i \not = d$ and $\text{Tor}_d^A(E, \kappa) = \kappa$. \end{lemma} 
\begin{lemma} \label{lemma-flat-unramified} Let $A \to B$ be a local homomorphism of Noetherian local rings. Let $\omega_A^\bullet$ be a normalized dualizing complex. If $A \to B$ is flat and $\mathfrak m_A B = \mathfrak m_B$, then $\omega_A^\bullet \otimes_A B$ is a normalized dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-flat-iso-mod-I} Let $A \to B$ be a flat map of Noetherian rings. Let $I \subset A$ be an ideal such that $A/I = B/IB$ and such that $IB$ is contained in the Jacobson radical of $B$. Let $\omega_A^\bullet$ be a dualizing complex. Then $\omega_A^\bullet \otimes_A B$ is a dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-completion-henselization-dualizing} Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. Let $\omega_A^\bullet$ be a dualizing complex. \begin{enumerate} \item $\omega_A^\bullet \otimes_A A^h$ is a dualizing complex on the henselization $(A^h, I^h)$ of the pair $(A, I)$, \item $\omega_A^\bullet \otimes_A A^\wedge$ is a dualizing complex on the $I$-adic completion $A^\wedge$, and \item if $A$ is local, then $\omega_A^\bullet \otimes_A A^h$, resp.\ $\omega_A^\bullet \otimes_A A^{sh}$ is a dualzing complex on the henselization, resp.\ strict henselization of $A$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-ubiquity-dualizing} The following types of rings have a dualizing complex: \begin{enumerate} \item fields, \item Noetherian complete local rings, \item $\mathbf{Z}$, \item Dedekind domains, \item any ring which is obtained from one of the rings above by taking an algebra essentially of finite type, or by taking an ideal-adic completion, or by taking a henselization,  or by taking a strict henselization. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-gorenstein} Properties (A), (B), (C), (D), and (E) of More on Algebra, Section \ref{more-algebra-section-properties-formal-fibres} hold for $P(k \to R) =$``$R$ is a Gorenstein ring''. \end{lemma} 
\begin{lemma} \label{lemma-dualizing-gorenstein-formal-fibres} Let $A$ be a Noetherian local ring. If $A$ has a dualizing complex, then the formal fibres of $A$ are Gorenstein. \end{lemma} 
\begin{lemma} \label{lemma-formal-fibres-lci} Properties (A), (B), (C), (D), and (E) of More on Algebra, Section \ref{more-algebra-section-properties-formal-fibres} hold for $P(k \to R) =$``$R$ is a local complete intersection''. See Divided Power Algebra, Definition \ref{dpa-definition-lci}. \end{lemma} 
\begin{lemma} \label{lemma-well-defined} Let $\varphi : R \to A$ be a finite type homomorphism of Noetherian rings. The functor $\varphi^!$ is well defined up to isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-shriek-boundedness} Let $\varphi : R \to A$ be a finite type homomorphism of Noetherian rings. \begin{enumerate} \item $\varphi^!$ maps $D^+(R)$ into $D^+(A)$ and $D^+_{\textit{Coh}}(R)$ into $D^+_{\textit{Coh}}(A)$. \item if $\varphi$ is perfect, then $\varphi^!$ maps $D^-(R)$ into $D^-(A)$, $D^-_{\textit{Coh}}(R)$ into $D^-_{\textit{Coh}}(A)$, and $D^b_{\textit{Coh}}(R)$ into $D^b_{\textit{Coh}}(A)$. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-shriek-dualizing-algebraic} Let $\varphi$ be a finite type homomorphism of Noetherian rings. If $\omega_R^\bullet$ is a dualizing complex for $R$, then $\varphi^!(\omega_R^\bullet)$ is a dualizing complex for $A$. \end{lemma} 
\begin{lemma} \label{lemma-flat-bc} Let $R \to R'$ be a flat homomorphism of Noetherian rings. Let $\varphi : R \to A$ be a finite type ring map. Let $\varphi' : R' \to A' = A \otimes_R R'$ be the map induced by $\varphi$. Then we have a functorial maps $$ \varphi^!(K) \otimes_A^\mathbf{L} A' \longrightarrow (\varphi')^!(K \otimes_R^\mathbf{L} R') $$ for $K$ in $D(R)$ which are isomorphisms for $K \in D^+(R)$. \end{lemma} 
\begin{lemma} \label{lemma-bc} Let $R \to R'$ be a homomorphism of Noetherian rings. Let $\varphi : R \to A$ be a perfect ring map (More on Algebra, Definition \ref{more-algebra-definition-pseudo-coherent-perfect}) such that $R'$ and $A$ are tor independent over $R$. Let $\varphi' : R' \to A' = A \otimes_R R'$ be the map induced by $\varphi$. Then we have a functorial isomorphism $$ \varphi^!(K) \otimes_A^\mathbf{L} A' = (\varphi')^!(K \otimes_R^\mathbf{L} R') $$ for $K$ in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-bc-flat} Let $R \to R'$ be a homomorphism of Noetherian rings. Let $\varphi : R \to A$ be flat of finite type. Let $\varphi' : R' \to A' = A \otimes_R R'$ be the map induced by $\varphi$. Then we have a functorial isomorphism $$ \varphi^!(K) \otimes_A^\mathbf{L} A' = (\varphi')^!(K \otimes_R^\mathbf{L} R') $$ for $K$ in $D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-composition-shriek-algebraic} Let $A \xrightarrow{a} B \xrightarrow{b} C$ be finite type homomorphisms of Noetherian rings. Then there is a transformation of functors $b^! \circ a^! \to (b \circ a)^!$ which is an isomorphism on $D^+(A)$. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-finite} Let $\varphi : R \to A$ be a finite map of Noetherian rings. Then $\varphi^!$ is isomorphic to the functor $R\Hom(A, -) : D(R) \to D(A)$ from Section \ref{section-trivial}. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-localize} Let $R$ be a Noetherian ring and let $f \in R$. If $\varphi$ denotes the map $R \to R_f$, then $\varphi^!$ is isomorphic to $- \otimes_R^\mathbf{L} R_f$. More generally, if $\varphi : R \to R'$ is a map such that $\Spec(R') \to \Spec(R)$ is an open immersion, then $\varphi^!$ is isomorphic to $- \otimes_R^\mathbf{L} R'$. \end{lemma} 
\begin{lemma} \label{lemma-upper-shriek-is-tensor-functor} Let $\varphi : R \to A$ be a perfect homomorphism of Noetherian rings (for example $\varphi$ is flat of finite type). Then $\varphi^!(K) = K \otimes_R^\mathbf{L} \varphi^!(R)$ for $K \in D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-if-have-omega} Let $\varphi : A \to B$ be a finite type homomorphism of Noetherian rings. Let $\omega_A^\bullet$ be a dualizing complex for $A$. Set $\omega_B^\bullet = \varphi^!(\omega_A^\bullet)$. Denote $D_A(K) = R\Hom_A(K, \omega_A^\bullet)$ for $K \in D_{\textit{Coh}}(A)$ and $D_B(L) = R\Hom_B(L, \omega_B^\bullet)$ for $L \in D_{\textit{Coh}}(B)$. Then there is a functorial isomorphism $$ \varphi^!(K) = D_B(D_A(K) \otimes_A^\mathbf{L} B) $$ for $K \in D_{\textit{Coh}}(A)$. \end{lemma} 
\begin{lemma} \label{lemma-base-change-relative-algebraic} Let $R \to R'$ be a homomorphism of Noetherian rings. Let $R \to A$ be of finite type. Set $A' = A \otimes_R R'$. If \begin{enumerate} \item $R \to R'$ is flat, or \item $R \to A$ is flat, or \item $R \to A$ is perfect and $R'$ and $A$ are tor independent over $R$, \end{enumerate} then there is an isomorphism $\omega_{A/R}^\bullet \otimes_A^\mathbf{L} A' \to \omega^\bullet_{A'/R'}$ in $D(A')$. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-algebraic} Let $\varphi : R \to A$ be a finite type map of Noetherian rings. \begin{enumerate} \item If $\varphi$ is perfect, then \begin{enumerate} \item $\omega_{A/R}^\bullet$ is in $D^b_{\textit{Coh}}(A)$, \item $\omega_{A/R}^\bullet$ has finite tor dimension over $R$, and \item $A \to R\Hom_A(\omega_{A/R}^\bullet, \omega_{A/R}^\bullet)$ is an isomorphism. \end{enumerate} \item If $\varphi$ is flat, then (1)(a), (1)(b), and (1)(c) hold and \begin{enumerate} \item $\omega_{A/R}^\bullet$ is $R$-perfect (More on Algebra, Definition \ref{more-algebra-definition-relatively-perfect}), and \item for every map $R \to k$ to a field the base change $\omega_{A/R}^\bullet \otimes_A^\mathbf{L} (A \otimes_R k)$ is a dualizing complex for $A \otimes_R k$. \end{enumerate} \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-base-change-dualizing-over-field} Let $K/k$ be an extension of fields. Let $A$ be a finite type $k$-algebra. Let $A_K = A \otimes_k K$. If $\omega_A^\bullet$ is a dualizing complex for $A$, then $\omega_A^\bullet \otimes_A A_K$ is a dualizing complex for $A_K$. \end{lemma} 
\begin{lemma} \label{lemma-lci-shriek} Let $\varphi : R \to A$ be a local complete intersection homomorphism of Noetherian rings. Then $\omega_{A/R}^\bullet$ is an invertible object of $D(A)$ and $\varphi^!(K) = K \otimes_R^\mathbf{L} \omega_{A/R}^\bullet$ for all $K \in D(R)$. \end{lemma} 
\begin{lemma} \label{lemma-gorenstein-shriek} Let $\varphi : R \to A$ be a flat finite type homomorphism of Noetherian rings. The following are equivalent \begin{enumerate} \item the fibres $A \otimes_R \kappa(\mathfrak p)$ are Gorenstein for all primes $\mathfrak p \subset R$, and \item $\omega_{A/R}^\bullet$ is an invertible object of $D(A)$, see More on Algebra, Lemma \ref{more-algebra-lemma-invertible-derived}. \end{enumerate} \end{lemma} 
\begin{lemma} \label{lemma-shriek-normalized} Let $\varphi : R \to A$ be a finite type homomorphism of Noetherian rings. Assume $R$ local and let $\mathfrak m \subset A$ be a maximal ideal lying over the maximal ideal of $R$. If $\omega_R^\bullet$ is a normalized dualizing complex for $R$, then $\varphi^!(\omega_R^\bullet)_\mathfrak m$ is a normalized dualizing complex for $A_\mathfrak m$. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-trivial-vanishing} Let $R \to A$ be a finite type homomorphism of Noetherian rings. Let $\mathfrak q \subset A$ be a prime ideal lying over $\mathfrak p \subset R$. Then $$ H^i(\omega_{A/R}^\bullet)_\mathfrak q \not = 0 \Rightarrow - d \leq i $$ where $d$ is the dimension of the fibre of $\Spec(A) \to \Spec(R)$ over $\mathfrak p$ at the point $\mathfrak q$. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-flat-vanishing} Let $R \to A$ be a flat finite type homomorphism of Noetherian rings. Let $\mathfrak q \subset A$ be a prime ideal lying over $\mathfrak p \subset R$. Then $$ H^i(\omega_{A/R}^\bullet)_\mathfrak q \not = 0 \Rightarrow - d \leq i \leq 0 $$ where $d$ is the dimension of the fibre of $\Spec(A) \to \Spec(R)$ over $\mathfrak p$ at the point $\mathfrak q$. If all fibres of $\Spec(A) \to \Spec(R)$ have dimension $\leq d$, then $\omega_{A/R}^\bullet$ has tor amplitude in $[-d, 0]$ as a complex of $R$-modules. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-CM-vanishing} Let $R \to A$ be a finite type homomorphism of Noetherian rings. Let $\mathfrak p \subset R$ be a prime ideal. Assume \begin{enumerate} \item $R_\mathfrak p$ is Cohen-Macaulay, and \item for any minimal prime $\mathfrak q \subset A$ we have $\text{trdeg}_{\kappa(R \cap \mathfrak q)} \kappa(\mathfrak q) \leq r$. \end{enumerate} Then $$ H^i(\omega_{A/R}^\bullet)_\mathfrak p \not = 0 \Rightarrow - r \leq i $$ and $H^{-r}(\omega_{A/R}^\bullet)_\mathfrak p$ is $(S_2)$ as an $A_\mathfrak p$-module. \end{lemma} 
\begin{lemma} \label{lemma-descent} Let $A \to B$ be a faithfully flat map of Noetherian rings. If $K \in D(A)$ and $K \otimes_A^\mathbf{L} B$ is a dualizing complex for $B$, then $K$ is a dualizing complex for $A$. \end{lemma} 
\begin{lemma} \label{lemma-descent-ascent} Let $\varphi : A \to B$ be a homomorphism of Noetherian rings. Assume \begin{enumerate} \item $A \to B$ is syntomic and induces a surjective map on spectra, or \item $A \to B$ is a faithfully flat local complete intersection, or \item $A \to B$ is faithfully flat of finite type with Gorenstein fibres. \end{enumerate} Then $K \in D(A)$ is a dualizing complex for $A$ if and only if $K \otimes_A^\mathbf{L} B$ is a dualizing complex for $B$. \end{lemma} 
\begin{lemma} \label{lemma-injective-hull-goes-up} Let $(A, \mathfrak m, \kappa) \to (B, \mathfrak n, l)$ be a flat local homorphism of Noetherian rings such that $\mathfrak n = \mathfrak m B$. If $E$ is the injective hull of $\kappa$, then $E \otimes_A B$ is the injective hull of $l$. \end{lemma} 
\begin{lemma} \label{lemma-injective-goes-up} Let $\varphi : A \to B$ be a flat homorphism of Noetherian rings such that for all primes $\mathfrak q \subset B$ we have $\mathfrak p B_\mathfrak q = \mathfrak qB_\mathfrak q$ where $\mathfrak p = \varphi^{-1}(\mathfrak q)$, for example if $\varphi$ is \'etale. If $I$ is an injective $A$-module, then $I \otimes_A B$ is an injective $B$-module. \end{lemma} 
\begin{definition} \label{definition-relative-dualizing-complex} Let $R \to A$ be a flat ring map of finite presentation. A {\it relative dualizing complex} is an object $K \in D(A)$ such that \begin{enumerate} \item $K$ is $R$-perfect (More on Algebra, Definition \ref{more-algebra-definition-relatively-perfect}), and \item $R\Hom_{A \otimes_R A}(A, K \otimes_A^\mathbf{L} (A \otimes_R A))$ is isomorphic to $A$. \end{enumerate} \end{definition} 
\begin{lemma} \label{lemma-uniqueness-relative-dualizing} Let $R \to A$ be a flat ring map of finite presentation. Any two relative dualizing complexes for $R \to A$ are isomorphic. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-noetherian} Let $\varphi : R \to A$ be a flat finite type ring map of Noetherian rings. Then the relative dualizing complex $\omega_{A/R}^\bullet = \varphi^!(R)$ of Section \ref{section-relative-dualizing-complexes-Noetherian} is a relative dualizing complex in the sense of Definition \ref{definition-relative-dualizing-complex}. \end{lemma} 
\begin{lemma} \label{lemma-base-change-relative-dualizing} Let $R \to A$ be a flat ring map of finite presentation. Then \begin{enumerate} \item there exists a relative dualizing complex $K$ in $D(A)$, and \item for any ring map $R \to R'$ setting $A' = A \otimes_R R'$ and $K' = K \otimes_A^\mathbf{L} A'$, then $K'$ is a relative dualizing complex for $R' \to A'$. \end{enumerate} Moreover, if $$ \xi : A \longrightarrow K \otimes_A^\mathbf{L} (A \otimes_R A) $$ is a generator for the cyclic module $\Hom_{D(A \otimes_R A)}(A, K \otimes_A^\mathbf{L} (A \otimes_R A))$ then in (2) the derived base change of $\xi$ by $A \otimes_R A \to A' \otimes_{R'} A'$ is a generator for the cyclic module $\Hom_{D(A' \otimes_{R'} A')}(A', K' \otimes_{A'}^\mathbf{L} (A' \otimes_{R'} A'))$ \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-RHom} Let $R \to A$ be a flat ring map of finite presentation. Let $K$ be a relative dualizing complex. Then $A \to R\Hom_A(K, K)$ is an isomorphism. \end{lemma} 
\begin{lemma} \label{lemma-relative-dualizing-composition} Let $R \to A \to B$ be a ring maps which are flat and of finite presentation. Let $K_{A/R}$ and $K_{B/A}$ be relative dualizing complexes for $R \to A$ and $A \to B$. Then $K = K_{A/R} \otimes_A^\mathbf{L} K_{B/A}$ is a relative dualizing complex for $R \to B$. \end{lemma} 
